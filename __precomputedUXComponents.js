function PRECOMPUTEDUX_2dd2f631bf924252925d9adc2a7e4fed_listofreceipts(go) { 
var jsout = [
'A5.u.element.setContent(\'{UXPRERENDEROUTPUTDIV}\',\'<div class="page  pulse "><style type="text/css">\\n.iconSizeable {\\n  vertical-align: middle;\\n  height: auto;\\n  width: auto;\\n  fill: #000;\\n  stroke: #000; }\\n.iconDisabled {\\n  opacity: .75; }\\n.icon {\\n  vertical-align: middle;\\n  width: 26px;\\n  height: 26px; }\\n</style>\\n<style>\\n</style><iframe style="display:none;" id="{UXPRERENDEREDALIAS}.__IFRAME1"></iframe>\\n<input type="hidden" value="" id="{UXPRERENDEREDALIAS}.PARAMETERBUCKET"/>\\n<input type="file" style="position:absolute; top:-1000px;visibility:hidden;" capture accept="image/*" id="{UXPRERENDEREDALIAS}._GETPHOTO"/><input type="file" style="position:absolute; top:-1000px;visibility:hidden;" name="files[]" multiple = "" id="{UXPRERENDEREDALIAS}._GETFILEMULTI"/><input type="file" style="position:absolute; top:-1000px;visibility:hidden;" name="files[]" id="{UXPRERENDEREDALIAS}._GETFILE"/></div>\');',
'',
'//mark 2',
'',
'if(typeof A5.pickers == \'undefined\'){\t',
'/*',
'Copyright (c) 2001, 2024 Alpha Software Corporation',
'All Rights Reserved.',
'This JavaScript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'A5.pickers={_:{pi:0,pci:{}},u:{get:function(id){var p=A5.pickers._.pci[id];if(!p)p=null;return p;}},guides:{\'list\':{display:{mode:\'flex\',width:\'stretch\',height:\'max\'},settings:{height:\'300px\',multiple:false,separator:\', \',selectionMode:\'default\',allowNullSelection:true,allowNullDeselection:true,filter:{allow:false,edit:{className:\'\'}},data:{filter:false,order:false,wait:{message:\'Loading...\'},empty:{message:\'No Results...\'}},item:{className:\'\',style:\'\'},onSelect:false},autoFilter:function(d){if(!this._.re)return true;if(typeof d==\'object\'&&d!=null){if(typeof d.type==\'string\'&&d.type==\'title\')return false;if(typeof d.value==\'string\'&&d.value.search(this._.re)!=-1)return true;if(typeof d.html==\'string\'&&d.html.search(this._.re)!=-1)return true;}else if(typeof d==\'string\'&&d.search(this._.re)!=-1)return true;return false;},processData:function(d,s,c){if(!d||d.constructor!=Array)return[];var f=s.data.filter;var changed=false;c._.re=false;if(f==\'contains\'||f==\'starts-with\'){var v=c.state.value.current;if(v!=\'\'&&v!=null){var re=\'\';if(f==\'contains\')re=new RegExp(String(v).escapeRegExp(),\'i\');else if(f==\'starts-with\')re=new RegExp(\'^\'+String(v).escapeRegExp(),\'i\');f=this.autoFilter;c._.re=re;}else f=false;}',
'if(typeof f==\'function\'){var td=[];for(var i=0;i<d.length;i++){if(f.call(c,d[i]))td.push(d[i]);}',
'if(!c._.re)changed=true;else{if(td.length!=1)changed=true;else if(typeof td[0]==\'string\'&&td[0]!=v)changed=true;else if(typeof td[0]==\'object\'&&td[0].value!=v)changed=true;}',
'if(changed)d=td;}',
'if(s.data.order){A5.u.array.order(d,s.data.order,this);changed=true;}',
'if(changed){var td=[];var di=null;for(var i=0;i<d.length;i++){di=d[i];if(typeof di==\'string\'||(typeof di==\'object\'&&!(typeof di.type==\'string\'&&di.type==\'title\')))td.push(di);}',
'd=td;}',
'return d;},init:function(ele,inst){var tl={};A5.themes.assign(tl,this.theme,\'listbox\');var id=ele.id+\'.\';inst.ctrl=new A5.ViewBox(ele.id,[],{pid:inst.id,allowAnyValue:true,allowNullSelection:true,allowNullDeselection:true,onChange:function(){var p=A5.pickers.u.get(this.pid);var c=[];var dj=null;var vi=null;for(var i=0;i<this.value.length;i++){vi=this.value[i];for(var j=0;j<this.data.length;j++){dj=this.data[j];if(typeof dj==\'object\'&&dj!=null){if(typeof dj.type==\'undefined\'||dj.type!=\'title\'){if(dj.value==vi)c.push(dj);}}else if(vi==dj)c.push(dj);}}',
'p.state.value.context=c;},items:{\'list-item\':{selectable:true,selectedClassName:tl.item.selectedClassName,onClick:function(v,ia,ele,e){A5.pickers.u.get(this.pid).commit(!this.multiple);}}},wrapper:{allow:true,html:\'<div class="\'+tl.header.className+\'" style="display: none;">Header</div><div a5-layout-target="true" style="flex: 1 1;"></div>\'},layout:\'list\',layouts:{\'list\':{type:\'template\',template:[\'{*if [root].length == 0}<div id="\'+id+\'EMPTY" class="\'+tl.item.className+\'"">{[scope].emptyMsg}</div>{*endif}\',\'{*root}\',\'{*if typeof [value] != \\\'object\\\'}\',\'<div id="\'+id+\'{[count]}" class="\'+tl.item.className+\' {[scope].getItemClassName([value])}" style="{[scope].getItemStyle([value])}" onmouseover="A5.u.element.cls(this,\\\'+=\'+tl.item.hoverClassName+\'\\\')" onmouseout="A5.u.element.cls(this,\\\'-=\'+tl.item.hoverClassName+\'\\\')" a5-item="list-item:{[count]}" a5-value="{[value]}">{[value]}</div>\',\'{*elseif <defined<type>> && type == \\\'title\\\'}\',\'<div class="\'+tl.item.titleClassName+\'">{html}</div>\',\'{*else}\',\'<div id="\'+id+\'{[count]}" class="\'+tl.item.className+\' {[scope].getItemClassName([value])}" style="{[scope].getItemStyle([value])}" onmouseover="A5.u.element.cls(this,\\\'+=\'+tl.item.hoverClassName+\'\\\')" onmouseout="A5.u.element.cls(this,\\\'-=\'+tl.item.hoverClassName+\'\\\')" a5-item="list-item:{[count]}" a5-value="{value}">{*if <defined<[value].html>>}{html}{*else}{text:escape}{*endif}</div>\',\'{*endif}\',\'{/*root}\'].join(\'\')},\'wait\':{type:\'template\',template:\'<div id="\'+id+\'WAIT" class="\'+tl.item.className+\'"">{[scope].waitMsg}</div>{*root}{/*root}\'}},getItemClassName:function(d){var v=this._itemCls;var t=typeof v;if(t==\'function\')return v(d);else if(t==\'string\')return v;return\'\';},getItemStyle:function(d){var v=this._itemStyle;var t=typeof v;if(t==\'function\')return v(d);else if(t==\'string\')return v;return\'\';}});ele.style.flexDirection=\'column\';A5.u.drag.add(ele,\'scroll\',{axis:\'y\'});},show:function(inst,st){var s=st.picker.settings;inst.element.style.maxHeight=s.height;inst.ctrl.multiple=s.multiple;inst.ctrl.selectionMode=s.selectionMode;inst.ctrl.allowNullSelection=s.allowNullSelection;inst.ctrl.allowNullDeselection=s.allowNullDeselection;inst.ctrl._itemCls=s.item.className;inst.ctrl._itemStyle=s.item.style;var d=null;if(st.data&&st.data.constructor==Array)d=st.data;else{if(inst.ctrl.layout!=\'wait\')inst.ctrl.layout=\'wait\';inst.ctrl.waitMsg=s.data.wait.message;inst.ctrl.refresh();return false;}',
'inst.ctrl.emptyMsg=s.data.empty.message;if(inst.ctrl.layout==\'wait\')inst.ctrl.layout=\'list\';d=inst.def.processData(d,s,this);inst.ctrl.populate(d);var vals=st.value.current;if(s.multiple&&vals.constructor!=Array){if(s.separator)vals=vals.split(s.separator);else vals=[vals];if(vals.join(\'\')==\'\')vals=[];}',
'inst.ctrl.setValue(vals);},update:function(type,inst,st){var s=st.picker.settings;var ud=type.indexOf(\'data\')!=-1;if(s.data.filter||s.data.order||ud){if(ud)inst.ctrl.layout=st.data?\'list\':\'wait\';var d=inst.def.processData(st.data,s,this);inst.ctrl.populate(d);var vals=st.value.current;if(s.multiple&&vals.constructor!=Array){if(s.separator)vals=vals.split(s.separator);else vals=[vals];}',
'inst.ctrl.setValue(vals);}},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst&&(name==\'first\'||name==\'last\'||name==\'prev\'||name==\'previous\'||name==\'next\')){if(inst.ctrl.selectionInfo.active.has)inst.ctrl.navigate(name);else inst.ctrl.navigate(\'first\');}},commit:function(inst,st){var s=st.picker.settings;if(s.multiple){var v=A5.u.array.unique(inst.ctrl.value);if(s.separator)return v.join(s.separator);else return v;}else return inst.ctrl.value.length>0?inst.ctrl.value[0]:null;}},\'date-time\':{display:{mode:\'\',width:\'\',height:\'max\'},settings:{format:A5.d.date.format},init:function(ele,inst){ele.style.textAlign=\'center\';ele.innerHTML=\'<div id="\'+ele.id+\'.C" style="display: inline-block;"></div>\'',
'inst.ctrl=new A5.DateTimePicker(ele.children[0].id,{theme:this.theme,pid:inst.id,datePicker:{navigator:{header:{todayButton:{show:true}}}},combinedContainer:{buttons:{show:\'auto\'}},onCommit:function(){A5.pickers.u.get(this.pid).commit();},onCancel:function(){A5.pickers.u.get(this.pid).cancel();}});},show:function(inst,st){var s=st.picker.settings;inst.ctrl.setFormat(s.format);var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},update:function(type,inst,st){var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst){var dpp=inst.ctrl._dp._curPane[0];if(name[0]==\'p\'){if(dpp==\'y\')inst.ctrl._dp.prevDecade();else if(dpp==\'m\')inst.ctrl._dp.prevYear();else inst.ctrl._dp.prevMonth();}else if(name[0]==\'n\'){if(dpp==\'y\')inst.ctrl._dp.nextDecade();else if(dpp==\'m\')inst.ctrl._dp.nextYear();else inst.ctrl._dp.nextMonth();}}},commit:function(inst,st){return inst.ctrl.date.toFormat(st.picker.settings.format);}},\'date\':{display:{mode:\'\',width:\'\',height:\'max\'},settings:{format:A5.d.date.format},init:function(ele,inst){ele.style.textAlign=\'center\';ele.innerHTML=\'<div id="\'+ele.id+\'.C" style="display: inline-block;"></div>\';inst.ctrl=new A5.DatePicker(ele.children[0].id,{theme:this.theme,pid:inst.id,navigator:{header:{todayButton:{show:true}}},onClick:function(){A5.pickers.u.get(this.pid).commit();}});},show:function(inst,st){var s=st.picker.settings;inst.ctrl.setFormat(s.format);var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},update:function(type,inst,st){var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst){var dpp=inst.ctrl._curPane[0];if(name[0]==\'p\'){if(dpp==\'y\')inst.ctrl.prevDecade();else if(dpp==\'m\')inst.ctrl.prevYear();else inst.ctrl.prevMonth();}else if(name[0]==\'n\'){if(dpp==\'y\')inst.ctrl.nextDecade();else if(dpp==\'m\')inst.ctrl.nextYear();else inst.ctrl.nextMonth();}}},commit:function(inst,st){return inst.ctrl.date.toFormat(st.picker.settings.format);}}}}',
'A5.Picker=Class.create({initialize:function(s){A5.u.object.assign(this,{theme:\'\',layout:\'\',layouts:{},onBeforeShow:false,onShow:false,onBeforeCommit:false,onCommit:false,onBeforeCancel:false,onCancel:false,onBeforeHide:false,onHide:false,onBeforeDestroy:false,onDestroy:false,state:{}});A5.u.object.assign(this,s);this._={id:\'A5PICKER.\'+A5.pickers._.pi,update:function(p,st,val){var stb=st.binding;if(stb.type==\'element\'){var be=$(stb.id);val=$gvs(be);var tn=be.tagName.toLowerCase()',
'if(this.state==\'show\'&&(tn==\'input\'||tn==\'textarea\')){be.focus();be.select();}}else if(stb.type==\'path\')val=A5.u.object.get(st.context,stb.path);if(this.process)val=this.process.call(p,val,st.data,st.context,st.scope);if(this.state==\'show\')st.value.initial=val;st.value.current=val;},hide:function(p){if(p.state.shown){if(typeof p.onBeforeHide==\'function\'){var res=p.onBeforeHide();if(typeof res==\'boolean\'&&!res)return false;}',
'var st=p.state;st.shown=false;var stb=st.binding;var def=p._.picker.def;if(typeof def.hide==\'function\')def.hide.call(p,p._.picker,st);p._.trans.hide();if(typeof p.onHide==\'function\')p.onHide();}},state:\'\',pickers:{},dState:{shown:false,instanceId:\'\',picker:{type:\'\',settings:null},target:{type:\'\',id:\'\',data:null,position:null},binding:{type:\'\',path:\'\',id:\'\'},value:{initial:\'\',current:\'\',context:null},data:null,context:null,scope:null}}',
'A5.u.object.assign(this.state,this._.dState);this._.trans=new A5.Transient({theme:this.theme,pickerId:this._.id,layout:this.layout,layouts:this.layouts,onShown:function(){var pObj=A5.pickers._.pci[this.pickerId];var def=pObj._.picker.def;if(typeof def.shown==\'function\')def.shown.call(pObj,pObj._.picker,pObj.state);},onHidden:function(){var pObj=A5.pickers._.pci[this.pickerId];pObj.state.shown=false;pObj._.state=\'hidden\';var def=pObj._.picker.def;if(typeof def.hidden==\'function\')def.hidden.call(pObj,pObj._.picker,pObj.state);pObj._.bs=null;pObj._.picker=null;A5.u.object.assign(pObj.state,pObj._.dState);}});this._.trans._.ele.style.zIndex=\'500\';A5.pickers._.pi++;A5.pickers._.pci[this._.id]=this;},destroy:function(){if(typeof this.onBeforeDestroy==\'function\')this.onBeforeDestroy.call(this);var po=null;for(var pn in this._.pickers){po=this._.pickers[pn];if(typeof po.destroy==\'function\')po.destroy();}',
'this._.trans.destroy();if(typeof this.onDestroy==\'function\')this.onDestroy.call(this);},setLayout:function(l){this._.trans.setLayout(l);},show:function(pt,t,b,d,ps,c,sc){var zIndx=500;if(typeof A5.Window!=\'undefined\')zIndx=Math.max(zIndx,A5.Window.prototype._maxDlgZIndx[0]);this._.trans._.ele.style.zIndex=\'\'+(zIndx+1);var def=A5.pickers.guides[pt];if(!def)return false;var s=null;if(!ps)var ps=def.settings;else A5.u.object.assign(ps,def.settings,true);if(!this._.pickers[pt]){var ele=document.createElement(\'div\');ele.id=this._.id+\'.\'+pt;ele.style.display=\'none\';this._.pickers[pt]={element:ele,def:def,id:this._.id};s=this._.pickers[pt];var cEle=this._.trans.getElement(\'content\');cEle.appendChild(ele);def.init.call(this,ele,s);}else s=this._.pickers[pt];if(s){if(typeof this.onBeforeShow==\'function\'){var res=this.onBeforeShow();if(typeof res==\'boolean\'&&!res)return false;}',
'this._.state=\'show\';var cEle=this._.trans.getElement(\'content\');for(var i=0;i<cEle.children.length;i++)cEle.children[i].style.display=\'none\';var st=this.state;st.picker.settings=ps;if(typeof d==\'string\'){if(this.data[d])d=this.data[d];else if(d[0]==\'*\'){d=d.substr(1);var dlc=d.toLowerCase();var td=null;var mIndx=[\'month\',\'month:0\',\'month:1\',\'mon\',\'mon:0\',\'mon:1\'].indexOf(dlc)',
'if(mIndx>=0&&mIndx<6){if(mIndx<3)td=[].concat(A5.d.date.months);else td=[].concat(A5.d.date.monthsShort);if(d[0]==\'M\'){var tc=\'proper\';if(d[1]==\'O\')tc=\'upper\'',
'for(var i=0;i<td.length;i++)td[i]=td[i].toCase(tc);}',
'if(mIndx==1||mIndx==4){for(var i=0;i<td.length;i++)td[i]={html:td[i],value:i};}else if(mIndx==2||mIndx==5){for(var i=0;i<td.length;i++)td[i]={html:td[i],value:i+1};}else{for(var i=0;i<td.length;i++)td[i]={html:td[i],value:td[i]};}',
'this.data[\'*\'+d]=td;d=td;}else return false;}else d=null;}',
'st.data=typeof d==\'object\'?d:null;st.context=typeof c==\'object\'?c:null;st.scope=typeof sc==\'object\'||typeof sc==\'function\'?sc:null;if(typeof t==\'object\'&&t!=null&&typeof t.id==\'string\'){if(t.id==\'\')t.id=A5.u.getUniqueId();t=t.id;}',
'if(typeof t==\'string\'){st.target.type=\'element\';st.target.id=t;}else if(typeof t==\'object\'&&t!=null){st.target.type=\'custom\';st.target.data=t;}else st.target.type=\'none\';var cancel=false;var val=null;if(typeof b==\'string\')b=$(b);if(typeof b==\'object\'){if(b.tagName){st.binding.type=\'element\';st.binding.id=b.id;}else{if(b.path){st.binding.type=\'path\';st.binding.path=b.path;}else if(b.element){st.binding.type=\'element\';var be=$(b.element);if(!be)cancel=true;st.binding.id=be.id;}else{b.type=\'custom\';if(typeof b.value!=\'undefined\')val=b.value;else cancel=true;}',
'this._.process=b.process||null;}}',
'if(cancel){A5.u.object.assign(st,this._.dState);this._.state=\'hidden\';return false;}',
'this._.picker=s;st.instanceId=pt+\'@\'+Date.now();this._.update(this,st,val);if(typeof def.show==\'function\')def.show.call(this,s,st);s.element.style.display=def.display.mode;this._.trans.show(t);st.shown=true;this._.state=\'shown\';if(typeof this.onShow==\'function\')this.onShow();return st.instanceId;}',
'return false;},update:function(t,d){if(this.state.shown){var st=this.state;var iid=typeof arguments[2]!=\'undefined\'?arguments[2]:st.instanceId;if(iid==st.instanceId){if(typeof t==\'string\'){t=[t];d=[d];}',
'var tt=\'\';var td=\'\';for(var i=0;i<t.length;i++){tt=t[i];td=d[i]||null;if(tt==\'value\')this._.update(this,st,td);else if(td){if(tt==\'data\')st.data=td;else if(tt==\'context\')st.context=td;else if(tt==\'scope\')st.scope=td;}}',
'var def=this._.picker.def;if(typeof def.update==\'function\')def.update.call(this,t,this._.picker,st);this._.trans.refresh();}}},focus:function(){var s=false;var iid=arguments[2]||this.state.instanceId;var pt=iid.split(\'@\')[0];s=this._.pickers[pt];if(s){var def=A5.pickers.guides[pt];if(typeof def.focus==\'function\')return def.focus.call(this,s,this.state,iid==this.state.instanceId,pt==this.state.type);}',
'return false;},action:function(an){var s=false;var args=arguments[1]||null;var iid=arguments[2]||this.state.instanceId;var pt=iid.split(\'@\')[0];s=this._.pickers[pt];if(s){var def=A5.pickers.guides[pt];if(typeof def.action==\'function\'){var res=def.action.call(this,an,args,s,this.state,iid==this.state.instanceId,pt==this.state.type);if(res||typeof res==\'undefined\')this._.trans.refresh();}}},commit:function(){if(this.state.shown){var hide=typeof arguments[0]==\'boolean\'?arguments[0]:true;var iid=typeof arguments[1]==\'string\'?arguments[1]:this.state.instanceId;if(iid==this.state.instanceId){if(typeof this.onBeforeCommit==\'function\'){var res=this.onBeforeCommit(hide);if(typeof res==\'boolean\'&&!res)return false;}',
'this._.state=\'commit\';var val=this._.picker.def.commit.call(this,this._.picker,this.state);var st=this.state;var stb=st.binding;if(typeof st.value.initial==\'number\'&&typeof val==\'string\'&&val==Number(val))val=Number(val);st.value.current=val;if(stb.type==\'element\'){$svs(stb.id,val);$e.execute(stb.id,\'change\');}else if(stb.type==\'path\')A5.u.object.set(st.context,stb.path,val);if(typeof this.onCommit==\'function\')this.onCommit(hide);if(hide){if(!this._.hide(this))return false;}',
'return val;}}},cancel:function(){if(this.state.shown){var iid=typeof arguments[0]!=\'undefined\'?arguments[0]:this.state.instanceId;if(iid==this.state.instanceId){if(typeof this.onBeforeCancel==\'function\'){var res=this.onBeforeCancel();if(typeof res==\'boolean\'&&!res)return false;}',
'if(!this._.hide(this))return false;if(typeof this.onCancel==\'function\')this.onCancel();}}}});}',
'if(!A5.controlBar) { \t',
'/*',
'Copyright (c) 2001, 2024 Alpha Software Corporation',
'All Rights Reserved.',
'This JavaScript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'A5.controlBar={disclosure:{defaultContainer:\'\'},items:{\'html\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',html:\'\',bind:{show:\'\'}},true);var html=s.html;html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;}},\'button\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,style:\'\'},actions:{},bind:{show:\'\',disabled:\'\'},autoHideDisclosure:\'auto\'},true);s.settings.style=\'width: 100%;\'+s.settings.style;if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;var html=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'\',true);if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'disabled\',true);html=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+html+\'{*endif}\';}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(item.settings.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),item.settings.pressedIcon);A5.buttons._p[id]={c:pcn,i:item.settings.icon};}else A5.buttons._p[id]=pcn;}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'button-toggle\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,style:\'\',type:\'two-state\',keepPressed:true},actions:{},bind:{value:\'\',data:\'\',show:\'\',disabled:\'\'},autoHideDisclosure:\'auto\'},true);s.settings.style=\'width: 100%;\'+s.settings.style;if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;if(s.settings.type==\'multi-state\'){var sStr=JSON.stringify(s.settings);sStr=sStr.replace(/\\{/g,\'\\\\{\');sStr=sStr.replace(/\\}/g,\'\\\\}\');sStr=sStr.replace(/:/g,\'\\\\:\');var html=\'{A5.buttons.html(\\\'\'+id+\'\\\',function(od)\\\\{var o = \'+sStr+\'; $u.o.assign(o,od); return o;\\\\}(\'+s.bind.data+\'[\'+s.bind.value+\']),\\\'a5-item="\'+name+\'"\\\')}\';}else{var html=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'\',true);if(s.settings.keepPressed){html=\'{*if \'+s.bind.value+\'}\'+A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'pressed\',true)+\'{*else}\'+html+\'{*endif}\';}',
'if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'disabled\',true);html=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+html+\'{*endif}\';}}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(item.settings.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),item.settings.pressedIcon);A5.buttons._p[id]={c:pcn,i:item.settings.icon};}else A5.buttons._p[id]=pcn;}',
'if(type==\'click\'){var curV=A5.u.object.get(this.data,item.bind.value);if(item.settings.type==\'multi-state\'){curV++;var d=A5.u.object.get(this.data,item.bind.data);if(curV>=d.length)curV=0;this.update(item.bind.value,curV);}else{this.update(item.bind.value,!curV);}}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'button-list\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,allowNullSelection:false,multiple:false,className:\'\',nullSelectionClassName:\'\',button:{keepPressed:true}},actions:{},bind:{data:\'\',value:\'\',show:\'\'},autoHideDisclosure:\'auto\'},true);var ts={};A5.themes.assign(ts,s.settings.theme,\'buttonList\');$u.o.assign(s.settings,ts,true);var sStr=JSON.stringify(s.settings);sStr=sStr.replace(/\\{/g,\'\\\\{\');sStr=sStr.replace(/\\}/g,\'\\\\}\');sStr=sStr.replace(/:/g,\'\\\\:\');var html=\'{A5.buttonLists.html(\\\'\'+id+\'\\\',\'+sStr+\',\'+s.bind.data+\',\'+$if(s.settings.button.keepPressed,s.bind.value,\'\\\'\\\'\')+\',\\\'a5-item="\'+name+\'" a5-value="\\\\{index\\\\}"\\\')}\';var cStyle=\'\';if(s.size==\'\')cStyle=\' style="display: inline-block;"\';if(s.settings.nullSelectionClassName!=\'\'){html=\'<div class="\'+s.settings.className+\'{*if (\'+s.bind.value+\').toString() == \\\'\\\'}\'+s.settings.nullSelectionClassName+\'{*endif}"\'+cStyle+\'>\'+html+\'</div>\';}else{html=\'<div class="\'+s.settings.className+\'"\'+cStyle+\'>\'+html+\'</div>\';}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.button.pressedClassName;if(pcn!=\'\'){$acn(ele,pcn);A5.buttons._p[id]=pcn;}}',
'if(type==\'click\'){var d=A5.u.object.get(this.data,item.bind.data);var v=d[Number(value)];if(v){if(typeof v==\'object\'){v=v.value;}',
'var curV=A5.u.object.get(this.data,item.bind.value);if(item.settings.multiple){if(curV.constructor==Array){var cIndx=curV.indexOf(v);if(cIndx==-1){curV.push(v);v=curV;}else curV.splice(cIndx,1);if(item.settings.allowNullSelection===false&&curV.length==0)v=[v];else v=curV;}else console.log(\'ERROR - button-list value must be array if multiple select is set to true.\');}else{if(item.settings.allowNullSelection===true&&v.toString()==curV.toString()){if(curV.constructor==Array)v=[];else v=\'\';}else if(curV.constructor==Array)v=[v];}',
'this.update(item.bind.value,v);}}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'disclosure-button\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',autoHideDisclosure:\'always\',disclosure:{name:\'\',type:\'\'},actions:{},settings:{show:{theme:theme,style:\'\'},hide:{theme:theme,style:\'\'}},bind:{show:\'\',disabled:\'\'}},true);s.settings.show.style=\'width: 100%;\'+s.settings.show.style;s.settings.hide.style=\'width: 100%;\'+s.settings.hide.style;if(s.size!=\'\'){s.settings.show.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.show.style;s.settings.hide.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.hide.style;}',
'var showHTML=A5.buttons.html(id,s.settings.show,\'a5-item="\'+name+\'"\',\'\',true);var hideHTML=A5.buttons.html(id,s.settings.hide,\'a5-item="\'+name+\'"\',\'\',true);if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings.show,\'a5-item="\'+name+\'"\',\'disabled\',true);showHTML=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+showHTML+\'{*endif}\';dHTML=A5.buttons.html(id,s.settings.hide,\'a5-item="\'+name+\'"\',\'disabled\',true);hideHTML=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+hideHTML+\'{*endif}\';}',
'var html=\'{*if [temp].state.disclosure.shown && [temp].state.disclosure.name == \\\'\'+s.disclosure.name+\'\\\'}\'+hideHTML+\'{*else}\'+showHTML+\'{*endif}\';html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){var id=ele.id;if(this._d.shown)var bs=item.settings.hide;else var bs=item.settings.show;if(type==\'down\'){var pcn=bs.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(bs.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),bs.pressedIcon);A5.buttons._p[id]={c:pcn,i:bs.icon};}else A5.buttons._p[id]=pcn;}',
'if(type==\'click\'){if(this._d.shown)var html=A5.buttons.html(id,item.settings.hide,\'a5-item="\'+name+\'"\',\'\',true);else var html=A5.buttons.html(id,item.settings.show,\'a5-item="\'+name+\'"\',\'\',true);var pEle=ele.parentNode;pEle.innerHTML=A5.u.template.expand(this.data,html);A5.buttons._p[id]=pcn;}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'edit\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',update:\'default\',actions:{},settings:{theme:theme,style:\'\',watermark:{text:\'\',className:\'\'}},bind:{value:\'\',show:\'\'}},true);var ts={};A5.themes.assign(ts,s.settings.theme,\'edit\');$u.o.assign(s.settings,ts,true);if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;s.settings.style=\'display: inline-block; overflow: hidden;\'+s.settings.style;var wm=s.settings.watermark.text;if(wm==\'\')wm=\'&nbsp;\';var html=\'{*if \'+s.bind.value+\' != \\\'\\\'}<div id="\'+id+\'" a5-item="\'+name+\'" class="\'+s.settings.className+\'" style="box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \'+s.settings.style+\'{*if [temp].state.edit.shown && [temp].state.edit.item == \\\'\'+name+\'\\\'}visibility: hidden;{*endif}">{\'+s.bind.value+\'}</div>{*else}<div id="\'+id+\'" a5-item="\'+name+\'" class="\'+s.settings.className+\' \'+s.settings.watermark.className+\'" style="box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \'+s.settings.style+\'{*if [temp].state.edit.shown && [temp].state.edit.item == \\\'\'+name+\'\\\'}visibility: hidden;{*endif}"><escape<\'+wm+\'>></div>{*endif}\';html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'; text-align: left;">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}}},_:{lDefs:{type:\'default\',className:\'\',style:\'\',bind:{show:\'\'},before:{items:[]},middle:{items:[]},after:{items:[]}},initDone:false,init:function(){if(!A5.controlBar._.initDone){A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLine\',\'position: relative; text-align: center;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineCust\',\'position: relative;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineBefore\',\'text-align: left;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineAfter\',\'text-align: right;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarItem\',\'display: inline-block;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineContentBefore\',\'position: absolute; top: 0px; left: 0px;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineContentAfter\',\'position: absolute; top: 0px; right: 0px;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineBefore .A5ControlBarLineContentBefore, .A5ControlBarHorz .A5ControlBarLineAfter .A5ControlBarLineContentAfter\',\'position: static;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarHorz .A5ControlBarLine > div\',\'position: static; display: inline;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarHorz .A5ControlBarLine\',\'text-align: inherit;\');A5.u.css.setSelector(\'.A5ControlBarVert\',\'display: table; height: 100%;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLine\',\'display: table-cell; vertical-align: middle;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineCust\',\'display: table-cell;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineBefore\',\'display: table-cell; vertical-align: top;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineAfter\',\'display: table-cell; vertical-align: bottom;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineContentBefore\',\'position: absolute; top: 0px;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineContentAfter\',\'position: absolute; bottom: 0px;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineBefore .A5ControlBarLineContentBefore, .A5ControlBarVert .A5ControlBarLineAfter .A5ControlBarLineContentAfter\',\'position: static;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarVert .A5ControlBarLine > div\',\'position: static; display: block;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarVert .A5ControlBarLine\',\'vertical-align: top;\');A5.controlBar._.initDone=true;}}}}',
'A5.ControlBar=Class.create({initialize:function(contId,data,settings){if(typeof settings==\'undefined\'){settings=data;data=null;}',
'this.contId=contId;A5.controlBar._.init();$u.o.assign(this,{theme:\'\',override:\'base\',edge:\'top\',className:\'\',disclosuresClassName:\'\',topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\',separator:{horizontalClassName:\'\',verticalClassName:\'\'},items:{},actions:{},layout:\'\',layouts:{},disclosure:{container:A5.controlBar.disclosure.defaultContainer,animation:{duration:300,tween:\'ease-in-out\'},coverClassName:\'\',cover:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},extend:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},expand:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},defaults:{type:\'static\',html:\'\',className:\'\',onInitialize:false,onBeforeDraw:false,onDraw:false,onSize:false,onShow:false,onShowComplete:false,onHide:false}},disclosures:{},data:{},state:{layout:\'\',edit:{shown:false,item:\'\',part:\'\',path:\'\'},disclosure:{shown:false,name:\'\',type:\'\',edge:\'\'}},onDraw:false,onBeforeDraw:false,onPopulate:false,onBeforePopulate:false,onChange:false});if(typeof settings.theme!=\'undefined\')A5.themes.assign(this,settings.theme,\'controlBar\');$u.o.assign(this,settings);A5.overrides.assign(this,\'controlBar\',this.override);this.initializeItems();var cEle=$(contId);cEle.innerHTML=\'<div></div><input id="\'+this.contId+\'.EDIT" style="position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\';if(cEle.style.position!=\'absolute\')cEle.style.position=\'relative\';cEle.style.padding=\'0px\';cEle.style.overflow=\'hidden\';$acn(cEle,this.className);this._bindEvents(cEle);this._m={anim:false,next:{has:false,args:[]},async:{}};var egName=\'CONTROLBAR.\'+this.contId;var dEle=document.createElement(\'div\');dEle.id=this.contId+\'.DISCLOSURES\';$ss(dEle,\'z-index: 100000; position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px; display: none;\');dEle.innerHTML=\'<div style="position: absolute; overflow: hidden;"><div class="\'+this.disclosure.defaults.className+\'" id="\'+this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC" style="z-index: 100002; position: absolute; display: none;"><div></div><input id="\'+this.contId+\'.EDITDIS" style="position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" /></div></div><div id="\'+this.contId+\'.DISCLOSURE.CLOSE" style="z-index: 100001; position: absolute; display: none;">&nbsp;</div>\';$acn(dEle,this.disclosuresClassName);if(this.disclosure.container!=\'\')$(this.disclosure.container).appendChild(dEle);else document.body.insertBefore(dEle,document.body.firstChild);this._bindEvents(dEle.children[0].children[0]);$e.add(dEle,A5.d.evnts.click,this._disClick,this,false,egName);$e.add(this.contId+\'.DISCLOSURE.CLOSE\',A5.d.evnts.click,this._disCloseClick,this,false,egName);if(A5.flags.supportsTouch){$e.add(dEle,\'touchmove\',function(e){var tempT=$e.getTouches(e);var pDef=true;if(tempT){if(tempT.length){if(tempT.length>1)pDef=false;}}',
'if(pDef)$e.preventDefault(e);});}',
'this._d={ele:dEle,shown:false,current:false,next:false};var dd=null;for(var d in this.disclosures){dd=this.disclosures[d];this.addDisclosure(d,dd,true);}',
'var eEle=$(this.contId+\'.EDIT\');var edEle=$(this.contId+\'.EDITDIS\');$e.add(eEle,\'keyup\',this._editKeyup,this,false,egName);$e.add(edEle,\'keyup\',this._editKeyup,this,false,egName);$e.add(eEle,\'blur\',this._editBlur,this,false,egName);$e.add(edEle,\'blur\',this._editBlur,this,false,egName);this._e={ele:eEle,dEle:edEle,shown:0,current:false};if(data!=null)this.populate(data);else this.refresh();if(!A5.flags.isMobile)$e.add(window,\'resize\',this._relayout,this,true,egName);else{$e.add(window,\'orientationchange\',this._relayout,this,true,egName);if(A5.flags.iOSVersion==-1)$e.add(window,\'resize\',this._relayout,this,true,egName);}',
'$e.add(document,\'webkitfullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'mozfullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'fullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'fullscreenchange\',this._relayout,this,true,egName);},initializeItems:function(){var iObj=null;var iTObj=null;var theme=this.theme;theme=theme.split(\':\').shift();for(var item in this.items){iObj=this.items[item];iTObj=A5.controlBar.items[iObj.type];if(iTObj)iTObj.initialize(item,this.contId+\'.\'+item,iObj,theme);else iObj.template=\'ERROR \'+item+\' - Item type "\'+iObj.type+\'" not found!\';}',
'for(var layout in this.layouts){if(typeof this.layouts[layout]._t!=\'undefined\'){delete this.layouts[layout]._t.top;delete this.layouts[layout]._t.bottom;delete this.layouts[layout]._t.left;delete this.layouts[layout]._t.right;}}},destroy:function(){$e.removeGroup(\'CONTROLBAR.\'+this.contId);var dEle=this._d.ele;if(dEle){var pEle=dEle.parentNode;if(pEle)pEle.removeChild(dEle);}},populate:function(data){var anim=typeof arguments[1]!=\'undefined\'?arguments[1]:false;var fEvnts=typeof arguments[2]!=\'undefined\'?arguments[2]:true;var async=typeof arguments[3]!=\'undefined\'?arguments[3]:false;if(this.onBeforePopulate.constructor==Function&&fEvnts){var res=this.onBeforePopulate.call(this,data);if(typeof res==\'boolean\'){if(!res)return false;}}',
'this.data={};$u.o.assign(this.data,data);this.refresh(anim,async);if(this.onPopulate.constructor==Function&&fEvnts)this.onPopulate.call(this,data);},update:function(p,v){var anim=typeof arguments[2]!=\'undefined\'?arguments[2]:false;var fEvnts=typeof arguments[3]!=\'undefined\'?arguments[3]:true;var async=typeof arguments[4]!=\'undefined\'?arguments[4]:false;if(typeof p==\'string\'){p=[p];v=[v];}',
'for(var i=0;i<p.length;i++)A5.u.object.set(this.data,p[i],v[i],true);if(fEvnts){if(this.onChange.constructor==Function)this.onChange.call(this,p,v);}',
'this.refresh(anim,async);},setLayout:function(l){if(this.layouts[l]){var anim=typeof arguments[1]!=\'undefined\'?arguments[1]:false;var async=typeof arguments[2]!=\'undefined\'?arguments[2]:false;this.layout=l;this.refresh(anim,async);}else console.log(\'ERROR - control bar layout "\'+l+\'" not found\');},refresh:function(){var anim=typeof arguments[0]!=\'undefined\'?arguments[0]:false;var async=typeof arguments[1]!=\'undefined\'?arguments[1]:false;if(this._m.anim){this._m.next.has=true;this._m.next.args=[anim,async];return false;}',
'if(async){clearTimeout(this._m.async.to);var ci=this;this._m.async.to=setTimeout(function(){ci.refresh.apply(ci,ci._m.async.args);delete ci;},0);this._m.async.args=[anim];return false;}',
'if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'main\');var l=\'\';if(this.layout.constructor==Function)l=this.layout.call(this);else l=this.layout;this._cl=this.layouts[l];this.state.layout=l;this._compileTemplate(this._cl,this.edge);var cEle=$(this.contId);var html=A5.u.template.expand(this.data,{template:this._cl._t[this.edge]},{state:this.state},this);var animDo=false;var cn=\'class="\'+this[this.edge+\'ClassName\']+\'" \';var hCSS=\'\';if(this.edge==\'left\'||this.edge==\'right\')hCSS=\' height: 100%;\';if(anim){if(typeof anim!=\'object\')anim={type:anim,duration:500};if(!anim.tween)anim.tween=\'ease-in-out\';if(anim.type.indexOf(\'-in\')!=-1||anim.type.indexOf(\'-out\')!=-1||anim.type.indexOf(\'-before\')!=-1||anim.type.indexOf(\'-after\')!=-1){if(this.edge==\'top\'){anim.type=anim.type.replace(\'-in\',\'-top\').replace(\'-out\',\'-bottom\').replace(\'-before\',\'-left\').replace(\'-after\',\'-right\');}else if(this.edge==\'bottom\'){anim.type=anim.type.replace(\'-in\',\'-bottom\').replace(\'-out\',\'-top\').replace(\'-before\',\'-left\').replace(\'-after\',\'-right\');}else if(this.edge==\'left\'){anim.type=anim.type.replace(\'-in\',\'-left\').replace(\'-out\',\'-right\').replace(\'-before\',\'-top\').replace(\'-after\',\'-bottom\');}else if(this.edge==\'right\'){anim.type=anim.type.replace(\'-in\',\'-right\').replace(\'-out\',\'-left\').replace(\'-before\',\'-top\').replace(\'-after\',\'-bottom\');}}',
'var oldHTML=\'\';var ccEle=$(this.contId+\'.CONTENT\');if(ccEle){oldHTML=ccEle.innerHTML;oldHTML=oldHTML.replace(/id="[^"]+"/g,\'\').replace(/a5-item="[^"]+"/g,\'\');}',
'var tProp=A5.u.css.properties.transform;var tPropDOM=A5.u.css.properties.transformDOM;var taProp=tProp.replace(\'transform\',\'transition\');if(anim.type.indexOf(\'slide-\')==0){var vals=[\'0px\',\'100%\',\'0px\',\'-100%\'];if(anim.type==\'slide-left\')vals=[\'100%\',\'0px\',\'-100%\',\'0px\'];else if(anim.type==\'slide-right\')vals=[\'-100%\',\'0px\',\'100%\',\'0px\'];else if(anim.type==\'slide-bottom\')vals=[\'0px\',\'-100%\',\'0px\',\'100%\'];var taVal=taProp+\': \'+tProp+\' \'+anim.duration+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' \'+tProp+\': \'+A5.u.css.transform2D(\'0px\',\'0px\')+\'; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'\'+tProp+\': \'+A5.u.css.transform2D(vals[0],vals[1])+\'; \'+taVal+\'">\'+html+\'</div>\';animDo=[{p:tPropDOM,v:A5.u.css.transform2D(\'0px\',\'0px\')},{p:tPropDOM,v:A5.u.css.transform2D(vals[2],vals[3])}];}else if(anim.type.indexOf(\'swap-\')==0){var vals=[\'0px\',\'-100%\'];if(anim.type==\'swap-left\')vals=[\'-100%\',\'0px\'];else if(anim.type==\'swap-right\')vals=[\'100%\',\'0px\'];else if(anim.type==\'swap-bottom\')vals=[\'0px\',\'100%\'];var hDur=(anim.duration/2);var taVal=taProp+\': \'+tProp+\' \'+hDur+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' \'+tProp+\': \'+A5.u.css.transform2D(\'0px\',\'0px\')+\'; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'\'+tProp+\': \'+A5.u.css.transform2D(vals[0],vals[1])+\'; \'+taVal+\' transition-delay: \'+hDur+\'ms;">\'+html+\'</div>\';animDo=[{p:tPropDOM,v:A5.u.css.transform2D(\'0px\',\'0px\')},{p:tPropDOM,v:A5.u.css.transform2D(vals[0],vals[1])}];}else if(anim.type==\'fade\'){var taVal=taProp+\': opacity \'+anim.duration+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' opacity: 1; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'opacity: 0; \'+taVal+\'">\'+html+\'</div>\';animDo=[{p:\'opacity\',v:\'1\'},{p:\'opacity\',v:\'0\'}];}else html=\'<div id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'">\'+html+\'</div>\';}else html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'">\'+html+\'</div>\';if(hCSS==\'\')cEle.children[0].style.height=\'\';else cEle.children[0].style.height=\'100%\';cEle.children[0].innerHTML=html;this._m.anim=false;if(animDo){var lcEle=$(this.contId+\'.CONTENT\');var lcoEle=$(this.contId+\'.CONTENTOLD\');lcEle.offsetWidth;lcEle.style[animDo[0].p]=animDo[0].v;lcoEle.style[animDo[1].p]=animDo[1].v;var ci=this;setTimeout(function(){var ele=$(ci.contId+\'.CONTENTOLD\');pEle=ele.parentNode;pEle.removeChild(ele);ci._refreshAnimComplete();delete ci;delete ele;delete pEle;},anim.duration);this._m.anim=true;}',
'if(this.onDraw.constructor==Function)this.onDraw.call(this,\'main\',cEle);if(this._d.shown){if(this._d.current.s.isTemplate){if(this._d.current.s.name.substr(0,7)==\'layout:\'){var dEle=$(this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC\');if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'disclosure\');var layoutEdge=this._d.current.layoutEdge;var cn=\'class="\'+this[layoutEdge+\'ClassName\']+\'" \';var hCSS=\'\';if(layoutEdge==\'left\'||layoutEdge==\'right\')hCSS=\'height: 100%;\';if(hCSS==\'\')dEle.children[0].style.height=\'\';else dEle.children[0].style.height=\'100%\';dEle.children[0].innerHTML=\'<div \'+cn+\' style="\'+hCSS+\'">\'+A5.u.template.expand(this.data,{template:this._cdl._t[layoutEdge]},{state:this.state},this)+\'</div>\';if(this.onDraw.constructor==Function)this.onDraw.call(this,\'disclosure\',dEle);}else{var dd=this.disclosures[this._d.current.s.name];var dEle=$(this.contId+\'.DISCLOSURE.\'+this._d.current.s.name);if(dd.onBeforeDraw.constructor==Function)dd.onBeforeDraw.call(this,dEle);A5.u.element.setContent(dEle,A5.u.template.expand(this.data,{template:dd._t},{state:this.state},this));if(dd.onDraw.constructor==Function)dd.onDraw.call(this,dEle);}}}},action:function(action){if(this.actions[action]){var data=typeof arguments[1]!=\'undefined\'?arguments[1]:false;this.actions[action].call(this,data);}else console.log(\'ERROR - control bar action "\'+action+\'" not found\');},focus:function(name){var iObj=this.items[name];if(iObj){var id=this.contId+\'.\'+name;var ele=$(id);if(iObj.type==\'edit\'){if(ele){var part=\'disclosure\';while(ele!=document.body){if(ele.id==this.contId){part=\'main\';break;}',
'ele=ele.parentNode;}',
'if(this.state.edit.shown){var tEle=$(this._e.current.id);tEle.innerHTML=this._e.ele.value;tEle.style.visibility=\'\';}',
'this._e.current={item:iObj,id:id,p:part};if(part==\'main\')var eEle=this._e.ele;else var eEle=this._e.dEle;eEle.className=iObj.settings.className;$ss(eEle,iObj.settings.style+\'; position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\');var ev=A5.u.object.get(this.data,iObj.bind.value);eEle.value=ev;this._editPos();eEle.focus();eEle.select();this.state.edit.shown=true;this.state.edit.item=name;this.state.edit.part=part;this.state.edit.path=iObj.bind.value;}}else ele.focus();}},addDisclosure:function(n,s,ow){if(this.disclosures[n]&&!ow)return false;var cdEle=$(this.contId+\'.DISCLOSURES\').children[0];A5.u.object.assign(s,this.disclosure.defaults,true);if(!ow)this.disclosures[n]=s;var tdEle=document.createElement(\'div\');tdEle.id=this.contId+\'.DISCLOSURE.\'+n;tdEle.className=s.className;tdEle.style.position=\'absolute\';tdEle.style.display=\'none\';tdEle.style.zIndex=\'100002\';cdEle.appendChild(tdEle);if(s.type==\'template\')this._bindEvents(tdEle);else tdEle.innerHTML=s.html;if(s.onInitialize.constructor==Function)s.onInitialize.call(this,tdEle);return true;},showDisclosure:function(s){if(this._d.shown){this._d.next=s;this.hideDisclosure();}else{var ele=typeof arguments[1]!=\'undefined\'?arguments[1]:false;ele=$(ele);$u.o.assign(s,{name:\'\',type:\'extend\',size:false,margin:{top:0,left:0,right:0,bottom:0},animation:true,autoHide:true,className:\'\',coverClassName:this.disclosure.coverClassName},true);if(typeof s.margin.top!=\'number\')s.margin.top=A5.u.convertUnits(s.margin.top.toString(),\'px\');if(typeof s.margin.left!=\'number\')s.margin.left=A5.u.convertUnits(s.margin.left.toString(),\'px\');if(typeof s.margin.right!=\'number\')s.margin.right=A5.u.convertUnits(s.margin.right.toString(),\'px\');if(typeof s.margin.bottom!=\'number\')s.margin.bottom=A5.u.convertUnits(s.margin.bottom.toString(),\'px\');var type=s.type;if(type.indexOf(\'element\')!=-1&&!ele){type=type.split(\'-\').shift();if(type==\'expand\')type=\'expand-after\';}',
'this._cdl=false;var dd=false;if(s.name.substr(0,7)==\'layout:\'){var dEle=$(this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC\');this._cdl=this.layouts[s.name.substr(7)];if(!this._cdl)return false;if(s.className==\'\')s.className=this.disclosure.defaults.className;s.isTemplate=true;}else{dd=this.disclosures[s.name];if(!dd)return false;var dEle=$(this.contId+\'.DISCLOSURE.\'+s.name);if(s.className==\'\')s.className=dd.className;if(dd.type==\'template\'){s.isTemplate=true;if(typeof dd._t==\'undefined\'){var tPH=\'\';var tHTML=dd.html;for(var item in this.items){tPH=\'[\'+item+\']\';if(tHTML.indexOf(tPH)!=-1)tHTML=tHTML.split(tPH).join(this.items[item].template);}',
'tHTML=tHTML.replace(/A5CONTROLBARITEMSIZE/gi,\'width\');tHTML=tHTML.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.horizontalClassName);dd._t=A5.u.template.parse(tHTML);}',
'if(dd.onBeforeDraw.constructor==Function)dd.onBeforeDraw.call(this,dEle);A5.u.element.setContent(dEle,A5.u.template.expand(this.data,{template:dd._t},{state:this.state},this));if(dd.onDraw.constructor==Function)dd.onDraw.call(this,dEle);}else s.isTemplate=false;}',
'dEle.className=s.className;dEle.style.top=\'\';dEle.style.bottom=\'\';dEle.style.left=\'\';dEle.style.right=\'\';dEle.style.width=\'\';dEle.style.height=\'\';if(type==\'explicit\'){if(s.rectangle.constructor==Function)var rect=s.rectangle.call(this,s,ele);else var rect=s.rectangle;}else var rect=this._getDisclosureRect(type,ele);var layoutEdge=this.edge;if(s.name.substr(0,7)==\'layout:\'){if(type==\'outside-before\'||type==\'outside-after\'||type.split(\'-\').shift()==\'screen\')layoutEdge=rect.edge;this._compileTemplate(this._cdl,layoutEdge);if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'disclosure\');var cn=\'class="\'+this[layoutEdge+\'ClassName\']+\'" \';var hCSS=\'\';if(layoutEdge==\'left\'||layoutEdge==\'right\')hCSS=\'height: 100%;\';if(hCSS==\'\')dEle.children[0].style.height=\'\';else dEle.children[0].style.height=\'100%\';dEle.children[0].innerHTML=\'<div \'+cn+\' style="\'+hCSS+\'">\'+A5.u.template.expand(this.data,{template:this._cdl._t[layoutEdge]},{state:this.state},this)+\'</div>\';if(this.onDraw.constructor==Function)this.onDraw.call(this,\'disclosure\',dEle);}',
'var dcEle=this._d.ele.children[0];if(typeof rect.className!=\'undefined\')dcEle.className=rect.className;else dcEle.className=\'\';dcEle.style.top=(rect.top+s.margin.top)+\'px\';dcEle.style.bottom=(rect.bottom+s.margin.bottom)+\'px\';dcEle.style.left=(rect.left+s.margin.left)+\'px\';dcEle.style.right=(rect.right+s.margin.right)+\'px\';var setMargin=false;dEle.style[rect.edge]=\'0px\';dEle.style.marginLeft=\'\';dEle.style.marginTop=\'\';if(rect.fill==\'both\'||s.size==\'fill\'){dEle.style.top=\'0px\';dEle.style.bottom=\'0px\';dEle.style.left=\'0px\';dEle.style.right=\'0px\';}else if(rect.fill==\'width\'){dEle.style.left=\'0px\';dEle.style.right=\'0px\';}else if(rect.fill==\'height\'){dEle.style.top=\'0px\';dEle.style.bottom=\'0px\';}else{if(!rect.align)rect.align=\'middle\';if(rect.align==\'before\'){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.left=\'0px\';else dEle.style.top=\'0px\';}else if(rect.align==\'after\'){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.right=\'0px\';else dEle.style.bottom=\'0px\';}else{if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.left=\'50%\';else dEle.style.top=\'50%\';setMargin=true;}}',
'var startTrans=\'\';if(rect.edge==\'top\'){startTrans=A5.u.css.transform2D(\'0px\',\'-100%\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.height=s.size;}}else if(rect.edge==\'bottom\'){startTrans=A5.u.css.transform2D(\'0px\',\'100%\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.height=s.size;}}else if(rect.edge==\'left\'){startTrans=A5.u.css.transform2D(\'-100%\',\'0px\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.width=s.size;}}else if(rect.edge==\'right\'){startTrans=A5.u.css.transform2D(\'100%\',\'0px\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.width=s.size;}}',
'dEle.style.display=\'\';if(type.split(\'-\').shift()==\'expand\'&&!s.size)this._d.ele.className=this.disclosuresClassName+\' \'+s.coverClassName+\' A5ControlBarCollapse\';else this._d.ele.className=this.disclosuresClassName+\' \'+s.coverClassName;var dur=this.disclosure.animation.duration;var tween=this.disclosure.animation.tween;var completeDelay=false;if(s.animation){if(typeof s.animation==\'object\'){if(s.animation.duration)dur=s.animation.duration;if(s.animation.tween)tween=s.animation.tween;}',
'var cssDOMProp=A5.u.css.properties.transformDOM;var cssAnimProp=A5.u.css.properties.transitionDOM;dEle.style[cssDOMProp]=startTrans;dEle.style[cssAnimProp]=\'\';this._d.ele.style.display=\'\';dEle.offsetHeight;dEle.style[cssAnimProp]=A5.u.css.properties.transform+\' \'+dur+\'ms \'+tween;dEle.style[cssDOMProp]=A5.u.css.transform2D(\'0px\',\'0px\');completeDelay=true;}else{var cssDOMProp=A5.u.css.properties.transformDOM;var cssAnimProp=A5.u.css.properties.transitionDOM;dEle.style[cssDOMProp]=A5.u.css.transform2D(\'0px\',\'0px\');dEle.style[cssAnimProp]=\'\';this._d.ele.style.display=\'\';dEle.offsetHeight;dEle.style[cssAnimProp]=A5.u.css.properties.transform+\' \'+dur+\'ms \'+tween;}',
'if(setMargin){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.marginLeft=\'-\'+(dEle.offsetWidth/2)+\'px\';else dEle.style.marginTop=\'-\'+(dEle.offsetHeight/2)+\'px\';}',
'var eleId=false',
'if(ele)eleId=ele.id;this._d.current={s:s,eleId:eleId,dEle:dEle,trans:startTrans,dur:dur,layoutEdge:layoutEdge,internalShow:false};this._d.next=false;this._d.shown=true;var dbcEle=$(this.contId+\'.DISCLOSURE.CLOSE\');dbcEle.style.display=\'none\';if(this._d.internalShow&&ele){this._d.current.internalShow=true;var eBRect=ele.getBoundingClientRect();var tOff=0;var lOff=0;if(this.disclosure.container!=\'\'){var cEle=$(this.disclosure.container);if(cEle){var ceBRect=cEle.getBoundingClientRect();tOff=ceBRect.top;lOff=ceBRect.left;}}',
'dbcEle.style.top=(eBRect.top-tOff)+\'px\';dbcEle.style.left=(eBRect.left-lOff)+\'px\';dbcEle.style.width=eBRect.width+\'px\';dbcEle.style.height=eBRect.height+\'px\';dbcEle.style.display=\'block\';}',
'this.state.disclosure.shown=true;this.state.disclosure.name=s.name;this.state.disclosure.type=type;this.state.disclosure.edge=layoutEdge;if(dd){$e.execute(dEle,\'a5resize\');if(dd.onShow.constructor==Function)dd.onShow.call(this,dEle);if(dd.onSize.constructor==Function)dd.onSize.call(this,dEle);if(completeDelay){var ci=this;setTimeout(function(){ci._showDisclosureComplete();delete ci;},dur+10);}else this._showDisclosureComplete();}}},hideDisclosure:function(){if(this._d.shown){if(this.state.edit.shown&&this.state.edit.part!=\'main\'){this._e.dEle.blur();this._editBlur.call(this._e.dEle,false,this);}',
'var anim=typeof arguments[0]!=\'undefined\'?arguments[0]:true;var dur=0;if(anim){this._d.current.dEle.style[A5.u.css.properties.transformDOM]=this._d.current.trans;dur=this._d.current.dur;}',
'clearTimeout(this._hdcTO);var ci=this;this._hdcTO=setTimeout(function(){ci._hideDisclosureComplete();delete ci;},dur);}},resizeDisclosure:function(){if(this._d.shown){var s=this._d.current.s;var type=s.type',
'if(type==\'explicit\'){if(s.rectangle.constructor==Function)var rect=s.rectangle.call(this,s,$(this._d.current.eleId));else var rect=s.rectangle;}else var rect=this._getDisclosureRect(type,$(this._d.current.eleId));var dcEle=this._d.ele.children[0];dcEle.style.top=(rect.top+s.margin.top)+\'px\';dcEle.style.bottom=(rect.bottom+s.margin.bottom)+\'px\';dcEle.style.left=(rect.left+s.margin.left)+\'px\';dcEle.style.right=(rect.right+s.margin.right)+\'px\';var dd=this.disclosures[s.name];if(dd){$e.execute(this._d.current.dEle,\'a5resize\');if(dd.onSize.constructor==Function)dd.onSize.call(this,this._d.current.dEle);}',
'if(this._d.current.internalShow){var dbcEle=$(this.contId+\'.DISCLOSURE.CLOSE\');var eBRect=$(this._d.current.eleId).getBoundingClientRect();var tOff=0;var lOff=0;if(this.disclosure.container!=\'\'){var cEle=$(this.disclosure.container);if(cEle){var ceBRect=cEle.getBoundingClientRect();tOff=ceBRect.top;lOff=ceBRect.left;}}',
'dbcEle.style.top=(eBRect.top-tOff)+\'px\';dbcEle.style.left=(eBRect.left-lOff)+\'px\';dbcEle.style.width=eBRect.width+\'px\';dbcEle.style.height=eBRect.height+\'px\';}}},_getDisclosureRect:function(type,ele){var rect={top:0,left:0,right:0,bottom:0,edge:this.edge,fill:\'\',className:\'\'};var cBRect=$(this.contId).getBoundingClientRect();var eBRect=false;if(ele)eBRect=ele.getBoundingClientRect();if(this.disclosure.container!=\'\'){var tBRect=$(this.disclosure.container).getBoundingClientRect();var leftOff=tBRect.left;var topOff=tBRect.top;var docWidth=tBRect.width;var docHeight=tBRect.height;}else{var leftOff=0;var topOff=0;var docWidth=document.documentElement.clientWidth;var docHeight=document.documentElement.clientHeight;}',
'if(type.split(\'-\').shift()==\'expand\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;if(this.edge==\'top\'||this.edge==\'bottom\'){rect.fill=\'height\';if(type==\'expand-before\'){rect.edge=\'left\';}else if(type==\'expand-after\'){rect.edge=\'right\';}else if(type==\'expand-element\'||type==\'expand-element-cover\'){if(eBRect.left>(cBRect.left+(cBRect.width/2))){rect.edge=\'right\';if(type==\'expand-element\')rect.right=(docWidth-eBRect.left+leftOff);else rect.right=(docWidth-eBRect.right+leftOff);}else{rect.edge=\'left\';if(type==\'expand-element\')rect.left=eBRect.right-leftOff;else rect.left=eBRect.left-leftOff;}}}else{rect.fill=\'width\';if(type==\'expand-before\'){rect.edge=\'top\';}else if(type==\'expand-after\'){rect.edge=\'bottom\';}else if(type==\'expand-element\'||type==\'expand-element-cover\'){if(eBRect.top>(cBRect.top+(cBRect.height/2))){rect.edge=\'bottom\';if(type==\'expand-element\')rect.bottom=(docHeight-eBRect.top+topOff);else rect.bottom=(docHeight-eBRect.bottom+topOff);}else{rect.edge=\'top\';if(type==\'expand-element\')rect.top=eBRect.bottom-topOff;else rect.top=eBRect.top-topOff;}}}',
'rect.className=this.disclosure.expand[rect.edge+\'ClassName\'];}else if(type.split(\'-\').shift()==\'flyout\'){if(this.edge==\'top\'||this.edge==\'bottom\'){if(this.edge==\'top\'){if(type==\'flyout-element\')rect.top=eBRect.bottom-topOff;else if(type==\'flyout-element-cover\')rect.top=eBRect.top-topOff;else rect.top=cBRect.bottom-topOff;}else{if(type==\'flyout-element\')rect.bottom=docHeight-eBRect.top+topOff;else if(type==\'flyout-element-cover\')rect.bottom=docHeight-eBRect.bottom+topOff;else rect.bottom=docHeight-cBRect.top+topOff;}',
'if(eBRect.left>(cBRect.left+(cBRect.width/2))){rect.align=\'after\';rect.right=(docWidth-eBRect.right+leftOff);}else{rect.align=\'before\';rect.left=eBRect.left-leftOff;}}else{if(this.edge==\'left\'){if(type==\'flyout-element\')rect.left=eBRect.right-leftOff;else if(type==\'flyout-element-cover\')rect.left=eBRect.left-leftOff;else rect.left=cBRect.right-leftOff;}else{if(type==\'flyout-element\')rect.right=docWidth-eBRect.left+leftOff;else if(type==\'flyout-element-cover\')rect.right=docWidth-eBRect.right+leftOff;else rect.right=docWidth-cBRect.left+leftOff;}',
'if(eBRect.top>(cBRect.top+(cBRect.height/2))){rect.align=\'after\';rect.bottom=(docHeight-eBRect.bottom+topOff);}else{rect.align=\'before\';rect.top=eBRect.top-topOff;}}}else if(type==\'cover\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'both\';rect.className=this.disclosure.cover[rect.edge+\'ClassName\'];}else if(type.split(\'-\').shift()==\'screen\'){rect.edge=type.split(\'-\').pop();if(rect.edge==\'left\'||rect.edge==\'right\')rect.fill=\'height\';else rect.fill=\'width\';}else{if(this.edge==\'top\'){rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'width\';if(type==\'extend-element\'){rect.top=eBRect.bottom-topOff;}else if(type==\'extend-element-cover\'){rect.top=eBRect.top-topOff;}else{rect.top=cBRect.bottom-topOff;if(type==\'outside-before\'){rect.fill=\'height\';rect.edge=\'left\';}else if(type==\'outside-after\'){rect.fill=\'height\';rect.edge=\'right\';}}}else if(this.edge==\'bottom\'){rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'width\';if(type==\'extend-element\'){rect.bottom=docHeight-eBRect.top+topOff;}else if(type==\'extend-element-cover\'){rect.bottom=docHeight-eBRect.bottom+topOff;}else{rect.bottom=docHeight-cBRect.top+topOff;if(type==\'outside-before\'){rect.fill=\'height\';rect.edge=\'left\';}else if(type==\'outside-after\'){rect.fill=\'height\';rect.edge=\'right\';}}}else if(this.edge==\'left\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.fill=\'height\';if(type==\'extend-element\'){rect.left=eBRect.right-leftOff;}else if(type==\'extend-element-cover\'){rect.left=eBRect.left-leftOff;}else{rect.left=cBRect.right-leftOff;if(type==\'outside-before\'){rect.fill=\'width\';rect.edge=\'top\';}else if(type==\'outside-after\'){rect.fill=\'width\';rect.edge=\'bottom\';}}}else if(this.edge==\'right\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.fill=\'height\';if(type==\'extend-element\'){rect.right=docWidth-eBRect.left+leftOff;}else if(type==\'extend-element-cover\'){rect.right=docWidth-eBRect.right+leftOff;}else{rect.right=docWidth-cBRect.left+leftOff;if(type==\'outside-before\'){rect.fill=\'width\';rect.edge=\'top\';}else if(type==\'outside-after\'){rect.fill=\'width\';rect.edge=\'bottom\';}}}',
'rect.className=this.disclosure.extend[rect.edge+\'ClassName\'];}',
'return rect;},_showDisclosureComplete:function(){if(this._d.shown){var dd=this.disclosures[this._d.current.s.name];if(dd){if(dd.onShowComplete.constructor==Function)dd.onShowComplete.call(this,this._d.current.dEle);}}},_hideDisclosureComplete:function(){if(this._d.shown){this._d.shown=false;this.state.disclosure.shown=false;this._d.current.dEle.style.display=\'none\';var dd=this.disclosures[this._d.current.s.name];if(dd){if(dd.onHide.constructor==Function)dd.onHide.call(this,this._d.current.dEle);}',
'if(this._d.next){this.showDisclosure(this._d.next,this._d.current.eleId);}else{this._d.ele.style.display=\'none\';this._d.current=false;}',
'this.refresh();}},_refreshAnimComplete:function(){this._m.anim=false;if(this._m.next.has){this._m.next.has=false;this.refresh.apply(this,this._m.next.args);delete this._m.next.args;}},_relayout:function(){if(this._d.shown){var ci=this',
'clearTimeout(this._rdTO);this._rdTO=setTimeout(function(){ci.resizeDisclosure();delete ci},50);}',
'if(this._e.shown){var ci=this',
'clearTimeout(this._reTO);this._reTO=setTimeout(function(){ci._editPos();delete ci},50);}},_disClick:function(e,ci){if(ci._d.current){var cEle=$(ci.contId);var coor=$e.getCoors(e);var ele=document.elementFromPoint(coor.clientX,coor.clientY);if(!ele)return true;while(ele!=cEle&&ele!=document.body){if(ele.hasAttribute(\'a5-action\'))ci.action(ele.getAttribute(\'a5-action\'),{element:ele,event:e});else if(ele==ci._d.current.dEle)return true;ele=ele.parentNode;}',
'if(ci._d.current){if(!ci._d.current.s.autoHide)return true;ci.hideDisclosure();}}},_disCloseClick:function(e,ci){ci.hideDisclosure();},_editKeyup:function(e,ci){if(ci.state.edit.item!=\'\'){if(ci._e.current.item.update!=\'done\')ci.update(ci.state.edit.path,this.value);A5.controlBar.items.edit.event.call(ci,\'keyup\',ci.state.edit.item,this.value,ci.items[ci.state.edit.item],this,e);var keyCode=e.charCode||e.keyCode;if(keyCode==13)this.blur();}},_editBlur:function(e,ci){if(document.activeElement!=ci._e.ele&&document.activeElement!=ci._e.dEle&&ci.state.edit.item!=\'\'){ci._e.shown=false;$(ci._e.current.id).style.visibility=\'\';A5.controlBar.items.edit.event.call(ci,\'done\',ci.state.edit.item,this.value,ci.items[ci.state.edit.item],this,e);this.style.display=\'none\';ci.state.edit.shown=false;ci.state.edit.item=\'\';ci.state.edit.part=\'\';if(ci._e.current.item.update==\'done\')ci.update(ci.state.edit.path,this.value);}},_editPos:function(){var tEle=$(this._e.current.id);if(tEle){if(this._e.current.p==\'main\')var ele=this._e.ele;else var ele=this._e.dEle;var eBRect=tEle.getBoundingClientRect();var peBRect=ele.parentNode.getBoundingClientRect();ele.style.top=(eBRect.top-peBRect.top)+\'px\';ele.style.left=(eBRect.left-peBRect.left)+\'px\';ele.style.width=eBRect.width+\'px\';ele.style.height=eBRect.height+\'px\';ele.style.display=\'\';tEle.style.visibility=\'hidden\';this._e.shown=true;}else{this._e.ele.style.display=\'none\';this._e.dEle.style.display=\'none\';this._e.shown=false;}},_down:function(e,ci){var r=ci._aEle(e);ci._startItem=false;if(r){ci._startItem={i:r.i,v:r.v,id:r.ele.id};if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'down\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_up:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'up\',r.i,r.v,iObj,r.ele,e);}',
'if(A5.u.drag._sDif<$e.abstractEvents.click.scrollMax){var id=\'\';if(ci._startItem){if(ci._startItem.i==r.i){id=r.ele.id;var dShown=ci._d.shown;if(iObj.disclosure){if(iObj.autoHideDisclosure!=\'auto\')ci._d.internalShow=true;ci.showDisclosure(iObj.disclosure,r.ele);ci._d.internalShow=false;}else if(iObj.type==\'edit\'){if(ci.state.edit.shown){var tEle=$(ci._e.current.id);tEle.innerHTML=ci._e.ele.value;tEle.style.visibility=\'\';}',
'ci._e.current={item:iObj,id:id,p:r.p};if(r.p==\'main\')var eEle=ci._e.ele;else var eEle=ci._e.dEle;eEle.className=iObj.settings.className;$ss(eEle,iObj.settings.style+\'; position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\');var ev=A5.u.object.get(ci.data,iObj.bind.value);eEle.value=ev;ci._editPos();eEle.focus();eEle.select();ci.state.edit.shown=true;ci.state.edit.item=r.i;ci.state.edit.part=r.p;ci.state.edit.path=iObj.bind.value;}',
'if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'click\',r.i,r.v,iObj,r.ele,e);}',
'if(dShown&&!ci._d.next&&ci._d.current){if(iObj.autoHideDisclosure){var hide=false;if(iObj.autoHideDisclosure==\'always\')hide=true;else if(iObj.autoHideDisclosure!=\'never\'&&ci._d.current.s.autoHide)hide=true;if(hide)ci.hideDisclosure();}}}}',
'if(this._oid==id)this._isdc=true;else{this._isdc=false;this._oid=id;}}}}}',
'delete r;},_dblClick:function(e,ci){if(!this._isdc)return false;var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'dblclick\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_rClick:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'contextclick\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_downHold:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'downhold\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_swipe:function(e,ci){if(ci._startItem){var r=ci._startItem;var ele=$(r.id);if($ga(ele,\'a5-disabled\')!=\'true\'&&!ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'swipe\',r.i,r.v,iObj,ele,e);}}}}},_aEle:function(e){var cEle=$(this.contId);var coor=$e.getCoors(e);var ele=document.elementFromPoint(coor.clientX,coor.clientY);if(!ele)return false;var result=false;var i=\'\';while(ele!=cEle&&ele!=document.body){if(!result){i=$ga(ele,\'a5-item\');if(i!=null&&i!=\'\'){var v=this._getValue(ele);result={i:i,v:v,ele:ele,p:\'disclosure\'};}}',
'ele=ele.parentNode;}',
'if(ele==cEle&&result)result.p=\'main\';return result;},_getValue:function(ele){var v=$ga(ele,\'a5-value\');if(v==\'\'||v==null)v=ele.id;return v;},_bindEvents:function(ele){var egName=\'CONTROLBAR.\'+this.contId;$e.add(ele,A5.d.evnts.dblClick,this._dblClick,this,false,egName);$e.add(ele,\'contextmenu\',this._rClick,this,false,egName);$e.add(ele,A5.d.evnts.down,this._down,this,false,egName);$e.add(ele,A5.d.evnts.up,this._up,this,false,egName);$e.add(ele,\'abstractdownhold\',this._downHold,this,false,egName);$e.add(ele,\'abstractswipe\',this._swipe,this,false,egName);},_compileTemplate:function(cl,edge){if(typeof cl._t==\'undefined\')cl._t={};if(typeof cl._t[edge]==\'undefined\'){var tLines=[];var l=null;var ti=null;var cn=\'\';var temp=[];var name=\'\';var tHTML=\'\';var tPH=\'\';for(var i=0;i<cl.lines.length;i++){l=cl.lines[i];$u.o.assign(l,A5.controlBar._.lDefs,true);cn=\'A5ControlBarLine\';if(l.type!=\'custom\'){if(l.middle.items.length==0){if(l.before.items.length==0)cn=\'A5ControlBarLine A5ControlBarLineAfter\';else cn=\'A5ControlBarLine A5ControlBarLineBefore\';}}else cn=\'A5ControlBarLineCust\';temp=[\'<div class="\'+cn+\' \'+l.className+\'" style="\'+l.style+\'">\'];if(l.type==\'custom\'){tHTML=l.html;for(var item in this.items){tPH=\'[\'+item+\']\';if(tHTML.indexOf(tPH)!=-1)tHTML=tHTML.split(tPH).join(this.items[item].template);}',
'temp.push(tHTML);}else{if(l.before.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentBefore">&#65279;\');for(var k=0;k<l.before.items.length;k++){name=l.before.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}',
'if(l.middle.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentMiddle">&#65279;\');for(var k=0;k<l.middle.items.length;k++){name=l.middle.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}',
'if(l.after.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentAfter">&#65279;\');for(var k=0;k<l.after.items.length;k++){name=l.after.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}}',
'temp.push(\'</div>\');if(l.bind.show!=\'\'){temp.unshift(\'{*if \'+l.bind.show+\'}\')',
'temp.push(\'{*endif}\');}',
'tLines.push(temp.join(\'\'));}',
'if(edge==\'left\'){tLines.unshift(\'<div class="A5ControlBarVert">\');tLines.push(\'</div>\');}else if(edge==\'bottom\'){tLines.reverse();tLines.unshift(\'<div class="A5ControlBarHorz">\');tLines.push(\'</div>\');}else if(edge==\'right\'){tLines.reverse();tLines.unshift(\'<div class="A5ControlBarVert">\');tLines.push(\'</div>\');}else{tLines.unshift(\'<div class="A5ControlBarHorz">\');tLines.push(\'</div>\');}',
'tLines=tLines.join(\'\');if(edge==\'left\'||edge==\'right\'){tLines=tLines.replace(/A5CONTROLBARITEMSIZE/gi,\'height\');tLines=tLines.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.verticalClassName);}else{tLines=tLines.replace(/A5CONTROLBARITEMSIZE/gi,\'width\');tLines=tLines.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.horizontalClassName);}',
'cl._t[edge]=A5.u.template.parse(tLines);}}});};',
'A5._windowDefaults={title:{tools:{defaults:{\'close\':{action:\'close\',name:\'close\',image:\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB/klEQVR42qWTPU9qQRCGn92zh0BskGMBFbmlPZHWhopgbWNj/EmWJ7EiASztKK39BZiTGwtCSCAaPIrZz9vIBu69nZtMss3MPO87MyKEwE+eAphOp7+staPNZtNxzknnHN57vPf8/Q8h+DRNn5RSlzc3N78VgLV2dHp6etZut3HOYa2NYYzBGIPWGmMMX19fsiiKs/l8PgK6CmCz2XTa7TYfHx8453h/f0dKidY6RlmWfDej1Woxm806ABJgh22MYTKZcHt7GxMAPj8/ub+/5/HxEe89u5z9AlhrKcuSoihYLBbkeU5ZlpRlyXg8ZrVasVgs0FpHX6KJ3nustUgpub6+Js9zlssld3d3hBBYr9dkWUa/3ydJEpxzOOeIBN77aFSaplxdXXFycsJqtWK9XtNoNBgMBlQqldjsgGAnQWsNgDGG/f0IIcQxOucQQvxLsHP77e2N4XAYOx8fH/P6+srDw0OckjEmEhxI2DcsyzIuLi4YDAaxyHQ6ZbvdHkiIUzDGANBsNmk0GvT7fZRSJElCr9ejXq+TZRlCiCgnehBC8NvtVlpr6Xa7aK3jInnvSZKE8/NzhBAAaK0JIfhIkKbpU1EUVCoVqtUqR0dHJEmClJKdRKUUQgiMMby8vFCr1Z4igVLqcj6fj56fnzvOObl/RP87pu/kSwDx03P+A1+yn0B7bDkwAAAAAElFTkSuQmCC\'}}}}}',
'A5.serverSideDateFormat = \'dd/MM/yyyy\';',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj == \'object\') { ',
'\t{UXPRERENDEREDALIAS}_DlgObj._destroy();',
'\ttry {',
'\t\tdelete {UXPRERENDEREDALIAS}_DlgObj;',
'\t} catch(e) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj = undefined;',
'\t}',
'};',
';if(typeof {UXPRERENDEREDALIAS}_PanelObj != \'undefined\' && {UXPRERENDEREDALIAS}_PanelObj) {',
'\tvar ele = $({UXPRERENDEREDALIAS}_PanelObj.getPanelId());',
'\tif(ele) {',
'\t\tif(ele.parentNode) ele.parentNode.removeChild(ele);',
'\t}',
'\tdelete {UXPRERENDEREDALIAS}_PanelObj;',
'}',
';window[\'{UXPRERENDEREDALIAS}_PanelObj\'] = new A5.PanelNavigator([',
'{',
'\tname: \'PANELCARD_1\',',
'\tsrc: new A5.PanelCard({',
'\ttheme: \'Alpha-Magenta\',',
'\tbody: {',
'\t\tcontent: {',
'\t\t\ttype: \'html\',',
'\t\t\tsrc: \'<div class="A5CWLayout" style="width: 2in" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.LIST_OF_RECEIPT" for="{UXPRERENDEREDALIAS}.V.R1.LIST_OF_RECEIPT" title="" class="label" style="color: #8f0606; font-size: 18px; font-weight: bold; display: block; ">List of Receipts</label>\\r\\n\\r\\n <span id="{UXPRERENDEREDALIAS}.V.R1.LIST_OF_RECEIPT" class="gridData " style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display:inline-block" title=""   onchange="var tfunc = function() {onChange_List_of_receipt_995356d6ad0442008a94946542a46cad.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"  ></span>\\r\\n</div><br  style="clear:both; " />\\r\\n<div  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_1"   \\r\\n   A5-containerType="none"\\r\\n   class="A5CWLayout "  style="width: 100%; "  >\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.FROMDATE" for="{UXPRERENDEREDALIAS}.V.R1.FROMDATE" title="" class="label" style="display:block;">From Date</label>\\r\\n\\r\\n <table id="{UXPRERENDEREDALIAS}.V.R1.FROMDATE.CONTAINER" cellspacing="0" cellpadding="0" class="editBG" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display: inline-table; white-space:normal; ">\\r\\n<tr>\\r\\n<td style="width:100%">\\r\\n <input   id="{UXPRERENDEREDALIAS}.V.R1.FROMDATE" name="V.R1.FROMDATE"  value=""  autocomplete="off"   size="200" class="editBGEdit" style="width: 100%; ; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\\r\\n \\r\\n</td>\\r\\n  <td class="" >&nbsp;</td>\\r\\n  <td id="{UXPRERENDEREDALIAS}.V.R1.FROMDATE.BUTTON" class="editBGButton" style="width: 0%;"><svg     class="icon"><use x="0" y="0" width="100%" height="100%" xlink:href="#alpha-icon-chevronDown"  pointer-events="none" /></svg></td>\\r\\n </tr>\\r\\n</table>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.TODATE" for="{UXPRERENDEREDALIAS}.V.R1.TODATE" title="" class="label" style="display:block;">To Date</label>\\r\\n\\r\\n <table id="{UXPRERENDEREDALIAS}.V.R1.TODATE.CONTAINER" cellspacing="0" cellpadding="0" class="editBG" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display: inline-table; white-space:normal; ">\\r\\n<tr>\\r\\n<td style="width:100%">\\r\\n <input   id="{UXPRERENDEREDALIAS}.V.R1.TODATE" name="V.R1.TODATE"  value=""  autocomplete="off"   size="200" class="editBGEdit" style="width: 100%; ; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\\r\\n \\r\\n</td>\\r\\n  <td class="" >&nbsp;</td>\\r\\n  <td id="{UXPRERENDEREDALIAS}.V.R1.TODATE.BUTTON" class="editBGButton" style="width: 0%;"><svg     class="icon"><use x="0" y="0" width="100%" height="100%" xlink:href="#alpha-icon-chevronDown"  pointer-events="none" /></svg></td>\\r\\n </tr>\\r\\n</table>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 75%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.MEDREPN" for="{UXPRERENDEREDALIAS}.V.R1.MEDREPN" title="" class="label" style="float: left; width: 1in; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;">MEDREP</label>\\r\\n<div style="margin-left: 1in ;"><table id="{UXPRERENDEREDALIAS}.V.R1.MEDREPN.CONTAINER" cellspacing="0" cellpadding="0" class="editBG" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display: inline-table; white-space:normal; ">\\r\\n<tr>\\r\\n<td style="width:100%">\\r\\n <input   id="{UXPRERENDEREDALIAS}.V.R1.MEDREPN" name="V.R1.MEDREPN"  value=""  autocomplete="off"   size="200" class="editBGEdit" style="width: 100%; ; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\\r\\n \\r\\n</td>\\r\\n  <td class="" >&nbsp;</td>\\r\\n  <td id="{UXPRERENDEREDALIAS}.V.R1.MEDREPN.BUTTON" class="editBGButton" style="width: 0%;" ><svg     class="icon"><use x="0" y="0" width="100%" height="100%" xlink:href="#alpha-icon-chevronDown"  pointer-events="none" /></svg></td>\\r\\n </tr>\\r\\n</table>\\r\\n</div>\\r\\n</div><br  style="clear:both; " />\\r\\n<div style="display:none;font: 0pt arial;clear:both;"></div>\\r\\n </div>\\r\\n<br  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_1.BREAK"  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: " >\\r\\n <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_1"    ></button>\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5floatClear"></div>\'',
'\t\t},',
'\t\tscroll: {',
'\t\t\taxis: \'both\',',
'\t\t\tstopPropogation: false,',
'\t\t\tpull: {',
'\t\t\t\ty: \'auto\',',
'\t\t\t\tx: \'auto\',',
'\t\t\t\tduration: 1000',
'\t\t\t},',
'\t\t\tindicator: {',
'\t\t\t\tshow: true,',
'\t\t\t\th: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'top\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\tleft: \'0px\',',
'\t\t\t\t\tright: \'0px\'',
'\t\t\t\t},',
'\t\t\t\tv: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'right\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\ttop: \'0px\',',
'\t\t\t\t\tbottom: \'0px\'',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t},',
'\theader: {',
'\t\thtml: \'<div style="display:none;"></div>\'',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tonSize: function() {if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard) {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard(\'PANELCARD_1\',this);',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj != null && typeof {UXPRERENDEREDALIAS}_DlgObj._panelCardResize != \'undefined\') { {UXPRERENDEREDALIAS}_DlgObj._panelCardResize(\'PANELCARD_1\'); };},',
'\tonView: function() {;',
'},',
'\tonActivate: function() {},',
'\tonCreate: function() {',
'}',
'})',
'},',
'{',
'\tname: \'PANELCARD_2\',',
'\tsrc: new A5.PanelCard({',
'\ttheme: \'Alpha-Magenta\',',
'\tbody: {',
'\t\tcontent: {',
'\t\t\ttype: \'html\',',
'\t\t\tsrc: \'<div class="A5floatClear"></div>\'',
'\t\t},',
'\t\tscroll: {',
'\t\t\taxis: \'both\',',
'\t\t\tstopPropogation: false,',
'\t\t\tpull: {',
'\t\t\t\ty: \'auto\',',
'\t\t\t\tx: \'auto\',',
'\t\t\t\tduration: 1000',
'\t\t\t},',
'\t\t\tindicator: {',
'\t\t\t\tshow: true,',
'\t\t\t\th: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'top\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\tleft: \'0px\',',
'\t\t\t\t\tright: \'0px\'',
'\t\t\t\t},',
'\t\t\t\tv: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'right\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\ttop: \'0px\',',
'\t\t\t\t\tbottom: \'0px\'',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t},',
'\theader: {',
'\t\thtml: \'<div class="A5CWLayout"   id="{UXPRERENDEREDALIAS}.V.R1.CONTROLBAR_1" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"> </div> <div style="display:none;"></div>\',',
'\t\tshow: true',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tonSize: function() {if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard) {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard(\'PANELCARD_2\',this);try { var cbObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'CONTROLBAR_1\'); ',
'if(cbObj && {UXPRERENDEREDALIAS}_DlgObj.flagRenderComplete && arguments[0].changed ) cbObj.refresh();',
'} catch(error) { };',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj != null && typeof {UXPRERENDEREDALIAS}_DlgObj._panelCardResize != \'undefined\') { {UXPRERENDEREDALIAS}_DlgObj._panelCardResize(\'PANELCARD_2\'); };},',
'\tonView: function() {;',
'},',
'\tonActivate: function() {},',
'\tonCreate: function() {',
'}',
'})',
'}',
'],{',
'\t__parentPanelName: \'[top]\',',
'\ttype: \'programmatic\',',
'\tflow: \'ltr\',',
'\tloopNavigate: false,',
'\tonPanelActivate: function() {},',
'\tonPanelActivateComplete: function() {;',
'{UXPRERENDEREDALIAS}_DlgObj.refreshClientSideComputations(true);},',
'\tonPanelView: function() {',
';',
'},',
'\tonSize: function() {;if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\') {',
' if(typeof {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule != \'undefined\') {',
'  {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule();',
' }',
'}',
'try { var cbObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'CONTROLBAR_1\');',
'if(cbObj && {UXPRERENDEREDALIAS}_DlgObj.flagRenderComplete && arguments[0].changed ) cbObj.refresh();',
'} catch(error) { };},',
'\tonCreate: function() {',
'},',
'\ttheme: \'Alpha-Magenta\',',
'\theader: {',
'\t\tshow: false',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tcontrols: {',
'\t\tprev: {',
'\t\t\thas: false',
'\t\t},',
'\t\tnext: {',
'\t\t\thas: false',
'\t\t},',
'\t\tback: {',
'\t\t\thas: false',
'\t\t},',
'\t\tforward: {',
'\t\t\thas: false',
'\t\t}',
'\t},',
'\tbody: {',
'\t},',
'\tanimation: {',
'\t\tduration: 400',
'\t}',
'})',
'var ele = window[\'{UXPRERENDEREDALIAS}_PanelObj\'].create(\'{UXPRERENDEREDALIAS}.R1\');',
'\t\tvar panelRootId = \'{UXPRERENDEROUTPUTDIV}\';',
'\t\tvar flagSizeToParent = true;',
'\t\tvar wf_alias = \'{UXPRERENDEREDALIAS}\';',
'\t\tif(panelRootId != \'\') { ',
'\t\t\tif (!$(panelRootId)) panelRootId = \'\';',
'\t\t}',
'\t\tif(panelRootId != \'\') { ',
'\t\t\t$(panelRootId).appendChild(ele);',
'\t\t\tif(flagSizeToParent) { ',
'\t\t\t\tif(window[wf_alias + \'_PanelObj\']) window[wf_alias + \'_PanelObj\'].bindSize(\'parent\');',
'\t\t\t\tvar ele = $(panelRootId + \'.CONTENT\'); if(ele) ele.style.display = \'none\'; //srec',
'\t\t\t}',
'\t\t} else { ',
'\t\t\tdocument.body.insertBefore(ele,document.body.firstChild);',
'\t\t\tif(window[wf_alias + \'_PanelObj\']) window[wf_alias + \'_PanelObj\'].bindSize(\'window\');',
'\t\t}',
'{UXPRERENDEREDALIAS}_PanelObj._panelPath = {',
'\tPANELCARD_1: \'PANELCARD_1\',',
'\tPANELCARD_2: \'PANELCARD_2\'',
'}',
'{UXPRERENDEREDALIAS}_PanelObj._displayNames = {',
'PANELCARD_1 : \'PANELCARD_1\',PANELCARD_2 : \'PANELCARD_2\',PANELNAVIGATOR_1 : \'PANELNAVIGATOR_1\'',
'};',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj == \'object\') {UXPRERENDEREDALIAS}_DlgObj._destroy();',
'window[\'{UXPRERENDEREDALIAS}_DlgObj\'] = new A5.DialogComponentHelper(\'{UXPRERENDEREDALIAS}\',{',
'\tajaxURL: \'{UXPRERENDERAJAXURL}\',',
'\t_embeddedMode: false,',
'\t_livePreviewInBuilder: false,',
'\tcomponentGUID: \'b48f2396-3f25-40c8-a109-820f8de8d33f\',',
'\tcolumnInfo: {\'LIST_OF_RECEIPT\': {info: {controlType: \'label\'}, hiddenVal: false, type: \'label,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'CURRENTUSER\': {info: {controlType: \'textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'FROMDATE\': {info: {controlType: \'textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'D\', validate: function(data,colName,rowNum,instNum) {if($u.s.aTrim(data) == \'\') return \'From Date is Required\'; return true; }  },\'TODATE\': {info: {controlType: \'textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'D\', validate: function(data,colName,rowNum,instNum) {if($u.s.aTrim(data) == \'\') return \'To Date is Required\'; return true; }  },\'MEDREPN\': {info: {controlType: \'TextBox\',controlSubType: \'Edit-Combo List\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  }},',
'\toriginalValues: [{',
'\t"LIST_OF_RECEIPT": "",',
'\t"FROMDATE": "",',
'\t"TODATE": "",',
'\t"MEDREPN": "",',
'\t"CURRENTUSER": "Invalid expression: session.username"',
'}],',
'\tdefaultValues: {',
'\t"LIST_OF_RECEIPT": "",',
'\t"FROMDATE": "",',
'\t"TODATE": "",',
'\t"MEDREPN": "",',
'\t"CURRENTUSER": "Invalid expression: session.username"',
'},',
'\tdatePickerMonthNames: [\'January\',\'February\',\'March\',\'April\',\'May\',\'June\',\'July\',\'August\',\'September\',\'October\',\'November\',\'December\'],',
'\tdatePickerDayNames: [\'Sun\',\'Mon\',\'Tue\',\'Wed\',\'Thu\',\'Fri\',\'Sat\'],',
'\tdatePickerTodayButton: \'Today\',',
'\tdatePickerCloseButton: \'\',',
'\tdatePickerFirstDayOfWeek: 1,',
'\tresetFormMessage: \'Are you sure you want to reset the form?\',',
'\tresetFormTitle: \'Warning\',',
'\tresetFormIcon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\tdirtyFormMessage: \'You must first save your changes or cancel changes by clicking the Reset button.\',',
'\tdirtyFormTitle: \'Notice\',',
'\tdirtyFormIcon: \'svgIcon=#alpha-icon-infoCircle:icon\',',
'\tdeleteRecordDialogTitle: \'Delete Record\',',
'\tdeleteRecordDialogMessage: \'Are you sure you want to delete this record?\',\t',
'\tssDateFormat: \'dd/MM/yyyy\',',
'\tstyleName: \'Alpha-Magenta\',',
'\t_fieldHelpers_DIALOG2: [],',
'\tparentComponentAlias: \'\'+go._thisGridAlias+\'\',',
'\tsubmitIfHasClientSideErrors: true, ',
'\trowErrors: {',
'\t\t\t\tshowMessageBox: false,',
'\t\t\t\tmessageBoxTitle: \'Error\',',
'\t\t\t\tstyle: \'color: red; width: 6in; height: 2in;\'',
'\t\t},',
'\tfieldErrors: {',
'\t\ttype: \'block\', ',
'\t\tclassName: \'errorText\',',
'\t\tinputClassName: \'editError\',',
'\t\tedit: { ',
'\t\t\tcontainer: { className: \'editError\'}',
'\t\t},',
'\t\ticon: \'svgIcon=#alpha-icon-exclamationCircle:icon\',',
'\t\tglobal: {',
'\t\t\tcontId: \'{UXPRERENDEREDALIAS}.GLOBALERRORS\',',
'\t\t\thoverClassName: \'errorTextHighlight\',',
'\t\t\thoverInputClassName: \'errorInputHighlight\'',
'\t\t}',
'\t},',
'\t\tonOrientationChange: function(e) {',
'var pObj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();',
'if(pObj && pObj.resize && typeof pObj.resize == \'function\') pObj.resize();',
'\t\t},',
'\t\tonFirestoreAuthStateChanged: function(e) {',
'{UXPRERENDEREDALIAS}_DlgObj.onFirestoreLogin(e);',
'\t\t},',
'\t\t_onWindowResize: function(e) {',
'var arr = {UXPRERENDEREDALIAS}_DlgObj._listControls;',
'if(arr) {',
'\tvar obj;',
'\tfor(var i = 0; i < arr.length; i++) { ',
'\t\tobj = {UXPRERENDEREDALIAS}_DlgObj.getControl(arr[i]);',
'\t\tif(obj && obj.resize && typeof obj.resize == \'function\') obj.resize()',
'\t}',
'}',
'\t\t},',
'_onInitializeBegin: function(e) { /*systemOnInitializeBegin*/ ;',
'   },',
'\t});',
'{UXPRERENDEREDALIAS}_DlgObj._onOrientationChange =  function(e) { ;',
'{UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule();',
';  };',
'A5.__componentObj = {UXPRERENDEREDALIAS}_DlgObj;',
'A5.map._fn=\'https://maps.googleapis.com/maps/api/js?key=&libraries=geometry,places&callback=A5.map.init\';',
'{UXPRERENDEREDALIAS}_DlgObj._tabObjects = [];',
'A5.loadJavascript(\'\\n\\n;\\nfunction onChange_List_of_receipt_995356d6ad0442008a94946542a46cad(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'LIST_OF_RECEIPT\\\');};\\nfunction onChange_currentuser_5020163a25df48acbbac46af43b34c1a(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'CURRENTUSER\\\');};\\n\\nfunction onChange_FromDate_f613194305954fc9b7a09154096a603a(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'FROMDATE\\\');};\\nfunction onChange_ToDate_4c271c41ea3f4ae28b4b2daeb5e426cb(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'TODATE\\\');};\\nfunction onChange_MEDREPN_262c851ff1344131ba0f9cdee6a9c7a1(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'MEDREPN\\\');};\\n\\n\\n;\\n\');',
'{UXPRERENDEREDALIAS}_DlgObj._controlsThatHaveHiddenProperty = [\'currentuser\']',
'if(!{UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'FROMDATE\']) {  {UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'FROMDATE\'] = new A5.EditDateTime({',
'\ttheme: \'Alpha-Magenta\',',
'\tdateTime: {',
'\t\tformat: \'<DefaultDateOnlyFormat>\',',
'\t\tdatePicker: {',
'\t\t\tdays: {UXPRERENDEREDALIAS}_DlgObj.datePickerDayNames,',
'\t\t\tmonths: {UXPRERENDEREDALIAS}_DlgObj.datePickerMonthNames,',
'\t\t\tstartDay: {UXPRERENDEREDALIAS}_DlgObj.datePickerFirstDayOfWeek-1,',
'\t\t\tcalendar: {',
'\t\t\t\tlockColumnWidth: false,',
'\t\t\t\tdaysOfWeek: {',
'\t\t\t\t\tshow: true',
'\t\t\t\t},',
'\t\t\t\tweeksOfYear: {',
'\t\t\t\t\tshow: false',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tnavigator: {',
'\t\t\t\theader: {',
'\t\t\t\t\ttodayButton: {',
'\t\t\t\t\t\tshow: true,',
'\t\t\t\t\t\thtml: {UXPRERENDEREDALIAS}_DlgObj.datePickerTodayButton,',
'\t\t\t\t\t\ttip: \'\'',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tdisabledDates: {',
'\t\t\t\tlow: \'\',',
'\t\t\t\thigh: \'\',',
'\t\t\t\tdays: []',
'\t\t\t},',
'\t\t\twidth: \'100%\',',
'\t\t\theight: \'\'',
'\t\t},',
'\t\tswitchYear: 20,',
'\t\tcombinedContainer: {',
'\t\t\tstyle: \'display:block\'',
'\t\t}',
'\t},',
'\twindow: {',
'\t\tautoGenerateButtons: false,',
'\t\tbuttons: {',
'\t\t\titems: [',
'\t\t\t{',
'\t\t\t\thtml: \'OK\',',
'\t\t\t\taction: \'commit\'',
'\t\t\t},',
'\t\t\t{',
'\t\t\t\thtml: \'Cancel\',',
'\t\t\t\taction: \'close\'',
'\t\t\t}]',
'\t\t}',
'\t},',
'\tonSelect: function() {$e.execute(this,\'change\');} ,',
'\tmultiple: {',
'\t\tallow: false',
'\t},',
'\tselectionRequired: true',
'});}',
'if(!{UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'TODATE\']) {  {UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'TODATE\'] = new A5.EditDateTime({',
'\ttheme: \'Alpha-Magenta\',',
'\tdateTime: {',
'\t\tformat: \'<DefaultDateFormat>\',',
'\t\tdatePicker: {',
'\t\t\tdays: {UXPRERENDEREDALIAS}_DlgObj.datePickerDayNames,',
'\t\t\tmonths: {UXPRERENDEREDALIAS}_DlgObj.datePickerMonthNames,',
'\t\t\tstartDay: {UXPRERENDEREDALIAS}_DlgObj.datePickerFirstDayOfWeek-1,',
'\t\t\tcalendar: {',
'\t\t\t\tlockColumnWidth: false,',
'\t\t\t\tdaysOfWeek: {',
'\t\t\t\t\tshow: true',
'\t\t\t\t},',
'\t\t\t\tweeksOfYear: {',
'\t\t\t\t\tshow: false',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tnavigator: {',
'\t\t\t\theader: {',
'\t\t\t\t\ttodayButton: {',
'\t\t\t\t\t\tshow: true,',
'\t\t\t\t\t\thtml: {UXPRERENDEREDALIAS}_DlgObj.datePickerTodayButton,',
'\t\t\t\t\t\ttip: \'\'',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tdisabledDates: {',
'\t\t\t\tlow: \'\',',
'\t\t\t\thigh: \'\',',
'\t\t\t\tdays: []',
'\t\t\t},',
'\t\t\twidth: \'100%\',',
'\t\t\theight: \'\'',
'\t\t},',
'\t\tswitchYear: 20,',
'\t\tcombinedContainer: {',
'\t\t\tstyle: \'display:block\'',
'\t\t}',
'\t},',
'\twindow: {',
'\t\tautoGenerateButtons: false,',
'\t\tbuttons: {',
'\t\t\titems: [',
'\t\t\t{',
'\t\t\t\thtml: \'OK\',',
'\t\t\t\taction: \'commit\'',
'\t\t\t},',
'\t\t\t{',
'\t\t\t\thtml: \'Cancel\',',
'\t\t\t\taction: \'close\'',
'\t\t\t}]',
'\t\t}',
'\t},',
'\tonSelect: function() {$e.execute(this,\'change\');} ,',
'\tmultiple: {',
'\t\tallow: false',
'\t},',
'\tselectionRequired: true',
'});}',
'/* DIALOG2FieldHelperBegin:MEDREPN */',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj !== \'undefined\' && typeof {UXPRERENDEREDALIAS}_DlgObj.fieldHelpers!== \'undefined\') if(!{UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'MEDREPN\']){UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'MEDREPN\'] = new A5.EditCombo({dialog.editcombochoices.MEDREPN},{',
'\ttheme: \'Alpha-Magenta\',',
'\tonBind: function() {  } ,',
'\twindow: {',
'\t\theight: \'max: 3in\',',
'\t\tlocation: \'dropdown\'',
'\t},',
'\tbody: {',
'\t\tstyle: \'overflow: auto;\'',
'\t},',
'\tonSelect: function(data,classInst) { ',
'\t$e.execute(this,\'change\');',
'\tif(this.value == \'&nbsp;\') this.value = \'\';;',
';',
'\tclassInst.selecting = false;',
'}',
',',
'\tonBeforeSelect:  function(data,classInst) { ',
'\t//console.log(\'selecting: \' + JSON.stringify(data,\'\',\'\\t\') )',
'\tclassInst.selecting = true;',
'}',
',',
'\tlistbox: {',
'\t\tonItemDraw: function(ele,data,indx) {},',
'\t\titem: {',
'\t\t\tcolumns: [',
'\t\t\t{',
'\t\t\t\tname: \'MEDREP\'',
'\t\t\t}],',
'\t\t\ttemplate: \'{MEDREP}  \',',
'\t\t\tcalculateValue: function(data) { ',
'return \'\' + data.MEDREP;',
'}',
'\t\t}',
'\t},',
'\tselectionRequired: false,',
'\tprogressiveFilterMode: \'in-value\',',
'\tselectionRequiredFilterMode: \'default\'',
'});',
'/* DIALOG2FieldHelperEnd:MEDREPN */',
'{UXPRERENDEREDALIAS}_DlgObj.lookups = {',
'};',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_CURRENTUSER\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};;',
'\t;',
'\tvar enable = (1 == 2);',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.CURRENTUSER\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.CURRENTUSER\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'currentuser\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'currentuser\'); if(obj) {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'currentuser\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'currentuser\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'currentuser\', flag: enable});}',
'}',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.MEDREPN\',\'focusin\',function(e) { ',
'\t\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'MEDREPN\');',
'\t\t\tconsole.log(\'obj.selecting: \' + obj.selecting);',
'\t\t\tvar id = \'\';',
'\t\t\tvar ele = e.relatedTarget;',
'\t\t\tif(ele != null) { ',
'\t\t\t\tid = ele.id',
'\t\t\t}',
'\t\t\t//console.log(id);',
'\t\t\tif(id != obj._listbox.contId + \'.FOCUSCATCHER\' && !obj.selecting) { ',
'\t\t\t\tvar bEle = $(this.id + \'.BUTTON\');',
'\t\t\t\t//bEle.click();',
'\t\t\t\t$e.execute(bEle,A5.d.evnts.click);',
'\t\t\t}',
'\t\t});',
'window[\'{UXPRERENDEREDALIAS}_O_B1CA1F40726C45E393970E7FC0CBB884\'] = function(rowNum,rowId,objEle) {',
'var runMethod = \'ajax\';',
'if(runMethod == \'ajax\') {',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj._onlineStatus != \'undefined\') { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj._onlineStatus == \'offline\') { ',
'\t\t( function() {  }() );',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onAjaxCallbackNotAvailable\', {xbasicFunctionName: \'\', ajaxEvent: \'OpenComponent\'})',
'\t\treturn false;',
'\t}',
'}\t\t',
'};',
'var panelId = {UXPRERENDEREDALIAS}_DlgObj.panelGetId(\'PANELCARD_2\',\'body\');',
'$(panelId).innerHTML =\'<div id="\'+panelId+\'.__REPORTHTML"></div> \';',
'var eleInnerPanel = $(panelId+\'.__REPORTHTML\');',
'{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_2\',true,true);',
'eleInnerPanel.innerHTML = \'<img src="css/A5System/Images/wait.gif" />Working...\';',
'\tvar ro = new Object();',
'ro.ajaxFailedMessage = \'\';',
'ro.ajaxCallbackTimeout = {UXPRERENDEREDALIAS}_DlgObj.ajaxCallbackTimeout;',
'\tro.hostComponentType = \'Dialog\';',
'\tro.reportName = \'listofreceipts@ProjectReport\';',
'\tro.reportNameShort = \'listofreceipts\';',
'\tro.reportType = \'Report\';',
'\tro.reportIFrame = \'IFRAME_\'+panelId;',
'\tro.gridId = \'{UXPRERENDEREDALIAS}\';',
'\tro.download = \'N\';',
'\tro.xbasicFunction = \'\';',
'\tro.clientSideFilename = \'\';',
'\tro.reportMessagesDivId = \'\';',
'\tro.filter = \'medrep = `\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'MEDREPN\')+\'` .OR. supervison = `\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'MEDREPN\')+\'` .OR. areamanager = `\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'MEDREPN\')+\'`  .OR. linemanager = `\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'MEDREPN\')+\'`\';',
'\tro.order = \'\';',
'\tro.sqlFilter = \'\';',
'\tro.mode = \'Odialog2\';',
'\tro.sqlOrder = \'\';',
'\tro.arguments = \'mCompId|Numeric|session.compid||mDat1|Date|\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'FROMDATE\')+\'||mDat2|Date|\'+{UXPRERENDEREDALIAS}_DlgObj.getValue(\'TODATE\')+\'\';',
'\tro.rawArgumentMapping = \'mCompId|Numeric|session.compid||mDat1|Date|{FromDate}||mDat2|Date|{ToDate}\';',
'\tro.controlReferences = [\'FROMDATE\',\'TODATE\'];',
'\tro.workingMessage = \'Working...\';',
'\tro.workingMessageIcon = \'css/A5System/Images/wait.gif\'',
'\tro.pdfoptions = \'\';',
'\tro.displayMode = \'\';',
'\tro.saveAs = \'HTML\';',
'\tro.pdfOpenParameters = \'\' ;',
'\tif(ro.hostComponentType == \'Grid\') { ',
'\t\tro._gridCurrentFilter = {UXPRERENDEREDALIAS}_DlgObj._gridFilter;',
'\t\tro._gridCurrentArguments = {UXPRERENDEREDALIAS}_DlgObj._gridArguments;',
'\t\tro.arrayControls = {UXPRERENDEREDALIAS}_DlgObj._getArrayControls();',
'\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._gridFilterENC != \'undefined\') { ',
'\t\t\tro._gridCurrentFilterENC = {UXPRERENDEREDALIAS}_DlgObj._gridFilterENC;',
'\t\t\tro._gridCurrentArgumentsENC = {UXPRERENDEREDALIAS}_DlgObj._gridArgumentsENC;',
'\t\t\tdelete ro._gridCurrentFilter;',
'\t\t\tdelete ro._gridCurrentArguments;',
'\t\t}',
'\t\tro._gridCurrentOrder = {UXPRERENDEREDALIAS}_DlgObj._gridOrder;',
'\t\tro._gridCurrentDBType = {UXPRERENDEREDALIAS}_DlgObj._gridDBType;',
'\t}',
'\tro._rowNumber = rowNum;',
'\tro.afterExecuteJavascript = \'{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\\\'PANELCARD_2\\\',true,true);\\n\';',
'\tif(A5.__dtfmt) ro.__dtfmt = A5.__dtfmt;',
'\tro.__flagIIS = false;',
'\tif(A5.__flagIIS) ro.__flagIIS = A5.__flagIIS;',
'\t//should the PDF be displayed in a PDFViewer control',
'\tro.pdfTarget = false;',
'\tro.pdfViewerID = \'\';',
'\tro.htmlReporting = {initialView: \'HTML\',styleName: \'Alpha-Magenta\',componentAlias: \'{UXPRERENDEREDALIAS}\',buttons: {pdf: true,excel: true,word: true,text: false,printHTML: true,pdfButton: {text: \'PDF\',buttonType: \'Image followed by text\',imageName: \'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACZElEQVR42qWTT0gUcRTHv/NzVmd/O+2waplQIPTnIJRZLCVdTMgSo5OHqE4dIuhSWpSHIBCJiAgqgkQUImu9pXQM6eAhJIVUgiDUdQV3DWlndnd2dn7vN9Nh/bOw0sUHj8c7fD+8L+89xfd97CYYdhlqaTM4PLauh4K+kMSIiBEJRiQVScQyVqYybOijt29du16qUUotfBr/mm47FzWyWRsuEYQgCCHgCsL091lUVxv+zMzci77H3T3bgJaWZMZx6qxCAZtpbtQ8D0F/NQhL+ihkM7h65TJGYuP+wkL8+dP+B/cBoOJRff0zLRpFuLYWe2tqcCASwSHDQGM4jG9Liziy+BuyvQOWaaKpqRENDQeVxMrqmY+xMX7xQusXVQCp9cnJOrNkAqtQgOm6UKtrEEgsI6IyTCdTeDvwHradh+sKZtu5bgAPVW1qar8GYB+AkdjndPv5s4ZtO2BMgeLksRY9Bf1PEh2d7UibGaRNC6aVw1/TzJWt0ZMSiqKAMQbGGBCPg3d1Qf0xgz06hx7i0DmHzkPwPE/+B1CEePNz4J2XQKkk/F8/wYMaeJCD8yr4npRldyA9uSVm8EETEwi8fA2tQFi51wPvRDP85ii0k6fhSW8HgJRgGxb80Rjk0hLsu3cgjh1H+MZN2NkscmspVKkVkDtN4HlFC8r8LGR/H5S+Jwi0tgGCACGhEKFSSAhBkJLKAfm847irKSPQ24vs0DvQ4aMQLkFsXaUEUbFKQX4ZwHEcN6cFQW8G4OrhEvG2cBPkClH+TIsL8dDQ8IcEUVFIJCEFgUgUe0kgIpAgrCSWOQD8A03mbUJ5QKFgAAAAAElFTkSuQmCC\',bubbleHelp: \'Print report as a PDF document.\'},excelButton: {text: \'Excel\',buttonType: \'Image followed by text\',imageName: \'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACOUlEQVR42pWTy0vUURTHP/Pw0YCGo4JDo0a+e8wUzCIsoiBaRbSJIvoTpNcmWkWRkmTiSqJIgrZtyogWZdCiNBclWjlWojEwlprzUseZc+60mJmfjwjybL6ce+De7/ne79fW8/J6RkRQUUSzqCKIKKo5tPq/Z04RobFmD6JpRMVCzfcm/c9Z8OMEzuzLafZXH2Ez1TtwExHFriqICputLBPBKTkG3a+7CIaDZEwGk1b82/y0HbvAWGiUnifdLC4sko6nSMVT7G3YR1mLDRXNrqAqHKo7zPTCFLWtlSxHVxh//4U7/beZCAdxeYpwebeQCC8RG4tw5vhZnk88yq6QFydQE+BA9UFCg3MUuQoobyll5PsIFBocxU6WZpeJjUVov3SLXQ27EU2jKthVFDFZDU4FTlNJFT8/LVBcWojHV0EslCAyGSU6GqHjcifNdS2rGohiF8kyAMAGXk81M5/niYcXcbmLqdxZTnQ6zvlzF2na0bxGxDQieQYqmIyh7+0Dhn8M4fG5mXoTQpNCSZWLiiY39x7fZT4yt3qByTHQnAYPh/oY/PYOCgyJ2SQOVwHj/ZPYHXa2bi/BVmHnatcVkitJAMtMzrwtA95WyhxuzIqiKcWUGWZ//2L4xRDOcgeZjGFmPkzn/Q6utd2wNLCc6PP68Xn968xiMoZnr54SS8SyB41QX1u/RgPFqSrWL2wsu83OiaMn/8+JvQPtqwFai2ZDuPKBMtYKQvDD13XRVVWsiG+I9brYq/IHpszb2W6YMygAAAAASUVORK5CYII=\',bubbleHelp: \'Export report to Excel.\'},wordButton: {text: \'Word\',buttonType: \'Image followed by text\',imageName: \'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACGklEQVR42pWTTUhUURTHf85M40flqjBIhhZBC/vCrUy7EhdBEIWLCDLbSQtpZVBCEM6uNhZIFJEQhUiLRqEIFxWDQQmpg1aYKGjZTKgzzNz7znnT4r35pI0HLpz3zrvn/u55/3/djeFUQUQQ9ZcoooLWPHu5IFpRFyEkIpyLNiOqqLqIv7xcK3IXdbWqPjqZJOR1V9oP72In8Ti+hKgQKJ6801BV/woqiLrcfRmmUChgrME6lqErDSSSOR5NpBjpb6X7zjzWWoxjsNZy/lQLokJIxWtQKLgYa7HWYBzLWjrI0zd/MNYClGrbqTXEEVT3o6oEvIm63LwoGGswjmGop5nhVyl+r66yvjgDQP+FCLnsNluf3xHrPeIP05+BqAJ4p1vDs7dpfqykWXk/hqqymXG492KBzbmPdJ4+QTR6DHFdRKRM4GEarDVMzfzl16fXdJ05SX1LhPtj31ie+0qTbDE4eMkfYpFABHH9Bo5HkF6cZk8gy8BAN8YxTEwtkP/+hYcP+mhsrAegSB6qJdhaX2ZjNsH4+C3C4RD5fI7M7Ad6r3XRdvRQxW/0CdRXG4DJZdmYjhOL9XCwdR8AmZ/zRA7s5Xrf2SodiLpoWQfeEJ/fPk6i8yodHW2lD+Mjl2na3UAgUFcjJI8gJFK+QjAYqNoMlEhqQ3yvlJT4JL5UNopbbaJKo5WNVSRQZXQyWbavr/H/2rvCzt475R8j+PhlHf6sWAAAAABJRU5ErkJggg==\',bubbleHelp: \'Export report to Word.\'},printHTMLButton: {text: \'Print HTML\',buttonType: \'Image followed by text\',imageName: \'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACQUlEQVR42p2Sz0tUURTHv+/OmxlG0ZCMSEYosoJoSAonImpRbzNMxYCgmyEQMmjhf2DQLAQXQotoU4NbXUiMttFw0yJIVy50VTAwyTS8QUabX84759zbQh2c/EH0hcu5i3s/53zPOZYxBgDwYXp+u6MjpEVYEbFiYcXMSpitYnGr+vrVWDeOkX1w6T7baT16GO36Xa7AI4bnETyP0PAIn5e+VHGCmgBmNtVaHbOz8xCtISwQEVy6egUNb9f7BwDBtn0YHIyj4Xmo1nZRrtRQqdahRcupAMdx+pLPXnYqS2FhYQkWsFeFaETvDkC40TM+Pr7tui5yudzA4uLi9xZAJBKZsX0+SykLQ0NPoZQFANgp17CzU0Zbe7t6PjJyxnVdTE5OvgHwuAlwHKcvkUjc3Fhfwcb6ykmVolAogIgQDodvOY7Tt7y8/AMA7EgkMjM8POwPhUI4GKkxBsYYaK0hIi0xmUxeKJVK0wAeAIAtIpfX1taanw8DjDEQkZa4D7vWtBAMBiv9/f1dWmtorZuPtNZgZhDRkRMMBhtHxphKpXCaRkdH8eRFFB/ffT1+D67fuI379+5gq7QNZgGLQFiDRbD6ba+5n96vguivPchms/bExIScO3/RF+7thQq0gTyGRwyivfirUEQ6nZaDZrqu20ys5ubmeogoHwgEIFqDiUHM+/4ZTAy/bSMWi/ni8bhPa53PZDI9LRby+bzdID9PTb21atW6IWEIEYgJzIzNzZ9WJlPOA0CxWLQPW7AOj+9/9AcTs3PS+mqd7gAAAABJRU5ErkJggg==\',bubbleHelp: \'Print the HTML report.\'},bookmarksButton: {buttonType: \'Text\',text: \'Bookmarks\',imageName: \'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAACPklEQVR42qWTu2sUURSHv3vnEWdfs8lOsiQ+EJNgogmKhfgfiIUg2FkJQipLRUWCBBUT1E5BFMFC7ASxEETER2UUNBohhMS0kscmszs7uzuzs3MtQpYsiVVOdbjn8HF/v3OOUEqxk5DsMPSNZPz26AspGEYITwi5LJDPLl+78Qrg7p2xM4r4vFJxJ0qlY8X01es3z7UApJQDF0YuDlX8MkV3jbm5mdO3xq64AL39vdn+/kFhZ9tJJFM8ffyg3vID8VqkxxmVhZVFKn4ZwzA5dHhIJCyrHRT7D/QR1RsUVhapVn1iFWvipEiqt8pf96BuTbh6qSfn5HGcPFKTlD2vqbPseUhN4jh5ck4eN/B6MLWJTRJUIkZphZVF3LUCAIZhsEkeXqmIVyqSbc+hiCWCVIsHoJSd7SCTsQnDEN8vNSu7LIuck8c0TYTUQKG2TAHAL3usFpaIoggVx813d3WVouui6zodua7tx4gCO9tBMpmiXg+JopBSqQhA9+496LqJYZjohgmblq8JqBeC1KOH9wMpJZaVFMNHjuobi7bwZz7+9XMqqlYqxHFMVAnSWwA1o1oe6DuRAwiCgN8/vlP01n2w0xnZ5XSabd09ALyf/FBoAdh/2fu1+ikzPTUZbRQOWoPymH1cAnxzv8Tzy7NNU6qilrGzcl8ToNW0565RcutBzQdooKyPjXdnZ72ZMFShKsglw4qTLyUiBKg0goRmam8AxP+use9S8lRbo22kIVQ5lLUnC/eqn7frEzs9538gH+3P1K5yIwAAAABJRU5ErkJggg==\'}},bookMarkPanelSize: \'3in\',htmlReportHeight: \'3in\',htmlReportWidth: \'6in\',reportTargetType: \'div\',flagResizeDiv: false,reportTargetId: panelId,pdfOptions: \'\'};',
'\tif({UXPRERENDEREDALIAS}_DlgObj._embeddedMode) {',
'\t\tvar callWorkingPreview = true;',
'\t\tif( typeof ro.htmlReporting == \'object\' ) {',
'\t\t\tif( ro.htmlReporting.initialView == "HTML" ) {',
'\t\t\t\tcallWorkingPreview = false;',
'\t\t\t}',
'\t\t}',
'\t\tif( callWorkingPreview ) {',
'\t\t\tro.windowType = \'MDI\';',
'\t\t\tvar usingPDFViewer = false;',
'\t\t\tif(typeof ro.pdfTarget != \'undefined\') usingPDFViewer = ro.pdfTarget;',
'\t\t\tif(!usingPDFViewer) {',
'\t\t\t\treportPreviewFromWorkingPreview(ro);',
'\t\t\t\treturn false;',
'\t\t\t}',
'\t\t}',
'\t}',
'\tA5.component.runReport(ro);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({',
'\t"__dtfmt": "dd/MM/yyyy",',
'\t"__tfmt": "",',
'\t"__dialogGuid": "b48f2396-3f25-40c8-a109-820f8de8d33f",',
'\t"argumentsBoundToCotrols": "",',
'\t"__sgr": ""',
'});//ssi3;',
'{UXPRERENDEREDALIAS}_DlgObj._cascadingControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._cascadingControlsChildren = [];',
'A5.msgBox.theme = \'Alpha-Magenta\';',
'A5.msgBox.buttonWidth = \'1in\';',
'{UXPRERENDEREDALIAS}_DlgObj._defaultWindowTitleDirection = \'ltr\';',
'{UXPRERENDEREDALIAS}_DlgObj._controlContainers = {}',
'{UXPRERENDEREDALIAS}_DlgObj._panelCardControls = {',
'LIST_OF_RECEIPT:\'PANELCARD_1\',',
'CURRENTUSER:\'PANELCARD_1\',',
'FROMDATE:\'PANELCARD_1\',',
'TODATE:\'PANELCARD_1\',',
'MEDREPN:\'PANELCARD_1\'',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._controlsOnPanel = {',
'\t\'PANELCARD_1\' : {controls: [\'LIST_OF_RECEIPT\',\'CURRENTUSER\',\'FROMDATE\',\'TODATE\',\'MEDREPN\']}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._buttons = {};',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_1\'] = new A5.Button({',
'\tlayout: \'text\',',
'\tstyle: \'box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\',',
'\thtml: \'View Receipts for the selected Rep.\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta:raised\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_1\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_1\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_1\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_1\');',
'{UXPRERENDEREDALIAS}_DlgObj._controlBars = {}; ',
'{UXPRERENDEREDALIAS}_DlgObj._controlBars[\'CONTROLBAR_1\'] = {',
'\t"settings": {',
'    "_name": "CONTROLBAR_1",',
'    "className": "{UXPRERENDEREDALIAS}_CONTROLBAR_1",',
'    "disclosuresClassName": "{UXPRERENDEREDALIAS}_CONTROLBAR_1",',
'    "__listNavigationState": function(listName) {var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(listName);',
'if(!lObj) return false;',
'var ls = lObj._state;',
'var flagFirst = true;',
'var flagPrev = true;',
'var flagNext = true;',
'var flagLast = true;',
'if(ls.pageCount == 1) {',
' flagFirst = false;',
' flagPrev = false;',
' flagNext = false;',
' flagLast = false;',
'} else {',
' if(ls.page ==1) {',
'  flagFirst = false;',
'  flagPrev = false;',
' } else if (ls.page == ls.pageCount) {',
'  flagNext = false;',
'  flagLast = false;',
' }',
'};',
'var txtPageNumber = \'\' + ls.page + \'/\' + ls.pageCount;',
'var _d = this.data;',
'var name;',
'name = \'LISTNAV_\' + listName.toUpperCase() + \'_first\';',
'if(typeof _d[name] != \'undefined\') _d[name] = !flagFirst;',
'name = \'LISTNAV_\' + listName.toUpperCase() + \'_prev\';',
'if(typeof _d[name] != \'undefined\') _d[name] = !flagPrev;',
'name = \'LISTNAV_\' + listName.toUpperCase() + \'_next\';',
'if(typeof _d[name] != \'undefined\') _d[name] = !flagNext;',
'name = \'LISTNAV_\' + listName.toUpperCase() + \'_last\';',
'if(typeof _d[name] != \'undefined\') _d[name] = !flagLast;',
'name = \'LISTNAV_\' + listName.toUpperCase() + \'_pageNumber\';',
'if(typeof _d[name] != \'undefined\') _d[name] = txtPageNumber;',
'this.refresh();},',
'    "__badgeText": function(txt,max) {if( (typeof txt == \'string\' && txt.toNumber() == txt) ) {',
' txt = txt.toNumber()',
'}',
'if(typeof txt == \'number\' && txt > max) {',
' txt = max + \'+\';',
'}',
'if(txt == 0 || !txt || txt == \'false\') {',
' txt = \'\';',
'}',
'return txt},',
'    "theme": "Alpha-Magenta",',
'    "edge": "top",',
'    "items": {',
'        "Back": {',
'            "size": "",',
'            "type": "button",',
'            "autoHideDisclosure": "auto",',
'            "bind": {},',
'            "actions": {',
'                "click": "SystemAction_135f181ebb494774abae9d31d42af7c1"',
'            },',
'            "settings": {',
'                "layout": "icon text",',
'                "theme": "Alpha-Magenta:left",',
'                "html": "Back"',
'            }',
'        }',
'    },',
'    "actions": {',
'        "Back_onClick": function(data) {alert(\'this action not yet defined\');},',
'        "SystemAction_135f181ebb494774abae9d31d42af7c1": function(data) {{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_1\');}',
'    },',
'    "layout": "Default",',
'    "layouts": {',
'        "Default": {',
'            "lines": [',
'                {',
'                    "before": {',
'                        "items": [',
'                            "Back"',
'                        ]',
'                    },',
'                    "middle": {',
'                        "items": []',
'                    },',
'                    "after": {',
'                        "items": []',
'                    }',
'                }',
'            ]',
'        }',
'    },',
'    "disclosures": {}',
'},',
'\t"data": {},',
'\t"id": "{UXPRERENDEREDALIAS}.V.R1.CONTROLBAR_1"',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.setVariables({});',
'{UXPRERENDEREDALIAS}_DlgObj._dataBoundControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._primaryTableAlias = \'\';',
'{UXPRERENDEREDALIAS}_DlgObj._actions = {};',
'{UXPRERENDEREDALIAS}_DlgObj._actions[\'getvalue\'] = \'\';',
'{UXPRERENDEREDALIAS}_DlgObj._hasPanels = true;',
'{UXPRERENDEREDALIAS}_DlgObj._hasOnSynchronizeEvent = false;',
'{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation = function() {',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj == \'undefined\') return \'\';',
'\tvar orientation = {UXPRERENDEREDALIAS}_DlgObj.getOrientation();',
'\tif( orientation == \'landscape\') {',
'\t\t\t//landscape',
'\t\t\tif({UXPRERENDEREDALIAS}_DlgObj._orientation != \'landscape\') {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._orientation = \'landscape\';',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onOrientationChange\',{orientation: \'landscape\'});',
'\t\t\t}',
'\t} else {',
'\t\t//portrait',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj._orientation != \'portrait\') {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._orientation = \'portrait\';',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onOrientationChange\',{orientation: \'portrait\'});',
'\t\t\t}',
'\t}',
'}',
'\tA5.flags.cordovaLoaded = true;',
'\ttry {',
'\t\tdocument.addEventListener(\'deviceready\', function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = true;',
'\t\t\t//alert(\'fire on cordova ready 2\')',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onCordovaReady\',{});',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onPhoneGapReady\',{});',
'\t\t\tnavigator.geolocation.getAccuratePosition = function(geolocationSuccess, geolocationError, options) {',
' var _lastCheckedPosition = null;',
' var _locationEventCount = 0;',
' options = options || {};',
' options.context = this;',
'    function _checkLocation(pos) {',
'        _lastCheckedPosition = pos;',
'        _locationEventCount++;',
'        if ((pos.coords.accuracy <= options.desiredAccuracy) && (_locationEventCount > options.ignoreResultCount)) {',
'            clearTimeout(_timerID);',
'            navigator.geolocation.clearWatch(_watchID);',
'            _foundPosition(pos);',
'        }',
'    }',
'    function _stopLocationCheck() {',
'      var error = {};',
'      error.code = 0;',
'      error.message = \'Timeout: No results\';',
'        navigator.geolocation.clearWatch(_watchID);',
'        _lastCheckedPosition ? _foundPosition(_lastCheckedPosition) : geolocationError.call(options.context,error);',
'    }',
'    function _onError(error) {',
'        clearTimeout(_timerID);',
'        navigator.geolocation.clearWatch(_watchID);',
'        geolocationError.call(options.context,error);',
'    }',
'    function _foundPosition(pos) {',
'        geolocationSuccess.call(options.context,pos);',
'    }',
'    if (!options.maxWait) {',
'     options.maxWait = 10000;',
'    }',
'    if (!options.desiredAccuracy) {',
'       options.desiredAccuracy = 20;',
'    }',
'    if (!options.timeout) {',
'        options.timeout = options.maxWait;',
'  }',
'  if (!options.ignoreResultCount) {',
'    options.ignoreResultCount = 1;',
'  }',
'    options.maximumAge = 0;',
'    options.enableHighAccuracy = true;',
'    var _watchID = navigator.geolocation.watchPosition(_checkLocation, _onError, options);',
'    var _timerID = setTimeout(_stopLocationCheck, options.maxWait);',
'}',
'\t\t} , false);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._onPhoneGapReady = function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executePhoneGapDelayed();',
'\t\t\tif({UXPRERENDEREDALIAS}_DlgObj) {',
'\t\t\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();',
'\t\t\t\tif(obj) obj.resize();',
'\t\t\t\tif({UXPRERENDEREDALIAS}_DlgObj.instantUpdateOnRenderComplete) {UXPRERENDEREDALIAS}_DlgObj.instantUpdateOnRenderComplete()',
'\t\t\t};',
'\t\t}',
'\t}',
'\tcatch(err) {}',
'{UXPRERENDEREDALIAS}_DlgObj._waitGif = \'css/A5System/Images/wait.gif\';',
'/*',
'Copyright (c) 2001, 2019 Alpha Software Corporation',
'All Rights Reserved.',
'This Javascript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'\t{UXPRERENDEREDALIAS}_DlgObj.imageCaptureUsingCamera = function(options) {',
'\t\toptions.specialMode = \'callback\';',
'\t\ttry{',
'\t\t\tif(options.pictureSourceVal == \'0\') options.phonegapMoveFileToPermanentStorage = false;',
'\t\t}catch(e) { };',
'\t\tthis.detailViewImageCapture(options);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCapture = function(options) {',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tvar flagPhoneGapLoaded = false;',
'\t\tvar flagUseCordova = false;',
'\t\tif (typeof window[\'cordova\'] != \'undefined\') {',
'\t\t\tflagPhoneGapLoaded = true;',
'\t\t\tif(options.captureMethod == \'phonegappreferred\' || options.captureMethod == \'phonegap\') {',
'\t\t\t\tflagUseCordova = true;',
'\t\t\t}',
'\t\t}',
'\t\tif(options.captureMethod == \'phonegap\' && flagPhoneGapLoaded == false) {',
'\t\t\talert(\'PhoneGap not available\'); return false;',
'\t\t}',
'\t\tif(!flagUseCordova) {',
'\t\t\tthis.detailViewImageCaptureHTML5(options);',
'\t\t} else {',
'\t\t\tthis.detailViewImageCapturePhoneGap(options);',
'\t\t}',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCaptureHTML5 = function(options) {',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tif(options.onBeforeCaptureJavascript) {',
'\t\t\tvar result = options.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tif(A5.flags.isAndroid == false) {',
'\t\t\tif(A5.flags.isIPhone || A5.flags.isIPad){',
'\t\t\t\tif (typeof A5.flags.iOSVersion != \'undefined\') {',
'\t\t\t\t\tvar majorNum = A5.flags.iOSVersion.split(\'.\')[0];',
'\t\t\t\t\tif(parseInt(majorNum) < 6) {',
'\t\t\t\t\t\talert(\'HTML5 camera access not supported on this version of iOS\');',
'\t\t\t\t\t\treturn false;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tif(A5.u.css.supportsTransition == false) {',
'\t\t\talert(\'Browser does not support HTML5 camera access\');',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof options.resizePolicyHTML5 == \'undefined\') options.resizePolicyHTML5 = \'Always\';',
'\t\toptions.resizePolicyHTML5 = options.resizePolicyHTML5.toLowerCase();',
'\t\tif(options.resizePolicyHTML5 != \'always\') {',
'\t\t\tvar maxSize = 99999999999;',
'\t\t\tif(typeof options.maxImageSizeHTML5 != \'undefined\') maxSize = Number(options.maxImageSizeHTML5);',
'\t\t}',
'\t\t//if(typeof options.resizeImageHTML5 == \'undefined\') options.resizeImageHTML5 = true;',
'\t\tvar ops = {};',
'\t\tops.dialogObj = this;',
'\t\tif(options.specialMode == \'callback\' ) {',
'\t\t\toptions.controlName = \'\';',
'\t\t}',
'\t\tif(typeof options.android14mode == \'undefined\') options.android14mode = \'Camera\'',
'\t \tops.targetImage = options.controlName;',
'\t \tops.targetImage = ops.targetImage.toUpperCase();',
'\t \tops.html5 = {};',
'\t \tops.html5.resizeFlag = options.resizeImageHTML5;',
'\t \tops.html5.compressionFactor = options.imageCompressionHTML5;',
'\t \tops.html5.maxWidth = options.maxImageWidth;',
'\t \tops.html5.maxHeight = options.maxImageHeight;',
'\t \tops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t \tops.imageFieldName = (ops.fieldPrefix + \'.\' + ops.targetImage).toUpperCase();',
'\t \tops.hiddenFileName =  (ops.fieldPrefix + \'.\' + ops.targetImage + \'_HIDDENA5FN\').toUpperCase();',
'\t \tops.android14mode = options.android14mode;',
' \t\tops.handleFileSelect = function(evt) {',
'\t\t\t// creates a FileList object',
'\t\t\tvar files = evt.target.files;',
'\t\t\t// Even if multiple files are presented, only the first file will be uploaded.',
'\t\t\tif (!files.length){',
'\t\t\t\t// alerts should be ok here when fired by a timer',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\t\t//alert(\'<a5:r>No files selected.</a5:r>\');',
'\t\t\t\t},50);',
'\t\t\t\treturn false;',
'\t\t\t} else {',
'\t\t\t\t// we\'re processing only 1 file at this point',
'\t\t\t\tvar f = files[0];',
'\t\t\t\tops.updateImage(f);',
'\t\t\t}',
'\t\t}',
'\t\tif(ops.android14mode.toLowerCase() == \'library\') {',
'\t\t\tvar ele = $(this.dialogId + \'._GETPHOTO\');',
'\t\t\tele.removeAttribute(\'capture\');',
'\t\t}',
'\t\t$e.removeGroup(\'__detailViewImageCapture\')',
'\t\t$e.add($(this.dialogId + \'._GETPHOTO\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__detailViewImageCapture\');',
'\t\tops.updateImage = function(_thisFile) {',
'\t\t\tvar _sourceFileName = _thisFile.name;',
'\t\t\tvar _thisImageName = ops.imageFieldName;',
'\t\t\tvar _thisImage = $(_thisImageName);',
'\t\t\tvar reader = new FileReader();',
'\t\t\treader.onload = function(e) {',
'\t\t\t\tvar flagResize = false;',
'\t\t\t\tif(options.resizePolicyHTML5 == \'always\') {',
'\t\t\t\t\tflagResize = true;',
'\t\t\t\t} else {',
'\t\t\t\t\tif(e.target.result.length > maxSize) {',
'\t\t\t\t\t\tflagResize = true;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(!flagResize) {',
'\t\t\t\t\t//not resizing',
'\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\t_thisImage.src = e.target.result;',
'\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\tif(eleH) eleH.src = _thisImage.src;',
'\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t$sa(eleH,\'a5imageSourceName\',_sourceFileName);',
'\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result});',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\t//resizing',
'\t\t\t\t\tif(options.displaySpinnerWhileResizingImage) {',
'\t\t\t\t\t\t_thisImage.src = options.spinnerURI.replace(/\\|/gi,\'/\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _orientation = ops.parseExifOrientation(e.target.result);',
'\t\t\t\t\tops.renderImgToCanvas(_thisFile,_orientation,_sourceFileName);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\treader.onerror = function(e) {',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\talert(\'<a5:r>Error reading file.</a5:r>\');',
'\t\t\t\t},0);',
'\t\t\t}',
'\t\t\treader.readAsDataURL(_thisFile);',
'\t\t}',
'\t\tops.parseExifOrientation = function(dataUrl) {',
'\t\t\ttry {',
'\t\t\t\t// Some of the more current browsers set the default image_orientation property to from-image',
'\t\t\t\t// It was previously always set to none. This check insures that the image is not rotated twice.',
'\t\t\t\t/* -----------------',
'\t\t\t\t* // 8-13-2020: modified to return null for all iOS browsers',
'\t\t\t\t* if (parseFloat(A5.flags.iOSVersion)>= 13.2) {',
'\t\t\t\t* // if running on an iOS device then check version, do not rotate for versions 13.2 snd greater',
'\t\t\t\t* return null;',
'\t\t\t\t* ------------------',
'\t\t\t\t*/',
'\t\t\t\tif (A5.flags.browserSpecs.name == "Safari") {',
'\t\t\t\t\treturn null;',
'\t\t\t\t} else if ((A5.flags.browserSpecs.name == "Chrome") && (parseFloat(A5.flags.browserSpecs.version) >= 83)) {',
'\t\t\t\t\t//if running on Chrome version 81 or greater, do not rotate',
'\t\t\t\t\treturn null;',
'\t\t\t\t} else if ((A5.flags.browserSpecs.name == "Firefox") && (parseFloat(A5.flags.browserSpecs.version) >= 75)) {',
'\t\t\t\t\t//if running on Firefox version 75 or greater, do not rotate',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t\t// This universal check should work with all modern browsers (Opera, etc.) that set the default value of imageOrientation to "from-image"',
'\t\t\t\tvar _obj = getComputedStyle(document.body);',
'\t\t\t\tif (obj.imageOrientation == "from-image") {',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t\tvar _byteString = atob(dataUrl.split(\',\')[1]);',
'\t\t\t\tvar _binaryFile = new EXIF.BinaryFile(_byteString, 0, _byteString.length);',
'\t\t\t\tvar _exif = EXIF.findEXIFinJPEG(_binaryFile);',
'\t\t\t\t// Store EXIF orientation (if available) in data property.',
'\t\t\t\tif (_exif && _exif[\'Orientation\']) {',
'\t\t\t\t\treturn _exif[\'Orientation\'];',
'\t\t\t\t} else {',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t} catch (e) {',
'\t\t\t\t// Error parsing EXIF data.',
'\t\t\t\tconsole.log(\'Error loading EXIF data\', e);',
'\t\t\t\treturn null;',
'\t\t\t}',
'\t\t}',
'\t\tops.renderImgToCanvas = function(_file,_orientation,_sourceFileName) {',
'\t\t\t// using megapix-image.js here which handles(?) sub-sampling issue with large images and Canvas on iOS6 Safari',
'\t\t\tvar mpImg = new MegaPixImage(_file);',
'\t\t\tmpImg.onrender = function(){',
'\t\t\t\t// this timeout required to ensure _thisCanvas render complete',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\t\tvar dataURL = _thisCanvas.toDataURL(\'image/jpeg\', ops.html5.compressionFactor);',
'\t\t\t\t\t//alert(\'html5 size after resizing image:\' + dataURL.length);',
'\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\t\t//put the scaled image in the element',
'\t\t\t\t\t\tele.src = dataURL;',
'\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\tif(eleH) eleH.src = dataURL;',
'\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t$sa(eleH,\'a5imageSourceName\',_sourceFileName);',
'\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : dataURL, sourceFileName: _sourceFileName});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : dataURL, sourceFileName: _sourceFileName});',
'\t\t\t\t\t}',
'\t\t\t\t},0);',
'\t\t\t}',
'\t\t\tvar _thisCanvas = document.createElement(\'canvas\');',
'\t\t\tvar ctx = _thisCanvas.getContext(\'2d\');',
'\t\t\t// adjust based on extracted _orientation',
'\t\t\tif (_orientation) {',
'\t\t\t\tmpImg.render(_thisCanvas,{maxWidth: ops.html5.maxWidth, maxHeight:ops.html5.maxHeight, orientation:_orientation});',
'\t\t\t} else {',
'\t\t\t\tmpImg.render(_thisCanvas,{maxWidth: ops.html5.maxWidth, maxHeight:ops.html5.maxHeight});',
'\t\t\t}',
'\t\t}',
'\t\t//click the hidden image control',
'\t\tvar ele = $(this.dialogId + \'._GETPHOTO\');',
'\t\tif (ele) {',
'\t\t\tele.value = \'\';',
'\t\t\tele.click();',
'\t\t}',
'\t}',
'\t/////\\\\\\\\\\',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewVideoCapturePhoneGap = function(opsIn) {',
'\t\t//ops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t\t//ops.videoFieldName = (ops.fieldPrefix + \'.\' + ops.controlName).toUpperCase();',
'\t\topsIn.dialogObj = this;',
'\t\tvar options = opsIn.options;',
'\t\tvar onSuccess = function(mediaFiles) { var e = {filename: mediaFiles[0].fullPath};',
'\t\t\tvar e_filename = e.filename;',
'\t\t\tif(e_filename.indexOf(\'file:\') != 0) {',
'\t\t\t\te_filename = e_filename.replace(\'/private\',\'file:\\/\\/\');',
'\t\t\t}',
'\t\t\tif(e_filename.indexOf(\'file:\') != 0 && e_filename.indexOf(\'.wav\') > 0) {',
'\t\t\t\te_filename = \'file:\\/\\/\' + e_filename;',
'\t\t\t\t//alert(e_filename);',
'\t\t\t}',
'\t\t\topsIn.dialogObj.setValue(opsIn.controlName,e_filename);',
'\t\t\t//var ele = $(ops.imageFieldName);',
'\t\t\t//if(ele) ele.src = thisImageURL;',
'\t\t\t//var eleH = $(ops.hiddenFileName);',
'\t\t\t//if(eleH) eleH.src = thisImageURL;',
'\t\t\t//$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\topsIn.dialogObj.refreshClientSideComputations();',
'\t\t};',
'\t\tvar onFailed = function() {',
'\t\t};',
'\t\tvar flagAudio = false;',
'\t\tif(typeof opsIn.audio != \'undefined\') flagAudio = opsIn.audio;',
'\t\tif(!flagAudio) {',
'\t\t\tnavigator.device.capture.captureVideo(onSuccess,onFailed,options);',
'\t\t} else {',
'\t\t\t//alert(\'audio\');',
'\t\t\t//debugger;',
'\t\t\tvar options = { limit: 1, duration: 10 };',
'\t\t\t//navigator.device.capture.captureAudio(captureSuccess, captureError, options);',
'\t\t\t//navigator.device.capture.captureAudio(onSuccess,onFailed,options);',
'\t\t\tvar _media = {',
'\t\t\t\trecorder: null,',
'\t\t\t\trecFile: \'myaudio/myrecording3.amr\'  //if device.platform is \'Android\' then use .amr, otherwise .wav',
'\t\t\t}',
'\t\t\tfunction captureStatus(e) {',
'\t\t\t\tconsole.log(\'status....\' + JSON.stringify(e));',
'\t\t\t}',
'\t\t\tvar onSuccessAudio = function() {',
'\t\t\t\tconsole.log(\'try to play it now\');',
'\t\t\t\tsetTimeout(function() { _media.recorder.play(); },1000);',
'\t\t\t\t//var e_filename = _media.recFile;',
'\t\t\t\t//opsIn.dialogObj.setValue(opsIn.controlName,e_filename);',
'\t\t\t\t//opsIn.dialogObj.refreshClientSideComputations();',
'\t\t\t};',
'\t\t\t_media.recorder = new Media(_media.recFile,onSuccessAudio,onFailed,captureStatus);',
'\t\t\tconsole.log(\'about to record\');',
'\t\t\t_media.recorder.startRecord();',
'\t\t\tconsole.log(\'start\');',
'\t\t\tsetTimeout(function() { console.log(\'stop\'); _media.recorder.stopRecord();  },5000);',
'\t\t\t//_media.recorder.play();',
'\t\t}',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCapturePhoneGap =  function(options) {',
'\t\tvar flagCustomOnError = false;',
'\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\t\t//if(!flagCustomOnError) window.onerror = function(err) { alert(\'Unhandled Javascript Error - phoneGapImageCapture:  \' + JSON.stringify(err));}',
'\t\tif(options.onBeforeCaptureJavascript) {',
'\t\t\tvar result = options.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tif (typeof window[\'cordova\'] == \'undefined\') {',
'\t\t\talert(\'PhoneGap not loaded\');',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof options.imageSelectionCanceledMessage == \'undefined\') options.imageSelectionCanceledMessage = \'Image Selection Canceled\';',
'\t\tif(typeof options.imageSelectionCanceledButton == \'undefined\') options.imageSelectionCanceledButton = \'Done\';',
'\t\tif(typeof options.cameraCanceledMessage == \'undefined\') options.cameraCanceledMessage = \'Camera Action Canceled\';',
'\t\tif(typeof options.cameraCanceledButton == \'undefined\') options.cameraCanceledButton = \'Done\';',
'\t\tvar maxSize = -1;',
'\t\tif(typeof options.maxImageSizePhoneGap != \'undefined\') maxSize = Number(options.maxImageSizePhoneGap);',
'\t\tif(maxSize == -1) maxSize = 9999999999;',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tvar ops = {};',
'\t\tops.dialogObj = this;',
'\t\tif(options.specialMode == \'callback\') {',
'\t\t\toptions.controlName = \'\';',
'\t\t}',
'\t\tops.targetImage = options.controlName.toUpperCase();',
'\t\tops.cordova = {};',
'\t\tops.cordova.pictureSourceVal = options.pictureSourceVal;',
'\t\tops.cordova.imageQuality = options.imageQualityPhonegap;',
'\t\tops.cordova.allowEdit = options.allowPictureEditing',
'\t\tops.cordova.targetWidth = options.maxImageWidth;',
'\t\tops.cordova.targetHeight = options.maxImageHeight;',
'\t\tops.cordova.saveToPhotoAlbum = options.saveToPhotoAlbum',
'\t\tops.cordova.iPadEleId = \'\';',
'\t\tops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t\tops.imageFieldName = (ops.fieldPrefix + \'.\' + ops.targetImage).toUpperCase();',
'\t\tops.hiddenFileName = (ops.fieldPrefix + \'.\' + ops.targetImage + \'_HIDDENA5FN\').toUpperCase();',
'\t\tops.onCameraSuccess = function(imageURI) {',
'\t\t\tif(typeof options.captureDataMode == \'undefined\') options.captureDataMode = \'base64\';',
'\t\t\ttry {',
'\t\t\t    var iOps = JSON.parse(imageURI);',
'\t\t\t    var filename = iOps.filename;',
'\t\t\t    var metadata = iOps.json_metadata;',
'\t\t\t    var iMD = JSON.parse(metadata);',
'\t\t\t    if(typeof iMD.GPS != \'undefined\') {',
'\t\t\t    \t//running on iOS',
'\t\t\t    \tvar gpsObj = {};',
'\t\t\t    \tgpsObj.latitude = iMD.GPS.Latitude;',
'\t\t\t    \tgpsObj.longitude = iMD.GPS.Longitude;',
'\t\t\t    \tif(iMD.GPS.LongitudeRef == \'W\') gpsObj.longitude = Number(gpsObj.longitude) * -1;',
'\t\t\t    \tif(iMD.GPS.LatitudeRef == \'S\') gpsObj.latitude = Number(gpsObj.latitude) * -1;',
'\t\t\t    \tgpsObj.altitude = iMD.GPS.Altitude;',
'\t\t\t    \tgpsObj.dateTime = iMD.GPS.DateStamp + \' \' + iMD.GPS.TimeStamp;',
'\t\t\t    \tgpsObj.ExifJSON = metadata;',
'\t\t\t    } else {',
'\t\t\t    \t//android',
'\t\t\t    \tvar latRaw = iMD.gpsLatitude;   //":"42/1,28/1,50093/1000",',
'\t\t\t    \tvar latRef = iMD.gpsLatitudeRef;  //":"N",',
'\t\t\t    \tvar lngRaw = iMD.gpsLongitude; //":"71/1,12/1,16183/1000",',
'\t\t\t    \tvar lngRef = iMD.gpsLongitudeRef; //":"W",',
'\t\t\t    \tvar altRaw = iMD.gpsAltitude;',
'\t\t\t    \tvar altRef = iMD.gpsAltitudeRef;',
'\t\t\t    \tops.fixGPS = function(raw,ref) {',
'\t\t\t    \t\t//alert( \' raw: \' + raw + \' ref: \' + ref);',
'\t\t\t    \t\tif(raw == null) return null;',
'\t\t\t\t\t\tvar lat_d, lat_m, lat_s, lat;',
'\t\t\t\t\t\tlat_d = eval(raw.split(\',\')[0]);',
'\t\t\t\t\t\tlat_m = eval(raw.split(\',\')[1]) * ( 1/60);',
'\t\t\t\t\t\tlat_s = eval(raw.split(\',\')[2]) * ( 1/60);',
'\t\t\t\t\t\tlat = Number(lat_d) + Number(lat_m) + Number(lat_s);',
'\t\t\t\t\t\tif(ref != null) {',
'\t\t\t\t\t\t\tif(ref.toUpperCase() == \'S\') lat = Number(lat) * -1;',
'\t\t\t\t\t\t\tif(ref.toUpperCase() == \'W\') lat = Number(lat) * -1;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn lat;',
'\t\t\t    \t}',
'\t\t\t    \tvar lat = ops.fixGPS(latRaw,latRef);',
'\t\t\t    \tvar lng = ops.fixGPS(lngRaw,lngRef);',
'\t\t\t    \tvar alt = ops.fixGPS(altRaw,altRef);',
'\t\t\t    \tvar gpsObj = {};',
'\t\t\t\t\tgpsObj.latitude = lat;',
'\t\t\t\t\tgpsObj.longitude = lng;',
'\t\t\t\t\tgpsObj.altitude = alt;',
'\t\t\t\t\tgpsObj.dateTime = iMD.datetime;',
'\t\t\t\t\tgpsObj.ExifJSON = metadata;',
'\t\t\t    }',
'\t\t\t    options.EXIF = gpsObj;',
'\t\t\t    ops._moveFile(filename);',
'\t\t\t\t//do not call onCaptureJavascript() here ... it gets called by ops._move() ....window.resolveLocalFileSystemURL(imageURI,ops.fsOK,ops.fsError);',
'\t\t\t    //if(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : imageURI});',
'\t\t\t} catch(err) {',
'\t\t\t\t//if you get here then you were not using the AA camera plugin, so EXIF info is not available',
'\t\t\t\tops._moveFile(imageURI);',
'\t\t\t\t//do not call onCaptureJavascript() here ... it gets called by ops._move() ....window.resolveLocalFileSystemURL(imageURI,ops.fsOK,ops.fsError);',
'\t\t\t\t//if(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : imageURI});',
'\t\t\t}',
'\t\t}',
'\t\tops._moveFile = function(filename) {',
'\t\t\tvar flagMove = false;',
'\t\t\tif(typeof options.phonegapMoveFileToPermanentStorage != \'undefined\') flagMove = options.phonegapMoveFileToPermanentStorage;',
'\t\t\tif(flagMove) {',
'\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\talert(\'ERROR The PhoneGap \\\'device\\\' plugin is not installed.\');',
'\t\t\t\t}',
'\t\t\t\tvar _dir = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(options.phonegapFileSystemType);',
'\t\t\t\tvar _onFolderEnsured = function() {',
'\t\t\t\t\tvar pos = filename.indexOf(\'?\'); // look for ?, not part of a filename when moving files',
'\t\t\t\t\tif (pos>=0) filename = filename.substring(0,pos); // remove query parts if present',
'\t\t\t\t\tvar objFn = A5.parseFilename(filename);',
'\t\t\t\t\tvar extension = objFn.name.split(\'.\');',
'\t\t\t\t\textension = extension[extension.length-1];',
'\t\t\t\t\tvar targetName = A5.UUID() + \'.\' + extension;',
'\t\t\t\t\tvar subfolder = \'\';',
'\t\t\t\t\tif(options.phonegapPermanentStorageFolder != \'\') {',
'\t\t\t\t\t\tsubfolder = options.phonegapPermanentStorageFolder + \'/\';',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _moveOK = function() {',
'\t\t\t\t\t\tvar fn = _dir + subfolder + targetName;',
'\t\t\t\t\t\twindow.resolveLocalFileSystemURL(fn,ops.fsOK,ops.fsError);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _moveFail = function(e) {',
'\t\t\t\t\t\talert(\'Move error: \'+e.code);',
'\t\t\t\t\t}',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(filename,_dir, subfolder + targetName,_moveOK,_moveFail)',
'\t\t\t\t}',
'\t\t\t\tvar _onError = function() {',
'\t\t\t\t\talert(\'could not create folder\');',
'\t\t\t\t}',
'\t\t\t\tif(options.phonegapPermanentStorageFolder != \'\') {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_dir, options.phonegapPermanentStorageFolder, _onFolderEnsured, _onError)',
'\t\t\t\t} else {',
'\t\t\t\t\t//storing in the root of the requested filesystem --',
'\t\t\t\t\t_onFolderEnsured();',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//do not need to move the file',
'\t\t\t\twindow.resolveLocalFileSystemURL(filename,ops.fsOK,ops.fsError);',
'\t\t\t}',
'\t\t}',
'\t\tops.onImageSelectFail = function(msg) {',
'\t\t\tif(typeof options.onCaptureCancel == \'function\') {',
'\t\t\t\toptions.onCaptureCancel.call();',
'\t\t\t} else {',
'\t\t\t\tnavigator.notification.alert(msg,null,options.imageSelectionCanceledMessage,options.imageSelectionCanceledButton);',
'\t\t\t}',
'\t\t}',
'\t\tops.onCameraCaptureFail = function(msg) {',
'\t\t\tif(typeof options.onCaptureCancel == \'function\') {',
'\t\t\t\t\toptions.onCaptureCancel.call(this,msg);',
'\t\t\t} else {',
'\t\t\t\tnavigator.notification.alert(msg,null,options.cameraCanceledMessage,options.cameraCanceledButton);',
'\t\t\t}',
'\t\t}',
'\t\tops.fsOK = function(fileEntry) {',
'\t\t\t// HTML5 File system available as fileEntry',
'\t\t\t// Using standard HTML5 file handling here',
'\t\t\t// get fileEntry URL for upload',
'\t\t\tvar thisImageURL = fileEntry.toURL();',
'\t\t\tif(options.captureDataMode == \'filename\') {',
'\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t//better be - only mode we are supporting for \'filename\'',
'\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\tif(ele) ele.src = {UXPRERENDEREDALIAS}_DlgObj.addCustomSchemeForAlphaWkWebView(thisImageURL);',
'\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\tif(eleH) eleH.src = thisImageURL;',
'\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\tvar exifData = \'\';',
'\t\t\t\t\tif(typeof options.EXIF != \'undefined\') exifData = JSON.stringify(options.EXIF);',
'\t\t\t\t\t$sa(eleH,\'a5EXIF\',exifData);',
'\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : thisImageURL, options: options.EXIF});',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tfileEntry.file(function(file){',
'\t\t\t\t\tvar reader = new FileReader();',
'\t\t\t\t\treader.onloadend = function(e) {',
'\t\t\t\t\t\t// this is Base64 encoded',
'\t\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\t\t\tif(ele) ele.src = e.target.result;',
'\t\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\t\tif(eleH) eleH.src = e.target.result;',
'\t\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result, fileSystemURL: fileEntry.nativeURL, options: options});',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result, fileSystemURL: fileEntry.nativeURL, options: options});  //pass in options so that the user defined callback js can reference options (which has the exif data in it)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t};',
'\t\t\t\t\treader.onerror = function(e) {',
'\t\t\t\t\t\tnavigator.notification.alert(\'<a5:r>File reader error</a5:r>\');',
'\t\t\t\t\t};',
'\t\t\t\t\treader.readAsDataURL(file);',
'\t\t\t\t},function(error) {',
'\t\t\t\t\tnavigator.notification.alert(\'<a5:r>Image file read error</a5:r>\');',
'\t\t\t\t});',
'\t\t\t}',
'\t\t}',
'\t\tops.fsError = function() {',
'\t\t\tnavigator.notification.alert(\'<a5:r>Local File system unavailable.</a5:r>\');',
'\t\t}',
'\t\t// Calculate positioning for iPad popup menu if applicable',
'\t\tvar cordovaPopoverOptions = null;',
'\t\t\tif (ops.cordova.iPadEleId.length > 0) {',
'\t\t\tvar ele = $(ops.cordova.iPadEleId);',
'\t\t\tif (ele) {',
'\t\t\t\tvar rect = ele.getBoundingClientRect();',
'\t\t\t\tvar x = rect.left;',
'\t\t\t\tvar y = rect.top;',
'\t\t\t\tvar w = rect.right - rect.left;',
'\t\t\t\tvar h = rect.bottom - rect.top;',
'\t\t\t\tcordovaPopoverOptions = new CameraPopoverOptions(x,y,w,h,15);',
'\t\t\t}',
'\t\t}',
'\t\t// These options define all of the objects functionality',
'\t\tvar cordovaOptions = {',
'\t\t\tquality: Number(ops.cordova.imageQuality),',
'\t\t\tallowEdit: ops.cordova.allowEdit,',
'\t\t\tsourceType: Number(ops.cordova.pictureSourceVal),',
'\t\t\tcorrectOrientation: true,',
'\t\t\tdestinationType: 1,',
'\t\t\ttargetWidth: Number(ops.cordova.targetWidth),',
'\t\t\ttargetHeight: Number(ops.cordova.targetHeight),',
'\t\t\tsaveToPhotoAlbum: ops.cordova.saveToPhotoAlbum,',
'\t\t\tpopoverOptions: cordovaPopoverOptions,',
'\t\t\tencodingType: Camera.EncodingType.JPEG',
'\t\t}',
'\t\t/*',
'\t\tvar options = {',
'\t\t\t\tdestinationType: Camera.DestinationType.FILE_URI,',
'\t\t\t\tsourceType: Camera.PictureSourceType.PHOTOLIBRARY,',
'\t\t\t\tmediaType: Camera.MediaType.VIDEO',
'\t\t\t\t//getting error: destination file type unavailable',
'\t\t\t};',
'\t\t*/',
'\t\tif (cordovaOptions.sourceType != 1) {',
'\t\t\tcordovaOptions.saveToPhotoAlbum = false;',
'\t\t\tnavigator.camera.getPicture(ops.onCameraSuccess, ops.onImageSelectFail,cordovaOptions);',
'\t\t} else {',
'\t\t\tnavigator.camera.getPicture(ops.onCameraSuccess, ops.onCameraCaptureFail,cordovaOptions);',
'\t\t}',
'\t}',
'{UXPRERENDEREDALIAS}_DlgObj.stripCustomSchemeForAlphaWkWebView = function(fileURL) {',
'\tif(fileURL.indexOf(\'alpha-local://\') == 0 && fileURL.indexOf(\'_app_file_\') >-1) {',
'\t\tvar name = fileURL.split(\'alpha-local://localhost/_app_file_/\')[1];',
'\t\t//file: protocol requires 3 forward slashes',
'\t\tname = \'file:///\'+ name ;',
'\t\treturn name;',
'\t}',
'\ttry{',
'\t\tif(fileURL.toLowerCase().indexOf(\'alpha-local\') == -1) return fileURL;',
'\t\treturn fileURL.split(\'url=\')[1]',
'\t}catch(e) { return fileURL}',
'}',
'//////////',
'{UXPRERENDEREDALIAS}_DlgObj.addCustomSchemeForAlphaWkWebView = function(fileURL) {',
'\tif (typeof fileURL != \'string\') return fileURL; //only process strings',
'\t// catch null fileURL',
'\tif (!fileURL) {',
'\t\treturn fileURL;',
'\t}',
'\tfunction getExt(path){',
'    \tvar ext = (path.match(/(?:.+..+[^\\/]+$)/ig) != null) ? path.split(\'.\').slice(-1): [\'dir\'];',
'    \treturn ext[0].toLowerCase();',
'\t}',
'\t// set default',
'\tvar modifiedFileURL = fileURL;',
'\tconst alphaJpgScheme   = \'alpha-local://jpg?url=\';',
'\tconst alphaSvgScheme   = \'alpha-local://svg?url=\';',
'\tconst alphaPngScheme   = \'alpha-local://png?url=\';',
'\tconst alphaAudioScheme = \'alpha-local://audio?url=\';',
'\tconst alphaVideoScheme = \'alpha-local://video?url=\';',
'\tconst alphaHtmlScheme  = \'alpha-local://html?url=\';',
'\tconst alphaViewScheme  = \'alpha-local://view?url=\';',
'\tconst alphaViewDirScheme = \'alpha-local://viewdir?url=\';',
'\t// Is Alpha\'s WkWebView plugin installed?',
'\tif (typeof WkWebView == \'object\' && WkWebView != null) {',
'\t\tif (typeof WkWebView.convertFilePath == \'function\') {',
'\t\t\t//using Cordova 6.2',
'\t\t\tvar modifiedFileURL = WkWebView.convertFilePath(fileURL);',
'\t\t} else {',
'\t\t\tif (typeof WkWebView.isAlphaWkWebView == \'function\') {',
'\t\t\t\tif (fileURL.startsWith(\'file://\')) {',
'\t\t\t\t\tvar ext = getExt(fileURL);',
'\t\t\t\t\tswitch(ext) {',
'\t\t\t\t\t\tcase "jpg":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaJpgScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "png":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaPngScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "svg":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaSvgScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "m4a":',
'\t\t\t\t\t\tcase "mp3":',
'\t\t\t\t\t\tcase "wav":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaAudioScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "mp4":',
'\t\t\t\t\t\tcase "m4v":',
'\t\t\t\t\t\tcase "mov":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaVideoScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "html":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaHtmlScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t// for viewing files in iOS QuickLook viewer',
'\t\t\t\t\t\tcase "pdf":',
'\t\t\t\t\t\tcase "doc":',
'\t\t\t\t\t\tcase "xlsx":',
'\t\t\t\t\t\tcase "rtf":',
'\t\t\t\t\t\tcase "csv":',
'\t\t\t\t\t\tcase "ppt":',
'\t\t\t\t\t\tcase "txt":',
'\t\t\t\t\t\tcase "zip":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaViewScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t// for viewing a directory of files in iOS QuickLook viewer',
'\t\t\t\t\t\tcase "dir":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaViewDirScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\treturn modifiedFileURL;',
'}',
'//////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload = function(__guid,number,rowId) {',
'\t\tvar arrS3 = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'arrS3\'];',
'\t\tvar options = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'options\'];',
'\t\tvar _dlgObj = {UXPRERENDEREDALIAS}_DlgObj;',
'\t\tvar _xhr = arrS3[number].xhr;',
'\t\t_xhr.abort();',
'\t\tarrS3[number].aborted = true;',
'\t\tif(typeof rowId != \'undefined\') {',
'\t\t\tvar ele = $(rowId);',
'\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t}',
'\t\t//uploadCompleteFunction',
'\t\tvar ops = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'ops\'];',
'\t\t//fire the onComplete events',
'\t\tvar flagAllCompleted = false;',
'\t\tvar c = 0;',
'\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\tif(arrS3[i].completed == true || arrS3[i].aborted == true) c = c+1;',
'\t\t}',
'\t\tif(c == arrS3.length) flagAllCompleted = true;',
'\t\tvar f = arrS3[number];',
'\t\tvar e = {',
'\t\t\tname: f.name,',
'\t\t\ttype: f.type,',
'\t\t\tsize: f.size,',
'\t\t\taborted: f.aborted,',
'\t\t\tnumber: number,',
'\t\t\tfileArray: arrS3,',
'\t\t\ttargetName: arrS3[number].targetName',
'\t\t}',
'\t\toptions.onCompleteFile(e);',
'\t\tif(flagAllCompleted) {',
'\t\t\toptions.onCompleteAllFiles(e);',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar eleP = $(_dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder);',
'\t\t\t\tif(eleP) eleP.style.display = \'none\';',
'\t\t\t}',
'\t\t\tdelete {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid];',
'\t\t}',
'\t\t//end onComplete events',
'\t}',
'\t/////////////////////////////////////////////////////////////////////////',
'{UXPRERENDEREDALIAS}_DlgObj.fileUploadAmazonS3 = function(options) {',
'if( typeof options.maxActiveUploads == \'undefined\') options.maxActiveUploads = 10;',
'\t\tif(typeof options.target != \'undefined\') {',
'\t\t\tif(options.target.toLowerCase() == \'server\') {',
'\t\t\t\tif({UXPRERENDEREDALIAS}_DlgObj._embeddedMode) {',
'\t\t\t\t\talert(\'This action cannot be perfomed in Working Preview.\');',
'\t\t\t\t\treturn;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tvar eleB = \'\';',
'\t\tvar _dlgObj = this;',
'\t\tvar _part = options.part;',
'\t\tdelete ops;',
'\t\tvar ops = {};',
'\t\tif(typeof options.onBeforeFileSelect == \'function\') {',
'\t\t\tvar result = options.onBeforeFileSelect();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tops.formatNum = function(num) {',
'\t\t\tvar suffix = \'Kb\';',
'\t\t \tif(num >= 1000000) {',
'\t\t \t\tnum = num/1000000;',
'\t\t \t\tsuffix = \'Mb\';',
'\t\t\t} else if(num >= 1000) {',
'\t\t\t \tnum = num / 1000;',
'\t\t\t \tsuffix = \'Kb\';',
'\t\t\t} else {',
'\t\t\t   suffix = \'bytes\'',
'\t\t\t  }',
'\t\t\tnum = Math.round(num * 100) / 100;',
'\t\t\tnum = Number(num);',
'\t\t\treturn (num).toLocaleString() + suffix;',
'\t\t}',
'\t\tops.setProgress = function(percent,message,objS3) {',
'\t\t\t//fire system onProgress events',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar i = objS3.number;',
'\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\tvar ep = $(id_i);',
'\t\t\t\tif(ep) {',
'\t\t\t\t\tif(options.progressStyle == \'text\') ep.innerHTML = percent + \'%\';',
'\t\t\t\t\telse ep.style.width = percent + \'%\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar e = {',
'\t\t\t\tpercent: percent,',
'\t\t\t\tmessage: message,',
'\t\t\t\tname: objS3.name,',
'\t\t\t\ttargetName: objS3.targetName,',
'\t\t\t\tnumber: objS3.number,',
'\t\t\t\tsize: objS3.size,',
'\t\t\t\ttype: objS3.type',
'\t\t\t}',
'\t\t\tif(typeof objS3.userProgressFunction == \'function\') objS3.userProgressFunction(e);;',
'\t\t}',
'\t\tops.createCORSRequest = function(method, url) {',
'\t\t\tvar left = url.split(\'?\')[0];',
'\t\t\tvar right = url.split(\'?\')[1];',
'\t\t\tright = right.split(\'/\').join(\'%2F\');',
'\t\t\tright = right.replace(\'host;x-amz-acl\',\'host%3Bx-amz-acl\')',
'\t\t\turl = left + \'?\' + right;',
'  \t\t\tvar xhr = new XMLHttpRequest();',
'  \t\t\t//alert(method)',
'  \t\t\t//alert(url);',
'\t\t\t // "withCredentials" only exists on XHR2 objects',
'  \t\t\tif ("withCredentials" in xhr) {',
'  \t\t\t\ttry {',
'    \t\t\t\txhr.open(method, url, true);',
'    \t\t\t} catch(err) {',
'    \t\t\t\talert(\'XHR error - could not open XHR object. This action is not supported in Working Preview if you are using Internet Explorer. Try using Chrome Working Preview.\');',
'    \t\t\t\treturn false;',
'    \t\t\t}',
'\t\t\t} else if (typeof XDomainRequest != "undefined") {',
'\t\t\t    // XDomainRequest only exists in IE',
'    \t\t\txhr = new XDomainRequest();',
'\t\t\t    xhr.open(method, url);',
'  \t\t\t} else {',
'\t\t\t  \t// CORS not supported by this browser',
'    \t\t\txhr = null;',
'\t\t\t  }',
'\t\t  return xhr;',
'\t\t}',
'\t\tops.uploadToS3 = function(file, url, objS3) {',
'\t\t\tvar targetServer = objS3.targetServer;',
'\t\t\tif(typeof targetServer == \'undefined\') targetServer = \'S3\';',
'\t\t\tif(targetServer.toUpperCase() == \'S3\') {',
'\t\t\t\tvar xhr = ops.createCORSRequest(\'PUT\', url);',
'\t\t\t} else {',
'\t\t\t\t//alpha server',
'\t\t\t\tvar additionalInfo = \'\';',
'\t\t\t\tif(typeof options.additionalInfo == \'function\') {',
'\t\t\t\t\tadditionalInfo = options.additionalInfo.call();',
'\t\t\t\t}',
'\t\t\t\tvar s3Indirect = \'\';',
'\t\t\t\tif(typeof options.xbasicFunctionNameS3Indirect !=\'undefined\') s3Indirect = options.xbasicFunctionNameS3Indirect;',
'\t\t\t\tadditionalInfo = A5.ajax.buildURLParam(\'__additionalInfo\',additionalInfo);',
'\t\t\t\tvar AAURI = encodeURI({UXPRERENDEREDALIAS}_DlgObj.ajaxURL + \'&\' + additionalInfo + \'&__Ajax=true&__FormAction=GenericAjaxCallback&_XbasicFunction=system:multifileupload&_xbasic=\' + options.xbasicFunction + \'&_s3indirect=\' + s3Indirect );',
'\t\t\t\tvar xhr = new XMLHttpRequest();',
'\t\t\t\txhr.open(\'POST\',AAURI,true);',
'\t\t\t}',
'\t\t\tif (!xhr) {',
'\t\t\t\t//ops.setProgress(0, \'CORS not supported\',objS3);',
'\t\t\t\tif(typeof objS3.onError == \'function\') objS3.onError({errorText: \'CORS not supported\', errorCode: -1, fileObject: objS3});',
'\t\t\t  \telse alert(\'CORS not supported\');',
'\t\t\t} else {',
'\t\t\t//capture the xhr object so you can call cancel',
'\t\t\tobjS3.arrS3[objS3.number].xhr = xhr;',
'\t\t\txhr.onreadystatechange = function() {',
'\t\t\t\t//this.readyState == 4 & this.status == 200 -- success',
'\t\t\t\t//this.readyState == 4 && this.status = 408 - timeout',
'\t\t\t\t//anything else is an error',
'\t\t\t}',
'\t\t\txhr.onload = function() {',
'\t\t\t  if(xhr.status == 200) {',
'\t\t\t\tops.setProgress(100, \'Upload completed.\',objS3);',
'\t\t\t\t//file number is available in objS3.number',
'\t\t\t\tobjS3.uploadCompleteFunction.call(objS3);',
'\t\t\t\tvar txt = this.responseText;',
'\t\t\t\tif(txt.indexOf(\'Eval:\') == 0) {',
'\t\t\t\t\ttxt = txt.substring(5);',
'\t\t\t\t\teval(txt);',
'\t\t\t\t}',
'\t\t\t  } else {',
'\t\t\t\t//ops.setProgress(0, \'Upload error: \' + xhr.status);',
'\t\t\t\tvar responseText = \'\';',
'\t\t\t\tif(typeof xhr.responseText != \'undefined\') responseText = xhr.responseText;',
'\t\t\t\tif(typeof objS3.onError == \'function\') objS3.onError({errorText: \'Upload error\', errorCode: xhr.status, fileObject: objS3, errorText: responseText});',
'\t\t\t  \telse alert(\'XHR error. Reported error:\' + responseText);',
'\t\t\t  }',
'\t\t\t};',
'\t\t\txhr.onerror = function() {',
'\t\t\t  //ops.setProgress(0, \'XHR error.\');',
'\t\t\t  if(typeof objS3.onError == \'function\') objS3.onError({errorText: \'XHR Error\', errorCode: xhr.status, fileObject: objS3});',
'\t\t\t  else alert(\'XHR error\');',
'\t\t\t};',
'\t\t\txhr.upload.onprogress = function(e) {',
'\t\t\t  if (e.lengthComputable) {',
'\t\t\t\tvar percentLoaded = Math.round((e.loaded / e.total) * 100);',
'\t\t\t\tops.setProgress(percentLoaded, percentLoaded == 100 ? \'Finalizing.\' : \'Uploading.\',objS3);',
'\t\t\t  }',
'\t\t\t};',
'\t\t\tif(!options.target) options.target = \'S3\';',
'\t\t\tif(options.target.toUpperCase() == \'S3\') {',
'\t\t\t\tif(typeof options.tags == \'undefined\') options.tags = \'\';',
'\t\t\t\txhr.setRequestHeader(\'Content-Type\', file.type);',
'\t\t\t\tif(typeof _dlgObj._authenticatedRead == \'boolean\') {',
'\t\t\t\t\tobjS3.authenticatedRead = _dlgObj._authenticatedRead  //set in a5DialogHelper_signAmazonS3FileUploadURL()',
'\t\t\t\t}',
'\t\t\t\tif(!objS3.authenticatedRead) {',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-acl\', \'public-read\');',
'\t\t\t\t} else {',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-acl\', \'authenticated-read\');',
'\t\t\t\t}',
'\t\t\t\tif(options.tags != \'\') {',
'\t\t\t\t\toptions.tags = decodeURIComponent(options.tags);',
'\t\t\t\t\toptions.tags = atob(options.tags);',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-tagging\', options.tags);',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//don\'t bother with headers. they will get set automatically becuase we will be .send()ing a FormData() object',
'\t\t\t}',
'\t\t\tif(targetServer.toUpperCase() == \'S3\') {',
'\t\t\t\tif (typeof window[\'cordova\'] != \'undefined\') {',
'\t\t\t\t}',
'\t\t\t\t//alert(typeof options);',
'\t\t\t\t//alert(1);',
'\t\t\t\t//',
'\t\t\t\t//var options = new FileUploadOptions();',
'\t\t\t\txhr.send(file);',
'\t\t\t} else {',
'\t\t\t\t//uploading to alpha server - by using a FormData() object, the content-type headers get set correctly',
'\t\t\t\tvar formData = new FormData();',
'\t\t\t\tformData.append(\'file\',file);',
'\t\t\t\txhr.send(formData);',
'\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tops.handleFileSelect = function(evt) {',
'\t\t\tdelete arrS3;',
'\t\t\tvar arrS3 = [];',
'\t\t\tops.__guid = Number(new Date());',
'\t\t\tvar __guid = ops.__guid;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads = {};',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid] = {};',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'arrS3\'] = arrS3;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'ops\'] = ops;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'options\'] = options;',
'\t\t\tvar files = evt.target.files;',
'\t\t\tvar f = \'\';',
'\t\t\tvar data = \'\';',
'\t\t\tvar targetName = \'\';',
'\t\t\tvar newTargetName = \'\';',
'\t\t\tarrS3.length = 0;',
'\t\t\tfor(var i = 0; i < files.length; i++) {',
'\t\t\t\tf = files[i];',
'\t\t\t\tif(typeof f.name == \'undefined\') {',
'\t\t\t\t\tvar localFileName = \'blobfile.jpg\';',
'\t\t\t\t\tif(typeof options.localFileName != \'undefined\') localFileName = options.localFileName;',
'\t\t\t\t\tf.name = localFileName;',
'\t\t\t\t}',
'\t\t\t\tdelete obji;',
'\t\t\t\tvar obji = {',
'\t\t\t\t\tnumber: i,',
'\t\t\t\t\tname: f.name,',
'\t\t\t\t\tsize: f.size,',
'\t\t\t\t\ttype: f.type,',
'\t\t\t\t\tfile: f,',
'\t\t\t\t\tcompleted: false,',
'\t\t\t\t\taborted: false,',
'\t\t\t\t\tlastModified: f.lastModified',
'\t\t\t\t}',
'\t\t\t\tarrS3.push(obji)',
'\t\t\t}',
'\t\t\tvar __guid = ops.__guid;',
'\t\t\t//validate file selection -------------------------------------',
'\t\t\tvar totalSize = 0;',
'\t\t\tif(typeof options.maxFileSize == \'undefined\') options.maxFileSize = -1;',
'\t\t\tvar maxSize = options.maxFileSize;',
'\t\t\tif(maxSize == -1) maxSize = 999999999999999;',
'\t\t\tif(typeof options.maxFileSizeTotal == \'undefined\') options.maxFileSizeTotal = -1;',
'\t\t\tvar maxSizeTotal = options.maxFileSizeTotal;',
'\t\t\tif(maxSizeTotal == -1) maxSizeTotal = 999999999999999;',
'\t\t\tif(typeof options.allowedFileTypes == \'undefined\') options.allowedFileTypes = \'\';',
'\t\t\tvar fileMsg = options.customization.maxFileSize;',
'\t\t\tvar fileTotalMsg = options.customization.totalFileSize;',
'\t\t\tvar typeMsg = options.customization.fileType;',
'\t\t\tvar flagHasValidationFunction = false;',
'\t\t\tif(typeof options.onValidationError == \'function\') flagHasValidationFunction = true;',
'\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\ttotalSize = totalSize + arrS3[i].size;',
'\t\t\t\t//check size',
'\t\t\t\tif(arrS3[i].size > maxSize) {',
'\t\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\t\toptions.onValidationError({violationType: \'size\', name: arrS3[i].name, size: arrS3[i].size, type: arrS3[i].type});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(typeof fileMsg != \'undefined\' && fileMsg != \'\') {',
'\t\t\t\t\t\t\tvar msg = fileMsg;',
'\t\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[filename]\',e.name);',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[filesize]\',\'\' + e.size);',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[maxfilesize]\',\'\' + maxSize);',
'\t\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\talert(\'File exceeds maximum allowed size of \' + maxSize);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\treturn false;',
'\t\t\t\t}',
'\t\t\t\t//check type',
'\t\t\t\tif(options.allowedFileTypes != \'\') {',
'\t\t\t\t\tvar arrT = options.allowedFileTypes.split(\',\');',
'\t\t\t\t\tfor(var i2 = 0; i2 < arrT.length; i2++ ) {',
'\t\t\t\t\t\tarrT[i2] =   $u.s.aTrim(arrT[i2].toLowerCase());',
'\t\t\t\t\t\tarrT[i2] = arrT[i2].replace(\'.\',\'\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ext = arrS3[i].name.split(\'.\');',
'\t\t\t\t\text = ext[ext.length -1];',
'\t\t\t\t\text = ext.toLowerCase();',
'\t\t\t\t\tvar ia = $u.a.find(arrT,ext);',
'\t\t\t\t\tif(ia == -1) {',
'\t\t\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\t\t\toptions.onValidationError({violationType: \'type\', name: arrS3[i].name, size: arrS3[i].size, type: arrS3[i].type});',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(typeof typeMsg != \'undefined\' && typeMsg != \'\') {',
'\t\t\t\t\t\t\t\tvar msg = typeMsg;',
'\t\t\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\t\t\tmsg = msg.replace(\'[filename]\',e.name);',
'\t\t\t\t\t\t\t\tmsg = msg.replace(\'[filetype]\',ext);',
'\t\t\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\talert(\'Invalid file type \' + ext);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn false;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//check total size',
'\t\t\tif(totalSize > maxSizeTotal) {',
'\t\t\t\t//Selected files ([filecount] files, total size [totalfilesize]) exceed the maximum allowed total file size of [maxtotalfilesize].',
'\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\toptions.onValidationError({violationType: \'totalSize\', totalSize: totalSize, maxSizeTotal: maxSizeTotal});',
'\t\t\t\t} else {',
'\t\t\t\t\tif(typeof fileTotalMsg != \'undefined\' && fileTotalMsg != \'\') {',
'\t\t\t\t\t\tvar msg = fileTotalMsg;',
'\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\tmsg = msg.replace(\'[filecount]\',arrS3.length);',
'\t\t\t\t\t\tmsg = msg.replace(\'[totalfilesize]\',\'\' + totalSize);',
'\t\t\t\t\t\tmsg = msg.replace(\'[maxtotalfilesize]\',\'\' + maxSizeTotal);',
'\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\talert(\'Files exceeds maximum allowed size of \' + maxSizeTotal);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treturn false;',
'\t\t\t}',
'\t\t\t//end validate file selection',
'\t\t\tif(typeof options.onAfterFilesSelect == \'function\') {',
'\t\t\t\tvar result = options.onAfterFilesSelect(arrS3);',
'\t\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\t\tif(!result) return false;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tops.__handleFileSelectLow(files,__guid,arrS3)',
'\t\t}',
'\t\tops._generatePlaceholderId = function() {',
'\t\t\tvar txt = options.progressDisplayPlaceholder;',
'\t\t\tvar flagDV = false;',
'\t\t\tif(typeof options.__dv != \'undefined\') flagDV = options.__dv;',
'\t\t\tvar num = txt.split(\'.\')[1];',
'\t\t\tif(!flagDV) {',
'\t\t\t\tvar eleId = _dlgObj.gridId + \'.V.R\'+options.rowNumber+\'._UNBOUND_STATICTEXT_\' + num;',
'\t\t\t} else {',
'\t\t\t\tvar eleId = _dlgObj.gridId + \'.D.V.R\'+options.rowNumber+\'._UNBOUND_STATICTEXT_\' + num;',
'\t\t\t}',
'\t\t\treturn eleId;',
'\t\t}',
'\t\tops.__handleFileSelectLow = function(files,__guid,arrS3) {',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar nn = options.progressDisplayPlaceholder.indexOf(\'[\');',
'\t\t\t\tif(options.progressDisplayPlaceholder.indexOf(\'ELEMENT:\') == 0) {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = options.progressDisplayPlaceholder.split(\':\')[1];',
'\t\t\t\t} else {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder',
'\t\t\t\t}',
'\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\tif(options.part == \'grid\') {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = this._generatePlaceholderId()',
'\t\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\t}',
'\t\t\t\tif(eleP) {',
'\t\t\t\t\teleP.style.display = \'\';',
'\t\t\t\t\tvar arrH = [];',
'\t\t\t\t\tvar id_i = \'\';',
'\t\t\t\t\tvar id_row_i = \'\';',
'\t\t\t\t\tvar html = \'\';',
'\t\t\t\t\tvar html_i = \'\';',
'\t\t\t\t\tvar spanTxt = \'\';',
'\t\t\t\t\tvar flagAllowCancel = options.allowCancel;',
'\t\t\t\t\tif(typeof flagAllowCancel == \'undefined\') flagAllowCancel = false;',
'\t\t\t\t\tif(typeof options.progressStyle == \'undefined\') options.progressStyle = \'bar\';',
'\t\t\t\t\tif(options.progressStyle == \'text\') {',
'\t\t\t\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_row_i = id_i + \'.ROW\';',
'\t\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\t\thtml_i += \'<tr id="\'+id_row_i+\'">\';',
'\t\t\t\t\t\t\tif(flagAllowCancel) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td><div style="cursor:pointer;padding: 5px;" title="Cancel upload" onclick="{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload(\\\'\'+__guid+\'\\\',\'+i+\',\\\'\'+id_row_i+\'\\\');">X</div></td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i +=\'<td><div>\' + arrS3[i].name + \' (\' + ops.formatNum(arrS3[i].size) + \') <span id=\'+id_i+\'></span> </div></td>\';',
'\t\t\t\t\t\t\thtml_i +=\'</tr>\'',
'\t\t\t\t\t\t\tarrH.push(html_i)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\thtml = arrH.join(\'\');',
'\t\t\t\t\t\thtml = \'<table>\' + html + \'</table>\'',
'\t\t\t\t\t} else if (options.progressStyle == \'bar\') {',
'\t\t\t\t\t\tvar flagShowFilename = options.showFileNameInProgressBar;',
'\t\t\t\t\t\tif(typeof flagShowFilename == \'undefined\') flagShowFilename = true;',
'\t\t\t\t\t\tvar flagMobile = false;',
'\t\t\t\t\t\tif(typeof options._flagMobile != \'undefined\') flagMobile = options._flagMobile;',
'\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\tif(typeof options.progressBarColor == \'undefined\') options.progressBarColor = \'#9fa1e8\';',
'\t\t\t\t\t\tif(typeof options.progressBarWidth == \'undefined\') options.progressBarWidth = \'1.5in\';',
'\t\t\t\t\t\tvar color = options.progressBarColor',
'\t\t\t\t\t\tvar width = options.progressBarWidth;',
'\t\t\t\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_row_i = id_i + \'.ROW\';',
'\t\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\t\thtml_i += \'<tr id="\'+id_row_i+\'">\';',
'\t\t\t\t\t\t\tif(flagShowFilename) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td>\' + arrS3[i].name + \' (\' + ops.formatNum(arrS3[i].size) + \')</td>\';',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\thtml_i += \'<td>(\' + ops.formatNum(arrS3[i].size) + \')</td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i += \'<td><div style="border: solid 1px \'+color+\'; width: \'+width+\';">\';',
'\t\t\t\t\t\t\thtml_i += \'<div id="\'+id_i+\'"style="width: 0%; height: .05in;  background-color:\'+color+\';"></div></div></td>\';',
'\t\t\t\t\t\t\tif(flagAllowCancel) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td><div style="cursor:pointer;padding: 5px;" title="Cancel upload" onclick="{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload(\\\'\'+__guid+\'\\\',\'+i+\',\\\'\'+id_row_i+\'\\\');">X</div></td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i += \'</tr>\';',
'\t\t\t\t\t\t\tarrH.push(html_i);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\thtml = arrH.join(\'\');',
'\t\t\t\t\t\t//for some reason in ie, this function is getting called a second time and if we don\'t exit here when .length == 0, it will overwrite the progress bar with a null string',
'\t\t\t\t\t\tif(arrH.length == 0) return true;',
'\t\t\t\t\t\thtml = \'<table>\' + html + \'</table>\'',
'\t\t\t\t\t\tif(flagMobile) {',
'\t\t\t\t\t\t\t//mobile upload limited to 1 file and don\'t wrap in table',
'\t\t\t\t\t\t\t//id_i = options.resolvedProgressPlaceholder + \'.\' + (1);',
'\t\t\t\t\t\t\thtml = \'\';',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\teleP.innerHTML = html;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tfunction onCompleteFile(e) {',
'\t\t\t\tthrottleRequests({finishedRequest: e});',
'\t\t\t\tif (onCompleteFile.origOnCompleteFile !== undefined && onCompleteFile.origOnCompleteFile !== null) {',
'\t\t\t\t\tonCompleteFile.origOnCompleteFile(e);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif (options.onCompleteFile !== onCompleteFile) {',
'\t\t\t\tonCompleteFile.origOnCompleteFile = options.onCompleteFile;',
'\t\t\t\toptions.onCompleteFile = onCompleteFile;',
'\t\t\t}',
'\t\t\tfunction sendRequest(i) {',
'\t\t\t\tvar f = files[i];',
'\t\t\t\tvar dataA = [];',
'\t\t\t\tdataA.push(\'_mimeType=\' + f.type);',
'\t\t\t\ttargetName = f.name;',
'\t\t\t\tif(typeof options.targetName == \'function\') {',
'\t\t\t\t\tnewTargetName = options.targetName( f  );',
'\t\t\t\t\tif(typeof newTargetName != \'undefined\') {',
'\t\t\t\t\t\tif(newTargetName != \'\') targetName = newTargetName;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tarrS3[i].targetName = targetName;',
'\t\t\t\tvar targetServer = options.target;',
'\t\t\t\tif(!options.target) targetServer = \'S3\';',
'\t\t\t\tarrS3[i].targetServer = targetServer;',
'\t\t\t\tdataA.push(\'_name=\' + urlencode(targetName));  //name of object in S3',
'\t\t\t\tdataA.push(\'_number=\' + i);',
'\t\t\t\tif(options.specifyCredentials == \'Explicit\') {',
'\t\t\t\t\tdataA.push(\'_xbasicFunctionNameForPropertyValues=\' + options.xbasicFunctionName);',
'\t\t\t\t\tdataA.push(\'_method=explicit\');',
'\t\t\t\t} else {',
'\t\t\t\t\tdataA.push(\'_namedStorageConnectionString=\' + options.connectionString);',
'\t\t\t\t\tdataA.push(\'_method=connectionString\');',
'\t\t\t\t}',
'\t\t\t\tdataA.push(\'_authenticatedRead=\' + options.authenticatedRead);',
'\t\t\t\tdataA.push(\'_part=\' + options.part);',
'\t\t\t\tdataA.push(\'_s3timeout=\'+ options.s3timeout);',
'\t\t\t\tif(typeof options.tags != \'undefined\') {',
'\t\t\t\t\tvar tags = options.tags;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar tags = \'\';',
'\t\t\t\t}',
'\t\t\t\tdataA.push(\'_tags=\'+ encodeURIComponent(tags));',
'\t\t\t\tdata = dataA.join(\'&\');',
'\t\t\t\t//alert(data);',
'\t\t\t\tif(typeof options.userProgressFunction == \'undefined\') options.userProgressFunction = function(e) {};',
'\t\t\t\tif(typeof options.onCompleteAllFiles == \'undefined\') options.onCompleteAllFiles = function(e) {};',
'\t\t\t\tvar obj = {',
'\t\t\t\t\t//ajax callback to sign url onComplete',
'\t\t\t\t\tonComplete: function() {',
'\t\t\t\t\t\tvar signedURL = decodeURIComponent(_dlgObj._fileCodedURL);',
'\t\t\t\t\t\t//attempt to fix a problem uploading to s3 when object name has ( )',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\'(\',\'%28\')',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\')\',\'%29\')',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\' \',\'%20\')',
'\t\t\t\t\t\tvar num = _dlgObj._fileCodedURLNum;',
'\t\t\t\t\t\tvar fi = arrS3[num].file;',
'\t\t\t\t\t\tvar targetServer = arrS3[num].targetServer;',
'\t\t\t\t\t\tdelete objS3;',
'\t\t\t\t\t\tvar objS3 = {',
'\t\t\t\t\t\t\tuploadCompleteFunction: function() {',
'\t\t\t\t\t\t\t\tthis.arrS3[this.number].completed = true;',
'\t\t\t\t\t\t\t\tvar flagAllCompleted = false;',
'\t\t\t\t\t\t\t\tvar c = 0;',
'\t\t\t\t\t\t\t\tfor(var i = 0; i < this.arrS3.length; i++) {',
'\t\t\t\t\t\t\t\t\tif(this.arrS3[i].completed == true || this.arrS3[i].aborted == true) c = c+1;',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\tif(c == this.arrS3.length) flagAllCompleted = true;',
'\t\t\t\t\t\t\t\tvar e = {',
'\t\t\t\t\t\t\t\t\tname: this.name,',
'\t\t\t\t\t\t\t\t\ttype: this.type,',
'\t\t\t\t\t\t\t\t\tsize: this.size,',
'\t\t\t\t\t\t\t\t\tnumber: this.number,',
'\t\t\t\t\t\t\t\t\tfileArray: this.arrS3,',
'\t\t\t\t\t\t\t\t\ttargetName: arrS3[this.number].targetName',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\toptions.onCompleteFile(e);',
'\t\t\t\t\t\t\t\tif(flagAllCompleted) {',
'\t\t\t\t\t\t\t\t\toptions.onCompleteAllFiles(e);',
'\t\t\t\t\t\t\t\t\tif(options.displayProgress) {',
'\t\t\t\t\t\t\t\t\t\t//var eleP = $(_dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder);',
'\t\t\t\t\t\t\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\t\t\t\t\t\t\tif(eleP) eleP.style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tdelete {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid];',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tuserProgressFunction: options.userProgressFunction,',
'\t\t\t\t\t\t\tonError: options.onError,',
'\t\t\t\t\t\t\tname: fi.name,',
'\t\t\t\t\t\t\tsize: fi.size,',
'\t\t\t\t\t\t\ttype: fi.type,',
'\t\t\t\t\t\t\tnumber: num,',
'\t\t\t\t\t\t\tarrS3: arrS3,',
'\t\t\t\t\t\t\ttargetName: arrS3[num].targetName,',
'\t\t\t\t\t\t\t__guid: __guid,',
'\t\t\t\t\t\t\tauthenticatedRead: options.authenticatedRead',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tobjS3.targetServer = targetServer;',
'\t\t\t\t\t\tops.uploadToS3(fi,signedURL,objS3);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tops.obj = obj;',
'\t\t\t\tvar reader = new FileReader();',
'\t\t\t\treader.onload = function(e) {',
'\t\t\t\t\tvar eleId = \'\';',
'\t\t\t\t\tvar ele = \'\';',
'\t\t\t\t\tif(typeof options.imageControl != \'undefined\' && options.part == \'ux\') {',
'\t\t\t\t\t\teleId = options.__alias + \'.V.R1.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\tele = $(eleId);',
'\t\t\t\t\t\tif(ele) ele.src = e.target.result;',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar flagDV = false;',
'\t\t\t\t\t\tif(typeof options.__dv != \'undefined\') flagDV = options.__dv',
'\t\t\t\t\t\tif(flagDV) {',
'\t\t\t\t\t\t\teleId = options.__alias + \'.D.V.R\'+options.rowNumber+\'.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\teleId = options.__alias + \'.V.R\'+options.rowNumber+\'.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tele = $(eleId);',
'\t\t\t\t\t\tif(ele) {',
'\t\t\t\t\t\t\tvar oldSrc = ele.src;',
'\t\t\t\t\t\t\t_dlgObj.__oldImage = oldSrc;',
'\t\t\t\t\t\t\tele.src = e.target.result;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treader.onerror = function(e) {',
'\t\t\t\t\talert(\'error in reader 123\');',
'\t\t\t\t}',
'\t\t\t\tif(typeof options.imageControl != \'undefined\') reader.readAsDataURL(f);',
'\t\t\t\tvar flagTargetIsServer = false;',
'\t\t\t\tif(typeof options.target != \'undefined\') {',
'\t\t\t\t\tif(options.target.toLowerCase() == \'server\') flagTargetIsServer = true;',
'\t\t\t\t}',
'\t\t\t\tif(!flagTargetIsServer) {',
'\t\t\t\t\t_dlgObj.ajaxCallback(\'\',\'\',\'a5DialogHelper_signAmazonS3FileUploadURL\',\'\',data,obj);',
'\t\t\t\t} else {',
'\t\t\t\t\t//no need to sign the url for target = \'alpha\'',
'\t\t\t\t\t_dlgObj._fileCodedURLNum = i;',
'\t\t\t\t\tobj.onComplete();',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar throttleRequests = function (requestsMax) {',
'\t\t\t\tvar activeRequests = 0;',
'\t\t\t\tvar maxRequests = requestsMax;',
'\t\t\t\tvar sentRequests = 0;',
'\t\t\t\tvar finishedRequests = 0;',
'\t\t\t\treturn function throttleRequestActual(options) {',
'\t\t\t\t\tif (options !== undefined && options !== null) {',
'\t\t\t\t\t\tif (options.finishedRequest !== undefined && options.finishedRequest !== null) {',
'\t\t\t\t\t\t\tactiveRequests--;',
'\t\t\t\t\t\t\tfinishedRequests++;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\twhile (sentRequests < files.length && activeRequests < maxRequests) {',
'\t\t\t\t\t\tactiveRequests++;',
'\t\t\t\t\t\tsendRequest(sentRequests);',
'\t\t\t\t\t\tsentRequests++',
'\t\t\t\t\t}',
'\t\t\t\t};',
'\t\t\t}(options.maxActiveUploads); // <---- This is the max number of requests to have active at one time.',
'\t\t\t// Kickoff the requests.',
'\t\t\tthrottleRequests({});',
'\t\t}',
'\t\t//$e.add($(this.dialogId + \'._GETFILEMULTI\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t$e.removeGroup(\'__amazonS3fileupload\')',
'\t\t//bind the change event to the file selector',
'\t\tif(options.allowMultipleFiles) {',
'\t\t\tif(typeof this._getFileMultiListenerLoaded == \'undefined\') {',
'\t\t\t\t//this._getFileMultiListenerLoaded = true;',
'\t\t\t\t//$(this.dialogId + \'._GETFILEMULTI\').addEventListener(\'change\',ops.handleFileSelect,false);',
'\t\t\t\t$e.add($(this.dialogId + \'._GETFILEMULTI\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t\t}',
'\t\t\teleB = $(this.dialogId + \'._GETFILEMULTI\');',
'\t\t} else {',
'\t\t\tif(typeof this._getFileListenerLoaded == \'undefined\') {',
'\t\t\t\t//this._getFileListenerLoaded = true;',
'\t\t\t\t//$(this.dialogId + \'._GETFILE\').addEventListener(\'change\',ops.handleFileSelect,false);',
'\t\t\t\t$e.add($(this.dialogId + \'._GETFILE\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t\t}',
'\t\t\teleB = $(this.dialogId + \'._GETFILE\');',
'\t\t}',
'\t\tvar flagFilePassedIn = false;',
'\t\tif(typeof options.flagFilePassedIn != \'undefined\') {',
'\t\t\tflagFilePassedIn = options.flagFilePassedIn',
'\t\t}',
'\t\tif(!flagFilePassedIn) {',
'\t\t\teleB.value = \'\';',
'\t\t\teleB.click();',
'\t\t\teleB.value = \'\';',
'\t\t} else {',
'\t\t\t//options.filePassedIn',
'\t\t\tvar evt = {};',
'\t\t\tevt.target = {};',
'\t\t\tevt.target.files = [];',
'\t\t\tif(options.filePassedIn.constructor == FileList) {',
'\t\t\t\tevt.target.files = options.filePassedIn;',
'\t\t\t} else {',
'\t\t\t\tevt.target.files[0] = options.filePassedIn;',
'\t\t\t}',
'\t\t\tops.handleFileSelect(evt);',
'\t\t}',
'\t}',
'\t////==== upload PhoneGap /////////////////////////////////////////////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileUpload = function(arr,options) {',
'\t\tvar _dlgObj = this;',
'\t\t//arr is an array of files to  upload. arr must have a .filename property in each item',
'\t\tif(typeof LocalFileSystem == \'undefined\') {',
'\t\t\tif(typeof cordova == \'undefined\') {',
'\t\t\t\talert(\'Method not supported when not running in PhoneGap\');',
'\t\t\t} else {',
'\t\t\t\talert(\'Required PhoneGap plugins (\\\'LocalFileSystem 2\\\')not loaded.\');',
'\t\t\t}',
'\t\t\treturn false;',
'\t\t}',
'\t\t//initialize variables',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].name = arr[i].filename;',
'\t\t\tarr[i].number = i;',
'\t\t\tarr[i].completed = false;',
'\t\t\tarr[i].aborted = false;',
'\t\t\tarr[i].succeeded = false;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: generateProgressBarsHTML -------------',
'\t\tvar generateProgressBarsHTML = function (ops,count) {',
'\t\t\tvar eleTarget = ops.progressElement;',
'\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\tvar html = \'\';',
'\t\t\tvar html_i = \'\';',
'\t\t\tvar name_i = \'\';',
'\t\t\tvar progress_i = \'\';',
'\t\t\tvar idName = \'\';',
'\t\t\tvar idProgress = \'\';',
'\t\t\tif(ops.individualProgress) {',
'\t\t\t\tfor(var  i = 0; i < count; i++) {',
'\t\t\t\t\tname_i = \'Name: \' + i;',
'\t\t\t\t\tprogress_i = \'Progress...\' + i;',
'\t\t\t\t\tidProgress = eleTarget + \'.PROGRESS.\' + i;',
'\t\t\t\t\tidName = eleTarget + \'.NAME.\' + i;',
'\t\t\t\t\tprogress_i = \'<div style="border: solid 1px \'+ops.color+\'; width: \'+ops.width+\';">\';',
'\t\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';"></div></div></td>\';',
'\t\t\t\t\thtml_i = \'<td id="\'+idName+\'">name \'+name_i+\'</td><td>\'+progress_i+\'</td>\';',
'\t\t\t\t\thtml_i = \'<tr>\' + html_i + \'</tr>\';',
'\t\t\t\t\thtml = html + html_i;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(ops.showTotalProgress) {',
'\t\t\t\tidProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\tidName = eleTarget + \'.NAME.TOTAL\';',
'\t\t\t\tprogress_i = \'<div style="border: solid 1px \'+ops.color+\'; width: \'+ops.width+\';">\';',
'\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';"></div></div></td>\';',
'\t\t\t\thtml_i = \'<td id="\'+idName+\'"></td><td>\'+progress_i+\'</td>\';',
'\t\t\t\thtml_i = \'<tr>\' + html_i + \'</tr>\';',
'\t\t\t\thtml = html + html_i',
'\t\t\t}',
'\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\thtml = \'<div id="\'+idProgress+\'"><table>\' + html + \'</table><div>\';',
'\t\t\t$(eleTarget).innerHTML = html;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: phoneGapUploadDoWork -------------',
'\t\tvar phoneGapUploadDoWork = function(arr,options) {',
'\t\t\tif(options.target.toLowerCase() == \'s3\') {',
'\t\t\t\t//s3',
'\t\t\t\tvar xbasicFunction = \'a5dialogHelper_systemSignS3Policy\';',
'\t\t\t\tvar o2 = {};',
'\t\t\t\t$u.o.assign(o2,options);',
'\t\t\t\t/////compute localTargetName before making the callback',
'\t\t\t\tvar filenameURI;',
'\t\t\t\tvar actionOptions = options;',
'\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\tfilenameURI = arr[i].filename;',
'\t\t\t\t\tvar fileName = filenameURI.substr(filenameURI.lastIndexOf(\'/\')+1);',
'\t\t\t\t\tvar targetName = fileName;',
'\t\t\t\t\tif(typeof actionOptions.onComputeS3Filename == \'function\') {',
'\t\t\t\t\t\tvar e = {name: targetName, object: arr[i]};',
'\t\t\t\t\t\tvar newTargetName = actionOptions.onComputeS3Filename(e);',
'\t\t\t\t\t\tif(typeof newTargetName == \'undefined\') newTargetName = targetName;',
'\t\t\t\t\t\tif(newTargetName == \'\') newTargetName = targetName;',
'\t\t\t\t\t\ttargetName = newTargetName;',
'\t\t\t\t\t}',
'\t\t\t\t\t//on iphone video name is always \'capturedvideo.mov\' (in a unique subfolder)',
'\t\t\t\t\tif(targetName.toLowerCase() == \'capturedvideo.mov\') {',
'\t\t\t\t\t\ttargetName = A5.UUID() + \'_video.MOV\';',
'\t\t\t\t\t}',
'\t\t\t\t\tarr[i].targetName = targetName;',
'\t\t\t\t}',
'\t\t\t\t///--------end compute s3 target name',
'\t\t\t\to2.arr = arr;',
'\t\t\t\tvar data = A5.ajax.buildURLParam(\'_jsonOptions\',JSON.stringify(o2));',
'\t\t\t\tvar ajaxObj = {',
'\t\t\t\t\terrorFunction: function() {',
'\t\t\t\t\t\tif(typeof options.onAjaxFailed == \'function\') options.onAjaxFailed();',
'\t\t\t\t\t},',
'\t\t\t\t\tonComplete: function() {',
'\t\t\t\t\t\tvar startUploadLocal = function() {',
'\t\t\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\t\t\ttotalSize = totalSize + Number(arr[i].size);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tvar _sysObj = {};',
'\t\t\t\t\t\t\t_sysObj.totalBytesToUpload = totalSize;',
'\t\t\t\t\t\t\tvar flagMobile = false;',
'\t\t\t\t\t\t\tif(typeof options._flagMobile != \'undefined\') flagMobile = options._flagMobile;',
'\t\t\t\t\t\t\toptions._flagMobile = flagMobile;',
'\t\t\t\t\t\t\tif(options.showProgress && !flagMobile) generateProgressBarsHTML(options.progress,arr.length);',
'\t\t\t\t\t\t\t//alert(\'ready to start uploading files: total \' + totalSize);',
'\t\t\t\t\t\t\tstartUploadFilesToS3(_sysObj,options);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tvar _sTop = {};',
'\t\t\t\t\t\tgetFileSizesForAllItemsInArray(startUploadLocal,_sTop);',
'\t\t\t\t\t},',
'\t\t\t\t\tdeviceOfflineFunction: function() {',
'\t\t\t\t\t\tif(typeof options.onDeviceOffline == \'function\') options.onDeviceOffline();',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t//alert(\'ajax callback\');',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',xbasicFunction,\'\',data,ajaxObj);',
'\t\t\t} else {',
'\t\t\t\t//alpha server',
'\t\t\t\tvar startUploadLocal = function() {',
'\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\ttotalSize = totalSize + Number(arr[i].size);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _sysObj = {};',
'\t\t\t\t\t_sysObj.totalBytesToUpload = totalSize;',
'\t\t\t\t\tif(options.showProgress) generateProgressBarsHTML(options.progress,arr.length);',
'\t\t\t\t\tstartUploadFilesToS3(_sysObj,options);',
'\t\t\t\t}',
'\t\t\t\tvar _sTop = {};',
'\t\t\t\tgetFileSizesForAllItemsInArray(startUploadLocal,_sTop);',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: getFileSizesForAllItemsInList',
'\t\tvar getFileSizesForAllItemsInArray = function(allDone_GotAllFileSizes_Callback, _sTop)  {',
'\t\t\tvar _s = {count: 0};',
'\t\t\tvar getFileSizesForAllItemsInArrayLow = function (arr,r,count,callback,_s,_sTop) {',
'\t\t\t\tvar rowNumber = r;',
'\t\t\t\tvar url = arr[r].filename;',
'\t\t\t\tvar resolveLocalFileURL_SUCCESS = function(fileEntry) {',
'\t\t\t\t\tvar file_SUCCESS = function(f) {',
'\t\t\t\t\t\tarr[r].size = f.size;',
'\t\t\t\t\t\t_s.count = _s.count + 1;',
'\t\t\t\t\t\tif(_s.count == count) {',
'\t\t\t\t\t\t\tcallback(_sTop);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tfileEntry.file(file_SUCCESS);',
'\t\t\t\t}',
'\t\t\t\tvar resolveLocalFileURL_fail = function() {',
'\t\t\t\t\tarr[r].size = 0',
'\t\t\t\t\t_s.count = _s.count + 1;',
'\t\t\t\t\tif(_s.count == count) {',
'\t\t\t\t\t\tcallback(_sTop);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t//on  iphone, video capture does not return a file with the file:// prefix',
'\t\t\t\tvar urlToResolve = url;',
'\t\t\t\tif(url.indexOf(\'file:\') != 0) {',
'\t\t\t\t\turlToResolve = urlToResolve.replace(\'/private\',\'file:\\/\\/\');',
'\t\t\t\t}',
'\t\t\t\t//window.resolveLocalFileSystemURL(urlToResolve, resolveLocalFileURL_SUCCESS, function() { } );',
'\t\t\t\twindow.resolveLocalFileSystemURL(urlToResolve, resolveLocalFileURL_SUCCESS, resolveLocalFileURL_fail );',
'\t\t\t}',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tgetFileSizesForAllItemsInArrayLow(arr,i,arr.length,allDone_GotAllFileSizes_Callback,_s,_sTop)',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: startUploadFilesToS3',
'\t\tvar startUploadFilesToS3 = function(_sysObj,options) {',
'\t\t\t//_sysObj.totalBytesToUpload;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tupLoadFilesToS3Work(arr[i].filename,arr,i,_sysObj,options)',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: s3SignedPolicy',
'\t\tvar s3SignedPolicy = function() {',
'\t\t\tvar obj = {};',
'\t\t\tobj.hasError = {UXPRERENDEREDALIAS}_DlgObj._pgS3.hasError;',
'\t\t\tobj.policyBase64 = {UXPRERENDEREDALIAS}_DlgObj._pgS3.policyBase64;',
'\t\t\tobj.signature = {UXPRERENDEREDALIAS}_DlgObj._pgS3.signature;',
'\t\t\tobj.userKey = {UXPRERENDEREDALIAS}_DlgObj._pgS3.accessKey;',
'\t\t\tobj.acl = {UXPRERENDEREDALIAS}_DlgObj._pgS3.acl;',
'\t\t\tobj.bucket = {UXPRERENDEREDALIAS}_DlgObj._pgS3.bucket;',
'\t\t\treturn obj;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: uploadFilesToS3Work',
'\t\tvar upLoadFilesToS3Work = function(filenameURI,arr,fileNumber,_sysObj, actionOptions) {',
'\t\t\t//this code to compute the targetName now gets run before the ajax callback to sign the url is made because the v4 amz signing method',
'\t\t\t//needs to include the s3 object name in the url that gets signed',
'\t\t\tvar fileName = filenameURI.substr(filenameURI.lastIndexOf(\'/\')+1);',
'\t\t\tvar targetName = fileName;',
'\t\t\tif(typeof actionOptions.onComputeS3Filename == \'function\') {',
'\t\t\t\tvar e = {name: targetName, object: arr[fileNumber]};',
'\t\t\t\tvar newTargetName = actionOptions.onComputeS3Filename(e);',
'\t\t\t\tif(typeof newTargetName == \'undefined\') newTargetName = targetName;',
'\t\t\t\tif(newTargetName == \'\') newTargetName = targetName;',
'\t\t\t\ttargetName = newTargetName;',
'\t\t\t}',
'\t\t\t//on iphone video name is always \'capturedvideo.mov\' (in a unique subfolder)',
'\t\t\tif(targetName.toLowerCase() == \'capturedvideo.mov\') {',
'\t\t\t\ttargetName = A5.UUID() + \'_video.MOV\';',
'\t\t\t}',
'\t\t\tif(typeof actionOptions.target != \'undefined\') {',
'\t\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\t\tarr[fileNumber].targetName = targetName',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//',
'\t\t\t//do not do this here when target is S3. it has already been done before the ajax callback.',
'\t\t\t//arr[fileNumber].targetName = targetName; //use name that event returned',
'\t\t\tvar ft = new FileTransfer();',
'\t\t\tvar options = new FileUploadOptions();',
'\t\t\toptions.fileKey = "file";',
'\t\t\toptions.fileName = targetName;',
'\t\t\toptions.mimeType = "image/jpeg";',
'\t\t\toptions.chunkedMode = false;',
'\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\tvar s3URI = encodeURI( $u.s.aTrim({UXPRERENDEREDALIAS}_DlgObj.ajaxURL));',
'\t\t\t\t//s3URI = \'junk\'; //force a file upload error',
'\t\t\t\t//alert(\'remember to turn this off\');',
'\t\t\t\tvar xbasicAfterUpload = actionOptions.xbasicAfterFileUploaded',
'\t\t\t\tvar specialMode = \'\';',
'\t\t\t\tif(typeof actionOptions.specialMode != \'undefined\') specialMode = actionOptions.specialMode;',
'\t\t\t\toptions.params = {',
'\t\t\t\t\t"_XbasicFunction" : "system:phonegapfileupload",',
'\t\t\t\t\t"__Ajax" : "true",',
'\t\t\t\t\t"__FormAction" : "GenericAjaxCallback",',
'\t\t\t\t\t"__FormID" : "",',
'\t\t\t\t\t"__xbasicAfterUpload" : xbasicAfterUpload,',
'\t\t\t\t\t"__arrayIndex" : fileNumber,',
'\t\t\t\t\t"__actionOptions" : JSON.stringify(actionOptions),',
'\t\t\t\t\t"__specialMode" : specialMode,',
'\t\t\t\t\t"__targetName" : targetName,',
'\t\t\t\t\t"__arrayItem" : JSON.stringify(arr[fileNumber]),',
'\t\t\t\t\t"__ajaxURL" : $u.s.aTrim({UXPRERENDEREDALIAS}_DlgObj.ajaxURL)',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//s3',
'\t\t\t\tvar obj = s3SignedPolicy();',
'\t\t\t\tvar s3URI = encodeURI(\'https://\' + obj.bucket + \'.s3.amazonaws.com/\'),',
'\t\t\t\t\tpolicyBase64 = obj.policyBase64,',
'\t\t\t\t\tsignature = obj.signature,',
'\t\t\t\t\tawsKey = obj.userKey,',
'\t\t\t\t\tacl = obj.acl;',
'\t\t\t\t//this is computed on the server',
'\t\t\t\ts3URI = {UXPRERENDEREDALIAS}_DlgObj._pgS3.signedURI;',
'\t\t\t\tvar arr2 = JSON.parse({UXPRERENDEREDALIAS}_DlgObj._pgS3.signedURIArrayJSON);',
'\t\t\t\tvar _uri = arr2[fileNumber].uri;',
'\t\t\t\tvar _mime = arr2[fileNumber].mimeType;',
'\t\t\t\ts3URI = _uri;',
'\t\t\t\t//alert(\'s3URI: \' + s3URI);',
'\t\t\t\toptions.params = {',
'\t\t\t\t\t"key": targetName,',
'\t\t\t\t\t"AWSAccessKeyId": awsKey,',
'\t\t\t\t\t"acl": acl,',
'\t\t\t\t\t"policy": policyBase64,',
'\t\t\t\t\t"signature": signature,',
'\t\t\t\t\t"Content-Type": "image/jpeg"',
'\t\t\t\t};',
'\t\t\t}',
'\t\t\tvar setProgress = function(progressId,fileNumber,pctComplete) {',
'\t\t\t\tvar id = \'\';',
'\t\t\t\tvar countCompleted = 0;',
'\t\t\t\tif(fileNumber == \'total\') {',
'\t\t\t\t\tid = progressId + \'.PROGRESS.TOTAL\';',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\tif(arr[i].completed) countCompleted = countCompleted + 1;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar idN = progressId + \'.NAME.TOTAL\';',
'\t\t\t\t\tvar ele = $(idN);',
'\t\t\t\t\t//if(ele) ele.innerHTML = \'Completed: \' + countCompleted +  \' of \' + arr.length;',
'\t\t\t\t} else {',
'\t\t\t\t\tid = progressId + \'.PROGRESS.\' + fileNumber;',
'\t\t\t\t}',
'\t\t\t\tvar ele = $(id);',
'\t\t\t\tif(ele) ele.style.width = pctComplete + \'%\';',
'\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\tele = $(idP);',
'\t\t\t\tif(ele) ele.style.display = \'\';',
'\t\t\t}',
'\t\t\tft.onprogress = function(progressEvent) {',
'\t\t\t\tvar totalBytesToTransfer = _sysObj.totalBytesToUpload',
'\t\t\t\tif(typeof _sysObj.workDone == \'undefined\') {',
'\t\t\t\t\t_sysObj.workDone = [];',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\t_sysObj.workDone[i] = 0;',
'\t\t\t\t\t}',
'\t\t\t\t };',
'\t\t\t\t_sysObj.workDone[fileNumber] = progressEvent.loaded;',
'\t\t\t\tvar gTotal = 0;',
'\t\t\t\tfor(var i = 0; i < _sysObj.workDone.length; i++) {',
'\t\t\t\t\tif(typeof _sysObj.workDone[i] != \'undefined\') {',
'\t\t\t\t\t\tgTotal = gTotal + _sysObj.workDone[i];',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\tif (progressEvent.lengthComputable) {',
'\t\t\t\t\tvar pctComplete = (progressEvent.loaded / progressEvent.total)*100;',
'\t\t\t\t\tif(pctComplete > 100) pctComplete = 100;',
'\t\t\t\t\tpctComplete = $u.n.round(pctComplete,4);',
'\t\t\t\t\tif(actionOptions.showProgress) setProgress(progressId,fileNumber,pctComplete);',
'\t\t\t\t\tif(typeof actionOptions.onProgressEvent == \'function\') {',
'\t\t\t\t\t\tactionOptions.onProgressEvent(arr, fileNumber, pctComplete, progressEvent.loaded, progressEvent.total);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar pctCompleteTotal = (gTotal / totalBytesToTransfer) * 100;',
'\t\t\t\t\tif(pctCompleteTotal > 100) pctCompleteTotal = 100;',
'\t\t\t\t\tpctCompleteTotal = $u.n.round( pctCompleteTotal,4);',
'\t\t\t\t\tif(actionOptions.showProgress) setProgress(progressId,\'total\',pctCompleteTotal);',
'\t\t\t\t\tif(typeof actionOptions.onProgressEvent == \'function\') {',
'\t\t\t\t\t\tactionOptions.onProgressEvent(arr, \'total\', pctCompleteTotal, gTotal, totalBytesToTransfer);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(actionOptions._flagMobile) {',
'\t\t\t\t\t\tif($(\'MOBILEUPLOADPROGRESS.1\')) $(\'MOBILEUPLOADPROGRESS.1\').style.width = pctCompleteTotal + \'%\';',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\t//progress messages not possible -- should never happen',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tvar _hasCompleted = function() {',
'\t\t\t\tvar flagAllDone = true;',
'\t\t\t\tfor(var i = 0; i < arr.length; i ++) {',
'\t\t\t\t\tif(arr[i].completed == false) {',
'\t\t\t\t\t\tflagAllDone = false;',
'\t\t\t\t\t\tbreak;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treturn flagAllDone;',
'\t\t\t}',
'\t\t\tvar fileUploadSuccess = function(r) {',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t\tarr[fileNumber].succeeded = true;',
'\t\t\t\tarr[fileNumber].remoteName = arr[fileNumber].targetName;',
'\t\t\t\t//for uploads to AlphaAnywhere, the Xbasic function that is called can send a response',
'\t\t\t\tif(r.response != \'undefined\') {',
'\t\t\t\t\tif(r.response != \'\') eval(r.response);',
'\t\t\t\t};',
'\t\t\t\t//if the targer is the Alpha server and the Xbasic handler sent a response that set the \'targetFileName\' property',
'\t\t\t\tvar target = actionOptions.target.toLowerCase();',
'\t\t\t\tif(target == \'s3\') {',
'\t\t\t\t\tif(typeof actionOptions.s3.template != \'undefined\') {',
'\t\t\t\t\t\tarr[fileNumber].remoteName = actionOptions.s3.template.replace(\'__name__\',arr[fileNumber].targetName);',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tif(typeof arr[fileNumber].targetFileName != \'undefined\') {',
'\t\t\t\t\t\tarr[fileNumber].remoteName = arr[fileNumber].targetFileName;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(typeof actionOptions.onCompleteIndividualFile == \'function\') {',
'\t\t\t\t\tactionOptions.onCompleteIndividualFile(arr,fileNumber);',
'\t\t\t\t}',
'\t\t\t\tvar flagAllDone = _hasCompleted();',
'\t\t\t\tif(flagAllDone) {',
'\t\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\tvar ele = $(idP);',
'\t\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t\t\tif(typeof actionOptions.onComplete == \'function\') {',
'\t\t\t\t\t\tactionOptions.onComplete(arr);',
'\t\t\t\t\t};',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar _hideProgress = function() {',
'\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\tvar ele = $(idP);',
'\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t}',
'\t\t\tvar fileUploadFailed = function(error) {',
'\t\t\t\tarr[fileNumber].failed = true;',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t\tif(typeof actionOptions.onError == \'function\') {',
'\t\t\t\t\tactionOptions.onError(arr,fileNumber,error);',
'\t\t\t\t}',
'\t\t\t\tif(typeof actionOptions.onCompleteIndividualFile == \'function\') {',
'\t\t\t\t\tactionOptions.onCompleteIndividualFile(arr,fileNumber);',
'\t\t\t\t}',
'\t\t\t\tvar flagAllDone = _hasCompleted();',
'\t\t\t\tif(flagAllDone) {',
'\t\t\t\t\t_hideProgress();',
'\t\t\t\t\tif(typeof actionOptions.onComplete == \'function\') {',
'\t\t\t\t\t\tactionOptions.onComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t};',
'\t\t\t}',
'\t\t\tvar flagOK = true;',
'\t\t\tif(typeof actionOptions.onValidate == \'function\') {',
'\t\t\t\tvar result = actionOptions.onValidate(arr,fileNumber);',
'\t\t\t\tif(typeof result != \'undefined\') flagOK = result;',
'\t\t\t}',
'\t\t\t//do the upload',
'\t\t\tif(flagOK) {',
'\t\t\t\tvar flagTrustAllHosts = false;',
'\t\t\t\tif(typeof _dlgObj != \'undefined\') {',
'\t\t\t\t\tif(typeof _dlgObj._phoneGapTrustAllHosts != \'undefined\') {',
'\t\t\t\t\t\tflagTrustAllHosts = _dlgObj._phoneGapTrustAllHosts;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\t\toptions.httpMethod = \'POST\';',
'\t\t\t\t} else {',
'\t\t\t\t\toptions.httpMethod = \'PUT\';',
'\t\t\t\t\toptions.headers = {\'Content-Type\': \'image/jpeg\',\'x-amz-acl\': acl };',
'\t\t\t\t\toptions.multipartMode = false;',
'\t\t\t\t}',
'\t\t\t\tft.upload(filenameURI, s3URI, fileUploadSuccess, fileUploadFailed, options,flagTrustAllHosts);',
'\t\t\t} else {',
'\t\t\t\tarr[fileNumber].aborted = true;',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t}',
'\t\t}',
'\t\tphoneGapUploadDoWork(arr,options);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory = function(dirName, onComplete, onError) {',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\t//got the filesystem',
'\t\t\tvar onDirCreateSuccess = function(dirEntry) {',
'\t\t\t\tif(typeof onComplete == \'function\') {',
'\t\t\t\t\tonComplete();',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tfs.root.getDirectory(dirName, {create: true},onDirCreateSuccess, onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectoryRecurse = function(dirName, onComplete, onError) {',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar prepareWork = function(dir) {',
'\t\t\tvar arr = dir.split(\'/\');',
'\t\t\tvar arr3 = [];',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tvar arr2 = [];',
'\t\t\t\tfor(var k = 0; k < i + 1; k++) {',
'\t\t\t\t\tarr2.push(arr[k]);',
'\t\t\t\t}',
'\t\t\t\tarr3.push(arr2.join(\'/\'));',
'\t\t\t}',
'\t\t\treturn arr3;',
'\t\t}',
'\t\tvar arr = prepareWork(dirName);',
'\t\tvar count = 0;',
'\t\tvar onCompleteLocal = function() {',
'\t\t\tif(count == arr.length) {',
'\t\t\t\tonComplete();',
'\t\t\t} else {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory(arr[count],onCompleteLocal,onError);',
'\t\t\t\t++count;',
'\t\t\t}',
'\t\t}',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory(arr[count],onCompleteLocal,onError);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory = function(dirName, onComplete, onError) {',
'\t\t//calls onComplete with an array of files in the directory',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\t//got filesystem event handler',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tif(dirName.indexOf(\'/\') == 0) dirName = dirName.substring(1);',
'\t\t\t//got the fileSystem',
'\t\t\t//alert(\'got fs - dirName:  \' + dirName);',
'\t\t\tfs.root.getDirectory(dirName,{},function(e) {',
'\t\t\tvar dirReader = e.createReader();',
'\t\t\tvar listFiles = function(entries) {',
'\t\t\t\tvar fileCount = entries.length;',
'\t\t\t\tvar arr = [];',
'\t\t\t\tvar displayName = \'\';',
'\t\t\t\tfor(var i = 0; i < fileCount ; i++) {',
'\t\t\t\t\tif(entries[i].isFile) displayName = entries[i].fullPath + \' [F]\';',
'\t\t\t\t\telse displayName = entries[i].fullPath + \' [D]\';',
'\t\t\t\t\tarr.push( {fullPath: entries[i].fullPath, isFile: entries[i].isFile, display: displayName } );',
'\t\t\t\t}',
'\t\t\t\tif(typeof onComplete == \'function\') {',
'\t\t\t\t\tonComplete(arr);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tdirReader.readEntries(listFiles,onError);',
'\t\t},onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectoryRecurse = function(folder, onDirComplete, onDirError) {',
'\t\t//onDirComplete gets called with files, an array of all files. each array entry has a \'fileName\' property.',
'\t\tvar files = [];',
'\t\tvar pending = 0;',
'\t\tvar onComplete = function(array) {',
'\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\tif(array[i].isFile) {',
'\t\t\t\t\tfiles.push({fullPath: array[i].fullPath, isFile: true, display: array[i].fullPath + \' [F]\'})',
'\t\t\t\t} else {',
'\t\t\t\t\t++pending;',
'\t\t\t\t\tfiles.push({fullPath: array[i].fullPath, isFile: false, display: array[i].fullPath + \' [D]\'})',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory(array[i].fullPath,onComplete,onError)',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t--pending;',
'\t\t\tif(pending == 0) {',
'\t\t\t\tonDirComplete(files);',
'\t\t\t}',
'\t\t}',
'\t\tvar onError = function(err) {',
'\t\t\tif(typeof onDirError == \'function\') {',
'\t\t\t\tonDirError(err);',
'\t\t\t\tonDirComplete = function() { } //prevent the all complete from firing',
'\t\t\t}',
'\t\t\telse alert(\'Error\');',
'\t\t}',
'\t\t++pending;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory(folder,onComplete,onError);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectory = function(dirName,onSuccess,onError,flagRecursive) {',
'\t\tif(typeof flagRecursive == \'undefined\') flagRecursive = false;',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar gotDirectory = function(dirEntry) {',
'\t\t\t\tif(flagRecursive) {',
'\t\t\t\t\tdirEntry.removeRecursively(function() {',
'\t\t\t\t\t\tif(typeof onSuccess == \'function\') onSuccess();',
'\t\t\t\t\t},onError);',
'\t\t\t\t} else {',
'\t\t\t\t\tdirEntry.remove(function() {',
'\t\t\t\t\t\tif(typeof onSuccess == \'function\') onSuccess();',
'\t\t\t\t\t},onError);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//if you cant find the dir then it is effectively removed, so call onSuccess',
'\t\t\tfs.root.getDirectory(dirName, {}, gotDirectory, onSuccess);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurse = function(dirName,onSuccess,onError) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectory(dirName,onSuccess,onError,true);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFile = function(fileName,onSuccess,onError) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tfs.root.getFile(fileName, {create: false}, function(f) {',
'\t\t\t\tf.remove( function() {',
'\t\t\t\t\tif(typeof onSuccess == \'function\') {',
'\t\t\t\t\t\tonSuccess();',
'\t\t\t\t\t}',
'\t\t\t\t}, onError );',
'\t\t\t}, onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExists = function(fileName,onResult,onFailed) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar gotFile = function(f) {',
'\t\t\t\tif(typeof onResult == \'function\') onResult(true);',
'\t\t\t}',
'\t\t\tvar didNotGetFile = function() {',
'\t\t\t\tif(typeof onResult == \'function\') onResult(false);',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create: false}, gotFile,didNotGetFile);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onFailed );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFile = function(fileName,onReadFile,onReadFileERROR,startAt,endAt) {',
'\t\tif(typeof fileName == \'object\') {',
'\t\t\tvar fnObj = fileName;',
'\t\t\tvar _success = onReadFile',
'\t\t\tif(typeof onReadFileERROR == \'undefined\') onReadFileERROR = function(err) { };',
'\t\t\tvar _error = onReadFileERROR;',
'\t\t\tif(fnObj._strip) {',
'\t\t\t\tvar _filePath = this.phoneGapGetLocalDirURL(fnObj._fs) + fnObj._dir + \'/\' + fnObj.fileNameShort;',
'\t\t\t} else {',
'\t\t\t\tvar _filePath = this.phoneGapGetLocalDirURL(fnObj._fs) + fnObj._dir + \'/\' + \'A5SessionFile/\' + fnObj.fileNameShort;',
'\t\t\t}',
'\t\t\tif(typeof startAt == \'undefined\') {',
'\t\t\t\tthis.phoneGapReadFileURL(_filePath, _success,_error);',
'\t\t\t} else {',
'\t\t\t\tthis.phoneGapReadFileURL(_filePath, _success,_error,startAt,endAt);',
'\t\t\t}',
'\t\t\treturn true;',
'\t\t}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar readFile = function(f) {',
'\t\t\t\tf.file( function(e) {',
'\t\t\t\t\treader = new FileReader();',
'\t\t\t\t\treader.onloadend = function(e) {',
'\t\t\t\t\t\tif(typeof onReadFile == \'function\') {',
'\t\t\t\t\t\t\tonReadFile(e.target.result);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tif(typeof startAt == \'undefined\' || typeof endAt == \'undefined\') {',
'\t\t\t\t\t\treader.readAsText(e);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar blob = e.slice(startAt,endAt);',
'\t\t\t\t\t\treader.readAsText(blob);',
'\t\t\t\t\t}',
'\t\t\t\t});',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create: false}, readFile, onReadFileERROR);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onReadFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low = function(fileName,text,onCreatedFile,onCreateFileERROR) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar writeFileData = function(f) {',
'\t\t\t\tvar doFileWrite = function(writerObject) {',
'\t\t\t\t\twriterObject.onwrite = function() {',
'\t\t\t\t\t\tif(typeof onCreatedFile == \'function\') onCreatedFile();',
'\t\t\t\t\t}',
'\t\t\t\t\twriterObject.seek(writerObject.length);',
'\t\t\t\t\tvar blob = new Blob([text], {type: \'text/plain\'});',
'\t\t\t\t\twriterObject.write(blob);',
'\t\t\t\t}',
'\t\t\t\tf.createWriter(doFileWrite);',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create:true}, writeFileData, onCreateFileERROR);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onCreateFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateFile = function(fileName,text,onCreatedFile,onCreateFileERROR,flagAppend) {',
'\t\tif(fileName == \'\') {if(typeof onCreateFileERROR == \'function\') onCreateFileERROR(); return false;}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tif(!flagAppend) {',
'\t\t\t\tvar onDelete = function() {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low(fileName,text,onCreatedFile,onCreateFileERROR);',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFile(fileName,onDelete,onDelete)',
'\t\t\t} else {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low(fileName,text,onCreatedFile,onCreateFileERROR)',
'\t\t\t}',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onCreateFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload = function(arr,options) {',
'\t\tvar totalSizePassedIn = 0;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(typeof arr[i].size != \'undefined\') totalSizePassedIn = totalSizePassedIn + arr[i].size;',
'\t\t}',
'\t\toptions.totalSizePassedIn = totalSizePassedIn',
'\t\tif(totalSizePassedIn > 0) options.totalFileSize = totalSizePassedIn;',
'\t\tif(typeof options.targetFolder == \'undefined\') {',
'\t\t\tvar _baseURI = this.phoneGapGetLocalDirURL(options.filesystem);; //sr2',
'\t\t\tvar _dirName = options.directory;;',
'\t\t\tif(_dirName == \'\') {',
'\t\t\t\tvar _dirPath = _baseURI;',
'\t\t\t} else {',
'\t\t\t\tvar _dirPath = _baseURI + _dirName + \'/\';',
'\t\t\t}',
'\t\t\toptions.fullyQualifiedPath = _dirPath;',
'\t\t}',
'\t\tvar _countDone = 0;',
'\t\tvar flagCustomOnError = false;',
'\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\t\t//if(!flagCustomOnError) window.onerror = function(err) { alert(\'Unhandled Javascript Error - phoneGapFileDownload:  \' + JSON.stringify(err));}',
'\t\tvar _dlgObj = this;',
'\t\tif(typeof LocalFileSystem == \'undefined\') {',
'\t\t\tif(typeof cordova == \'undefined\') {',
'\t\t\t\talert(\'Method not supported when not running in PhoneGap\');',
'\t\t\t} else {',
'\t\t\t\talert(\'Required PhoneGap plugins (\\\'LocalFileSystem\\\') not loaded.\');',
'\t\t\t}',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\t//got filesystem event handler',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].handled = false;',
'\t\t\tarr[i].downloaded = false;',
'\t\t\tarr[i].sourceType = \'server\';',
'\t\t\tif(arr[i].filename.toLowerCase().indexOf(\'http://\') == 0) arr[i].sourceType = \'url\';',
'\t\t\tif(arr[i].filename.toLowerCase().indexOf(\'https://\') == 0) arr[i].sourceType = \'url\';',
'\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\tarr[i].sourceFilename = arr[i].filename.split(\'/\').pop().split(\'?\')[0];',
'\t\t\t}',
'\t\t}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar baseDirectory = fs.root.toURL();',
'\t\t\toptions._baseDirectory = baseDirectory; //sr 99',
'\t\t\tvar url = {UXPRERENDEREDALIAS}_DlgObj.ajaxURL;',
'\t\t\t;',
'\t\t\turl = url.split(\'?\')[0];',
'\t\t\turl = url.split(\'/\');',
'\t\t\turl.pop();',
'\t\t\turl = url.join(\'/\') + \'/\';',
'\t\t\toptions._serverURL = url;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t//arr[i].localFileName = false;',
'\t\t\t}',
'\t\t\tif(options.showProgress) {',
'\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\tif(typeof eleTarget != \'undefined\'){',
'\t\t\t\t\tif(eleTarget != eleTarget.toUpperCase() ) {',
'\t\t\t\t\t\talert(\'error: PROGRESS WILL NOT BE SHOWN. target div name MUST be uppercase. you have specified :\' + eleTarget);',
'\t\t\t\t\t}',
'\t\t\t\t\teleTarget = eleTarget.toUpperCase();',
'\t\t\t\t}',
'\t\t\t\tvar idProgress = eleTarget;',
'\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\tif(!ele) options.showProgress = false; //set to false or else you will hang iOS',
'\t\t\t}',
'\t\t\tif(options.showProgress) {',
'\t\t\t\tvar ops = options.progress;',
'\t\t\t\tops.totalFileSize = options.totalFileSize;',
'\t\t\t\tvar eleTarget = ops.progressElement;',
'\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\tvar html = \'\';',
'\t\t\t\tvar html_i = \'\';',
'\t\t\t\tvar name_i = \'\';',
'\t\t\t\tvar progress_i = \'\';',
'\t\t\t\tvar idName = \'\';',
'\t\t\t\tvar idProgress = \'\';',
'\t\t\t\tidProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\tidName = eleTarget + \'.NAME.TOTAL\';',
'\t\t\t\tprogress_i = \'<div style="background-color: #f3f0ef; border: solid 1px gray; border-radius: 5px; width: \'+ops.width+\'; ">\';',
'\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';border-radius: 5px; border: solid .5px \'+ops.color+\';"></div></div>\';',
'\t\t\t\thtml_i = \'<div id="\'+idName+\'" ></div>\'+progress_i;',
'\t\t\t\thtml = html + html_i',
'\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\thtml = \'<div id="\'+idProgress+\'"  style="width: 100%" >\' + html + \'</div>\';',
'\t\t\t\tif ($(eleTarget)) $(eleTarget).innerHTML = html;',
'\t\t\t\tvar msg = \'eleTarget: \' + eleTarget + \'\\n\' + html',
'\t\t\t\tvar showProgress = function(pct,arr,fileNumber,loaded,totalBytes, onProgressEvent,completedFiles) {',
'\t\t\t\t\tvar eleTarget = options.progress.progressElement',
'\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\t\tif(ele) {',
'\t\t\t\t\t\tif(pct >=100) pct = 100;',
'\t\t\t\t\t\tele.style.width = pct + \'%\';',
'\t\t\t\t\t\tele.style.borderRadius = \'5px\';',
'\t\t\t\t\t}',
'\t\t\t\t\tif(typeof onProgressEvent == \'function\') {',
'\t\t\t\t\t\t//match the prototype of the function: array, arrayIndex, pctComplete, bytesCompleted, bytesTotal, completedFiles',
'\t\t\t\t\t\tonProgressEvent(arr,fileNumber,pct,loaded,totalBytes,completedFiles)',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tvar showProgress = function(pct) { };',
'\t\t\t\t//this is wrong. if the user has turned showprogress off, then the showProgress() function must still be defined, passsing in the user defined onProgress event',
'\t\t\t}',
'\t\t\tvar phoneGapFileDownload_low = function(arr,iIn,options) {',
'\t\t\t\tvar i = Number(iIn);',
'\t\t\t\tif(typeof options.targetFolder != \'undefined\') {',
'\t\t\t\t\tvar targetFolder = options.targetFolder;',
'\t\t\t\t\tif(targetFolder != \'\') targetFolder = targetFolder + \'/\';',
'\t\t\t\t\tif(typeof options._baseDirectory != \'undefined\') {',
'\t\t\t\t\t\tvar fnLocal = options._baseDirectory + targetFolder + A5.parseFilename(arr[i].filename).name;',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar fnLocal = targetFolder + A5.parseFilename(arr[i].filename).name; //sr99',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tvar flagStrip = false;',
'\t\t\t\t\tif(typeof options.strip != \'undefined\') flagStrip = options.strip;',
'\t\t\t\t\tvar flagHasA5SessionFilePrefix = false',
'\t\t\t\t\tif(arr[i].filename.indexOf(\'A5SessionFile/\') >=0) flagHasA5SessionFilePrefix = true;',
'\t\t\t\t\tif(flagStrip) {',
'\t\t\t\t\t\tvar _fn = (A5.parseFilename(arr[i].filename).name).replace(\'A5SessionFile/\',\'\');',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar _fn = A5.parseFilename(arr[i].filename).name;',
'\t\t\t\t\t\tif(flagHasA5SessionFilePrefix) _fn = \'A5SessionFile/\' + _fn;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar fnLocal = options.fullyQualifiedPath + _fn;',
'\t\t\t\t}',
'\t\t\t\t//alert(fnLocal); //could strip off /A5SessionFile',
'\t\t\t\t/*',
'\t\t\t\tnot sure why this is being done, but wrong',
'\t\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\t\tif(typeof targetFolder == \'undefined\') {',
'\t\t\t\t\t\ttargetFolder = options.directory + \'/\';',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\ttargetFolder = options.targetFolder + \'/\';',
'\t\t\t\t\t}',
'\t\t\t\t\tfnLocal = options._baseDirectory + targetFolder +arr[i].sourceFilename;',
'\t\t\t\t}',
'\t\t\t\t*/',
'\t\t\t\tif(A5.log) A5.log(\'fnLocal: \' + fnLocal);',
'\t\t\t\t//if the targetFolder is <SQLite>|localdbname.db user is doing a special download to the SQL database folder',
'\t\t\t\tvar flagSQLite = false;',
'\t\t\t\t/*',
'\t\t\t\tif(targetFolder.indexOf(\'<SQLite>\') == 0) {',
'\t\t\t\t\tvar localDBName = targetFolder.split(\'|\')[1];',
'\t\t\t\t\tlocalDBName = localDBName.split(\'/\')[0];',
'\t\t\t\t\tflagSQLite = true;',
'\t\t\t\t\tvar thisPackageName = \'\';',
'\t\t\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\t\t\tvar localDbFileUrl = \t{',
'\t\t\t\t\t\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\tios: \'cdvfile://localhost/persistent/\' + localDBName',
'\t\t\t\t\t\t\t//cdvfile://localhost/persistent/sqlite/\' + localDBName',
'\t\t\t\t\t\t};',
'\t\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar thisDevice = device.platform;',
'\t\t\t\t\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\t\t\t\t\tconsole.log(\'database location: \' + fileUrl);',
'\t\t\t\t\tfnLocal = fileUrl;',
'\t\t\t\t}',
'\t\t\t\t*/',
'\t\t\t\tif(typeof options.targetFolder != \'undefined\') {',
'\t\t\t\t\tif(targetFolder.indexOf(\'<SQLite>\') == 0) {',
'\t\t\t\t\t\tvar localDBName = targetFolder.split(\'|\')[1];',
'\t\t\t\t\t\tlocalDBName = localDBName.split(\'/\')[0];',
'\t\t\t\t\t\tflagSQLite = true;',
'\t\t\t\t\t\tvar thisPackageName = \'\';',
'\t\t\t\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\t\t\t\tvar localDbFileUrl = {',
'\t\t\t\t\t\t\t// Android note: This entry was tested and works on Android 6.01, 5.5.1, 4.4.2',
'\t\t\t\t\t\t\tandroidx: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\tandroid: cordova.file.applicationStorageDirectory.substr(7) + \'databases/\' + localDBName,',
'\t\t\t\t\t\t\t// iOS Note: dataDirectory will point to ..appid/Library/NoCloud',
'\t\t\t\t\t\t\t// This is not exposed to iTunes or iCloud',
'\t\t\t\t\t\t\tios: cordova.file.dataDirectory + localDBName',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tvar thisDevice = device.platform;',
'\t\t\t\t\t\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\t\t\t\t\t\tconsole.log(\'.phoneGapFileDownload reports fileUrl: \' + fileUrl);',
'\t\t\t\t\t\tfnLocal = fileUrl;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar fileFound = function() {',
'\t\t\t\t\tvar forceDownload = false;',
'\t\t\t\t\tforceDownload = options.forceDownloadIfFileExists;',
'\t\t\t\t\tif(typeof forceDownload == \'undefined\') forceDownload = false;',
'\t\t\t\t\tif(forceDownload) {',
'\t\t\t\t\t\tfileNotFound();',
'\t\t\t\t\t\treturn true;',
'\t\t\t\t\t}',
'\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\tarr[i].found = true;',
'\t\t\t\t\tarr[i].localFilename = fnLocal;',
'\t\t\t\t\tarr[i].success = true;',
'\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t////',
'\t\t\t\t\tvar totalBytes = 0;',
'\t\t\t\t\tvar loaded = 0;',
'\t\t\t\t\tvar pctCompleteTotal = 0;',
'\t\t\t\t\tvar flagStartShowingProgress = true;',
'\t\t\t\t\tvar completedFiles = 0;',
'\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\tvar _pctMethod = \'auto\' //base on filesLoadedCount if array size > 10',
'\t\t\t\t\tif(typeof options != \'undefined\') {',
'\t\t\t\t\t\tif(typeof options.pctMethod != \'undefined\') _pctMethod = options.pctMethod',
'\t\t\t\t\t}',
'\t\t\t\t\tif(arr.length == 1) _pctMethod = \'auto\';',
'\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\tif(typeof arr[k].totalBytes != \'undefined\') {',
'\t\t\t\t\t\t\ttotalBytes = totalBytes + arr[k].totalBytes;',
'\t\t\t\t\t\t\tloaded = loaded + arr[k].bytesLoaded;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(arr[k].handled) completedFiles++;',
'\t\t\t\t\t\tpctCompleteTotal = (loaded/totalBytes) * 100;',
'\t\t\t\t\t\tif(totalSize > 0) {',
'\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalSize) * 100;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(_pctMethod == \'auto\') {',
'\t\t\t\t\t\t\tif(arr.length >= 10) _pctMethod = \'fileCount\';',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(_pctMethod == \'fileCount\') {',
'\t\t\t\t\t\t\tpctCompleteTotal = (completedFiles/ arr.length) * 100;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(flagStartShowingProgress || true ) showProgress(pctCompleteTotal,arr,i,loaded,totalBytes, options.onProgressEvent,completedFiles);',
'\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar fileNotFound = function() {',
'\t\t\t\t\t//file was not in the local filesystem so must download it.',
'\t\t\t\t\tarr[i].found = false;',
'\t\t\t\t\tarr[i].localFilename = fnLocal;',
'\t\t\t\t\tvar url2 = options._serverURL + arr[i].filename;',
'\t\t\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\t\t\turl2 = arr[i].filename;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ft = new FileTransfer();',
'\t\t\t\t\tft.onprogress = function(progressEvent) {',
'\t\t\t\t\t\tif (progressEvent.lengthComputable) {',
'\t\t\t\t\t\t\tarr[i].totalBytes = progressEvent.total;',
'\t\t\t\t\t\t\tarr[i].bytesLoaded = progressEvent.loaded;',
'\t\t\t\t\t\t\tvar totalSize = -1;',
'\t\t\t\t\t\t\t_pctMethod = \'auto\' //base on filesLoadedCount if array size > 10',
'\t\t\t\t\t\t\tif(typeof options != \'undefined\') {',
'\t\t\t\t\t\t\t\ttotalSize = options.totalFileSize;',
'\t\t\t\t\t\t\t\tif(typeof options.pctMethod != \'undefined\') _pctMethod = options.pctMethod',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(arr.length == 1) _pctMethod = \'auto\';',
'\t\t\t\t\t\t\t//alert(_pctMethod);',
'\t\t\t\t\t\t\tif(typeof totalSize == \'undefined\') totalSize = -1;',
'\t\t\t\t\t\t\tif(totalSize == -1) {',
'\t\t\t\t\t\t\t\tvar pctComplete = (progressEvent.loaded / progressEvent.total)*100;',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\tvar pctComplete = (progressEvent.loaded / totalSize)*100;',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(pctComplete > 100) pctComplete = 100;',
'\t\t\t\t\t\t\tpctComplete = $u.n.round(pctComplete,4);',
'\t\t\t\t\t\t\tarr[i].pctComplete = pctComplete;',
'\t\t\t\t\t\t\tvar totalBytes = 0;',
'\t\t\t\t\t\t\tvar loaded = 0;',
'\t\t\t\t\t\t\tvar pctCompleteTotal = 0;',
'\t\t\t\t\t\t\tvar flagStartShowingProgress = true;',
'\t\t\t\t\t\t\tvar completedFiles = 0;',
'\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\tif(typeof arr[k].totalBytes != \'undefined\') {',
'\t\t\t\t\t\t\t\t\ttotalBytes = totalBytes + arr[k].totalBytes;',
'\t\t\t\t\t\t\t\t\tloaded = loaded + arr[k].bytesLoaded;',
'\t\t\t\t\t\t\t\t\tif(arr[k].handled) completedFiles++;',
'\t\t\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalBytes) * 100;',
'\t\t\t\t\t\t\t\t\tif(typeof options.totalSizePassedIn > 0) {',
'\t\t\t\t\t\t\t\t\t\ttotalSize = options.totalSizePassedIn;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(totalSize > 0) {',
'\t\t\t\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalSize) * 100;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(_pctMethod == \'auto\') {',
'\t\t\t\t\t\t\t\t\t\tif(arr.length >= 10) _pctMethod = \'fileCount\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(_pctMethod == \'fileCount\') {',
'\t\t\t\t\t\t\t\t\t\tpctCompleteTotal = (completedFiles/ arr.length) * 100;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(flagStartShowingProgress || true ) showProgress(pctCompleteTotal,arr,i,loaded,totalBytes, options.onProgressEvent,completedFiles); //sr55',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t//alert(\'length NOT computable: \' + arr[i].filename);',
'\t\t\t\t\t\t\tconsole.log(\'PhoneGap fileTransfer event. onProgress. length NOT computable: \' + arr[i].filename)',
'\t\t\t\t\t\t\t//alert(\'progressevent: \' + JSON.stringify(progressEvent));',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar flagTrustAllHosts = false;',
'\t\t\t\t\tif(typeof _dlgObj._phoneGapTrustAllHosts != \'undefined\') {',
'\t\t\t\t\t\tflagTrustAllHosts = _dlgObj._phoneGapTrustAllHosts;',
'\t\t\t\t\t}',
'\t\t\t\t\t//had a url like this: https://aapdf.s3.amazonaws.com/651 - 2015007 - HL072 - Summary P&L.PDF',
'\t\t\t\t\t//need to urlencode the url and the fnLocal to get this',
'\t\t\t\t\t//https://aapdf.s3.amazonaws.com/651%20-%202015007%20-%20HL072%20-%20Summary%20P%26L.PDF',
'\t\t\t\t\t//first decode, then encode again to make sure we don\'t double encode',
'\t\t\t\t\t//the fix the encoded \'&\' - %2526 to change to %26',
'\t\t\t\t\tvar testString1 = url2.toLowerCase();',
'\t\t\t\t\tvar testString2 = decodeURI(url2).toLowerCase();',
'\t\t\t\t\tvar search = \'X-Amz-\'.toLowerCase();',
'\t\t\t\t\tvar flagDoEncode = true;',
'\t\t\t\t\tif(testString1.indexOf(search) > -1 || testString2.indexOf(search) > -1) flagDoEncode = false;',
'\t\t\t\t\t//if the url to download from S3 is signed then the urlencode() will break the download',
'\t\t\t\t\tif(flagDoEncode) {',
'\t\t\t\t\t\turl2 = encodeURI(decodeURI(url2));',
'\t\t\t\t\t\turl2 = url2.replace(/%2526/g,\'%26\');',
'\t\t\t\t\t}',
'\t\t\t\t\tfnLocal = encodeURI(decodeURI(fnLocal));',
'\t\t\t\t\tfnLocal = fnLocal.replace(/%2526/g,\'%26\');',
'\t\t\t\t\tif(A5.log) A5.log(\'Inside PhoneGap file transfer url2: \' + url2);',
'\t\t\t\t\tif(A5.log) A5.log(\'Inside PhoneGap file transfer fnLocal: \' + fnLocal);',
'\t\t\t\t\tvar sessionId = \'unknown\';',
'\t\t\t\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.__sessionId != \'undefined\') sessionId = {UXPRERENDEREDALIAS}_DlgObj.__sessionId;',
'\t\t\t\t\tvar FToptions = {',
'\t\t\t\t\t\theaders: {\'X-A5WSessionId\':sessionId }',
'\t\t\t\t\t}',
'\t\t\t\t\tft.download(url2, fnLocal,',
'\t\t\t\t\t\t\tfunction(entry) {',
'\t\t\t\t\t\t\t\tarr[i].success = true;',
'\t\t\t\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\t\t\t\tarr[i].downloaded = true;',
'\t\t\t\t\t\t\t\t//fileAllDone();',
'\t\t\t\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t_countDone++;',
'\t\t\t\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\t\t\t\tshowProgress(100,arr,1,-1,-1, options.onProgressEvent,arr.length); //sr55',
'\t\t\t\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\t\t\t\tif(options.showProgress) {',
'\t\t\t\t\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase()',
'\t\t\t\t\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\t\t\t\t\tif($(idProgress)) $(idProgress).style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tfunction(err) {',
'\t\t\t\t\t\t\t\tarr[i].success = false;',
'\t\t\t\t\t\t\t\tarr[i].errorText = JSON.stringify(err);',
'\t\t\t\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\t\t\t\tif(A5.log) A5.log(\'Error in .download() function: \' + arr[i].errorText);',
'\t\t\t\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\t\t\t\tif(options.showProgress) {',
'\t\t\t\t\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase()',
'\t\t\t\t\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\t\t\t\t\tif($(idProgress)) $(idProgress).style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tflagTrustAllHosts, FToptions',
'\t\t\t\t\t);',
'\t\t\t\t\t//end fetch file  ---------------------------------------',
'\t\t\t\t\t//true/false -- trustAllHosts parameter',
'\t\t\t\t}',
'\t\t\t\twindow.resolveLocalFileSystemURL(fnLocal, fileFound, fileNotFound);',
'\t\t\t}',
'\t\t\tif(A5.log) A5.log(\'Call phoneGapFileDownload_low\');',
'\t\t\tif(A5.log) A5.log(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tphoneGapFileDownload_low(arr,i,options)',
'\t\t\t}',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\tA5.ts = function() {',
'\t\tvar d = new Date()',
'\t\treturn d.getTime().toString(36);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetFileSystemURIForLegacyPersistentStorage = function(ok,fail) {',
'\tvar _ok = ok;',
'\tvar onFSSuccess = function(fs) {',
'\t\tvar uri = fs.root.filesystem.root.nativeURL;',
'\t\t_ok(uri);',
'\t}',
'\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, fail );',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded = function(flagShowAlert) {',
'\tvar flag = true;',
'\tif(typeof window.requestFileSystem == \'undefined\') flag =  false;',
'\tif(typeof window.resolveLocalFileSystemURL == \'undefined\') flag =  false;',
'\tif(typeof LocalFileSystem == \'undefined\') flag =  false;',
'\tif(typeof flagShowAlert != \'undefined\' && flagShowAlert && !flag) {',
'\t\talert(\'PhoneGap File plugin is not loaded\');',
'\t}',
'\treturn flag;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.base64DataToBlob = function(dataURI) {',
'\t//data:image/jpeg;base64,/',
'\t// convert base64/URLEncoded data component to raw binary data held in a string',
'    var byteString;',
'    if (dataURI.split(\',\')[0].indexOf(\'base64\') >= 0)',
'        byteString = atob(dataURI.split(\',\')[1]);',
'    else',
'        byteString = unescape(dataURI.split(\',\')[1]);',
'        if(typeof byteString == \'undefined\') byteString = dataURI;',
'    // separate out the mime component',
'    var mimeString = dataURI.split(\',\')[0].split(\':\')[1].split(\';\')[0];',
'    // write the bytes of the string to a typed array',
'    var ia = new Uint8Array(byteString.length);',
'    for (var i = 0; i < byteString.length; i++) {',
'        ia[i] = byteString.charCodeAt(i);',
'    }',
'    return new Blob([ia], {type:mimeString});',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteDownloadDatabase = function(SQLiteDBURL,localDBName,onComplete,onError,optionsIn) {',
'\tif(SQLiteDBURL.indexOf(\'http://\') == 0 || SQLiteDBURL.indexOf(\'https://\') == 0) {',
'\t\t//don\'t need to add the baseURL',
'\t} else {',
'\t\tvar url = {UXPRERENDEREDALIAS}_DlgObj.ajaxURL;',
'\t\turl = url.split(\'?\')[0];',
'\t\turl = url.split(\'/\');',
'\t\turl.pop();',
'\t\turl = url.join(\'/\') + \'/\';',
'\t\tSQLiteDBURL =  url + SQLiteDBURL;',
'\t}',
'\tif(typeof onError != \'function\') {',
'\t\tonError = function(error) {',
'\t\t\talert(\'Database Download Failed. File transfer error: \'+error);',
'\t\t}',
'\t}',
'\tif(typeof _phoneGapSettings == \'undefined\') {',
'\t\talert(\'PhoneGap not loaded\');',
'\t\treturn false;',
'\t}',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\tflagSQL = true;',
'\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\tif(!flagSQL) {',
'\t\talert(\'SQLitePluginExt not loaded\');',
'\t\treturn false;',
'\t}',
'\t////////////////////',
'\tif(typeof optionsIn == \'undefined\') {',
'\t\tvar ops = {',
'\t\t\tshowProgress : false,',
'\t\t\tforceDownloadIfFileExists : true',
'\t\t\t}',
'\t} else {',
'\t\tvar ops = optionsIn',
'\t}',
'\tvar arr = [];',
'\tarr.push({filename: SQLiteDBURL});',
'\tvar options = {};',
'\toptions.targetFolder = \'<SQLite>|\' + localDBName;',
'\toptions.onComplete = function() {',
'\t\tonComplete.call();',
'\t}',
'\toptions.onError = function() { onError.call() };',
'\toptions.showProgress = ops.showProgress;',
'\toptions.forceDownloadIfFileExists = ops.forceDownloadIfFileExists;',
'\tif(options.showProgress) {',
'\t\toptions.progress = ops.progress;',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'\t///////////////////////////////////',
'\t/*',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\t//alert(thisPackageName)',
'\tvar localDbFileUrl = \t{',
'\t\t\t\t\t\t\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\t\tios: \'cdvfile://localhost/persistent/\' + localDBName',
'\t\t\t\t\t\t\t};',
'\tif(typeof device == \'undefined\') {',
'\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t}',
'\tvar thisDevice = device.platform;',
'\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\tvar fileTransfer = new FileTransfer();',
'\tvar uri = encodeURI(SQLiteDBURL);',
'\tvar options = {};',
'\tfileTransfer.download(uri,fileUrl,onComplete,onError,false,options);',
'\t*/',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQLPromise = function(dbName,sql,argumentsIn) {',
'\tvar f = function(resolve,reject) {',
'\t\tvar obj = {};',
'\t\tvar _ok = function(tx,result,resultArray) {',
'\t\t\tobj.result = result;',
'\t\t\tobj.resultArray = resultArray;',
'\t\t\tobj.tx = tx',
'\t\t\t//resolve(obj);',
'\t\t}',
'\t\tvar _fail = function(e) { };',
'\t\tvar _txOk = function() {',
'\t\t\tresolve(obj)',
'\t\t}',
'\t\tvar _txFail = function(e) {',
'\t\t\treject(e);',
'\t\t}',
'\t\tsetTimeout(function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,argumentsIn,_ok,_fail,_txOk,_txFail);',
'\t\t},50);',
'\t}',
'\treturn new Promise(f)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL = function(dbName,sql,argumentsIn,onSuccess,onError, onTransactionSuccess, onTransactionError, flagCloseDB,transObj) {',
'\tif(typeof transObj == \'undefined\') {',
'\t\ttransObj = {};',
'\t}',
'\tvar flagSQLisArray = false;',
'\tif(sql.constructor == Array) flagSQLisArray = true;',
'\tif(typeof flagCloseDB == \'undefined\') flagCloseDB = true;',
'\tvar flagCustomOnError = false;',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\t\tflagSQL = true;',
'\t\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\t\tif(!flagSQL) {',
'\t\t\talert(\'SQLitePluginExt not loaded\');',
'\t\t\treturn false;',
'\t}',
'\tif(typeof onSuccess == \'undefined\') onSuccess = false;',
'\tif(typeof onError == \'undefined\') onError = false;',
'\tif(typeof argumentsIn == \'undefined\' || argumentsIn.constructor != Array) argumentsIn = [];',
'\tif(onSuccess.constructor != Array)  {',
'\t\tif(typeof onSuccess != \'function\') {',
'\t\t\tonSuccess = function(tx,result) {',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(onError.constructor != Array)  {',
'\t\tif(typeof onError != \'function\') {',
'\t\t\t\tonError = function(e) {',
'\t\t\t\t}',
'\t\t}',
'\t}',
'\tif(typeof device == \'undefined\') {',
'\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t}',
'\tvar flagArrayOfObjects = false;',
'\tif(sql.constructor == Array) {',
'\t\tif(sql[0].constructor == Object) {',
'\t\t\tflagArrayOfObjects = true;',
'\t\t}',
'\t}',
'\tif(flagArrayOfObjects == false && flagSQLisArray) {',
'\t\t//convert to array of objects',
' \t\tvar obj2 = [];',
' \t\tfor(var i = 0; i <sql.length; i++) {',
' \t\t\tobj2.push({\'sql\': sql[i], \'arguments\': argumentsIn[i], \'onSuccess\': onSuccess[i], \'onError\':onError[i]});',
'\t\t}',
' \t\targumentsIn = false;',
'\t\t onSuccess = false;',
'\t\t onError = false;',
'\t\t sql = obj2',
'\t\tflagArrayOfObjects = true;',
'\t}',
'\tif(flagArrayOfObjects) {',
'\t\tvar a = sql;',
'\t\tdelete sql;',
'\t\tdelete sqlObject;',
'\t\tsql = [];',
'\t\tsqlObject = [];',
'\t\targumentsIn = [];',
'\t\tonSuccess = [];',
'\t\tonError = [];',
'\t\tfor(var i = 0; i < a.length; i++) {',
'\t\t\tsql[i] = a[i].sql;',
'\t\t\tsqlObject[i] = a[i];',
'\t\t\tif(typeof a[i].arguments != \'undefined\') {',
'\t\t\t\targumentsIn[i] = a[i].arguments;',
'\t\t\t} else {',
'\t\t\t\targumentsIn[i] = [];',
'\t\t\t}',
'\t\t\tif(typeof a[i].onSuccess != \'undefined\') {',
'\t\t\t\tonSuccess[i] = a[i].onSuccess;',
'\t\t\t} else {',
'\t\t\t\tonSuccess[i] = function() { };',
'\t\t\t}',
'\t\t\tif(typeof a[i].onError != \'undefined\') {',
'\t\t\t\tonError[i] = a[i].onError;',
'\t\t\t} else {',
'\t\t\t\tonError[i] = function() { };',
'\t\t\t}',
'\t\t}',
'\t}',
'\t/*',
'\tvar thisDevice = device.platform;',
'\t//var dbFilename = thisDevice == \'Android\' ? dbName:\'files/\' + dbName;',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\tvar localDbFileUrl = \t{',
'\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + dbName,',
'\t\tios: \'cdvfile://localhost/persistent/\' + dbName',
'\t\t//cdvfile://localhost/persistent/sqlite/\' + localDBName',
'\t};',
'\tvar dbFilename = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\tconsole.log(\'database location: \' + dbFilename);',
'\tdelete db;',
'\tif(typeof window.sqlitePlugin == \'undefined\') {',
'\t\talert(\'Error: PhoneGap SQLite plugin not loaded.\');',
'\t}',
'\tvar db = window.sqlitePlugin.openDatabase({name:dbFilename,location:2});',
'\t*/',
'\t///////////////// new code starts here/////////////',
'\t//start here........',
'\tvar thisDevice = device.platform;',
'\tvar dbFilename = thisDevice == \'Android\' ? dbName:\'NoCloud/\' + dbName;   //NoCloud -- no exposed to iTunes and not backed up to iCloud',
'\tconsole.log(\'.SQLiteExecuteSQL: database location = \' + dbFilename);',
'\tif(typeof window.sqlitePlugin == \'undefined\') {',
'\t\talert(\'Error: PhoneGap SQLite plugin not loaded.\');',
'\t}',
'\tvar location = \'download\';',
'\tif( dbName.indexOf(\'root:\') == 0) {',
'\t\tlocation = \'root\';',
'\t\tdbName = dbName.split(\'root:\')[1];',
'\t}',
'\t//this is for a db that is downloaded from the server',
'\tif(location == \'download\') {',
'\t\tvar db = window.sqlitePlugin.openDatabase({name:dbFilename,location:1});',
'\t} else {',
'\t\t//if the db is in the webroot (pre-populated), then use this code',
'\t\tvar db = window.sqlitePlugin.openDatabase({name: dbName , location: 2, createFromLocation: 1});',
'\t}',
'\t///// end here.....',
'\t///////////////////new code ends here ////////////////',
'\tdb.transaction(',
'\t\tfunction(tx) {',
'\t\t\tif(flagSQLisArray) {',
'\t\t\t}',
'\t\t\tvar flagArrayOfArrays = false;',
'\t\t\ttry{if(argumentsIn[0].constructor == Array) flagArrayOfArrays = true;} catch(e) {}',
'\t\t\tif(sql.constructor == Array || flagArrayOfArrays) {',
'\t\t\t\tif(sql.constructor == Array) {',
'\t\t\t\t\tvar sql_length = sql.length;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar sql_length = argumentsIn.length;',
'\t\t\t\t}',
'\t\t\t\tvar i = 0;',
'\t\t\t\tfunction _lowSQL(transObj) {',
'\t\t\t\t\tif(sql.constructor == Array) {',
'\t\t\t\t\t\tvar sql_i = sql[i];',
'\t\t\t\t\t\tvar sqlObject_i = sqlObject[i];',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar sql_i = sql;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar args_i = argumentsIn[i];',
'\t\t\t\t\tif(typeof args_i != \'undefined\') {',
'\t\t\t\t\t\tfor(var j = 0; j < args_i.length; j++) {',
'\t\t\t\t\t\t\tif(typeof args_i[j] == \'function\') {',
'\t\t\t\t\t\t\t\tvar result = args_i[j].call(this,transObj);',
'\t\t\t\t\t\t\t\targs_i[j] = result;',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar success_i = function(tx2,result) {',
'\t\t\t\t\t\tvar resultArray = {UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray(result);',
'\t\t\t\t\t\tif(onSuccess.constructor == Array) {',
'\t\t\t\t\t\t\tonSuccess[i].call(this,tx2,result,resultArray,transObj);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tonSuccess.call(this,tx2,result,resultArray,transObj);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\ti++;',
'\t\t\t\t\t\tif(i < sql_length) {',
'\t\t\t\t\t\t\ttransObj.i = i;',
'\t\t\t\t\t\t\t_lowSQL(transObj);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar error_i = function(e) {',
'\t\t\t\t\t\tif(onError.constructor == Array) {',
'\t\t\t\t\t\t\tonError[i].call(this,e);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tonError.call(this,e);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\ttx.sql = sql_i;',
'\t\t\t\t\ttx.arguments = args_i;',
'\t\t\t\t\ttx.sqlObject = sqlObject_i;',
'\t\t\t\t\ttx.executeSql(sql_i,args_i,success_i,error_i);',
'\t\t\t\t}',
'\t\t\t\t_lowSQL(transObj);',
'\t\t\t} else {',
'\t\t\t\t//single sql statement',
'\t\t\t\ttx.executeSql(sql,argumentsIn,function(tx,result) {',
'\t\t\t\t\tvar resultArray = {UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray(result);',
'\t\t\t\t\tonSuccess.call(this,tx,result,resultArray);',
'\t\t\t\t}, function(e) {onError.call(this,e); });',
'\t\t\t}',
'\t\t},',
'\t\tfunction(e) { /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}; if(flagCloseDB) db.close(); },',
'\t\tfunction() { /*transaction success*/ if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);} if(flagCloseDB) db.close();  }',
'\t\t//function(e) {alert(\'close the db1\'); db.close(); /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}  },',
'\t\t//function() { alert(\'close the db2\'); db.close(function() { alert(\'done closing\')} ); /*transaction success*/ if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);}   }',
'\t\t//function(e) { db.close(); /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}  },',
'\t\t//function() { db.close(function() { if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);}; alert(\'done closing\')} ); /*transaction success*/   }',
'\t);',
'}',
'////////////////////////sqlite incremental refresh',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteApplyIncrementalUpdates = function(cbId,_onErrorFunction) {',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshData;',
'\tvar sqlObj = {UXPRERENDEREDALIAS}_DlgObj.__sqliteIncrementalUpdate_computeSQL(obj);',
'\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToUpdate = sqlObj.length;',
'\tif(sqlObj.length > 0) {',
'\t\tvar _dbName = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshDBName;',
'\t\tvar _sql = sqlObj;',
'\t\tvar _args = false;',
'\t\tvar _success = false;',
'\t\tvar _error = false;',
'\t\tvar _onTxSuccess = function() {',
'\t\t\tif(transObj.insert.length == 0) {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata(cbId,true)',
'\t\t\t} else {',
'\t\t\t\t//run the inserts',
'\t\t\t\tvar sql2 = [];',
'\t\t\t\tvar sqlObj = transObj.insert;',
'\t\t\t\tfor(var i = 0; i < sqlObj.length; i++) {',
'\t\t\t\t\tsql2.push({sql: sqlObj[i].sql2, arguments: sqlObj[i].arguments2});',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToInsert = sql2.length',
'\t\t\t\t//get the sql to update the __metaData table, but don\'t run it.',
'\t\t\t\tvar metaDataSQL = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata(cbId,false);',
'\t\t\t\t//add the metadata sql to the sql2 object',
'\t\t\t\tfor(var i = 0; i < metaDataSQL.length; i++) {',
'\t\t\t\t\tsql2.push(metaDataSQL[i])',
'\t\t\t\t}',
'\t\t\t\t//var msg6 = JSON.stringify(sql2,\'\',\'\\t\')',
'\t\t\t\t//$(\'pre1\').innerHTML = \'combined insert and meta data sql: \' + msg6;',
'\t\t\t\t//make a closure that captures the cbId',
'\t\t\t\tvar _generate_txOK = function(cbId) {',
'\t\t\t\t\tvar _txOK = function() {',
'\t\t\t\t\t\tvar cbid = cbId;',
'\t\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbid);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _txOK',
'\t\t\t\t}',
'\t\t\t\tvar _txOK = _generate_txOK(cbId)',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefresh_ExecuteSQLCommands(_dbName,sql2,_txOK)',
'\t\t\t}',
'\t\t};',
'\t\t_error = _onErrorFunction',
'\t\tvar _onTxError = function() {',
'\t\t\t//alert(\'tx error\');',
'\t\t\t//alert(\'Failed to update SQLite database2\')',
'\t\t\t_onErrorFunction.call()',
'\t\t};',
'\t\t/*',
'\t\tvar _onTxError = function() {',
'\t\t\talert(\'Failed to update SQLite database\')',
'\t\t};',
'\t\t*/',
'\t\tvar transObj = {};',
'\t\ttransObj.insert = [];',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(_dbName,_sql,_args,_success,_error,_onTxSuccess,_onTxError,false,transObj);',
'\t} else {',
'\t\t//there was no work to do',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToUpdate = 0;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbId);',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.__sqliteIncrementalUpdate_computeSQL = function(d) {',
'\tvar obj2 = [];',
'\tfor (var i = 0; i < d.length; i++) {',
'\t\tvar rows = d[i].data.length;',
'\t\tif(rows > 0) {',
'\t\t\tvar rows = d[i].data.length;',
'\t\t\tif(rows > 0) {',
'\t\t\t    for(var j = 0; j < rows; j++) {',
'\t\t\t        var fields = [];',
'\t\t\t        var fieldsInsert = [];',
'\t\t\t        var fieldsInsertNotNull = [];',
'\t\t\t        var argsInsert = [];',
'\t\t\t        var args = [];',
'\t\t\t        var argsInsert = [];',
'\t\t\t        var argsInsertNotNull = [];',
'\t\t\t        var argsNotNull = [];',
'\t\t\t        var _d = d[i].data[j];',
'\t\t\t        for(var n in _d) {',
'\t\t\t            fields.push(n  + \' = ?\');',
'\t\t\t            fieldsInsert.push(n );',
'\t\t\t            argsInsert.push(\'?\');',
'\t\t\t            args.push(_d[n]);',
'\t\t\t            if(_d[n] != null) {',
'\t\t\t            \tfieldsInsertNotNull.push(n);',
'\t\t\t            \targsNotNull.push(_d[n]);',
'\t\t\t            \targsInsertNotNull.push(\'?\');',
'\t\t\t            }',
'\t\t\t        }',
'\t\t\t        var fieldList = fields.join(\',\')',
'\t\t\t        var pk = d[i].primaryKey.split(\',\');',
'\t\t\t        for(var k = 0; k < pk.length; k++) {',
'\t\t\t            args.push(_d[pk[k]]);',
'\t\t\t            pk[k] = pk[k] + \' = ?\';',
'\t\t\t        }',
'\t\t\t        var pkwhere = pk.join(\' and \')',
'\t\t\t        var sql = \'UPDATE \' +  d[i].SQLiteTableName + \' SET \' + fieldList + \' WHERE \' + pkwhere;',
'\t\t\t        var sqlInsert = \'INSERT INTO \'  + d[i].SQLiteTableName + \' (\' + fieldsInsert.join(\',\') + \' ) VALUES (\' + argsInsert.join(\',\') + \')\';',
'\t\t\t        var sqlInsertNotNull = \'INSERT INTO \'  + d[i].SQLiteTableName + \' (\' + fieldsInsertNotNull.join(\',\') + \' ) VALUES (\' + argsInsertNotNull.join(\',\') + \')\';',
'//alert(\'sqlInsertNotNull:\' + sqlInsertNotNull);',
'\t\t\t        obj2.push(',
'\t\t\t            {',
'\t\t\t                sql: sql,',
'\t\t\t                sqlInsert: sqlInsert,',
'\t\t\t                sqlInsertNotNull: sqlInsertNotNull,',
'\t\t\t                arguments: args,',
'\t\t\t                argumentsNotNull: argsNotNull,',
'\t\t\t                onSuccess: function(tx,result,resultArray, transObj) {',
'\t\t\t                    if(result.rowsAffected == 0) {',
'\t\t\t                    \t//alert(\'push on tx\');',
'\t\t\t                    \t//transObj.insert.push({sql2:  tx.sqlObject[\'sqlInsert\'], arguments2: tx.arguments})',
'\t\t\t                    \t//transObj.insert.push({sql2:  tx.sqlObject[\'sqlInsertNotNull\'], arguments2: tx.argsNotNull})',
'\t\t\t                    \ttransObj.insert.push({sql2:  tx.sqlObject[\'sqlInsertNotNull\'], arguments2: tx.sqlObject[\'argumentsNotNull\']})',
'\t\t\t                    \t//alert(\'push done\');',
'\t\t\t                    }',
'\t\t\t                },',
'\t\t\t                onError: function(e) {',
'\t\t\t                \t//don\'t emit this error as the _sqliteApplyIncrementalUpdates() function will emit the user defined error',
'\t\t\t                    //alert(\'error22222: \' );',
'\t\t\t                }',
'\t\t\t            }',
'\t\t\t        )',
'\t\t\t    }',
'\t\t\t}',
'\t\t}',
'\t}',
'\treturn obj2;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata = function(cbid, flagExecute) {',
'\tvar md = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshMetaData;',
'\tvar mdstring = JSON.stringify(md);',
'\tvar _dbName = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshDBName;',
'\tvar _obj = [];',
'\t_obj.push( { sql: \'DELETE FROM __metaData\'}  );',
'\t_obj.push( { sql: \'insert into __metaData (metadata) VALUES (?)\', arguments: [mdstring]}  );',
'\tvar _sql = _obj;',
'\tvar _args = false;',
'\tvar _success = false;',
'\tvar _error = false;',
'\tvar _onTxSuccess = function() {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbid);',
'\t};',
'\tvar _onTxError = function() {alert(\'Failed to update __metaDataTable\')};',
'\tif(flagExecute) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(_dbName,_sql,_args,_success,_error,_onTxSuccess,_onTxError);',
'\t} else {',
'\t\treturn _sql;',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefresh_ExecuteSQLCommands = function(dbName,sql,_txOK, _txFailed, obj) {',
'\t//alert(\'execute sql commands\');',
'\tif(typeof _txOK == \'function\') { _onTxSuccess = _txOK;} else { \t_onTxSuccess = function() { alert(\'txok\'); }};',
'\tif(typeof _txFailed == \'function\') {  _onTxError = _txFailed;} else { _onTxError = function() {',
'\t\talert(\'txfailed\');',
'\t\t//alert(\'sql to execute: \' + JSON.stringify(sql));',
'\t}};',
'\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,false,false,false,_onTxSuccess,_onTxError);',
'}',
'//////////////////////end sqlite incrmental refresh',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray = function(result) {',
'\tvar array = [];',
'\tif (result !=null && result.rows != null){',
'\t\tfor (var i = 0; i < result.rows.length; i++) {',
'\t\t\tarray.push(result.rows.item(i));',
'\t\t}',
'\t}',
'\treturn array;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteDeleteDatabase = function(dbName,successCB,errorCB,location) {',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\t\tflagSQL = true;',
'\t\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\t\tif(!flagSQL) {',
'\t\t\talert(\'SQLitePluginExt not loaded\');',
'\t\t\treturn false;',
'\t}',
'\t/*',
'\tif(typeof location == \'undefined\') location = 2;',
'\t*/',
'\t///// new code /////',
'\tif(typeof location == \'undefined\') location = 1;',
'\t///// end new code /////',
'\twindow.sqlitePlugin.deleteDatabase({name: dbName, location: location}, successCB, errorCB);',
'}',
'////////////////////////////////////////',
'{UXPRERENDEREDALIAS}_DlgObj.submitListDataAndMediaFiles = function(listName,xbCallbackFunction,ajaxObject,mediaFileUploadObject) {',
'\t//first, upload media files, then upload dirty records in a list and then call xbCallbackFunction on the server side. Uploaded data will be in e._listData in the Xbasic function',
'\t/*',
'\tExample syntax:',
'\tvar ajaxObject = {',
'\t\terrorFunction: function() { alert(\'failed ajax\'); },',
'\t\tonComplete: function() { alert(\'ajax done\');},',
'\t\tdeviceOfflineFunction: function() { alert(\'offline \');  }',
'\t}',
'\tvar objUpload = {',
'\t\ttarget: \'alphaanywhere\',',
'\t\tshowProgress: true,',
'\t\tonComplete: function(array) {},',
'\t\tonMediaUploadErrors: function(array) { alert(\'there were media upload errors\');},',
'\t\txbasicAfterFileUploaded: \'xbAfterUpload\',',
'\t\tprogress: {',
'\t\t\tcolor: \'#9fa1e8\',',
'\t\t\twidth: \'300px\',',
'\t\t\tindividualProgress: false,',
'\t\t\tshowTotalProgress: true,',
'\t\t\tallowCancel: false,',
'\t\t\tprogressElement: \'{UXPRERENDEREDALIAS}.V.R1.PLACEHOLDER_2\'',
'\t\t}',
'\t}',
'\t//to upload to s3',
'\ttarget: \'s3\',',
'\t\ts3: {',
'\t\t\tconnectionString: \'alphamediacapture\',',
'\t\t\tprotectedRead: false,',
'\t\t\ttemplate: \'https://alphamediacapture.s3.amazonaws.com/__name__\'',
'\t},',
'\t///////',
'\t{UXPRERENDEREDALIAS}_DlgObj.submitListDataAndMediaFiles(\'list1\',xbName,ajaxObject,objUpload);',
'\t*/',
'\tvar lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(listName);',
'\tif(!lObj) return false;',
'\tvar objAjax = {};',
'\tif(typeof arguments[2] == \'object\') objAjax = arguments[2];',
'\tvar objUpload = {};',
'\tif(typeof arguments[3] == \'object\') objUpload = arguments[3]; //this is the object that defines the upload target (s3/alphaanywhere), showProgress, etc',
'\tvar _userOnComplete = objUpload.onComplete;',
'\tobjUpload.onComplete = function(array) {',
'\t\t_userOnComplete.call(this,array)',
'\t\tpushRemoteMediaNamesToArray(array,_data);',
'\t}',
'\tvar xbasicFunction = xbCallbackFunction;',
'\t//define local functions',
'\tvar _ajaxUpload = function(data,xbasicFunction,objAjax) {',
'\t\tvar listData = JSON.stringify(data,\'\',\'\\t\');',
'\t\tlistData = A5.ajax.buildURLParam(\'_listData\',listData);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',xbasicFunction,\'\',listData, objAjax);',
'\t}',
'\tvar pushRemoteMediaNamesToArray = function(mediaFiles,_data) {',
'\t\tvar _data2 = [];',
'\t\t$u.o.assign(_data2,_data);',
'\t\t//media files have been uploaded and the mediaFiles[] array has these properties of interest',
'\t\t//listFieldName -- name of the field in the data array that had the media field',
'\t\t//route -- an array that looks like [{table: \'_top_\', row: 1}]',
'\t\t//remoteName -- the name of the alpha server or s3',
'\t\t//succeeded',
'\t\tvar r = \'\';',
'\t\tvar table = \'\';',
'\t\tvar _di = \'\';',
'\t\tvar _diTop = \'\';',
'\t\tfor(var i = 0; i < mediaFiles.length; i++) {',
'\t\t\tmediaFiles[i].routeObj = JSON.parse(mediaFiles[i].route);',
'\t\t\tr = mediaFiles[i].routeObj[0].row',
'\t\t\tfor(var j = 0; j < mediaFiles[i].routeObj.length; j ++) {',
'\t\t\t\ttable = mediaFiles[i].routeObj[j].table;',
'\t\t\t\tr = mediaFiles[i].routeObj[j].row',
'\t\t\t\tif(table == \'_top_\') {',
'\t\t\t\t\t_di = _data2[r];',
'\t\t\t\t\t_diTop = _di;',
'\t\t\t\t} else {',
'\t\t\t\t\t_di = _di[table][r];',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(typeof _di != \'undefined\') {',
'\t\t\t\t//need to add a check to see if the success flag is true',
'\t\t\t\tif(mediaFiles[i].succeeded) {',
'\t\t\t\t\t _di[mediaFiles[i].listFieldName] = mediaFiles[i].remoteName;',
'\t\t\t\t} else {',
'\t\t\t\t\t_diTop.__flagHasMediaFileUploadError = true;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\t//harvest rows that are dirty and also do not have media upload errors - these rows will be pushed to the server',
'\t\tvar _data3 = [];',
'\t\tvar _mErr = [];',
'\t\tvar flagPush = false;',
'\t\tvar flagHasMediaUploadError = false;',
'\t\tfor(var i = 0; i < _data2.length; i++) {',
'\t\t\tflagPush = true;',
'\t\t\tif(typeof _data2[i].__flagHasMediaFileUploadError != \'undefined\' && _data2[i].__flagHasMediaFileUploadError) {',
'\t\t\t\tflagPush = false;',
'\t\t\t\tflagHasMediaUploadError = true;',
'\t\t\t\t_mErr.push(_data2[i]);',
'\t\t\t}',
'\t\t\tif(flagPush) {',
'\t\t\t\tif(typeof _data2[i]._isDirty == \'undefined\') {',
'\t\t\t\t\tflagPush = false;',
'\t\t\t\t} else if(_data2[i]._isDirty == false) {',
'\t\t\t\t\tflagPush = false;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(flagPush) {',
'\t\t\t\t_data3.push(_data2[i]);',
'\t\t\t}',
'\t\t}',
'\t\tif(flagHasMediaUploadError) {',
'\t\t\tif(typeof objUpload.onMediaUploadErrors == \'function\') {',
'\t\t\t\tobjUpload.onMediaUploadErrors.call(this,_mErr);',
'\t\t\t}',
'\t\t}',
'\t\t_ajaxUpload(_data3,xbasicFunction,objAjax) //do the ajax callback to upload the fixed data array',
'\t}',
'\t//end local functions',
'\tvar _data = lObj.harvestList();',
'\tif(_data.length == 0) {',
'\t\treturn false;',
'\t}',
'\tvar arr = lObj._harvestMediaFields();',
'\tif(arr.length == 0) {',
'\t\t//no media fields -- just make the ajax callback',
'\t\t_ajaxUpload(_data,xbasicFunction,objAjax);',
'\t\treturn true;',
'\t} else {',
'\t\t//upload the media files -- the onComplete event will make the ajax callback',
'\t\t//objUpload._dataToUpload = _data;',
'\t\t_data = lObj._data;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileUpload(arr,objUpload);',
'\t}',
'}',
'// File manipulation',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()',
'//',
'// Returns true if there is a local file system and PhoneGap is running.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable = function() {',
'   if(typeof LocalFileSystem == \'undefined\') {',
'      if(typeof cordova == \'undefined\') {',
'         return false;',
'      }',
'      return false;',
'   }',
'   return true;',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(type)',
'//',
'// type: "temp", "private", "saved", "public"',
'// On iOS, saved and public may be backed up to iCloud',
'//',
'// Returns URL of base for the requested part of the file system.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL = function(type) {',
'   var dir = "";',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) return dir;',
'   if (type.toLowerCase().indexOf(\'explicit:\') == 0) {',
'   \t\tvar dir = type.substring(\'explicit:\'.length)',
'   \t\treturn dir;',
'   }',
'   if (device.platform == \'iOS\') {',
'      switch (type) {',
'         case "temp":',
'            dir = cordova.file.tempDirectory;',
'            break;',
'         case "private":',
'            dir = cordova.file.dataDirectory;',
'            break;',
'         case "saved":',
'            dir = cordova.file.syncedDataDirectory;',
'            break;',
'         case "public":',
'            dir = cordova.file.documentsDirectory;',
'            break;',
'         case "persistent": //original file system actions',
'          \tdir = cordova.file.dataDirectory.replace(\'NoCloud\',\'files\');',
'          \tbreak;',
'      }',
'   }',
'   else {',
'      switch (type) {',
'         case "temp":',
'            dir = cordova.file.externalCacheDirectory || cordova.file.cacheDirectory;',
'            break;',
'         case "private":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "saved":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "public":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "persistent":',
'          \tdir = \'file:///data/user/0/\'+_phoneGapSettings().appId+\'/files/files/\';',
'          \tbreak;',
'      }',
'   }',
'   return dir;',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(filepath, onReadSuccess, onError, startAt, endAt)',
'//',
'// filepath is the local file URL of the desired file.',
'// If startAt and endAt are present, returns just those positions in the file.',
'//',
'// onReadSuccess(result) returns the contents read.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL = function(filepath, onReadSuccess, onError, startAt, endAt) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               var doReadFunction =',
'                  function(file) {',
'                     var reader = new FileReader();',
'                     reader.onloadend =',
'                        function(e) {',
'                           onReadSuccess(this.result);',
'                        };',
'                     if (typeof startAt==\'undefined\' || typeof endAt==\'undefined\') {',
'                        reader.readAsText(file);',
'                     }',
'                     else {',
'                        var blob = file.slice(startAt, endAt);',
'                        reader.readAsText(blob);',
'                     }',
'                  };',
'               fileEntry.file(doReadFunction);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL(filepath, text, onWriteSuccess, onError, append)',
'//',
'// filepath is the local file URL of the desired file. The directory must',
'// exist, but the file need not.',
'// If append is true, appends to current contents.',
'// Truncates (if file existed) to end of what is written.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL = function(filepath, text, onWriteSuccess, onError, append) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               var writerFunction =',
'                  function(fileWriter) {',
'                     fileWriter.onwriteend =',
'                        function(e) {',
'                           onWriteSuccess();',
'                        };',
'                     fileWriter.onerror = onError;',
'                     if (append) {',
'                        fileWriter.seek(fileWriter.length);',
'                     }',
'                     var blob = new Blob([text], {type:\'text/plain\'});',
'                     fileWriter.write(blob);',
'                  };',
'               fileEntry.createWriter(writerFunction, onError);',
'            };',
'         fsEntry.getFile(filename, {create: true}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURLfilepath, onResult, onError)',
'//',
'// filepath is the local file URL of the desired file.',
'// onResult(properties) will be called with false if file does not exist.',
'// If file does exist, properties will be:',
'//',
'//    {',
'//       name:file\'s name,',
'//       lastModifiedDate:lastModifiedDate object,',
'//       size:size in bytes,',
'//       type:MIME type if known(not on iOS now, but yes on Android)',
'//    }',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURL = function(filepath, onResult, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               fileEntry.file(function(fileObj) {',
'                  onResult({name:fileObj.name, lastModifiedDate:fileObj.lastModifiedDate,',
'                     size:fileObj.size, type:fileObj.type});',
'                  },',
'                  onError);',
'            };',
'         var onDidNotGetFile =',
'            function() {',
'               onResult(false);',
'            };',
'         fsEntry.getFile(filename, {create: false}, onGotFile, onDidNotGetFile);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(filepath, onDeleteSuccess, onError)',
'//',
'// filepath is the local file URL of the file to be deleted.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL = function(filepath, onDeleteSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               fileEntry.remove(onDeleteSuccess, onError);',
'            };',
'         fsEntry.getFile(filename, {create: false}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(srcpath, destdirpath, destname, onCopySuccess, onError)',
'//',
'// srcpath is the local file URL of the file to be copied.',
'// destdirpath is the URL of the directory into which to copy the file.',
'// destname is the name to be given to the copied file. If null, the source filename will be used.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL = function(srcpath, destdirpath, destname, onCopySuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = srcpath.lastIndexOf("/");',
'   var dirpath = srcpath.substring(0,pos);',
'   var filename = srcpath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               window.resolveLocalFileSystemURL(destdirpath,',
'                  function(destDirEntry) {',
'                     fileEntry.copyTo(destDirEntry, destname, onCopySuccess, onError);',
'                  },',
'                  onError);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(srcpath, destdirpath, destname, onMoveSuccess, onError)',
'//',
'// srcpath is the local file URL of the file to be moved.',
'// destdirpath is the URL of the directory into which to move the file, replacing any existing file with the name.',
'// destname is the name to be given to the copied file. If null, the source filename will be used.',
'// If moved into the same directory, the file will be renamed.',
'// A move of a directory on top of an existing empty directory replaces that directory.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL = function(srcpath, destdirpath, destname, onMoveSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = srcpath.lastIndexOf("/");',
'   var dirpath = srcpath.substring(0,pos);',
'   var filename = srcpath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               window.resolveLocalFileSystemURL(destdirpath,',
'                  function(destDirEntry) {',
'                     fileEntry.moveTo(destDirEntry, destname, onMoveSuccess, onError);',
'                  },',
'                  onError);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError); //does not work on moving directories',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(dirpath, onRemoveSuccess, onError)',
'//',
'// dirpath is the file URL of the directory to be deleted.',
'// Deletes the specified directory and all of its contents, including other directories and',
'// their contents.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL = function(dirpath, onRemoveSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var onResolvedURL =',
'      function(dirEntry) {',
'         dirEntry.removeRecursively(onRemoveSuccess, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(rootpath, subdirpath, onCompletion, onError)',
'//',
'// rootpath is the file URL of the existing directory that will contain the directories that are needed.',
'// subdirpath is a path of directories to ensure exist below rootpath. They will be created',
'// if they don\'t exist.',
'//',
'// For example, if rootpath is "file://root/public/", subdirpath may be "toplevel/subdir1".',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL = function(rootpath, subdirpath, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var dirs = subdirpath.split(\'/\') || [];',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var ensureDirFunction =',
'            function(dirEntry) { // function to recurse',
'               if (dirs.length>0) {',
'                  if (dirs[0]==\'.\' || dirs[0]==\'\') {',
'                     dirs = dirs.slice(1); // remove null dir',
'                  }',
'               }',
'               if (dirs.length==0) {',
'                  onCompletion();',
'                  return;',
'               }',
'               dirEntry.getDirectory(dirs[0], {create: true},',
'                  function(subdirEntry) {',
'                     dirs = dirs.slice(1); // do next',
'                     ensureDirFunction(subdirEntry);',
'                  },',
'                  onError);',
'               };',
'         ensureDirFunction(fsEntry); // do first',
'      };',
'   window.resolveLocalFileSystemURL(rootpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(rootpath, onCompletion, onError)',
'//',
'// rootpath is the file URL of the directory whose contents will be listed.',
'// onCompletion(filelist) will contain an array of strings representing each file',
'// and directory down the hierarchy. Directories end in "/".',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL = function(rootpath, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var filelist = [];',
'   var pathprefix = "";',
'   var pending = 0;',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var processDirFunction =',
'            function(subdirpath, listingObj) {',
'               var files = listingObj.files;',
'               var i;',
'               var fpath;',
'               var prefix = subdirpath.slice(pathprefix.length);',
'               for (i=0; i<files.length; i++) {',
'                  fpath = prefix+files[i];',
'                  filelist.push(fpath);',
'               }',
'               var dirs = listingObj.dirs;',
'               if (dirs.length==0) {',
'                  if (pending==0) {',
'                     onCompletion(filelist);',
'                  }',
'                  return;',
'               }',
'               for (i=0; i<dirs.length; i++) {',
'                  fpath = dirs[i].fullPath.slice(pathprefix.length);',
'                  filelist.push(fpath);',
'                  pending++;',
'                  dirs[i].filesystem.root.getDirectory(dirs[i].fullPath, {create: false},',
'                     function(dirEntry) {',
'                        listDirFunction(dirEntry);',
'                     },',
'                     function(e){pending--;onError(e);});',
'               }',
'            };',
'         var listDirFunction =',
'            function(dirEntry) { // function to recurse on subdirs',
'               var dirReader = dirEntry.createReader();',
'               var listingObj = {files:[], dirs:[]};',
'               var readDirEntries = function() {',
'                  dirReader.readEntries( // start an async reading of entries',
'                     function(entries) { // more entries read, or done',
'                        if (!entries || entries.length==0) {',
'                           pending--;',
'                           processDirFunction(dirEntry.fullPath, listingObj);',
'                           return;',
'                        }',
'                        var entry;',
'                        for (var i=0; i<entries.length; i++) {',
'                           entry = entries[i];',
'                           if (entry.isFile) {',
'                              listingObj.files.push(entry.name);',
'                           }',
'                           else {',
'                              listingObj.dirs.push(entry);',
'                           }',
'                        }',
'                        readDirEntries(); // recurse to call dirReader.readEntries again',
'                     },',
'                     onError);',
'                  };',
'               readDirEntries(); // do first reading of entries',
'            };',
'         pending++;',
'         pathprefix = fsEntry.fullPath; // get prefix',
'         listDirFunction(fsEntry); // do first list getting',
'      };',
'   window.resolveLocalFileSystemURL(rootpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL(dirpath, matchRegex, onCompletion, onError)',
'//',
'// dirpath is the file URL of the directory whose contents will be listed (only files).',
'// matchRegex, if non-null, will need to match file names found for them to be listed.',
'// onCompletion(filelist) will contain an array of strings representing each file.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL = function(dirpath, matchRegex, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var filelist = [];',
'         var dirReader = fsEntry.createReader();',
'         var readEntriesFunction =',
'            function() { // function to recurse to call repeatedly after each completion until no result',
'               dirReader.readEntries( // start an async reading of entries',
'                  function(entries) { // more entries read, or done',
'                     if (!entries || entries.length==0) {',
'                        onCompletion(filelist);',
'                        return;',
'                     }',
'                     var name;',
'                     for (var i=0; i<entries.length; i++) {',
'                        name = entries[i].name;',
'                        if (!matchRegex || name.match(matchRegex)) {',
'                           filelist.push(name);',
'                        }',
'                     }',
'                     readEntriesFunction(); // recurse to call dirReader.readEntries again',
'                  },',
'                  onError);',
'               };',
'         readEntriesFunction(); // do first reading',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder = function(mode) {',
'\tif(typeof mode == \'undefined\') mode = 0;',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\tvar localDbFileUrl = {',
'\t\tandroidx: \'/data/data/\' + thisPackageName + \'/databases/\',',
'\t\tandroid1x: \'file:///data/data/\' + thisPackageName + \'/databases/\',',
'\t\tandroid2x: \'file:///data/data/\' + thisPackageName,',
'\t\tandroid: cordova.file.applicationStorageDirectory.substr(7)+ \'databases/\',',
'\t\tandroid1: cordova.file.applicationStorageDirectory + \'databases/\',',
'\t\tandroid2: cordova.file.applicationStorageDirectory.substr(0, cordova.file.applicationStorageDirectory.length -1) ,',
'\t\tios: cordova.file.dataDirectory',
'\t};',
'\ttry{',
'\t\tvar thisDevice = device.platform.toLowerCase();',
'\t\tif(mode == 1 && thisDevice == \'android\') thisDevice = \'android1\';',
'\t\tif(mode == 2 && thisDevice == \'android\') thisDevice = \'android2\';',
'\t\tvar _targetDir = localDbFileUrl[thisDevice];',
'\t\treturn _targetDir;',
'\t}catch(e) {',
'\t\talert(\'PhoneGap \\\'device\\\' Plugin not loaded\');',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLite =  function(explicitFileName,filesystemSource,folderSource,zipFileName,dirStructureTarget,ok,fail) {',
'\tif(typeof explicitFileName == \'undefined\' || explicitFileName == \'\') {',
'\t\tvar baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(filesystemSource)',
'\t\tvar fnSource = baseURI + folderSource + \'/\' + zipFileName;',
'\t} else {',
'\t\tvar fnSource = explicitFileName;',
'\t\tvar fn = fnSource',
'\t\tfn = fn.split(\'/\');',
'\t\tzipFileName = fn[fn.length-1];',
'\t}',
'\tvar baseURITarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\tvar dirTarget = baseURITarget ;',
'\tvar targetFolder = fnSource.split(\'/\')',
'\ttargetFolder.pop();',
'\ttargetFolder = targetFolder.join(\'/\') + \'/\';',
'\tvar copyFNSource = fnSource.split(\'.\');',
'\tcopyFNSource.pop();',
'\tcopyFNSource = copyFNSource.join(\'.\') + \'.db\'',
'\t//alert(\'target folder: \' + targetFolder)',
'\tvar cb = function(e) {',
'\t//alert(\'unzip cb \' + e);',
'\t\tif(e == 0) {',
'\t\t//get files in targetFolder (assumme .zip file only has a single sqlite file and that the sqllite file has as .db extension and name of sqlite.zip file is same as sqlite.db file)',
'\t\t\t//alert(\'copy file to target location\'); debugger;',
'\t\t\t///////////',
'\t\t\tvar rootpath = dirTarget;',
'\t\t\tvar _srcPath = copyFNSource',
'\t\t\tvar _destinationName = zipFileName.split(\'.\')',
'\t\t\t_destinationName.pop()',
'\t\t\t_destinationName = dirStructureTarget + \'___\' + _destinationName.join(\'.\') + \'.db\';',
'\t\t\t//ensure that the databases folder exists/////////',
'\t\t\tvar _baseURI = baseURITarget;',
'\t\t\tif(_baseURI.indexOf(\'/databases/\') > -1) {',
'\t\t\t\t_baseURI = _baseURI.substr(0,_baseURI.indexOf(\'/databases/\')+1)',
'\t\t\t}',
'\t\t\t//alert(_baseURI);',
'\t\t\tvar _dirStructure = \'databases\';;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure,function() {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(_srcPath, rootpath, _destinationName, function() { } ,function() { });',
'\t\t\t} ,function() {alert(\'failed to create databases folder\'); } );',
'\t\t\tok.call(this);',
'\t\t}',
'\t\telse fail.call(this);',
'\t}',
'\t//zip.unzip(fnSource, dirTarget, cb );',
'\tzip.unzip(fnSource, targetFolder, cb );',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB = function(explicitFilename,sourceFileSystem,sourceFolder,sourceDBName,targetDBName,targetFolder, onSuccess, onError) {',
'\t\tif(typeof onSuccess == \'undefined\') onSuccess = function() { };',
'\t\tif(typeof onError == \'undefined\') onError = function() { }',
'\t\tvar _copyLow = function() {',
'\t\t\tvar localDBName = targetDBName;',
'\t\t\tif (targetFolder != \'\') {',
'\t\t\t\tlocalDBName = targetFolder + \'___\' + targetDBName;',
'\t\t\t}',
'\t\t\tif(typeof explicitFilename == \'undefined\' || explicitFilename == \'\') {',
'\t\t\t\tvar fnSource = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(sourceFileSystem) + sourceFolder + \'/\' + sourceDBName;',
'\t\t\t} else {',
'\t\t\t\tvar fnSource = explicitFilename;',
'\t\t\t}',
'\t\t\tvar fnTarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) +  localDBName;',
'\t\t\t//alert(\'fnsource: \' + fnSource +\'\\nfntarget: \' + fnTarget);',
'\t\t\t// \'/data/data/\' + thisPackageName + \'/databases/\',',
'\t\t\tvar _onCopySuccess = function() {',
'\t\t\t\t//alert(\'sqlite copy success: \' + 5)',
'\t\t\t\tonSuccess.call(this);',
'\t\t\t\tif(sourceFolder == \'tempFolder/zipfiles\') {',
'\t\t\t\t\t//delete this folder. this is where the sqlitedb zip file was unzipped',
'\t\t\t\t\tvar _onRemoveSuccess = function() { /* alert(\'tempFolder/zipfiles was deleted\'); */};',
'\t\t\t\t\tvar _error = function(e) { /*alert(\'could not delete the tempFolder/zipfiles folder\');*/\t};',
'\t\t\t\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\t\t\t\tvar _dirName = \'tempFolder/zipfiles/\';;',
'\t\t\t\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tvar _onCopyError = function(e) {',
'\t\t\t\talert(\'sqlite copy error:\' + JSON.stringify(e));',
'\t\t\t\tonError.call(this);',
'\t\t\t};',
'\t\t\tvar _onDeleteSuccess = function() {',
'\t\t\t\tvar folderTarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) ;',
'\t\t\t\t//alert(fnSource);',
'\t\t\t\t//alert(folderTarget);',
'\t\t\t\t//alert(\'about to copy: \' + localDBName);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(fnSource,folderTarget, localDBName, _onCopySuccess, _onCopyError);',
'\t\t\t};',
'\t\t\tvar _onDeleteError = _onDeleteSuccess;',
'\t\t\t//alert(\'delete what: \' + fnTarget)',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(fnTarget, _onDeleteSuccess,_onDeleteError);',
'\t\t}',
'\t\tif(targetFolder != \'\') {',
'\t\t\tvar onFolderCreated = function() {   _copyLow();}',
'\t\t\tvar onFolderCreatedFailed = function(e) { alert(\'SQLite folder not created\');  onError.call()}',
'\t\t\tvar _base = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(2); //add file:// and omit trailing \'databases\' folder',
'\t\t\tvar targetx;',
'\t\t\tvar thisPackageName = \'\';',
'\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\tif(thisPackageName.toLowerCase() == \'android\') {',
'\t\t\t\ttargetx = \'databases/\' + targetFolder;',
'\t\t\t\ttargetx = \'databases/\'',
'\t\t\t} else {',
'\t\t\t\ttargetx = targetFolder;',
'\t\t\t\ttargetx = \'/\';',
'\t\t\t}',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_base,targetx, onFolderCreated, onFolderCreatedFailed);',
'\t\t} else {',
'\t\t\t_copyLow()',
'\t\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles =  function(explicitFileName,filesystemSource,folderSource,zipFileName,fileSystemTarget, dirStructureTarget,ok,fail,flagListUnzippedFiles) {',
'\tif(typeof ok == \'undefined\') ok = function() { };',
'\tif(typeof fail == \'undefined\') fail = function() { };',
'\tvar _listFileThatWereUnzipped = function() {',
'\t\t var _onSuccess = function(filelist) {',
'\t\t\tok.call(this,filelist);',
'\t\t\t//remove the tempUnzipFolder, but do not trigger the follow on function to unzip to the tempUnzipFolder',
'\t\t\t_removeTempUnzipFolder(\'\',2);',
'\t\t};',
'\t\tvar _error = function(e) { alert(\'error\');};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = \'tempUnzipFolder/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
'\t}',
'\tvar _removeTempUnzipFolder = function(fnSource,mode) {',
'\t\tif(typeof mode == \'undefined\') mode = 1;',
'\t\tvar _onRemoveSuccess = function() { if(mode == 1) _listUnzippedFiles(fnSource);};',
'\t\tvar _error = function(e) { if(mode == 1) _listUnzippedFiles(fnSource);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = \'tempUnzipFolder/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\tvar _listUnzippedFiles = function(fnSource) {',
'\t\tvar baseURITarget =  {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\')',
'\t\tvar cb = function(e) {',
'\t\t\tif(e == 0) {',
'\t\t\t\t_listFileThatWereUnzipped();',
'\t\t\t} else {',
'\t\t\t\t//could not unzip to the tempUnzipFolder -- should be unlikely',
'\t\t\t\tok.call(this,[]);',
'\t\t\t}',
'\t\t}',
'\t\tzip.unzip(fnSource,baseURITarget + \'tempUnzipFolder\',cb)',
'\t}',
'\tif(typeof explicitFileName == \'undefined\' || explicitFileName == \'\') {',
'\t\tvar baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(filesystemSource)',
'\t\tvar fnSource = baseURI + folderSource + \'/\' + zipFileName;',
'\t} else {',
'\t\tvar fnSource = explicitFileName;',
'\t}',
'\tvar baseURITarget = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemTarget)',
'\tvar dirTarget = baseURITarget + dirStructureTarget',
'\tvar cb = function(e) {',
'\t\tif(e == 0) {',
'\t\t\tif(flagListUnzippedFiles) {',
'\t\t\t\t//this function will call the follow on functions to unzip to the tempUnzipFolder',
'\t\t\t\t_removeTempUnzipFolder(fnSource)',
'\t\t\t} else {',
'\t\t\t\tok.call(this);',
'\t\t\t}',
'\t\t}',
'\t\telse {',
'\t\t\t//alert(\'in unzip: \' + e); sr55',
'\t\t\tfail.call(this);',
'\t\t}',
'\t}',
'\tif(typeof zip == \'undefined\') {',
'\t\talert(\'FATAL ERROR - Cordova Zip plugin not loaded\');',
'\t}',
'\tzip.unzip(fnSource, dirTarget, cb );',
'}',
'/*',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLiteDB = function(explicitFileName,filesystemSource,folderSource,zipName,account,onCopyOK,onCopyError) {',
'\t//unzips a .zip file that contains one (only 1) sqlite.db file and copies file to the sqlite folder',
'\tvar _copyLow = function(sqliteDBSource,account,onCopyOK,onCopyError) {',
'\t\tvar sourceFileSystem = \'temp\';',
'\t\tsourceFolder = \'tempFolder/zipfiles\';',
'\t\tsourceDBName = sqliteDBSource;',
'\t\ttargetDBName = sqliteDBSource;',
'\t\ttargetFolder = account;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB(sourceFileSystem,sourceFolder,sourceDBName,targetDBName,targetFolder, onCopyOK, onCopyError)',
'\t}',
'\tvar flagListUnzippedFiles = true;',
'\tvar okUnzip = function(fileArray) {',
'\t\talert(JSON.stringify(fileArray,\'\',\'\\t\'));',
'\t\tif(fileArray.length > 1) {',
'\t\t\talert(\'zip file caon only contain one SQLite database which must not be in a sub-folder.\');',
'\t\t} else {',
'\t\t\tvar sqliteDBSource = fileArray[0];',
'\t\t\talert(\'dirPath: \' + dirPath);',
'\t\t\t_copyLow(sqliteDBSource,account,onCopyOK,onCopyError)',
'\t\t}',
'\t };',
'\tvar failUnzip = function() { alert(\'fail\');}',
'\tvar dirPath = \'tempFolder/zipfiles\'',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles(explicitFileName,filesystemSource,folderSource,zipName,\'temp\', dirPath,okUnzip,failUnzip,flagListUnzippedFiles)',
'}',
'*/',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles = function(manifest,folder,cbAllDone,optionsIn,fileSystemPart,flagMoveSQLiteFiles,manifestName) {',
'\t////////////////////////////////////////////////////////',
'\tfunction storeManifest(string,name) {',
'\t\t//\'transFormOnDeviceManifest\'',
'\t\tif(manifestName == \'\') {',
'\t\t\tlocalStorage.setItem(\'transFormOnDeviceManifest\',string);',
'\t\t\treturn;',
'\t\t} else {',
'\t\t\tvar manifestObj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\t\t\tmanifestObj[name] = string;',
'\t\t\tlocalStorage.manifests = JSON.stringify(manifestObj);',
'\t\t}',
'\t}',
'\tfunction getManifest(name) {',
'\t\t//\'transFormOnDeviceManifest\'',
'\t\tif(manifestName == \'\') return localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\telse {',
'\t\t\tvar manifestObj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\t\t\tvar m = manifestObj[name];',
'\t\t\treturn m;',
'\t\t\t//return JSON.stringify(manifestObj[name]);',
'\t\t}',
'\t}',
'\tfunction getManifestStorageLocation(manifestName) {',
'\t\t//\'transFormFileSystemPart\'',
'\t\tif(manifestName == \'\'|| true) return localStorage.getItem(\'transFormFileSystemPart\')',
'\t}',
'\tfunction setManifestStorageLocation(string,manifestName) {',
'\t\t//\'transFormFileSystemPart\'',
'\t\tif(manifestName == \'\' || true) localStorage.setItem(\'transFormFileSystemPart\',string);',
'\t}',
'\t//var storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\t//var storedWhere = getManifestStorageLocation(manifestName);',
'\t//localStorage.setItem(\'transFormFileSystemPart\',_string);',
'\t//setManifestStorageLocation(_string,manifestName);',
'\t//localStorage.setItem(\'transFormOnDeviceManifest\',json);',
'\t//storeManifest(json,manifestName)',
'\t//localStorage.transFormOnDeviceManifest = m;',
'\t//storeManifest(m,manifestName);',
'\t//var oldManifest = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t//var oldManifest = getManifest(manifestName);',
'\t//var m = localStorage.transFormOnDeviceManifest;',
'\t//var m = getManifest(manifestName);',
'\t/////////////////////////////////////////////////////////',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar manifestName2 = manifestName',
'\tif(manifestName2 == \'\') manifestName2 = \'___default___\';',
'\tif(typeof obj[manifestName2] ==\'undefined\') obj[manifestName2] = {};',
'\tobj[manifestName2].folder = folder =  folder ;',
'\tobj[manifestName2].fileSystemPart = fileSystemPart',
'\tvar json = JSON.stringify(obj)',
'\tlocalStorage.setItem(\'manifestInfo\',json)',
'if(typeof flagMoveSQLiteFiles == \'undefined\') flagMoveSQLiteFiles = true;',
'\t/*',
'\tusage:',
'\tif \'informationOnly\' is set to true, the cb function is called with arr.mode = \'informationOnly\' and arr.array set to the manifest of files that need to be downloaded',
'\tvar opsIn = {',
'\t\tinformationOnly: false,',
'\t\tshowProgress: true,',
'\t\tprogress: {',
'\t\t\txcolor: \'#9fa1e8\',',
'\t\t\tcolor: \'green\',',
'\t\t\twidth: \'600px\',',
'\t\t\tprogressElement: \'{UXPRERENDEREDALIAS}.V.R1.PLACEHOLDER_1\'',
'\t\t}',
'\t}',
'\tvar cb = function(arr) {',
'\t\tif(typeof arr.mode != \'undefined\') {',
'\t\t\t\tif(arr.mode == \'informationOnly\') {',
'\t\t\t\t\talert(\'Number of files to download: \' + arr.array.length);',
'\t\t\t\t\treturn;',
'\t\t\t\t}',
'\t\t}',
'\t\talert(\'post process is now COMPLETE: items - \' + arr.array.length);',
'\t};',
'\t//url can also be an http::// or https:// address or an array of objects',
'\t\tvar url = \'\';',
'\t\turl = [',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/SQLiteNorthwind.zip\',',
'\t\t\t\t\t\ttype: \'sqlite\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 70900',
'\t\t\t\t\t},',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/sqlite3.db\',',
'\t\t\t\t\t\ttype: \'sqlite\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 7000',
'\t\t\t\t\t},',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/allimages.zip\',',
'\t\t\t\t\t\ttype: \'folder\',',
'\t\t\t\t\t\tzipped: true,',
'\t\t\t\t\t\ttargetFolder: \'transFormShortFileList\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 56900',
'\t\t\t\t\t}',
'\t\t]',
'\tvar url = \'https://alphamediacapture.s3.amazonaws.com/transform/transformManifest.json\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles(url,\'account1\',cb,opsIn)',
'\t*/',
'\tvar computeNewManifest = function(oldManifestJSON,manifest, accountId) {',
'\t\ttry{',
'\t\t\tvar om = JSON.parse(oldManifestJSON);',
'\t\t\tom = om[accountId];',
'\t\t\tif(typeof om == \'undefined\' || om == null) {',
'\t\t\t\treturn manifest;',
'\t\t\t}',
'\t\t\tvar arr = manifest;',
'\t\t\tvar totalSize = 0;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tarr[i].mustFetch = true;',
'\t\t\t\tvar url = arr[i].url;',
'\t\t\t\tvar type = arr[i].type;',
'\t\t\t\tfor(var j = 0; j < om.length; j++) {',
'\t\t\t\t\tif(om[j].url == url && om[j].type == type) {',
'\t\t\t\t\t\tvar oldVersion = om[j].version;',
'\t\t\t\t\t\tif(typeof oldVersion == \'undefined\') oldVersion = -1;',
'\t\t\t\t\t\tif(typeof oldVersion == \'number\') {',
'\t\t\t\t\t\t\tvar newVersion = arr[i].version;',
'\t\t\t\t\t\t\tif(typeof newVersion == \'undefined\') newVersion = -1;',
'\t\t\t\t\t\t\tif(typeof newVersion == \'number\') {',
'\t\t\t\t\t\t\t\tif(newVersion <= oldVersion) {',
'\t\t\t\t\t\t\t\t\tarr[i].mustFetch = false;',
'\t\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\t\t//alert(\'must fetch: \' + i);',
'\t\t\t\t\t\t\t\t\tif(typeof arr[i].size != \'undefined\') totalSize = totalSize + arr[i].size;',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar count = 0;',
'\t\t\tvar arr2 = [];',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(arr[i].mustFetch) {',
'\t\t\t\t\tcount++;',
'\t\t\t\t\tarr2.push(arr[i])',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//if optionsIn says information only then we can do the callback function here, passing in the arr2 array',
'\t\t\t//alert(\'count must fetch: \' + count +  \' total size: \' + totalSize);',
'\t\t\treturn arr2;',
'\t\t}catch(err) {',
'\t\t\treturn manifest;',
'\t\t}',
'\t}',
'\tvar flagExplicit = false;',
'\tif(typeof fileSystemPart == \'undefined\') fileSystemPart = \'saved\';',
'\tif(fileSystemPart.toLowerCase().indexOf(\'explicit:\') == 0) {',
'\t\tfileSystemPart = fileSystemPart.substr(\'explicit:\'.length);',
'\t\tflagExplicit = true;',
'\t}',
'\t//var storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\tvar storedWhere = getManifestStorageLocation(manifestName);',
'\tvar obj = {}',
'\tif(storedWhere == null) {',
'\t\tobj[folder] = fileSystemPart;',
'\t} else {',
'\t\ttry{',
'\t\t\tobj = JSON.parse(storedWhere)',
'\t\t\tobj[folder] = fileSystemPart;',
'\t\t}catch(e) {',
'\t\t\tobj[folder] = fileSystemPart;',
'\t\t}',
'\t}',
'\tvar _string = JSON.stringify(obj);',
'\t//localStorage.setItem(\'transFormFileSystemPart\',_string);',
'\tsetManifestStorageLocation(_string,manifestName);',
'\tvar accountId = folder;',
'\tvar fetchManifest = function(url) {',
'\tvar onOK = function(data) {',
'\t\ttry{',
'\t\t\tvar arr = JSON.parse(data);',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles(arr,accountId,cbAllDone,optionsIn,fileSystemPart,flagMoveSQLiteFiles,manifestName);',
'\t\t}catch(e) {',
'\t\t\t//alert(\'Error - could not read the TransForm manifest file.\' + JSON.stringify(e));',
'\t\t\tvar cbObj = {error: true, errorText: \'Could not read the manifest file.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t\t}',
'\t\t}',
'\t\tvar onFail = function() {',
'\t\t\t//alert(\'Error - Could not download the TransForm manifest file.\');',
'\t\t\tvar cbObj = {error: true, errorText: \'Could not download the manifest file.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t}',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.httpFetch(url,onOK,onFail,[{name:"cache-control",value:"no-cache"}]);',
'\t}',
'\tif(typeof manifest == \'function\') {',
'\t\tmanifest = manifest.call()',
'\t}',
'\tif(typeof manifest == \'string\') {',
'\t\tfetchManifest(manifest);',
'\t\treturn;',
'\t}',
'\t//var oldManifest = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t//debugger;',
'\tvar oldManifest = getManifest(manifestName);',
'\tvar obj = {};',
'\tvar newManifest = manifest;',
'\tif(oldManifest != null) {',
'\t\tvar newManifest = computeNewManifest(oldManifest,manifest,folder);',
'\t} else {',
'\t\tif(manifest.constructor != Array) {',
'\t\t\tobj = JSON.parse(manifest);',
'\t\t}',
'\t}',
'\tobj[folder] = manifest;',
'\tvar json = JSON.stringify(obj);',
'\tvar flagInformationOnly = false;',
'\tif(typeof optionsIn.informationOnly != \'undefined\') {',
'\t\tif(optionsIn.informationOnly) {',
'\t\t\tflagInformationOnly = true;',
'\t\t}',
'\t}',
'\tif (!flagInformationOnly) {',
'\t\t//localStorage.setItem(\'transFormOnDeviceManifest\',json);',
'\t\tstoreManifest(json,manifestName)',
'\t}',
'\tmanifest = newManifest;',
'\tif(flagInformationOnly) {',
'\t\tvar objCB = {error: false, array: manifest, accountId: accountId, mode: \'informationOnly\'}',
'\t\tcbAllDone.call(this,objCB);',
'\t\treturn;',
'\t}',
'\tif(manifest.length == 0) {',
'\t\tvar objCB = {error: false, array: manifest, accountId: accountId, arrayFilesRelative: [], arrayFiles: [], fileCount: 0}',
'\t\tcbAllDone.call(this,objCB);',
'\t\treturn;',
'\t}',
'\tif(typeof flagMoveSQLiteFiles == \'undefined\') flagMoveSQLiteFiles = true;',
'\t\tif(flagMoveSQLiteFiles) {',
'\t\t\t//android can use sqlite files in a sub-dir so they are moved to the root and given a filename account___sqlitedbname.db',
'\t\t\tif(typeof cbAllDone == \'undefined\') {',
'\t\t\t\tvar origCB = function() { }',
'\t\t\t} else {',
'\t\t\t\torigCB = cbAllDone;',
'\t\t\t}',
'\t\t\tcbAllDone = function(obj) {',
'\t\t\t\tvar makeCBDone = function(array,cbNoError) {',
'\t\t\t\t\tvar cbDone = function() {',
'\t\t\t\t\t\tvar arrayIn = array;',
'\t\t\t\t\t\t/////////////////',
'\t\t\t\t\t\tvar folder = accountId;',
'\t\t\t\t\t\tvar cb = function(array) {',
'\t\t\t\t\t\t\tvar arrFQ = [];',
'\t\t\t\t\t\t\tvar arrR = [];',
'\t\t\t\t\t\t\tvar uriPrefix = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId);',
'\t\t\t\t\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\t\t\t\t\tarrR.push(array[i].name);',
'\t\t\t\t\t\t\t\tarrFQ.push(uriPrefix + array[i].name);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t    var obj = {error: false, array: arrayIn, arrayFilesRelative: arrR, arrayFiles: arrFQ, fileCount: array.length}',
'\t\t\t\t\t\t\tcbNoError.call(this,obj);',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles(folder,cb);',
'\t\t\t\t\t\t////////////////',
'\t\t\t\t\t}',
'\t\t\t\t\treturn cbDone;',
'\t\t\t\t}',
'\t\t\t\tvar cbDone = makeCBDone(obj.array,origCB);',
'\t\t\t\tvar cbError = function() {};',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.moveSQLiteFilesFromSubfolder(obj.accountId,cbDone,cbError)',
'\t\t\t}',
'\t}',
'\tvar arr = manifest',
'\tvar tempFolderName = \'transFormTemp\';',
'\tfor(var i = 0; i < arr.length; i++) {',
'\t\tarr[i].filename = arr[i].url;',
'\t\tarr[i].zipped = false;',
'\t\tvar flagZip = false;',
'\t\tvar fn = arr[i].filename;',
'\t\tvar ext = fn.split(\'.\');',
'\t\text = ext[ext.length-1];',
'\t\tif(typeof ext != \'undefined\') {',
'\t\t\tif(ext.toLowerCase() == \'zip\') {',
'\t\t\t\tflagZip = true;',
'\t\t\t\tarr[i].zipped = true;',
'\t\t\t\tif(arr[i].type == \'file\') {',
'\t\t\t\t\tarr[i].type = \'folder\';',
'\t\t\t\t\tif(typeof arr[i].targetFolder == \'undefined\') arr[i].targetFolder = \'\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tarr[i].shortName = A5.parseFilename(fn).name;',
'\t\tif(typeof arr[i].targetFolder == \'undefined\') arr[i].targetFolder = \'\';',
'\t}',
'\tvar options = {',
'\t\tdirectory: tempFolderName,',
'\t\tstrip: true,',
'\t\tfilesystem: \'temp\',',
'\t\tforceDownloadIfFileExists: true,',
'\t\tonComplete: function(array) {',
'\t\t\t_processDownloadedFiles(arr,accountId)',
'\t\t},',
'\t\tonError: function(array,arrayIndex) {',
'\t\t\tvar cbObj = {error:true, errorText: \'Error downloading files to device.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t},',
'\t\tonDeviceOffline: function() {',
'\t\t\tvar cbObj = {error:true, errorText: \'No connection.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t}',
'\t}',
'\tif(typeof optionsIn == \'object\') $u.o.assign(options,optionsIn);',
'\tvar _deleteTempFolder = function() {',
'\t\tvar _onRemoveSuccess = function() {  };',
'\t\tvar _error = function(e) {  };',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = tempFolderName + \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\tvar postProcessComplete = function(arr) {',
'\t\tvar flagDone = true;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(arr[i].postProcessDone == false) {',
'\t\t\t\tflagDone = false;',
'\t\t\t\tbreak;',
'\t\t\t}',
'\t\t}',
'\t\tvar ph = \'\';',
'\t\tif(typeof options.progress != \'undefined\') {',
'\t\t\tif(typeof options.progress.progressElement != \'undefined\') {',
'\t\t\t\tph = options.progress.progressElement;',
'\t\t\t}',
'\t\t}',
'\t\tif(ph == \'\') flagShowProgress = false;',
'\t\tvar ele = $(ph + \'.PROGRESS.TOTAL\');',
'\t\tvar ele2 = $(ph + \'.PROGRESSDISPLAY\');',
'\t\tif(ele2) {',
'\t\t\tele2.style.display = \'\';',
'\t\t\tele2.innerHTML = \'Processing files...\';',
'\t\t}',
'\t\t//alert(\'flag done: \' + flagDone);',
'\t\tvar flagShowProgress = false;',
'\t\tif(typeof options.showProgress != \'undefined\') {',
'\t\t\tflagShowProgress = options.showProgress;',
'\t\t}',
'\t\tif(flagShowProgress) {',
'\t\t\t//we don\'t show progress anymore for post processing. just put up a message saying \'Processing files...\'',
'\t\t}',
'\t\tif(flagDone) {',
'\t\t\tif(ele2) ele2.innerHTML = \'\';',
'\t\t\tif(ele2) ele2.style.display = \'none\';',
'\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\tvar that = this;',
'\t\t\tsetTimeout(function() {',
'\t\t\t\tif(ele2) ele2.style.display = \'none\';',
'\t\t\t\tsetTimeout(function() {',
'\t\t\t\t\tvar objCB = {error: false, array: arr, accountId: accountId};',
'\t\t\t\t\tcbAllDone.call(that,objCB);',
'\t\t\t\t\t_deleteTempFolder();',
'\t\t\t\t},100);',
'\t\t\t},101);',
'\t\t} else {',
'\t\t\tvar countDone = 0;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(arr[i].postProcessDone) countDone = countDone + 1;',
'\t\t\t}',
'\t\t\tif(ele2) ele2.style.display = \'\';',
'\t\t\tvar pct = (countDone/arr.length) * 100;',
'\t\t\tif(ele) {',
'\t\t\t\t//ele.style.width = pct + \'%\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//////////////////// post process function start ////////////////////',
'\tvar _processDownloadedFiles = function(arr, accountId) {',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].postProcessDone = false;',
'\t\t\tarr[i].postProcessError = false;',
'\t\t}',
'\t\tvar flagMustUpdateOnDeviceManifest = false;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(!arr[i].downloaded) {',
'\t\t\t\tif(!flagInformationOnly) flagMustUpdateOnDeviceManifest = true;',
'\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t}',
'\t\t}',
'\t\t//sr00',
'\t\tif(flagMustUpdateOnDeviceManifest) {',
'\t\t\t//var m = localStorage.transFormOnDeviceManifest;',
'\t\t\tvar m = getManifest(manifestName);',
'\t\t\tvar mObj = JSON.parse(m);',
'\t\t\tvar url_i = \'\';',
'\t\t\tvar mObj2 = mObj[folder];',
'\t\t\t//window.onerror = function(err) { alert(\'Unhandled Javascript Error - postprocess:  \' + JSON.stringify(err));}',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(!arr[i].downloaded) {',
'\t\t\t\t\turl_i = arr[i].url;',
'\t\t\t\t\tfor(var j = 0; j < mObj2.length; j++) {',
'\t\t\t\t\t\tif(mObj2[j].url == url_i) {',
'\t\t\t\t\t\t\tmObj2[j].version = -1; //set version to -1 so that if the error is later corrected, file will download',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tm = JSON.stringify(mObj)',
'\t\t\t//localStorage.transFormOnDeviceManifest = m;',
'\t\t\tstoreManifest(m,manifestName);',
'\t\t}',
'\t\tpostProcessComplete(arr) //if all downloads fail, need to trigger the onDone event',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(arr[i].type == \'sqlite\' && arr[i].downloaded) {',
'\t\t\t\tvar flagZip = arr[i].zipped',
'\t\t\t\tif(flagZip) {',
'\t\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite unzipped in target - \'  + i + arr[i].localFilename );',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar fail = function() {',
'\t\t\t\t\t\t\t//alert(\'failed\');',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\treturn fail;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ok = _getcbok(i,arr);',
'\t\t\t\t\tvar fail = _getcbfail(i,arr);',
'\t\t\t\t\t//alert(\'about to unzip\'); debugger;',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLite(arr[i].localFilename,\'\',\'\',\'\',accountId,ok,fail)',
'\t\t\t\t} else {',
'\t\t\t\t\t//SQLite db is NOT zipped',
'\t\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar onSuccess = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite db copied: \' + i + \' must now delete \' + arr[i].localFilename);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\t//alert(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn onSuccess;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite db NOT copied: \' + i);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar onSuccess = _getcbok(i,arr);',
'\t\t\t\t\tvar onError = _getcbfail(i,arr);',
'\t\t\t\t\tvar fn = arr[i].localFilename',
'\t\t\t\t\tfn = fn.split(\'/\');',
'\t\t\t\t\tvar localDBName = fn[fn.length-1];',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB(arr[i].localFilename,\'\',\'\',\'\',localDBName,accountId, onSuccess, onError)',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(arr[i].type == \'file\' && arr[i].downloaded) {',
'\t\t\t\tvar fnSource = arr[i].localFilename;',
'\t\t\t\tif(arr[i].targetFolder == \'\') {',
'\t\t\t\t\tvar _targetFolder = accountId + \'/\';',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _targetFolder = accountId + \'/\' + arr[i].targetFolder;',
'\t\t\t\t}',
'\t\t\t\tvar makeOnMoveOK = function(arr,i) {',
'\t\t\t\t\tvar _ok = function() {',
'\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\tpostProcessComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _ok;',
'\t\t\t\t}',
'\t\t\t\tvar makeOnMoveError = function(arr,i) {',
'\t\t\t\t\tvar _err = function() {',
'\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\tpostProcessComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _err;',
'\t\t\t\t}',
'\t\t\t\tvar _onMoveSuccess = makeOnMoveOK(arr,i);',
'\t\t\t\tvar _error = makeOnMoveError(arr,i);',
'\t\t\t\tvar _srcPath = fnSource;',
'\t\t\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart) + _targetFolder;;',
'\t\t\t\tvar _destinationName = arr[i].shortName;',
'\t\t\t\tvar _onFolderCreateSuccess = function() {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(_srcPath, _destinationDirPath, _destinationName, _onMoveSuccess, _error);',
'\t\t\t\t};',
'\t\t\t\tvar _onFolderCreateError = makeOnMoveError(arr,i);',
'\t\t\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
'\t\t\t\tvar _dirStructure = _targetFolder;;',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _onFolderCreateSuccess, _onFolderCreateError);',
'\t\t\t}',
'\t\t\tif(arr[i].type == \'folder\' && arr[i].downloaded) {',
'\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function(err) {',
'\t\t\t\t\t\t\t//alert(\'failed\');',
'\t\t\t\t\t\t\talert(\'UNZIP folder failed: \' + i);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok;',
'\t\t\t\t\t}',
'\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar onSuccess = function() {',
'\t\t\t\t\t\t\t//alert(\'folder UNZIP OK: \' + i + \' delete temp file: \' + arr[i].localFilename) ;',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn onSuccess;',
'\t\t\t\t\t}',
'\t\t\t\tvar ok = _getcbok(i,arr)',
'\t\t\t\tvar fail = _getcbfail(i,arr)',
'\t\t\t\tif(arr[i].targetFolder == \'\') {',
'\t\t\t\t\tvar _target = accountId;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _target = accountId + \'/\' + arr[i].targetFolder;',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles(arr[i].localFilename,\'\',\'\',\'\',fileSystemPart, _target,ok,fail,false)',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//////////////////// post process function end ////////////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'}',
'//////////////////////////===========new',
'//each named manifest MUST have its own folder',
'{UXPRERENDEREDALIAS}_DlgObj.__getManifestObj = function(keyName) {',
'\tif(typeof keyName == \'undefined\') keyName = \'manifests\';',
'\t\tvar manifestObj = localStorage.getItem(keyName);',
'\t\tif(manifestObj == null || !manifestObj) manifestObj = \'\';',
'\t\tif(manifestObj == \'\') {',
'\t\t\tmanifestObj = {};',
'\t\t} else {',
'\t\t\tmanifestObj = JSON.parse(manifestObj);',
'\t\t}',
'\t\treturn manifestObj;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest = function(manifestName) {',
'\twindow.onerror = function(err) { alert(\'Error - getFolderForNamedManifest():  \' + JSON.stringify(err));}',
'\t//returns an object with \'folder\' and \'fileSystemPart\'',
'\tif(typeof manifestName == \'undefined\' || manifestName == \'\') manifestName = \'___default___\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar obj2 = obj[manifestName];',
'\treturn obj2;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesInManifest = function(manifestName,cb) {',
'\twindow.onerror = function(err) { alert(\'Error - phoneGapListFilesInManifest():  \' + JSON.stringify(err));}',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName);',
'\tif(obj) {',
'\t\tvar folder = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName).folder;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles(folder,cb);',
'\t} else {',
'\t\tvar arr = [];',
'\t\tcb.call(this,arr);',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesInManifest = function(manifestName,onOK,onError) {',
'\twindow.onerror = function(err) { alert(\'Error - phoneGapDeleteFilesInManifest():  \' + JSON.stringify(err));}',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName);',
'\tif(!obj) return;',
'\tif(obj) var folder = obj.folder;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFRemoveFilesForAccount(folder,onOK,onError,manifestName)',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tdelete obj[manifestName];',
'\tvar json = JSON.stringify(obj);',
'\tlocalStorage.setItem(\'manifestInfo\',json) ;',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\tdelete obj[manifestName];',
'\tvar json = JSON.stringify(obj);',
'\tlocalStorage.setItem(\'manifests\',json)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.listManifests = function(cb) {',
'\twindow.onerror = function(err) { alert(\'Error - listManifests():  \' + JSON.stringify(err));}',
'\tvar m = [];',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tif(obj) {',
'\t\tfor(var n in obj) {',
'\t\t\tif(n.indexOf(\'___default___\') > -1) {',
'\t\t\t\tvar obj2 = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\t\t\tif(obj2 == null || obj2 == \'null\') {',
'\t\t\t\t} else {',
'\t\t\t\t\tm.push(\'Default Manifest\');',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tm.push(n)',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(cb) cb.call(this,m);',
'\treturn m;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getManifests = function(onOK) {',
'\twindow.onerror = function(err) { alert(\'FATAL: getManifests()  \' + JSON.stringify(err));}',
'\tvar m = {UXPRERENDEREDALIAS}_DlgObj.listManifests();',
'\tvar r = [];',
'\tvar robj = {};',
'\tvar obj =  {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar obj2 = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\tfor(var i = 0; i < m.length; i++) {',
'\t\tvar n = m[i];',
'\t\tif(n == \'Default Manifest\') {',
'\t\t\tvar obj4 = obj[\'___default___\'];',
'\t\t\tif(obj4) {',
'\t\t\t\tif(obj4.folder && obj4.folder != null) {',
'\t\t\t\t\tdelete robj;',
'\t\t\t\t\tvar robj = {};',
'\t\t\t\t\trobj.name = \'Default Manifest\';;',
'\t\t\t\t\trobj.folder = obj4.folder',
'\t\t\t\t\trobj.fileSystemPart = obj4.fileSystemPart;',
'\t\t\t\t\tvar ls = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\t\t\t\tvar ls = JSON.parse(ls);',
'\t\t\t\t\tif(ls) {',
'\t\t\t\t\t\tvar manifest = ls[obj4.folder];',
'\t\t\t\t\t\trobj.manifest = manifest;',
'\t\t\t\t\t\tr.push(robj)',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t} else {',
'\t\t\tdelete robj;',
'\t\t\tvar robj = {};',
'\t\t\trobj.name = n;',
'\t\t\tvar obj4 = obj[n]',
'\t\t\tif(obj4 && obj4.folder) {',
'\t\t\t\trobj.folder = obj4.folder;',
'\t\t\t\trobj.fileSystemPart = obj4.fileSystemPart;',
'\t\t\t\trobj.manifest = JSON.parse(obj2[n])[obj4.folder];',
'\t\t\t\tr.push(robj);',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(typeof onOK == \'function\') onOK.call(this,r);',
'\treturn r;',
'}',
'/*',
'{UXPRERENDEREDALIAS}_DlgObj.getManifest = function(manifestName,onOK) {',
'\tvar val = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetManifestBaseFolder(manifestName,onOK,\'getManifest\')',
'}',
'*/',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetManifestBaseFolder = function(manifestName,onOK,mode) {',
'\tvar name = manifestName;',
'\tif(name == \'\') name = \'Default Manifest\';',
'\tif(manifestName == \'Default Manifest\') manifestName = \'\'',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getManifests();',
'\tif(!obj) {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,{});',
'\t\treturn \'\';',
'\t};',
'\tvar obj2 = {};',
'\tvar found = false;',
'\tfor(var i = 0; i < obj.length; i++) {',
'\t\tif(obj[i].name == name) {',
'\t\t\tobj2 = obj[i];',
'\t\t\tfound = true;',
'\t\t}',
'\t}',
'\tif(mode == \'getManifest\') {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,obj2)',
'\t\treturn obj2;',
'\t}',
'\tif(!found) {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,{});',
'\t\treturn \'\';',
'\t}',
'\tvar folder = obj2.folder;',
'\tvar fspart = obj2.fileSystemPart;',
'\tobj2.baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(obj2.fileSystemPart)',
'\tif(typeof onOK == \'function\') onOK.call(this,obj2)',
'\treturn \'\' + {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(obj2.fileSystemPart)',
'}',
'//////////////',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFReadFile = function(filename,ok,fail) {',
'\tvar fileSystemPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(account,true);',
'\tif(typeof ok == \'undefined\') ok = function() { };',
'\tif(typeof fail == \'undefined\') fail = function(e) { };',
'\tvar _success = function(result) {',
'\t\tok.call(this,result)',
'\t};',
'\tvar _error = function(e) {',
'\t\tfail.call(this,e)',
'\t};',
'\tif(fileSystemPart == null || fileSystemPart == \'\') {',
'\t\tfail.call(this);',
'\t\treturn;',
'\t}',
'\tvar _filePath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart) + filename;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(_filePath, _success,_error)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFExecuteSQL = function(dbName,sql,args,ok,fail) {',
'/*',
'useage:',
'var _success = function() {',
'\tresultArray = arguments[0];',
'\t{UXPRERENDEREDALIAS}_DlgObj.setListColumnsAndPopulate(\'list1\',resultArray)',
'};',
'var _error = function(e) { };',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFExecuteSQL(\'account1/SQLiteNorthwind.db\',\'select * from Customers where Country = ?\',[\'UK\'],ok,fail)',
'*/',
'\tif(typeof ok != \'function\') ok = function() { };',
'\tif(typeof fail != \'function\') fail = function(e) { }',
'\t//dbName is typically like this: account1/dbname.db',
'\tif(args.constructor == Array) {',
'\t\tvar _args = args;',
'\t} else {',
'\t\tvar _args = [];',
'\t}',
'\tvar _success = function(tx,result,resultArray) {',
'\t\tok.call(this,resultArray,result,tx)',
'\t};',
'\tvar _error = function(e) {',
'\t\tfail.call(this,e)',
'\t};',
'\t_onTxSuccess = function() {/*transaction success */  };',
'\t_onTxError = function() {/*transaction error */  };',
'\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,_args,_success,_error,_onTxSuccess,_onTxError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteSQLiteDBFiles = function(account,cb,onerror) {',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\tif(typeof onerror == \'undefined\') onerror = function() { };',
' \tvar ext = \'.db\';',
' \tvar _onCompletion = function() { cb.call(this);};',
'\tvar _error = function(e) { onerror.call(this) };',
'\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\tvar _dirName = \'/\';;',
'\tvar _matchRegex = new RegExp(account.escapeRegExp() + \'___[A-z0-9_]*\' + ext.escapeRegExp());',
'\tvar _keepList = [];',
'\tvar _dirPath = _baseURI + _dirName;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(_dirPath,_matchRegex,_keepList, _onCompletion, _error);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFRemoveFilesForAccount = function(accountId,cb,onError) {',
'\tif(typeof onError == \'undefined\') onError = function() { };',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\t//get the fspart where manifest was loaded',
'\tvar fsPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId);',
'\tvar __removeSQLite = function(accountId,cb,onError) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteSQLiteDBFiles(accountId,cb,onError);',
'\t}',
'\tvar _errorRemoveFolder = function() { __removeSQLite(accountId,cb,onError); };',
'\tvar _onRemoveFolderSuccess = function() { __removeSQLite(accountId,cb,onError);};',
'\tvar _dirPath = fsPart + accountId + \'/\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveFolderSuccess, _errorRemoveFolder);',
'\tvar manifestName = arguments[3];',
'\tif(typeof manifestName == \'undefined\') localStorage.transFormOnDeviceManifest = null;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles = function(account,cb) {',
'//alert(\'list\');',
'//debugger;',
'//if fileSystemPart is \'private\' on iOS will get odd results because private and getSQLiteFolder() are same folder',
'\tvar fileSystemPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(account,true);',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\tif(fileSystemPart == null || fileSystemPart == \'\') {',
'\t\tcb.call(this,[]);',
'\t\treturn;',
'\t}',
'\tvar arr = [];',
'\tvar _files = function(account) {',
'\t\tvar _onSuccess = function(filelist) {',
'\t\t\tvar str;',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tstr = filelist[i];',
'\t\t\t\tif(str.substr(str.length-1) != \'/\') {',
'\t\t\t\t\tarr.push({name: account + \'/\' + filelist[i], type: \'file\'});',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\t_sqlite(account)',
'\t\t};',
'\t\tvar _error = function(e) {  _sqlite(account) };',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
'\t\tvar _dirName = account + \'/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
'\t}',
'\tvar _sqlite = function(account) {',
'\t\tvar _onSuccessSQ = function(filelist) {',
'\t\t\tvar _ext = function(fn) {',
'\t\t\t\tfn = fn.split(\'.\')',
'\t\t\t\tif(fn.length == 1) return \'\';',
'\t\t\t\tvar ext = fn[fn.length-1];',
'\t\t\t\tif(typeof ext == \'undefined\') ext = \'\';',
'\t\t\t\treturn ext;',
'\t\t\t}',
'\t\t\tvar flagFixType = false;',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tflagFixType = false;',
'\t\t\t\t/*',
'\t\t\t\ttry{',
'\t\t\t\t\tif(fileSystemPart == \'private\' && device.platform.toLowerCase() == \'ios\') {',
'\t\t\t\t\t\tflagFixType = true;',
'\t\t\t\t\t}',
'\t\t\t\t}catch(e) { }',
'\t\t\t\t*/',
'\t\t\t\tif(flagFixType == false) {',
'\t\t\t\t\tif(filelist[i].indexOf(account) == 0) {',
'\t\t\t\t\t\tif( filelist[i].substr(filelist[i].length-1) != \'/\' && _ext(filelist[i]) == \'db\') {',
'\t\t\t\t\t\t\tarr.push({name: filelist[i], type: \'SQLiteDB\'});',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tif(flagFixType) {',
'\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\tvar _n = arr[i].name.split(\'.\');',
'\t\t\t\t\tvar _e = _n[_n.length-1];',
'\t\t\t\t\tif(_e.toLowerCase() == \'db\') {',
'\t\t\t\t\t\tarr[i].type = \'SQLiteDB\';',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tcb.call(this,arr);',
'\t\t};',
'\t\tvar _error = function(e) { cb.call(this,arr);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\t\t//var _dirName = account + \'/\';;',
'\t\t_dirName = \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccessSQ, _error);',
'\t}',
'\t_files(account)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetSQLiteDatabases = function(account,cb,error) {',
'\tif(typeof error == \'undefined\') error = function(e) { };',
'\tvar _sqlite = function(account) {',
'\t\tvar _onSuccessSQ = function(filelist) {',
'\t\t\tif(account != \'\') {',
'\t\t\t\tvar _f = [];',
'\t\t\t\tvar x;',
'\t\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\t\tx = filelist[i].split(\'.\');',
'\t\t\t\t\tx = x[x.length-1];',
'\t\t\t\t\tif(filelist[i].indexOf(account+\'___\') == 0 && x != \'undefined\' && x == \'db\' ) {',
'\t\t\t\t\t\t_f.push(filelist[i]);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tvar _f = [];',
'\t\t\t\tvar x;',
'\t\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\t\tx = filelist[i].split(\'.\');',
'\t\t\t\t\tx = x[x.length-1];',
'\t\t\t\t\tif(x != \'undefined\' && x == \'db\' ) {',
'\t\t\t\t\t\t_f.push(filelist[i]);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tcb.call(this,_f);',
'\t\t};',
'\t\tvar _error = function(e) { error.call(this,e);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\t\t_dirName = \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccessSQ, _error);',
'\t}',
'\t_sqlite(account)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart = function(accountId,flagShortPartName) {',
'\tif(typeof flagShortPartName == \'undefined\') flagShortPartName = false;',
'\tvar baseFolder = \'\'',
'\tvar storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\tvar obj = {}',
'\tif(storedWhere == null) {',
'\t} else {',
'\t\ttry{',
'\t\t\tobj = JSON.parse(storedWhere);',
'\t\t\tbaseFolder = obj[accountId];',
'\t\t}catch(e) {',
'\t\t}',
'\t}',
'\tif(flagShortPartName) {',
'\t\treturn baseFolder;',
'\t}',
'\tbaseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL( baseFolder);',
'\treturn baseFolder;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFullPath = function(relativeFilename,accountId) {',
'\tif(relativeFilename.indexOf(accountId) == -1) {',
'\t\tvar baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId) + accountId + \'/\' + relativeFilename;',
'\t} else {',
'\t\tvar baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId) +  relativeFilename;',
'\t}',
'\treturn baseFolder;',
'}',
'////=========== \'sr87',
'{UXPRERENDEREDALIAS}_DlgObj.moveSQLiteFilesFromSubfolder = function(accountIn, cbDone, cbError) {',
'\t//called after a manifest has been downloaded to move the SQLite databases to the root of the SQLite folder with \'accountName___\' as the db prefix',
'\t//this is done because while iOS can open a db named folder/sqlite.db, android can\'t. so we make folder___sqlite.db',
'\t//get a list of SQLite dbs in the subfolder, then iterate over list calling _moveLow()',
'\tfunction _moveLow(account,dbName,array, cbDone) {',
'\t\t//var _onMoveSuccess = function() { alert(\'ok\'); + alert(JSON.stringify(array)); };',
'\t\tvar _onMoveSuccess = cbDone;',
'\t\tvar _error = function(e) { alert(\'move failed\');};',
'\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) + account + \'/\' + dbName;',
'\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);;',
'\t\tvar _destinationName = account + \'___\' + dbName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(_srcPath, _destinationDirPath, _destinationName, _onMoveSuccess, _error);',
'\t}',
'\t//make a closure that captures the accountIn name',
'\tvar _makeOK = function(accountIn,cbDone,cbError) {',
'\t\tvar account = accountIn;',
'\t\tvar _ok = function(filelist) {',
'\t\t\tvar _arr = []',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tif(filelist[i].indexOf(account + \'/\') == 0) {',
'\t\t\t\t\tvar n = filelist[i];',
'\t\t\t\t\tn = n.split(\'/\')',
'\t\t\t\t\tvar acc = n[0];',
'\t\t\t\t\tvar dbName = n[1];',
'\t\t\t\t\t_arr.push({account: acc, dbName: dbName, completed: 0});',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//alert(\' now do _moveLow for \' + _arr.length + \' files\');',
'\t\t\tif (_arr.length == 0) {',
'\t\t\t\tcbDone.call();',
'\t\t\t}',
'\t\t\tvar count = 0;',
'\t\t\tfor(var i = 0; i < _arr.length; i++) {',
'\t\t\t\tvar _okmc = function(ii) {',
'\t\t\t\t\tvar arr = _arr;',
'\t\t\t\t\tvar _ok = function() {',
'\t\t\t\t\t\t_arr[ii].completed = 1;',
'\t\t\t\t\t\tvar _done = 0;',
'\t\t\t\t\t\tfor(var j = 0; j < arr.length; j++) {',
'\t\t\t\t\t\t\t_done = _done + arr[j].completed;',
'\t\t\t\t\t\t\tif(_done == arr.length) {',
'\t\t\t\t\t\t\t\t//alert(\'done: \' + _done + \' account: \' + accountIn + \' typeof cbDone: \' + typeof cbDone);',
'\t\t\t\t\t\t\t\t//alert(cbDone.toString())',
'\t\t\t\t\t\t\t\tcbDone.call();',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t};',
'\t\t\t\t\treturn _ok;',
'\t\t\t\t}',
'\t\t\t\tvar _okm = _okmc(i);',
'\t\t\t\t_moveLow(_arr[i].account,_arr[i].dbName,_arr,_okm)',
'\t\t\t}',
'\t\t};',
'\t\treturn _ok;',
'\t}',
'\t//var cbx = function() { };',
'\t//alert(1);',
'\t//alert(cbDone.toString());',
'\tvar _ok = _makeOK(accountIn,cbDone);',
'\tvar _err = function(e) { };',
'\tvar _err = _ok; //sr 6-12-2020 on android, if there are no sqlite databases, then the _err function will get called and as a result, the onComplete event was  not firing',
'\t//therefore make the _err() function same as the _ok() function',
'\t//need to specify a blank account because the sqlite unzip creates subfolders at the root level of the sqlite folder and these are the files we want to move',
'\tvar account = \'\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetSQLiteDatabases(account,_ok,_err);',
'}',
'////=======',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(dirpath, matchRegex, keepList, onCompletion, onError)',
'//',
'// dirpath is the file URL of the directory whose contents will be examined (only files).',
'// matchRegex, if non-null, will need to match file names found for them to be considered for deletion.',
'// Any file name which is in the array keepList will not be considered even if it matches.',
'// All remaining files found (those matched and not in keepList) will be deleted.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL = function(dirpath, matchRegex, keepList, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var keepnames = {}; // fill object with all the names as attributes',
'   for (var j=0; j<keepList.length; j++) {',
'      keepnames[keepList[j]] = true;',
'   }',
'   var filelist = []; // list of files to delete',
'   var totalDeleted = 0;',
'   var deleteFromFileList = function() { // called repeatedly by itself on successes until all deleted',
'      if (filelist.length==0) { // no more to delete',
'         onCompletion(totalDeleted);',
'         return;',
'      }',
'      var todelete = filelist.pop(); // pop one from list and delete it, leaving list shorter',
'      totalDeleted += 1;',
'      todelete.remove(deleteFromFileList, onError);',
'   };',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var dirReader = fsEntry.createReader();',
'         var readEntriesFunction =',
'            function() { // function to recurse to call repeatedly after each completion until no result',
'               dirReader.readEntries( // start an async reading of entries',
'                  function(entries) { // more entries read, or done',
'                     if (!entries || entries.length==0) {',
'                        deleteFromFileList(); // got all - now start deleting them',
'                        return;',
'                     }',
'                     var name;',
'                     for (var i=0; i<entries.length; i++) {',
'                        name = entries[i].name;',
'                        if (!matchRegex || name.match(matchRegex)) { // must match regex',
'                           if (!keepnames[name]) { // and not be on keep list',
'                              filelist.push(entries[i]); // add one to delete to list',
'                           }',
'                        }',
'                     }',
'                     readEntriesFunction(); // recurse to call dirReader.readEntries again',
'                  },',
'                  onError);',
'               };',
'         readEntriesFunction(); // do first reading',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetVideoFromLibrary = function(ops) {',
'\tif(typeof ops.onBeforeCaptureJavascript != \'undefined\') {',
'\t\tif(ops.onBeforeCaptureJavascript.constructor == Function) {',
'\t\t\tvar result = ops.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result !=\'undefined\' && !result) return false;',
'\t\t}',
'\t}',
'\tvar _options = ops',
'\tvar getVideoWithPromises = function() {',
'\t\treturn new Promise(function (returnResolve, returnReject) {',
'\t\t// here are all the callbacks as promises',
'\t\tnew Promise(function (resolve, reject) {',
'\t\t\t// call camera | photo library | videos only',
'\t\t\tvar options = {',
'\t\t\t\tdestinationType: Camera.DestinationType.FILE_URI,',
'\t\t\t\tsourceType: Camera.PictureSourceType.PHOTOLIBRARY,',
'\t\t\t\tmediaType: Camera.MediaType.VIDEO',
'\t\t\t};',
'\t\t\tnavigator.camera.getPicture(resolve, reject, options);',
'\t\t}).then(function(filePath) {',
'\t\t\tconsole.log(\'First promise returned filepath: \'+filePath);',
'\t\t\t//Android does not return prefix so append',
'\t\t\tvar prefix = \'file://\'',
'\t\t\tfilePath=filePath.includes(prefix)?filePath:prefix+filePath;',
'\t\t\treturn new Promise(function(resolve, reject) {',
'\t\t\t\t\twindow.resolveLocalFileSystemURL(filePath, resolve, reject);',
'\t\t\t});',
'\t\t}).then(function (videoFileEntry) {',
'\t\t\tconsole.log(\'Second promise returned videoFileEntry: \'+videoFileEntry);',
'\t\t\treturnResolve(videoFileEntry)',
'\t\t});',
'\t});',
'}',
'\tvar getVideo = function() {',
'\t\tgetVideoWithPromises().then(function (videoFileName) {',
'\t\t\tconsole.log(\'Final promise completed.\');',
'\t\t\tvar vUrl = videoFileName.toURL();',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._thisVideo = [vUrl];',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.setValue(\'vp\',vUrl);',
'\t\t\tconsole.log(\'Local Video File: \'+vUrl);',
'\t\t\tvar e2 = {};',
'\t\t\te2.fileSystemURL = vUrl;',
'\t\t\t_options.onCaptureJavascript.call(this,e2);',
'\t\t}, function(err) {',
'\t\t\tconsole.log(\'Error: \' + err);',
'\t\t\talert(\'Error: \' + err);',
'\t\t});',
'\t};',
'\tgetVideo();',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapOpenFileWithNativeViewer = function(objIn,_onSuccess,_onError) {',
'\tvar _ts = function(txt) { //add trailing slash',
' \t\tif(txt[txt.length-1] == \'/\') return txt;',
'\t\treturn txt + \'/\';',
'\t}',
'\tif(typeof objIn.targetFolder == \'undefined\') objIn.targetFolder = \'\';',
'\tobjIn.targetFolder = _ts(objIn.targetFolder);',
'\tobjIn.sourceFolder = _ts(objIn.sourceFolder);',
'\tobjIn.flagMustDownload = typeof objIn.flagMustDownload != \'undefined\' ? objIn.flagMustDownload: false;',
'\t//set up obj variables from the passed in object (objIn);',
'\tvar obj = {};',
'\tobj.__tempFolderDirName = \'__AATEMPFILES/\';',
'\tif(objIn.flagMustDownload == false) { //local file',
'\t\tobj.__fileName = objIn.sourceFileName;',
'\t} else {//remote file',
'\t\tvar __url = objIn.sourceFileName;',
'\t\tobj.__url = __url;',
'\t\tvar __forceDownloadIfFileExists = true;',
'\t\tvar __showProgress = objIn.options.showProgress;',
'\t\tvar __downloadOptions = objIn.options;',
'\t\t//alert(\'__url: \' + __url);',
'\t\tobj.__fileName = A5.parseFilename(objIn.sourceFileName).name; \'\'  //get the short filename from the URL',
'\t}',
'\tobj.__sourceFileSystemPart = objIn.sourceFileSystem;',
'\tobj.__sourceFolder = objIn.sourceFolder;',
'\tobj.flagMustDownload = objIn.flagMustDownload',
'\tobj.options = objIn;',
'\t//end set up obj variables',
'\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapOpenNativeLow(obj,_onSuccess,_onError)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._phoneGapOpenNativeLow = function(obj,_onSuccess,_onError) {',
'\ttry {',
'\t//cordova.plugins.fileOpener2',
'\t\tvar _open = cordova.plugins.disusered.open;',
'\t} catch(e) {',
'\t\talert("\'cordova-open\' plugin not loaded.");',
'\t\treturn false;',
'\t}',
'\tif(obj.__fileName.indexOf(\'http:\') == -1 && obj.__fileName.indexOf(\'https:\') == -1)  {',
'\t\tvar o = A5.parseFilename(obj.__fileName);',
'\t\tobj.__fileNameFull = obj.__fileName;',
'\t\tobj.__fileName = o.name;',
'\t\tif(o.path != \'\') {',
'\t\t\tobj.__sourceFolder = obj.__sourceFolder + o.path + \'/\';',
'\t\t}',
'\t}',
'\tvar __targetFileName = obj.options.targetFileName;',
'\tvar __tempFolderDirName = obj.__tempFolderDirName; //temp dir where files are copied so that they can be opened',
'\tvar __fileName = obj.__fileName;',
'\tvar __srcFileName = __fileName;',
'\tvar __srcFileNameFull = obj.__fileNameFull',
'\tif(typeof __targetFileName != \'undefined\') {',
'\t\t__fileName = __targetFileName;',
'\t} else {',
'\t\t__targetFileName = \'\';',
'\t}',
'\tvar __sourceFileSystemPart = obj.__sourceFileSystemPart; //dir part where local file exists were where remote file will be downloaded',
'\tvar __sourceFolder = obj.__sourceFolder; //dir folder where local file exists or where remote file will be downloaded',
'\tvar __url = obj.__url;  //if file is remote, the remote url for the file',
'\t//obj.flagMustDownload - true/false indicates if file is local or remote',
'\t//clear out the temp folder by deleting it/////////////////////////////////////',
'\tvar _deleteTemp = function(cb) {',
'\t\tvar _onRemoveSuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was removed.\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was not removed. Not critical, so continue.\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = __tempFolderDirName;;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\t//recreate the temp folder////////////////////////////////////////////////////',
'\tvar _createTemp = function(cb) {',
'\t\tvar _onSuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was created\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was not created. Critical error, so stop.\');',
'\t\t\t_onError(e);',
'\t\t\tcb.stop();',
'\t\t};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirStructure = __tempFolderDirName;;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _onSuccess, _error);',
'\t}',
'\t//copy the source file to the temp folder ////////////////////////////////////////////',
'\tvar _copyToTemp = function(cb) {',
'\t\tvar _onCopySuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'File was copied\');',
'\t\t\tcb.next()',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'File was not copied. Critical error, so stop.\');',
'\t\t\t_onError(e);',
'\t\t\tcb.stop();',
'\t\t};',
'\t\tif(__sourceFileSystemPart.indexOf(\'manifest:\') == -1 ) {',
'\t\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder +  __srcFileName;',
'\t\t} else {',
'\t\t\tvar manifestFolder = __sourceFileSystemPart.split(\':\')[1];',
'\t\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(manifestFolder)',
'\t\t\t_srcPath = _srcPath + manifestFolder + \'/\' + __srcFileNameFull;',
'\t\t}',
'\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _destinationName = __tempFolderDirName + __fileName;',
'\t\tif(A5.log) A5.log(\'Copy file - source: \' + _srcPath)',
'\t\tif(A5.log) A5.log(\'Copy file - target: \' + _destinationDirPath + _destinationName);',
'\t\tif(_srcPath == _destinationDirPath + _destinationName) {',
'\t\t \tcb.next();',
'\t\t } else {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(_srcPath, _destinationDirPath, _destinationName, _onCopySuccess, _error);',
'\t\t}',
'\t}',
'\t//open the file with the native viewer ////////////////////////////////////////',
'\tvar _openFile = function(cb) {',
'\t\tvar _open = cordova.plugins.disusered.open;',
'\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\') + __tempFolderDirName + __fileName;',
'\t\tif(A5.log) A5.log(\'File to show: \' +_filename);',
'\t\t_open(_filename,_onSuccess,_onError);',
'\t}',
'\tvar _actions = [];',
'\tif(obj.__sourceFileSystemPart != \'temp\') {',
'\t\t_actions.push(_deleteTemp);',
'\t\t_actions.push(_createTemp);',
'\t}',
'\t_actions.push(_copyToTemp);',
'\t_actions.push(_openFile);',
'\tvar forEach = function(actions,andThen,ifError) {',
'\t    var index = 0;',
'\t    var stop = function(err) {',
'\t    \tif(ifError) {',
'\t    \t\tifError(err);',
'\t    \t}',
'\t    }',
'\t    var  next = function() {',
'\t        if( index < actions.length ) {',
'\t            var action = actions[index];',
'\t            ++index;',
'\t            action({next:next,stop:stop});',
'\t        } else if(andThen) {',
'\t        \tandThen();',
'\t        }',
'\t    };',
'\t    next();',
'\t};',
'\tvar _allDone = function() { }',
'\tvar _fatal = function() { }',
'\tif(obj.flagMustDownload) { //file download',
'\t\tvar fileToGet = __url;',
'\t\tvar arr = [{filename: fileToGet}];',
'\t\tvar opsIn = obj.options;',
'\t\tvar options = {',
'\t\t\tdirectory: \'\',',
'\t\t\ttargetFolder: opsIn.sourceFolder,',
'\t\t\tforceDownloadIfFileExists: opsIn.options.forceDownloadIfFileExists,',
'\t\t\tshowProgress: opsIn.options.showProgress,',
'\t\t\tonComplete: function(array) {',
'\t\t\t\tif(A5.log) A5.log(\'File download complete\');',
'\t\t\t\tvar msg = JSON.stringify(array,\'\',\'\\t\');',
'\t\t\t\tif(A5.log) A5.log(msg);',
'\t\t\t\t/*',
'\t\t\t\tvar _a2 = []',
'\t\t\t\tvar _a = [];',
'\t\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\t\t_a.push({filename: array[i].localFilename, found: array[i].found, downloaded: array[i].downloaded});',
'\t\t\t\t\t_a2.push(array[i].localFilename);',
'\t\t\t\t}',
'\t\t\t\tvar l = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'list2\');',
'\t\t\t\tl.populate(_a);',
'\t\t\t\t$(\'div4\').innerHTML = \'actual download filename: \' + _a2.join(\'<br>\');',
'\t\t\t\t*/',
'\t\t\tif(__targetFileName == \'\' && (__sourceFileSystemPart == \'temp\' || __sourceFileSystemPart == \'public\')) {',
'\t\t\t\tif(A5.log) A5.log(\'Open file in place. No need to copy to a temporary folder\');',
'\t\t\t\tvar _open = cordova.plugins.disusered.open;',
'\t\t\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder + __fileName;',
'\t\t\t\t_open(_filename,_onSuccess,_onError);',
'\t\t\t\treturn false;',
'\t\t\t}',
'\t\t\t\tforEach(_actions,_allDone,_fatal)',
'\t\t\t},',
'\t\t\tonError: function(array,arrayIndex) { alert(\'Download error\'); _onError();},',
'\t\t\tonDeviceOffline: obj.options.options.onDeviceOffline,',
'\t\t\tprogress: opsIn.options.progress,',
'\t\t\tstrip: true',
'\t\t}',
'\t\tdelete options.targetFolder;',
'\t\toptions.filesystem =  opsIn.sourceFileSystem;',
'\t\toptions.directory = opsIn.sourceFolder;',
'\t\tif(A5.log) A5.log(\'About to do file download\')',
'\t\tif(A5.log) A5.log(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\tif(A5.log) A5.log(JSON.stringify(options,\'\',\'\\t\'));',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'\t\t//end file download',
'\t} else {',
'\t\t//local file',
'\t\tif(__targetFileName == \'\' && (__sourceFileSystemPart == \'temp\' || __sourceFileSystemPart == \'public\')) {',
'\t\t\tif(A5.log) A5.log(\'Open file in place. No need to copy to temporary folder.\');',
'\t\t\tvar _open = cordova.plugins.disusered.open;',
'\t\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder + __fileName;',
'\t\t\t_open(_filename,_onSuccess,_onError);',
'\t\t\treturn false;',
'\t\t}',
'\t\tforEach(_actions,_allDone,_fatal);',
'\t}',
'}',
'//PROMISE VERSIONS',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURLPromise = function(_baseURI,_dirStructure) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() {resolve()};',
'\t\tvar _err = function(e) { \treject(e)\t};',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _ok, _err);',
'\t}',
'   return new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURLPromise = function(filepath, text, append) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL(filepath,text,_ok,_err,append)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURLPromise = function(filepath, startAt, endAt) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(data) { resolve(data) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(filepath,_ok,_err,startAt, endAt)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURLPromise = function(rootpath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(data) { resolve(data) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(rootpath, _ok, _err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURLPromise = function(dirpath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(dirpath, _ok, _err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURLPromise = function(filepath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(flag) { resolve(flag) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURL(filepath,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURLPromise = function(filepath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(filepath,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURLPromise = function(dirpath, matchRegex, keepList) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() {resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(dirpath, matchRegex, keepList, _ok, _err);',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURLPromise = function(srcpath, destdirpath, destname) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(srcpath,destdirpath,destname,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURLPromise = function(srcpath, destdirpath, destname) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(srcpath,destdirpath,destname,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURLPromise = function(dirpath, matchRegex) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(filelist) { resolve(filelist) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL(dirpath,matchRegex,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
';',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph          = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG      = RGraph.SVG || {};',
'    RGraph.SVG.AJAX = RGraph.SVG.AJAX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    /**',
'    * Makes an AJAX call. It calls the given callback (a function) when ready',
'    * ',
'    * @param string   url      The URL to retrieve',
'    * @param function callback A function that is called when the response is ready, there\'s an example below',
'    *                          called "myCallback".',
'    */',
'    RG.SVG.AJAX = function (url, callback)',
'    {',
'        // Mozilla, Safari, ...',
'        if (window.XMLHttpRequest) {',
'            var httpRequest = new XMLHttpRequest();',
'        // MSIE',
'        } else if (window.ActiveXObject) {',
'            var httpRequest = new ActiveXObject("Microsoft.XMLHTTP");',
'        }',
'        httpRequest.onreadystatechange = function ()',
'        {',
'            if (this.readyState == 4 && this.status == 200) {',
'                this.__user_callback__ = callback;',
'                this.__user_callback__(this.responseText);',
'            }',
'        }',
'        httpRequest.open(\'GET\', url, true);',
'        httpRequest.send();',
'    };',
'    /**',
'    * Makes an AJAX POST request. It calls the given callback (a function) when ready',
'    * ',
'    * @param string   url      The URL to retrieve',
'    * @param object   data     The POST data',
'    * @param function callback A function that is called when the response is ready, there\'s an example below',
'    *                          called "myCallback".',
'    */',
'    RG.SVG.AJAX.POST = function (url, data, callback)',
'    {',
'        // Used when building the POST string',
'        var crumbs = [];',
'        // Mozilla, Safari, ...',
'        if (window.XMLHttpRequest) {',
'            var httpRequest = new XMLHttpRequest();',
'        // MSIE',
'        } else if (window.ActiveXObject) {',
'            var httpRequest = new ActiveXObject("Microsoft.XMLHTTP");',
'        }',
'        httpRequest.onreadystatechange = function ()',
'        {',
'            if (this.readyState == 4 && this.status == 200) {',
'                this.__user_callback__ = callback;',
'                this.__user_callback__(this.responseText);',
'            }',
'        }',
'        httpRequest.open(\'POST\', url, true);',
'        httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");',
'        for (i in data) {',
'            if (typeof i == \'string\') {',
'                crumbs.push(i + \'=\' + encodeURIComponent(data[i]));',
'            }',
'        }',
'        httpRequest.send(crumbs.join(\'&\'));',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing a number as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the number as an argument)',
'    */',
'    RG.SVG.AJAX.getNumber = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var num = parseFloat(this.responseText);',
'            callback(num);',
'        });',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing a string as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the string as an argument)',
'    */',
'    RG.SVG.AJAX.getString = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var str = String(this.responseText);',
'            callback(str);',
'        });',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing JSON (ie a JavaScript object ) as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the JSON object as an argument)',
'    */',
'    RG.SVG.AJAX.getJSON = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var json = eval(\'(\' + this.responseText + \')\');',
'            callback(json);',
'        });',
'    };',
'    /**',
'    * Uses the above RGraph.AJAX function but calls the call back passing an array as its argument.',
'    * Useful if you\'re retrieving CSV data',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the CSV/array as an argument)',
'    */',
'    RG.SVG.AJAX.getCSV = function (url, callback)',
'    {',
'        var seperator = (typeof arguments[2] === \'string\'  ? arguments[2] : \',\'),',
'            lineSep   = (typeof arguments[3] === \'string\' ? arguments[3] : "\\r?\\n");',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var text   = this.responseText,',
'                regexp = new RegExp(seperator),',
'                lines  = this.responseText.split(lineSep),',
'                rows   = [];',
'            for (var i=0; i<lines.length; ++i) {',
'                var row = lines[i].split(seperator);',
'                for (var j=0,len=row.length;j<len;++j) {',
'                    if (row[j].match(/^[0-9.]+$/)) {',
'                        row[j] = parseFloat(row[j]);',
'                    }',
'                }',
'                rows.push(row);',
'            }',
'            callback(rows);',
'        });',
'    };',
'// End module pattern',
'})(window, document);;',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph        = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG    = RGraph.SVG    || {};',
'    RGraph.SVG.FX = RGraph.SVG.FX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    RG.SVG.REG = {',
'        store: []',
'    };',
'    // ObjectRegistry',
'    RG.SVG.OR = {objects: []};',
'    // Used to categorise trigonometery functions',
'    RG.SVG.TRIG        = {};',
'    RG.SVG.TRIG.HALFPI = ma.PI * .4999;',
'    RG.SVG.TRIG.PI     = RG.SVG.TRIG.HALFPI * 2;',
'    RG.SVG.TRIG.TWOPI  = RG.SVG.TRIG.PI * 2;',
'    RG.SVG.ISIE = ua.indexOf(\'rident\') > 0;',
'    RG.SVG.ISFF = ua.indexOf(\'irefox\') > 0;',
'    RG.SVG.events = [];',
'    // This allows you to set globalconfiguration values that are copied to',
'    // all objects automatically.',
'    RG.SVG.GLOBALS = {};',
'    RG.SVG.ISFF     = ua.indexOf(\'Firefox\') != -1;',
'    RG.SVG.ISOPERA  = ua.indexOf(\'Opera\') != -1;',
'    RG.SVG.ISCHROME = ua.indexOf(\'Chrome\') != -1;',
'    RG.SVG.ISSAFARI = ua.indexOf(\'Safari\') != -1 && !RG.ISCHROME;',
'    RG.SVG.ISWEBKIT = ua.indexOf(\'WebKit\') != -1;',
'    RG.SVG.ISIE     = ua.indexOf(\'Trident\') > 0 || navigator.userAgent.indexOf(\'MSIE\') > 0;',
'    RG.SVG.ISIE6    = ua.indexOf(\'MSIE 6\') > 0;',
'    RG.SVG.ISIE7    = ua.indexOf(\'MSIE 7\') > 0;',
'    RG.SVG.ISIE8    = ua.indexOf(\'MSIE 8\') > 0;',
'    RG.SVG.ISIE9    = ua.indexOf(\'MSIE 9\') > 0;',
'    RG.SVG.ISIE10   = ua.indexOf(\'MSIE 10\') > 0;',
'    RG.SVG.ISIE11UP = ua.indexOf(\'MSIE\') == -1 && ua.indexOf(\'Trident\') > 0;',
'    RG.SVG.ISIE10UP = RG.SVG.ISIE10 || RG.SVG.ISIE11UP;',
'    RG.SVG.ISIE9UP  = RG.SVG.ISIE9 || RG.SVG.ISIE10UP;',
'    //',
'    // Create an SVG tag',
'    //',
'    RG.SVG.createSVG = function (opt)',
'    {',
'        var container = opt.container,',
'            obj       = opt.object;',
'        if (container.__svg__) {',
'            return container.__svg__;',
'        }',
'        var svg = doc.createElementNS("http://www.w3.org/2000/svg", "svg");',
'            svg.setAttribute(\'style\', \'top: 0; left: 0; position: absolute\');',
'            svg.setAttribute(\'width\', container.offsetWidth);',
'            svg.setAttribute(\'height\', container.offsetHeight);',
'            svg.setAttribute(\'version\', \'1.1\');',
'            svg.setAttributeNS("http://www.w3.org/2000/xmlns/", \'xmlns\', \'http://www.w3.org/2000/svg\');',
'            svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");',
'        container.appendChild(svg);',
'        container.__svg__ = svg;',
'        var style = getComputedStyle(container);',
'        if (style.position !== \'absolute\' && style.position !== \'fixed\' && style.position !== \'sticky\') {',
'            container.style.position = \'relative\';',
'        }',
'        // Add the groups that facilitate "background layers"',
'        var numLayers = 10;',
'        for (var i=1; i<=numLayers; ++i) {',
'            var group = RG.SVG.create({',
'                svg: svg,',
'                type: \'g\',',
'                attr: {',
'                    className: \'background\' + i',
'                }',
'            });',
'            // Store a reference to the group',
'            obj.layers[\'background\' + i] = group;',
'            svg[\'background\' + i]        = group;',
'        }',
'        // Add the group tag to the SVG that contains all of the elements',
'        var group = RG.SVG.create({',
'            svg: svg,',
'            type: \'g\',',
'            attr: {',
'                className: \'all-elements\'',
'            }',
'        });',
'        container.__svg__.all = group;',
'        return svg;',
'    };',
'    //',
'    // Create a defs tag inside the SVG',
'    //',
'    RG.SVG.createDefs = function (obj)',
'    {',
'        if (!obj.svg.defs) {',
'            var defs = RG.SVG.create({',
'                svg: obj.svg,',
'                type: \'defs\'',
'            });',
'            obj.svg.defs = defs;',
'        }',
'        return defs;',
'    };',
'    //',
'    // Creates a tag depending on the args that you give',
'    //',
'    //@param opt object The options for the function',
'    //',
'    RG.SVG.create = function (opt)',
'    {',
'        var ns  = "http://www.w3.org/2000/svg",',
'            tag = doc.createElementNS(ns, opt.type);',
'        // Add the attributes',
'        for (var o in opt.attr) {',
'            if (typeof o === \'string\') {',
'                var name = o;',
'                if (o === \'className\') {',
'                    name = \'class\';',
'                }',
'                if ( (opt.type === \'a\' || opt.type === \'image\') && o === \'xlink:href\') {',
'                    tag.setAttributeNS(\'http://www.w3.org/1999/xlink\', o, String(opt.attr[o]));',
'                } else {',
'                    tag.setAttribute(name, String(opt.attr[o]));',
'                }',
'            }',
'        }',
'        // Add the style',
'        for (var o in opt.style) {',
'            if (typeof o === \'string\') {',
'                tag.style[o] = String(opt.style[o]);',
'            }',
'        }',
'        if (opt.parent) {',
'            opt.parent.appendChild(tag);',
'        } else {',
'            opt.svg.appendChild(tag);',
'        }',
'        return tag;',
'    };',
'    //',
'    // Function that adds up all of the offsetLeft and offsetTops to get',
'    // X/Y coords for the mouse',
'    //',
'    //@param object e The event object',
'    //@return array   The X/Y coordinate pair representing the mouse',
'    //                location in relation to the SVG tag.',
'    //',
'    RG.SVG.getMouseXY = function(e)',
'    {',
'        // This is necessary for IE9',
'        if (!e.target) {',
'            return;',
'        }',
'        var el = e.target, offsetX = 0, offsetY = 0, x, y;',
'        if (typeof el.offsetParent !== \'undefined\') { ',
'            do {',
'                offsetX += el.offsetLeft;',
'                offsetY += el.offsetTop;',
'            } while ((el = el.offsetParent));',
'        }',
'        x = e.pageX;',
'        y = e.pageY;',
'        x -= (2 * (parseInt(document.body.style.borderLeftWidth) || 0));',
'        y -= (2 * (parseInt(document.body.style.borderTopWidth) || 0));',
'        // We return a javascript array with x and y defined',
'        return [x, y];',
'    };',
'    //',
'    // Draws an X axis',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawXAxis = function (obj)',
'    {',
'        var prop = obj.properties;',
'        // Draw the axis',
'        if (prop.xaxis) {',
'            var y = obj.type === \'hbar\' ? obj.height - prop.gutterBottom : obj.getYCoord(obj.scale.min < 0 && obj.scale.max < 0 ? obj.scale.max : (obj.scale.min > 0 && obj.scale.max > 0 ? obj.scale.min : 0));',
'            var axis = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    d: \'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft,',
'                        y,',
'                        obj.width - prop.gutterRight,',
'                        y',
'                    ),',
'                    fill: prop.xaxisColor,',
'                    stroke: prop.xaxisColor,',
'                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                    \'shape-rendering\': \'crispEdges\',',
'                    \'stroke-linecap\': \'square\'',
'                }',
'            });',
'            // HBar X axis',
'            if (obj.type === \'hbar\') {',
'                var width  = obj.graphWidth / obj.data.length,',
'                    x      = prop.gutterLeft,',
'                    startY = (obj.height - prop.gutterBottom),',
'                    endY   = (obj.height - prop.gutterBottom) + prop.xaxisTickmarksLength;',
'            // Line/Bar/Waterfall/Scatter X axis',
'            } else {',
'                var width  = obj.graphWidth / obj.data.length,',
'                    x      = prop.gutterLeft,',
'                    startY = obj.getYCoord(0) - (prop.yaxisMin < 0 ? prop.xaxisTickmarksLength : 0),',
'                    endY   = obj.getYCoord(0) + prop.xaxisTickmarksLength;',
'                if (obj.scale.min < 0 && obj.scale.max <= 0) {',
'                    startY = prop.gutterTop;',
'                    endY   = prop.gutterTop - prop.xaxisTickmarksLength;',
'                }',
'                if (obj.scale.min > 0 && obj.scale.max > 0) {',
'                    startY = obj.getYCoord(obj.scale.min);',
'                    endY   = obj.getYCoord(obj.scale.min) + prop.xaxisTickmarksLength;',
'                }',
'            }',
'            // Draw the tickmarks',
'            if (prop.xaxisTickmarks) {',
'                // The HBar uses a scale',
'                if (prop.xaxisScale) {',
'                    for (var i=0; i<(typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\' ? prop.xaxisLabelsPositionEdgeTickmarksCount : (obj.scale.numlabels + (prop.yaxis && prop.xaxisMin === 0 ? 0 : 1))); ++i) {',
'                        if (obj.type === \'hbar\') {',
'                            var dataPoints = obj.data.length;',
'                        }',
'                        x = prop.gutterLeft + ((i+(prop.yaxis && prop.xaxisMin === 0 ? 1 : 0)) * (obj.graphWidth / obj.scale.numlabels));',
'                        // Allow Manual specification of number of tickmarks',
'                        if (typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                            dataPoints = prop.xaxisLabelsPositionEdgeTickmarksCount;',
'                            var gap    = (obj.graphWidth / prop.xaxisLabelsPositionEdgeTickmarksCount);',
'                            x          = (gap * i) + prop.gutterLeft + gap;',
'                        }',
'                        RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    x,',
'                                    startY,',
'                                    x,',
'                                    endY',
'                                ),',
'                                stroke: prop.xaxisColor,',
'                                \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                } else {',
'                    // This style is used by Bar and Scatter charts',
'                    if (prop.xaxisLabelsPosition === \'section\') {',
'                        if (obj.type === \'bar\' || obj.type === \'waterfall\') {',
'                            var dataPoints = obj.data.length;',
'                        } else if (obj.type === \'line\'){',
'                            var dataPoints = obj.data[0].length;',
'                        } else if (obj.type === \'scatter\') {',
'                            var dataPoints = prop.xaxisLabels ? prop.xaxisLabels.length : 10;',
'                        }',
'                        // Allow Manual specification of number of tickmarks',
'                        if (typeof prop.xaxisLabelsPositionSectionTickmarksCount === \'number\') {',
'                            dataPoints = prop.xaxisLabelsPositionSectionTickmarksCount;',
'                        }',
'                        for (var i=0; i<dataPoints; ++i) {',
'                            x = prop.gutterLeft + ((i+1) * (obj.graphWidth / dataPoints));',
'                            RG.SVG.create({',
'                                svg: obj.svg,',
'                                parent: obj.svg.all,',
'                                type: \'path\',',
'                                attr: {',
'                                    d: \'M{1} {2} L{3} {4}\'.format(',
'                                        x + 0.001,',
'                                        startY,',
'                                        x,',
'                                        endY',
'                                    ),',
'                                    stroke: prop.xaxisColor,',
'                                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                    \'shape-rendering\': "crispEdges"',
'                                }',
'                            });',
'                        }',
'                    // This style is used by line charts',
'                    } else if (prop.xaxisLabelsPosition === \'edge\') {',
'                        if (typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                            var len = prop.xaxisLabelsPositionEdgeTickmarksCount;',
'                        } else {',
'                            var len = obj.data && obj.data[0] && obj.data[0].length ? obj.data[0].length : 0;',
'                        }',
'                        for (var i=0; i<len; ++i) {',
'                            var gap = ( (obj.graphWidth) / (len - 1)),',
'                                x   = prop.gutterLeft + ((i+1) * gap);',
'                            RG.SVG.create({',
'                                svg: obj.svg,',
'                                parent: obj.svg.all,',
'                                type: \'path\',',
'                                attr: {',
'                                    d: \'M{1} {2} L{3} {4}\'.format(',
'                                        x + 0.001,',
'                                        startY,',
'                                        x,',
'                                        endY',
'                                    ),',
'                                    stroke: prop.xaxisColor,',
'                                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                    \'shape-rendering\': "crispEdges"',
'                                }',
'                            });',
'                        }',
'                    }',
'                }',
'                // Draw an extra tick if the Y axis is not being shown',
'                if (prop.yaxis === false) {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        parent: obj.svg.all,',
'                        type: \'path\',',
'                        attr: {',
'                            d: \'M{1} {2} L{3} {4}\'.format(',
'                                prop.gutterLeft + 0.001,',
'                                startY,',
'                                prop.gutterLeft,',
'                                endY',
'                            ),',
'                            stroke: obj.properties.xaxisColor,',
'                            \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                            \'shape-rendering\': "crispEdges",',
'                            parent: obj.svg.all,',
'                        }',
'                    });',
'                }',
'            }',
'        }',
'        //',
'        // Draw an X axis scale',
'        //',
'        if (prop.xaxisScale) {',
'            if (obj.type === \'scatter\') {',
'                obj.xscale = RG.SVG.getScale({',
'                    object:    obj,',
'                    numlabels: prop.xaxisLabelsCount,',
'                    unitsPre:  prop.xaxisUnitsPre,',
'                    unitsPost: prop.xaxisUnitsPost,',
'                    max:       prop.xaxisMax,',
'                    min:       prop.xaxisMin,',
'                    point:     prop.xaxisPoint,',
'                    round:     prop.xaxisRound,',
'                    thousand:  prop.xaxisThousand,',
'                    decimals:  prop.xaxisDecimals,',
'                    strict:    typeof prop.xaxisMax === \'number\',',
'                    formatter: prop.xaxisFormatter',
'                });',
'                var segment = obj.graphWidth / prop.xaxisLabelsCount',
'                for (var i=0; i<obj.xscale.labels.length; ++i) {',
'                    var x = prop.gutterLeft + (segment * i) + segment + prop.xaxisLabelsOffsetx;',
'                    var y = (obj.height - prop.gutterBottom) + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                    RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text:   obj.xscale.labels[i],',
'                        x:      x,',
'                        y:      y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'                // Add the minimum label if labels are enabled',
'                if (prop.xaxisLabelsCount > 0) {',
'                    var y   = obj.height - prop.gutterBottom + prop.xaxisLabelsOffsety + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10),',
'                        str = RG.SVG.numberFormat({',
'                            object:     obj,',
'                            num:        prop.xaxisMin.toFixed(prop.xaxisDecimals),',
'                            prepend:    prop.xaxisUnitsPre,',
'                            append:     prop.xaxisUnitsPost,',
'                            point:      prop.xaxisPoint,',
'                            thousand:   prop.xaxisThousand,',
'                            formatter:  prop.xaxisFormatter',
'                        });',
'                    var text = RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text: typeof prop.xaxisFormatter === \'function\' ? (prop.xaxisFormatter)(this, prop.xaxisMin) : str,',
'                        x: prop.gutterLeft + prop.xaxisLabelsOffsetx,',
'                        y: y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'            // =========================================================================',
'            } else {',
'                var segment = obj.graphWidth / prop.xaxisLabelsCount,',
'                    scale   = obj.scale;',
'                for (var i=0; i<scale.labels.length; ++i) {',
'                    var x = prop.gutterLeft + (segment * i) + segment + prop.xaxisLabelsOffsetx;',
'                    var y = (obj.height - prop.gutterBottom) + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                    RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text:   obj.scale.labels[i],',
'                        x:      x,',
'                        y:      y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'                // Add the minimum label if labels are enabled',
'                if (prop.xaxisLabelsCount > 0) {',
'                    var y   = obj.height - prop.gutterBottom + prop.xaxisLabelsOffsety + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10),',
'                        str = RG.SVG.numberFormat({',
'                            object:     obj,',
'                            num:        prop.xaxisMin.toFixed(prop.xaxisDecimals),',
'                            prepend:    prop.xaxisUnitsPre,',
'                            append:     prop.xaxisUnitsPost,',
'                            point:      prop.xaxisPoint,',
'                            thousand:   prop.xaxisThousand,',
'                            formatter:  prop.xaxisFormatter',
'                        });',
'                    var text = RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text: typeof prop.xaxisFormatter === \'function\' ? (prop.xaxisFormatter)(this, prop.xaxisMin) : str,',
'                        x: prop.gutterLeft + prop.xaxisLabelsOffsetx,',
'                        y: y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'            }',
'        //',
'        // Draw the X axis labels',
'        //',
'        } else {',
'            if (typeof prop.xaxisLabels === \'object\' && !RG.SVG.isNull(prop.xaxisLabels) ) {',
'                var angle = prop.xaxisTextAngle;',
'                // Loop through the X labels',
'                if (prop.xaxisLabelsPosition === \'section\') {',
'                    var segment = (obj.width - prop.gutterLeft - prop.gutterRight) / prop.xaxisLabels.length;',
'                    for (var i=0; i<prop.xaxisLabels.length; ++i) {',
'                        var x = prop.gutterLeft + (segment / 2) + (i * segment);',
'                        if (obj.scale.max <=0 && obj.scale.min < obj.scale.max) {',
'                            var y = prop.gutterTop - (RG.SVG.ISFF ? 5 : 10)  - (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                            var valign = \'bottom\';',
'                        } else {',
'                            var y = obj.height - prop.gutterBottom + (RG.SVG.ISFF ? 5 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                            var valign = \'top\';',
'                        }',
'                        RG.SVG.text({',
'                            object: obj,',
'                            parent: obj.svg.all,',
'                            text: prop.xaxisLabels[i],',
'                            x: x + prop.xaxisLabelsOffsetx,',
'                            y: y,',
'                            valign: (typeof angle === \'number\' && angle) ? \'center\' : valign,',
'                            halign: (typeof angle === \'number\' && angle) ? \'right\' : \'center\',',
'                            angle: angle,',
'                            tag:    \'labels.xaxis\',',
'                            size:   prop.xaxisTextSize   || prop.textSize,',
'                            italic: prop.xaxisTextItalic || prop.textItalic,',
'                            font:   prop.xaxisTextFont   || prop.textFont,',
'                            bold:   prop.xaxisTextBold   || prop.textBold,',
'                            color:  prop.xaxisTextColor  || prop.textColor',
'                        });',
'                    }',
'                } else if (prop.xaxisLabelsPosition === \'edge\') {',
'                    if (obj.type === \'line\') {',
'                        var hmargin = prop.hmargin;',
'                    } else {',
'                        var hmargin = 0;',
'                    }',
'                    var segment = (obj.graphWidth - hmargin - hmargin) / (prop.xaxisLabels.length - 1);',
'                    for (var i=0; i<prop.xaxisLabels.length; ++i) {',
'                        var x = prop.gutterLeft + (i * segment) + hmargin;',
'                        if (obj.scale.max <= 0 && obj.scale.min < 0) {',
'                            valign = \'bottom\';',
'                            y = prop.gutterTop - (RG.SVG.ISFF ? 5 : 10) - (prop.xaxisTickmarksLength - 5)  - (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety',
'                        } else {',
'                            valign = \'top\';',
'                            y = obj.height - prop.gutterBottom + (RG.SVG.ISFF ? 5 : 10) + (prop.xaxisTickmarksLength - 5) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                        }',
'                        RG.SVG.text({',
'                            object: obj,',
'                            parent: obj.svg.all,',
'                            text: prop.xaxisLabels[i],',
'                            x: x + prop.xaxisLabelsOffsetx,',
'                            y: y,',
'                            valign: (typeof angle === \'number\' && angle) ? \'center\' : valign,',
'                            halign: (typeof angle === \'number\' && angle) ? \'right\' : \'center\',',
'                            angle: angle,',
'                            tag:    \'labels.xaxis\',',
'                            size:   prop.xaxisTextSize   ||  prop.textSize,',
'                            italic: prop.xaxisTextItalic ||  prop.textItalic,',
'                            font:   prop.xaxisTextFont   ||  prop.textFont,',
'                            bold:   prop.xaxisTextBold   ||  prop.textBold,',
'                            color:  prop.xaxisTextColor  ||  prop.textColor',
'                        });',
'                    }',
'                }',
'            }',
'        }',
'    };',
'    //',
'    // Draws an Y axis',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawYAxis = function (obj)',
'    {',
'        var prop = obj.properties;',
'        if (prop.yaxis) {',
'            // The X coordinate that the Y axis is positioned at',
'            if (obj.type === \'hbar\') {',
'                var x = obj.getXCoord(prop.xaxisMin > 0 ? prop.xaxisMin : 0);',
'                if (prop.xaxisMin < 0 && prop.xaxisMax <= 0) {',
'                    x = obj.getXCoord(prop.xaxisMax);',
'                }',
'            } else {',
'                var x = prop.gutterLeft;',
'            }',
'            var axis = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    d: \'M{1} {2} L{3} {4}\'.format(',
'                        x,',
'                        prop.gutterTop,',
'                        x,',
'                        obj.height - prop.gutterBottom',
'                    ),',
'                    stroke: prop.yaxisColor,',
'                    fill: prop.yaxisColor,',
'                    \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                    \'shape-rendering\': "crispEdges",',
'                    \'stroke-linecap\': \'square\'',
'                }',
'            });',
'            if (obj.type === \'hbar\') {',
'                var height = (obj.graphHeight - prop.vmarginTop - prop.vmarginBottom) / prop.yaxisLabels.length,',
'                    y      = prop.gutterTop + prop.vmarginTop,',
'                    len    = prop.yaxisLabels.length,',
'                    startX = obj.getXCoord(0) + (prop.xaxisMin < 0 ? prop.yaxisTickmarksLength : 0),',
'                    endX   = obj.getXCoord(0) - prop.yaxisTickmarksLength;',
'                if (prop.xaxisMin < 0 && prop.xaxisMax <=0) {',
'                    startX = obj.getXCoord(prop.xaxisMax);',
'                    endX   = obj.getXCoord(prop.xaxisMax) + 5;',
'                }',
'                // A custom number of tickmarks',
'                if (typeof prop.yaxisLabelsPositionSectionTickmarksCount === \'number\') {',
'                    len    = prop.yaxisLabelsPositionSectionTickmarksCount;',
'                    height = (obj.graphHeight - prop.vmarginTop - prop.vmarginBottom) / len;',
'                }',
'                //',
'                // Draw the tickmarks',
'                //',
'                if (prop.yaxisTickmarks) {',
'                    for (var i=0; i<len; ++i) {',
'                        // Draw the axis',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    y,',
'                                    endX,',
'                                    y + 0.001',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                        y += height;',
'                    }',
'                    // Draw an extra tick if the X axis position is not zero or',
'                    // if the xaxis is not being shown',
'                    if (prop.xaxis === false) {',
'                        if (obj.type === \'hbar\' && prop.xaxisMin <= 0 && prop.xaxisMax < 0) {',
'                            var startX = obj.getXCoord(prop.xaxisMax);',
'                            var endX   = obj.getXCoord(prop.xaxisMax) + prop.yaxisTickmarksLength;',
'                        } else {',
'                            var startX = obj.getXCoord(0) - prop.yaxisTickmarksLength;',
'                            var endX   = obj.getXCoord(0) + (prop.xaxisMin < 0 ? prop.yaxisTickmarksLength : 0);',
'                        }',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    ma.round(obj.height - prop.gutterBottom - parseFloat(prop.vmarginBottom)),',
'                                    endX,',
'                                    ma.round(obj.height - prop.gutterBottom - parseFloat(prop.vmarginBottom))',
'                                ),',
'                                stroke: obj.properties.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                }',
'            //',
'            // Bar, Line etc types of chart',
'            //',
'            } else {',
'                var height = obj.graphHeight / prop.yaxisLabelsCount,',
'                    y      = prop.gutterTop,',
'                    len    = prop.yaxisLabelsCount,',
'                    startX = prop.gutterLeft,',
'                    endX   = prop.gutterLeft - prop.yaxisTickmarksLength;',
'                // A custom number of tickmarks',
'                if (typeof prop.yaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                    len    = prop.yaxisLabelsPositionEdgeTickmarksCount;',
'                    height = obj.graphHeight / len;',
'                }',
'                //',
'                // Draw the tickmarks',
'                //',
'                if (prop.yaxisTickmarks) {',
'                    for (var i=0; i<len; ++i) {',
'                        // Draw the axis',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    y,',
'                                    endX,',
'                                    y',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                        y += height;',
'                    }',
'                    // Draw an extra tick if the X axis position is not zero or',
'                    //if the xaxis is not being shown',
'                    if (    (prop.yaxisMin !== 0 || prop.xaxis === false)',
'                        && !(obj.scale.min > 0 && obj.scale.max > 0) ) {',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    prop.gutterLeft - prop.yaxisTickmarksLength,',
'                                    obj.height - prop.gutterBottom,',
'                                    prop.gutterLeft,',
'                                    obj.height - prop.gutterBottom - 0.001',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                }',
'            }',
'        }',
'        //',
'        // Draw the Y axis labels',
'        //',
'        if (prop.yaxisScale) {',
'            var segment = (obj.height - prop.gutterTop - prop.gutterBottom) / prop.yaxisLabelsCount;',
'            for (var i=0; i<obj.scale.labels.length; ++i) {',
'                var y = obj.height - prop.gutterBottom - (segment * i) - segment;',
'                RG.SVG.text({',
'                    object: obj,',
'                    parent: obj.svg.all,',
'                    text:   obj.scale.labels[i],',
'                    x:      prop.gutterLeft - 7 - (prop.yaxis ? (prop.yaxisTickmarksLength - 3) : 0) + prop.yaxisLabelsOffsetx,',
'                    y:      y + prop.yaxisLabelsOffsety,',
'                    halign: prop.yaxisLabelsHalign || \'right\',',
'                    valign: prop.yaxisLabelsValign || \'center\',',
'                    tag:    \'labels.yaxis\',',
'                    font:   prop.yaxisTextFont   || prop.textFont,',
'                    size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                    bold:   prop.yaxisTextBold   || prop.textBold,',
'                    italic: prop.yaxisTextItalic || prop.textItalic,',
'                    color:  prop.yaxisTextColor  || prop.textColor',
'                });',
'            }',
'            //',
'            // Add the minimum label',
'            //',
'            var y   = obj.height - prop.gutterBottom,',
'                str = (prop.yaxisUnitsPre + prop.yaxisMin.toFixed(prop.yaxisDecimals).replace(/\\./, prop.yaxisPoint) + prop.yaxisUnitsPost);',
'            var text = RG.SVG.text({',
'                object: obj,',
'                parent: obj.svg.all,',
'                text: typeof prop.yaxisFormatter === \'function\' ? (prop.yaxisFormatter)(this, prop.yaxisMin) : str,',
'                x: prop.gutterLeft - 7 - (prop.yaxis ? (prop.yaxisTickmarksLength - 3) : 0) + prop.yaxisLabelsOffsetx,',
'                y: y + prop.yaxisLabelsOffsety,',
'                halign: \'right\',',
'                valign: \'center\',',
'                tag:    \'labels.yaxis\',',
'                font:   prop.yaxisTextFont   || prop.textFont,',
'                size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                bold:   prop.yaxisTextBold   || prop.textBold,',
'                italic: prop.yaxisTextItalic || prop.textItalic,',
'                color:  prop.yaxisTextColor  || prop.textColor',
'            });',
'        //',
'        // Draw Y axis labels (eg when specific labels are defined or',
'        //the chart is an HBar',
'        //',
'        } else if (prop.yaxisLabels && prop.yaxisLabels.length) {',
'            for (var i=0; i<prop.yaxisLabels.length; ++i) {',
'                var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / prop.yaxisLabels.length,',
'                    y       = prop.gutterTop + (prop.vmarginTop || 0) + (segment * i) + (segment / 2) + prop.yaxisLabelsOffsety,',
'                    x       = prop.gutterLeft - 7 /*- (prop.yaxis ? (prop.yaxisTickmarksLength) : 0)*/ - (prop.yaxisLinewidth || 1) + prop.yaxisLabelsOffsetx,',
'                    halign  = \'right\';',
'                // HBar labels',
'                if (obj.type === \'hbar\' && obj.scale.min < obj.scale.max && obj.scale.max <= 0) {',
'                    halign = \'left\';',
'                    x      = obj.width - prop.gutterRight + 7 + prop.yaxisLabelsOffsetx;',
'                // HBar labels (again?)',
'                } else if (obj.type === \'hbar\' && !prop.yaxisLabelsSpecific) {',
'                    var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / (prop.yaxisLabels.length);',
'                    y = prop.gutterTop + (prop.vmarginTop || 0) + (segment * i) + (segment / 2) + prop.yaxisLabelsOffsety;',
'                // Specific scale',
'                } else {',
'                    var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / (prop.yaxisLabels.length - 1);',
'                    y = obj.height - prop.gutterBottom - (segment * i) + prop.yaxisLabelsOffsety;',
'                }',
'                var text = RG.SVG.text({',
'                    object: obj,',
'                    parent: obj.svg.all,',
'                    text:   prop.yaxisLabels[i] ? prop.yaxisLabels[i] : \'\',',
'                    x:      x,',
'                    y:      y,',
'                    halign: halign,',
'                    valign: \'center\',',
'                    tag:    \'labels.yaxis\',',
'                    font:   prop.yaxisTextFont   || prop.textFont,',
'                    size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                    bold:   typeof prop.yaxisTextBold === \'boolean\' ? prop.yaxisTextBold : prop.textBold,',
'                    italic: typeof prop.yaxisTextItalic === \'boolean\' ? prop.yaxisTextItalic : prop.textItalic,',
'                    color:  prop.yaxisTextColor  || prop.textColor',
'                });',
'            }',
'        }',
'    };',
'    //',
'    // Draws the background',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawBackground = function (obj)',
'    {',
'        var prop = obj.properties;',
'        // Set these properties so that if it doesn\'t exist things don\'t fail',
'        if (typeof prop.variant3dOffsetx !== \'number\') prop.variant3dOffsetx = 0;',
'        if (typeof prop.variant3dOffsety !== \'number\') prop.variant3dOffsety = 0;',
'        if (prop.backgroundColor) {',
'            RG.SVG.create({',
'                svg:  obj.svg,',
'                parent: obj.svg.all,',
'                type: \'rect\',',
'                attr: {',
'                    x: -1 + prop.variant3dOffsetx + prop.gutterLeft,',
'                    y: -1 - prop.variant3dOffsety + prop.gutterTop,',
'                    width: parseFloat(obj.svg.getAttribute(\'width\')) + 2 - prop.gutterLeft - prop.gutterRight,',
'                    height: parseFloat(obj.svg.getAttribute(\'height\')) + 2 - prop.gutterTop - prop.gutterBottom,',
'                    fill: prop.backgroundColor',
'                }',
'            });',
'        }',
'        // Render a background image',
'        // <image xlink:href="firefox.jpg" x="0" y="0" height="50px" width="50px"/>',
'        if (prop.backgroundImage) {',
'            var attr = {',
'                \'xlink:href\': prop.backgroundImage,',
'                //preserveAspectRatio: \'xMidYMid slice\',',
'                preserveAspectRatio: prop.backgroundImageAspect || \'none\',',
'                x: prop.gutterLeft,',
'                y: prop.gutterTop',
'            };',
'            if (prop.backgroundImageStretch) {',
'                attr.x      = prop.gutterLeft + prop.variant3dOffsetx;',
'                attr.y      = prop.gutterTop + prop.variant3dOffsety;',
'                attr.width  = obj.width - prop.gutterLeft - prop.gutterRight;',
'                attr.height = obj.height - prop.gutterTop - prop.gutterBottom;',
'            } else {',
'                if (typeof prop.backgroundImageX === \'number\') {',
'                    attr.x =  prop.backgroundImageX + prop.variant3dOffsetx;',
'                } else {',
'                    attr.x =  prop.gutterLeft + prop.variant3dOffsetx;',
'                }',
'                if (typeof prop.backgroundImageY === \'number\') {',
'                    attr.y =  prop.backgroundImageY + prop.variant3dOffsety;',
'                } else {',
'                    attr.y =  prop.gutterTop + prop.variant3dOffsety;',
'                }',
'                if (typeof prop.backgroundImageW === \'number\') {',
'                    attr.width =  prop.backgroundImageW;',
'                }',
'                if (typeof prop.backgroundImageH === \'number\') {',
'                    attr.height =  prop.backgroundImageH;',
'                }',
'            }',
'            //',
'            // Account for the chart being 3d',
'            //',
'            if (prop.variant === \'3d\') {',
'                attr.x += prop.variant3dOffsetx;',
'                attr.y -= prop.variant3dOffsety;',
'            }',
'            var img = RG.SVG.create({',
'                svg:  obj.svg,',
'                parent: obj.svg.all,',
'                type: \'image\',',
'                attr: attr,',
'                style: {',
'                    opacity: typeof prop.backgroundImageOpacity === \'number\' ? prop.backgroundImageOpacity : 1',
'                }',
'            });',
'            // Set the width and height if necessary',
'            if (!prop.backgroundImageStretch) {',
'                var img2    = new Image();',
'                img2.src    = prop.backgroundImage;',
'                img2.onload = function ()',
'                {',
'                    img.setAttribute(\'width\', typeof prop.backgroundImageW === \'number\' ? prop.backgroundImageW : img2.width);',
'                    img.setAttribute(\'height\', typeof prop.backgroundImageH === \'number\' ? prop.backgroundImageH : img2.height);',
'                };',
'            }',
'        }',
'        if (prop .backgroundGrid) {',
'            var parts = [];',
'            // Add the horizontal lines to the path',
'            if (prop.backgroundGridHlines) {',
'                if (typeof prop.backgroundGridHlinesCount === \'number\') {',
'                    var count = prop.backgroundGridHlinesCount;',
'                } else if (obj.type === \'hbar\' || obj.type === \'bipolar\') {',
'                    if (typeof prop.yaxisLabels === \'object\' && !RG.SVG.isNull(prop.yaxisLabels) && prop.yaxisLabels.length) {',
'                        var count = prop.yaxisLabels.length;',
'                    } else if (obj.type === \'hbar\') {',
'                        var count = obj.data.length;',
'                    } else if (obj.type === \'bipolar\') {',
'                        var count = obj.left.length;',
'                    }',
'                } else {',
'                    var count = prop.yaxisLabelsCount || 5;',
'                }',
'                for (var i=0; i<=count; ++i) {',
'                    parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft + prop.variant3dOffsetx,',
'                        prop.gutterTop + (obj.graphHeight / count) * i - prop.variant3dOffsety,',
'                        obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                        prop.gutterTop + (obj.graphHeight / count) * i - prop.variant3dOffsety',
'                    ));',
'                }',
'                // Add an extra background grid line to the path - this its',
'                // underneath the X axis and shows up if its not there.',
'                parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                ));',
'            }',
'            // Add the vertical lines to the path',
'            if (prop.backgroundGridVlines) {',
'                if (obj.type === \'line\' && RG.SVG.isArray(obj.data[0])) {',
'                    var len = obj.data[0].length;',
'                } else if (obj.type === \'hbar\') {',
'                    var len = prop.xaxisLabelsCount || 10;',
'                } else if (obj.type === \'bipolar\') {',
'                    var len = prop.xaxisLabelsCount || 10;',
'                } else if (obj.type === \'scatter\') {',
'                    var len = (prop.xaxisLabels && prop.xaxisLabels.length) || 10;',
'                } else if (obj.type === \'waterfall\') {',
'                    var len = obj.data[0].length;',
'                } else {',
'                    var len = obj.data.length;',
'                }',
'                var count = typeof prop.backgroundGridVlinesCount === \'number\' ? prop.backgroundGridVlinesCount : len;',
'                if (prop.xaxisLabelsPosition === \'edge\') {',
'                    count--;',
'                }',
'                for (var i=0; i<=count; ++i) {',
'                    parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft + ((obj.graphWidth / count) * i) + prop.variant3dOffsetx,',
'                        prop.gutterTop - prop.variant3dOffsety,',
'                        prop.gutterLeft + ((obj.graphWidth / count) * i) + prop.variant3dOffsetx,',
'                        obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                    ));',
'                }',
'            }',
'            // Add the box around the grid',
'            if (prop.backgroundGridBorder) {',
'                parts.push(\'M{1} {2} L{3} {4} L{5} {6} L{7} {8} z\'.format(',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    prop.gutterTop  - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    prop.gutterTop - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety,',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                ));',
'            }',
'            // Get the dash array if its defined to be dotted or dashed',
'            var dasharray;',
'            if (prop.backgroundGridDashed) {',
'                dasharray = [3,5];',
'            } else if (prop.backgroundGridDotted) {',
'                dasharray = [1,3];',
'            } else if (prop.backgroundGridDashArray) {',
'                dasharray = prop.backgroundGridDashArray;',
'            } else {',
'                dasharray = \'\';',
'            }',
'            // Now draw the path',
'            var grid = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    className: \'rgraph_background_grid\',',
'                    d: parts.join(\' \'),',
'                    stroke: prop.backgroundGridColor,',
'                    fill: \'rgba(0,0,0,0)\',',
'                    \'stroke-width\': prop.backgroundGridLinewidth,',
'                    \'shape-rendering\': "crispEdges",',
'                    \'stroke-dasharray\': dasharray',
'                },',
'                style: {',
'                    pointerEvents: \'none\'',
'                }',
'            });',
'        }',
'        // Draw the title and subtitle',
'        if (obj.type !== \'bipolar\') {',
'            RG.SVG.drawTitle(obj);',
'        }',
'    };',
'    /**',
'    * Returns true/false as to whether the given variable is null or not',
'    * ',
'    * @param mixed arg The argument to check',
'    */',
'    RG.SVG.isNull = function (arg)',
'    {',
'        // must BE DOUBLE EQUALS - NOT TRIPLE',
'        if (arg == null || typeof arg === \'object\' && !arg) {',
'            return true;',
'        }',
'        return false;',
'    };',
'    /**',
'    * Returns an appropriate scale. The return value is actualy an object consisting of:',
'    *  scale.max',
'    *  scale.min',
'    *  scale.scale',
'    * ',
'    * @param  obj object  The graph object',
'    * @param  prop object An object consisting of configuration properties',
'    * @return     object  An object containg scale information',
'    */',
'    RG.SVG.getScale = function (opt)',
'    {',
'        var obj          = opt.object,',
'            prop         = obj.properties,',
'            numlabels    = opt.numlabels,',
'            unitsPre     = opt.unitsPre,',
'            unitsPost    = opt.unitsPost,',
'            max          = Number(opt.max),',
'            min          = Number(opt.min),',
'            strict       = opt.strict,',
'            decimals     = Number(opt.decimals),',
'            point        = opt.point,',
'            thousand     = opt.thousand,',
'            originalMax  = max,',
'            round        = opt.round,',
'            scale        = {max:1,labels:[],values:[]},',
'            formatter    = opt.formatter;',
'        /**',
'        * Special case for 0',
'        * ',
'        * ** Must be first **',
'        */',
'        if (max === 0 && min === 0) {',
'            var max = 1;',
'            for (var i=0; i<numlabels; ++i) {',
'                var label = ((((max - min) / numlabels) * (i + 1)) + min).toFixed(decimals);',
'                scale.labels.push(unitsPre + label + unitsPost);',
'                scale.values.push(parseFloat(label))',
'            }',
'        /**',
'        * Manually do decimals',
'        */',
'        } else if (max <= 1 && !strict) {',
'            var arr = [',
'                1,0.5,',
'                0.10,0.05,',
'                0.010,0.005,',
'                0.0010,0.0005,',
'                0.00010,0.00005,',
'                0.000010,0.000005,',
'                0.0000010,0.0000005,',
'                0.00000010,0.00000005,',
'                0.000000010,0.000000005,',
'                0.0000000010,0.0000000005,',
'                0.00000000010,0.00000000005,',
'                0.000000000010,0.000000000005,',
'                0.0000000000010,0.0000000000005',
'            ], vals = [];',
'            for (var i=0; i<arr.length; ++i) {',
'                if (max > arr[i]) {',
'                    i--;',
'                    break;',
'                }',
'            }',
'            scale.max    = arr[i]',
'            scale.labels = [];',
'            scale.values = [];',
'            for (var j=0; j<numlabels; ++j) {',
'                var value = ((((arr[i] - min) / numlabels) * (j + 1)) + min).toFixed(decimals);',
'                scale.values.push(value);',
'                scale.labels.push(RG.SVG.numberFormat({',
'                    object: obj,',
'                    num: value,',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: prop.yaxisPoint,',
'                    thousand: prop.yaxisThousand,',
'                    formatter: formatter',
'                }));',
'            }',
'        } else if (!strict) {',
'            /**',
'            * Now comes the scale handling for integer values',
'            */',
'            // This accomodates decimals by rounding the max up to the next integer',
'            max = ma.ceil(max);',
'            var interval = ma.pow(10, ma.max(1, Number(String(Number(max) - Number(min)).length - 1)) );',
'            var topValue = interval;',
'            while (topValue < max) {',
'                topValue += (interval / 2);',
'            }',
'            // Handles cases where the max is (for example) 50.5',
'            if (Number(originalMax) > Number(topValue)) {',
'                topValue += (interval / 2);',
'            }',
'            // Custom if the max is greater than 5 and less than 10',
'            if (max <= 10) {',
'                topValue = (Number(originalMax) <= 5 ? 5 : 10);',
'            }',
'            // Added 02/11/2010 to create "nicer" scales',
'            if (obj && typeof(round) == \'boolean\' && round) {',
'                topValue = 10 * interval;',
'            }',
'            scale.max = topValue;',
'            for (var i=0; i<numlabels; ++i) {',
'                var label = RG.SVG.numberFormat({',
'                    object: obj,',
'                    num: ((((i+1) / numlabels) * (topValue - min)) + min).toFixed(decimals),',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: point,',
'                    thousand: thousand,',
'                    formatter: formatter',
'                });',
'                scale.labels.push(label);',
'                scale.values.push(((((i+1) / numlabels) * (topValue - min)) + min).toFixed(decimals));',
'            }',
'        } else if (typeof max === \'number\' && strict) {',
'            /**',
'            * ymax is set and also strict',
'            */',
'            for (var i=0; i<numlabels; ++i) {',
'                scale.labels.push(RG.SVG.numberFormat({',
'                    object: obj,',
'                    formatter: formatter,',
'                    num: ((((i+1) / numlabels) * (max - min)) + min).toFixed(decimals),',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: point,',
'                    thousand: thousand',
'                }));',
'                scale.values.push(',
'                    ((((i+1) / numlabels) * (max - min)) + min).toFixed(decimals)',
'                );',
'            }',
'            // ???',
'            scale.max = max;',
'        }',
'        scale.unitsPre  = unitsPre;',
'        scale.unitsPost = unitsPost;',
'        scale.point     = point;',
'        scale.decimals  = decimals;',
'        scale.thousand  = thousand;',
'        scale.numlabels = numlabels;',
'        scale.round     = Boolean(round);',
'        scale.min       = min;',
'        //',
'        // Convert all of the scale values to numbers',
'        //',
'        for (var i=0; i<scale.values.length; ++i) {',
'            scale.values[i] = parseFloat(scale.values[i]);',
'        }',
'        return scale;',
'    };',
'    /**',
'    * Pads/fills the array',
'    * ',
'    * @param  array arr The array',
'    * @param  int   len The length to pad the array to',
'    * @param  mixed     The value to use to pad the array (optional)',
'    */',
'    RG.SVG.arrayFill = ',
'    RG.SVG.arrayPad  = function (opt)',
'    {',
'        var arr   = opt.array,',
'            len   = opt.length,',
'            value = (typeof opt.value === \'undefined\' ? null : opt.value);',
'        if (arr.length < len) {            ',
'            for (var i=arr.length; i<len; i+=1) {',
'                arr[i] = value;',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * An array sum function',
'    * ',
'    * @param  array arr The  array to calculate the total of',
'    * @return int       The summed total of the arrays elements',
'    */',
'    RG.SVG.arraySum = function (arr)',
'    {',
'        // Allow integers',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        // Account for null',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        var i, sum, len = arr.length;',
'        for(i=0,sum=0;i<len;sum+=arr[i++]);',
'        return sum;',
'    };',
'    /**',
'    * Returns the maximum numeric value which is in an array. This function IS NOT',
'    * recursive',
'    * ',
'    * @param  array arr The array (can also be a number, in which case it\'s returned as-is)',
'    * @param  int       Whether to ignore signs (ie negative/positive)',
'    * @return int       The maximum value in the array',
'    */',
'    RG.SVG.arrayMax = function (arr)',
'    {',
'        var max = null',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            if (typeof arr[i] === \'number\') {',
'                var val = arguments[1] ? ma.abs(arr[i]) : arr[i];',
'                if (typeof max === \'number\') {',
'                    max = ma.max(max, val);',
'                } else {',
'                    max = val;',
'                }',
'            }',
'        }',
'        return max;',
'    };',
'    /**',
'    * Returns the minimum numeric value which is in an array',
'    * ',
'    * @param  array arr The array (can also be a number, in which case it\'s returned as-is)',
'    * @param  int       Whether to ignore signs (ie negative/positive)',
'    * @return int       The minimum value in the array',
'    */',
'    RG.SVG.arrayMin = function (arr)',
'    {',
'        var max = null,',
'            min = null,',
'            ma  = Math;',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            if (typeof arr[i] === \'number\') {',
'                var val = arguments[1] ? ma.abs(arr[i]) : arr[i];',
'                if (typeof min === \'number\') {',
'                    min = ma.min(min, val);',
'                } else {',
'                    min = val;',
'                }',
'            }',
'        }',
'        return min;',
'    };',
'    /**',
'    * Returns the maximum value which is in an array',
'    * ',
'    * @param  array arr The array',
'    * @param  int   len The length to pad the array to',
'    * @param  mixed     The value to use to pad the array (optional)',
'    */',
'    RG.SVG.arrayPad = function (arr, len)',
'    {',
'        if (arr.length < len) {',
'            var val = arguments[2] ? arguments[2] : null;',
'            for (var i=arr.length; i<len; i+=1) {',
'                arr[i] = val;',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * An array sum function',
'    * ',
'    * @param  array arr The  array to calculate the total of',
'    * @return int       The summed total of the arrays elements',
'    */',
'    RG.SVG.arraySum = function (arr)',
'    {',
'        // Allow integers',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        // Account for null',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        var i, sum, len = arr.length;',
'        for(i=0,sum=0;i<len;sum+=arr[i++]);',
'        return sum;',
'    };',
'    /**',
'    * Takes any number of arguments and adds them to one big linear array',
'    * which is then returned',
'    * ',
'    * @param ... mixed The data to linearise. You can strings, booleans, numbers or arrays',
'    */',
'    RG.SVG.arrayLinearize = function ()',
'    {',
'        var arr  = [],',
'            args = arguments',
'        for (var i=0,len=args.length; i<len; ++i) {',
'            if (typeof args[i] === \'object\' && args[i]) {',
'                for (var j=0,len2=args[i].length; j<len2; ++j) {',
'                    var sub = RG.SVG.arrayLinearize(args[i][j]);',
'                    for (var k=0,len3=sub.length; k<len3; ++k) {',
'                        arr.push(sub[k]);',
'                    }',
'                }',
'            } else {',
'                arr.push(args[i]);',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * Takes one off the front of the given array and returns the new array.',
'    * ',
'    * @param array arr The array from which to take one off the front of array ',
'    * ',
'    * @return array The new array',
'    */',
'    RG.SVG.arrayShift = function(arr)',
'    {',
'        var ret = [];',
'        for(var i=1,len=arr.length; i<len; ++i) {',
'            ret.push(arr[i]);',
'        }',
'        return ret;',
'    };',
'    /**',
'    * Reverses the order of an array',
'    * ',
'    * @param array arr The array to reverse',
'    */',
'    RG.SVG.arrayReverse = function (arr)',
'    {',
'        if (!arr) {',
'            return;',
'        }',
'        var newarr=[];',
'        for(var i=arr.length - 1; i>=0; i-=1) {',
'            newarr.push(arr[i]);',
'        }',
'        return newarr;',
'    };',
'    /**',
'    * Makes a clone of an object',
'    * ',
'    * @param obj val The object to clone',
'    */',
'    RG.SVG.arrayClone = function (obj)',
'    {',
'        if(obj === null || typeof obj !== \'object\') {',
'            return obj;',
'        }',
'        if (RG.SVG.isArray(obj)) {',
'            var temp = [];',
'            for (var i=0,len=obj.length;i<len; ++i) {',
'                if (typeof obj[i]  === \'number\') {',
'                    temp[i] = (function (arg) {return Number(arg);})(obj[i]);',
'                } else if (typeof obj[i]  === \'string\') {',
'                    temp[i] = (function (arg) {return String(arg);})(obj[i]);',
'                } else if (typeof obj[i] === \'function\') {',
'                    temp[i] = obj[i];',
'                } else {',
'                    temp[i] = RG.SVG.arrayClone(obj[i]);',
'                }',
'            }',
'        } else if (typeof obj === \'object\') {',
'            var temp = {};',
'            for (var i in obj) {',
'                if (typeof i === \'string\') {',
'                    temp[i] = obj[i];',
'                }',
'            }',
'        }',
'        return temp;',
'    };',
'    //',
'    // Converts an the truthy values to falsey values and vice-versa',
'    //',
'    RG.SVG.arrayInvert = function (arr)',
'    {',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            arr[i] = !arr[i];',
'        }',
'        return arr;',
'    };',
'    //',
'    // An array_trim function that removes the empty elements off',
'    //both ends',
'    //',
'    RG.SVG.arrayTrim = function (arr)',
'    {',
'        var out = [], content = false;',
'        // Trim the start',
'        for (var i=0; i<arr.length; i++) {',
'            if (arr[i]) {',
'                content = true;',
'            }',
'            if (content) {',
'                out.push(arr[i]);',
'            }',
'        }',
'        // Reverse the array and trim the start again',
'        out = RG.SVG.arrayReverse(out);',
'        var out2 = [], content = false ;',
'        for (var i=0; i<out.length; i++) {',
'            if (out[i]) {',
'                content = true;',
'            }',
'            if (content) {',
'                out2.push(out[i]);',
'            }',
'        }',
'        // Now reverse the array and return it',
'        out2 = RG.SVG.arrayReverse(out2);',
'        return out2;',
'    };',
'    /**',
'    * Determines if the given object is an array or not',
'    * ',
'    * @param mixed obj The variable to test',
'    */',
'    RG.SVG.isArray = function (obj)',
'    {',
'        if (obj && obj.constructor) {',
'            var pos = obj.constructor.toString().indexOf(\'Array\');',
'        } else {',
'            return false;',
'        }',
'        return obj != null &&',
'               typeof pos === \'number\' &&',
'               pos > 0 &&',
'               pos < 20;',
'    };',
'    /**',
'    * Returns the absolute value of a number. You can also pass in an',
'    * array and it will run the abs() function on each element. It',
'    * operates recursively so sub-arrays are also traversed.',
'    * ',
'    * @param array arr The number or array to work on',
'    */',
'    RG.SVG.abs = function (value)',
'    {',
'        if (typeof value === \'string\') {',
'            value = parseFloat(value) || 0;',
'        }',
'        if (typeof value === \'number\') {',
'            return ma.abs(value);',
'        }',
'        if (typeof value === \'object\') {',
'            for (i in value) {',
'                if (   typeof i === \'string\'',
'                    || typeof i === \'number\'',
'                    || typeof i === \'object\') {',
'                    value[i] = RG.SVG.abs(value[i]);',
'                }',
'            }',
'            return value;',
'        }',
'        return 0;',
'    };',
'    //',
'    // Formats a number with thousand seperators so it\'s easier to read',
'    //',
'    // @param opt object The options to the function',
'    //',
'    RG.SVG.numberFormat = function (opt)',
'    {',
'        var obj                = opt.object,',
'            prepend            = opt.prepend ? String(opt.prepend) : \'\',',
'            append             = opt.append ? String(opt.append) : \'\',',
'            output             = \'\',',
'            decimal_seperator  = typeof opt.point === \'string\' ? opt.point : \'.\',',
'            thousand_seperator = typeof opt.thousand === \'string\' ? opt.thousand : \',\',',
'            num                = opt.num',
'            decimals_trim      = opt.decimals_trim;',
'        RegExp.$1   = \'\';',
'        if (typeof opt.formatter === \'function\') {',
'            return opt.formatter(obj, num);',
'        }',
'        // Ignore the preformatted version of "1e-2"',
'        if (String(num).indexOf(\'e\') > 0) {',
'            return String(prepend + String(num) + append);',
'        }',
'        // We need then number as a string',
'        num = String(num);',
'        // Take off the decimal part - we re-append it later',
'        if (num.indexOf(\'.\') > 0) {',
'            var tmp = num;',
'            num     = num.replace(/\\.(.*)/, \'\'); // The front part of the number',
'            decimal = tmp.replace(/(.*)\\.(.*)/, \'$2\'); // The decimal part of the number',
'        } else {',
'            decimal = \'\';',
'        }',
'        // Thousand seperator',
'        //var seperator = arguments[1] ? String(arguments[1]) : \',\';',
'        var seperator = thousand_seperator;',
'        /**',
'        * Work backwards adding the thousand seperators',
'        */',
'        var foundPoint;',
'        for (i=(num.length - 1),j=0; i>=0; j++,i--) {',
'            var character = num.charAt(i);',
'            if ( j % 3 == 0 && j != 0) {',
'                output += seperator;',
'            }',
'            /**',
'            * Build the output',
'            */',
'            output += character;',
'        }',
'        /**',
'        * Now need to reverse the string',
'        */',
'        var rev = output;',
'        output = \'\';',
'        for (i=(rev.length - 1); i>=0; i--) {',
'            output += rev.charAt(i);',
'        }',
'        // Tidy up',
'        //output = output.replace(/^-,/, \'-\');',
'        if (output.indexOf(\'-\' + thousand_seperator) == 0) {',
'            output = \'-\' + output.substr((\'-\' + thousand_seperator).length);',
'        }',
'        // Reappend the decimal',
'        if (decimal.length) {',
'            output =  output + decimal_seperator + decimal;',
'            decimal = \'\';',
'            RegExp.$1 = \'\';',
'        }',
'        //',
'        // Trim the decimals if it\'s all zeros',
'        //',
'        if (decimals_trim) {',
'            output = output.replace(/0+$/,\'\');',
'            output = output.replace(/\\.$/,\'\');',
'        }',
'        // Minor bugette',
'        if (output.charAt(0) == \'-\') {',
'            output = output.replace(/-/, \'\');',
'            prepend = \'-\' + prepend;',
'        }',
'        return prepend + output + append;',
'    };',
'    //',
'    // A function that adds text to the chart',
'    //',
'    RG.SVG.text = function (opt)',
'    {',
'        var obj        = opt.object,',
'            parent     = opt.parent || opt.object.svg.all,',
'            size       = typeof opt.size === \'number\' ? opt.size + \'pt\' : (typeof opt.size === \'string\' ? opt.size.replace(/pt$/,\'\') : 12) + \'pt\',',
'            bold       = opt.bold ? \'bold\' : \'normal\',',
'            font       = opt.font ? opt.font : \'sans-serif\',',
'            italic     = opt.italic ? \'italic\' : \'normal\',',
'            halign     = opt.halign,',
'            valign     = opt.valign,',
'            str        = opt.text,',
'            x          = opt.x,',
'            y          = opt.y,',
'            color      = opt.color ? opt.color : \'black\',',
'            background = opt.background || null,',
'            padding    = opt.padding || 0,',
'            link       = opt.link || \'\',',
'            linkTarget = opt.linkTarget || \'_blank\',',
'            events     = (opt.events === false ? false : true),',
'            angle      = opt.angle;',
'        //',
'        // Change numbers to strings',
'        //',
'        if (typeof str === \'number\') {',
'            str = String(str);',
'        }',
'        //',
'        // If the string starts with a carriage return add a unicode non-breaking',
'        // space to the start of it.',
'        //',
'        if (str.substr(0,2) == \'\\r\\n\' || str.substr(0,1) === \'\\n\') {',
'            str = "\\u00A0" + str;',
'        }',
'        // Horizontal alignment',
'        if (halign === \'right\') {',
'            halign = \'end\';',
'        } else if (halign === \'center\' || halign === \'middle\') {',
'            halign = \'middle\';',
'        } else {',
'            halign = \'start\';',
'        }',
'        // Vertical alignment',
'        if (valign === \'top\') {',
'            valign = \'hanging\';',
'        } else if (valign === \'center\' || valign === \'middle\') {',
'            valign = \'central\';',
'            valign = \'middle\';',
'        } else {',
'            valign = \'bottom\';',
'        }',
'        //',
'        // If a link has been specified then the text node should',
'        // be a child of an a node',
'        if (link) {',
'            var a = RGraph.SVG.create({',
'                svg: obj.svg,',
'                type: \'a\',',
'                parent: parent,',
'                attr: {',
'                    \'xlink:href\': link,',
'                    target: linkTarget',
'                }',
'            });',
'        }',
'        //',
'        // Text does not include carriage returns',
'        //',
'        if (str && str.indexOf && str.indexOf("\\n") === -1) {',
'            var text = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: link ? a : opt.parent,',
'                type: \'text\',',
'                attr: {',
'                    tag: opt.tag ? opt.tag : \'\',',
'                    fill: color,',
'                    x: x,',
'                    y: y,',
'                    \'font-size\':         size,',
'                    \'font-weight\':       bold,',
'                    \'font-family\':       font,',
'                    \'font-style\':        italic,',
'                    \'text-anchor\':       halign,',
'                    \'dominant-baseline\': valign',
'                }',
'            });',
'            var textNode = document.createTextNode(str);',
'            text.appendChild(textNode);',
'            if (!events) {',
'                text.style.pointerEvents = \'none\';',
'            }',
'        //',
'        // Includes carriage returns',
'        //',
'        } else if (str && str.indexOf) {',
'            // Measure the text',
'            var dimensions = RG.SVG.measureText({',
'                text: \'My\',',
'                bold: bold,',
'                font: font,',
'                size: size',
'            });',
'            var lineHeight = dimensions[1];',
'            str = str.split(/\\r?\\n/);',
'            //',
'            // Account for the carriage returns and move the text',
'            // up as required',
'            //',
'            if (valign === \'bottom\') {',
'                y -= str.length * lineHeight;',
'            }',
'            if (valign === \'center\' || valign === \'middle\') {',
'                y -= (str.length * lineHeight) / 2;',
'            }',
'            var text = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: link ? a : opt.parent,',
'                type: \'text\',',
'                attr: {',
'                    tag: opt.tag ? opt.tag : \'\',',
'                    fill: color,',
'                    x: x,',
'                    y: y,',
'                    \'font-size\':         size,',
'                    \'font-weight\':       bold,',
'                    \'font-family\':       font,',
'                    \'font-style\':        italic,',
'                    \'text-anchor\':       halign,',
'                    \'dominant-baseline\': valign',
'                }',
'            });',
'            if (!events) {',
'                text.style.pointerEvents = \'none\';',
'            }',
'            for (var i=0; i<str.length; ++i) {',
'                var tspan = RG.SVG.create({',
'                    svg: obj.svg,',
'                    parent: text,',
'                    type: \'tspan\',',
'                    attr: {',
'                        x: x,',
'                        dy: dimensions ? (dimensions[1] * (i ? 1 : 0)) + 3 : 0',
'                    }',
'                });',
'                var textNode = document.createTextNode(str[i]);',
'                tspan.appendChild(textNode);',
'                if (!events) {',
'                    tspan.style.pointerEvents = \'none\';',
'                }',
'                var dimensions = RG.SVG.measureText({',
'                    text: str[i],',
'                    bold: bold,',
'                    font: font,',
'                    size: parseInt(size)',
'                });',
'            }',
'        }',
'        // Now add the rotation if necessary',
'        if (typeof angle === \'number\' && angle && text) {',
'            text.setAttribute(\'x\', 0);',
'            text.setAttribute(\'y\', 0);',
'            text.setAttribute(\'transform\', \'translate({1} {2}) rotate({3})\'.format(x, y, -1 * angle));',
'        }',
'        //',
'        // Add a background color if specified',
'        //',
'        if (typeof background === \'string\') {',
'            var parent = link ? a : parent;',
'            var bbox = text.getBBox(),',
'                rect = RG.SVG.create({',
'                    svg:    obj.svg,',
'                    parent: parent,',
'                    type:   \'rect\',',
'                    attr: {',
'                        x:      bbox.x - padding,',
'                        y:      bbox.y - padding,',
'                        width:  bbox.width + (padding * 2),',
'                        height: bbox.height + (padding * 2),',
'                        fill:   background',
'                    }',
'                });',
'                if (!events) {',
'                    rect.style.pointerEvents = \'none\';',
'                }',
'            text.parentNode.insertBefore(rect, text);',
'        }',
'        if (RG.SVG.ISIE && (valign === \'hanging\') && text) {',
'            text.setAttribute(\'y\', y + (text.scrollHeight / 2));',
'        } else if (RG.SVG.ISIE && valign === \'middle\') {',
'            text.setAttribute(\'y\', y + (text.scrollHeight / 3));',
'        }',
'        if (RG.SVG.ISFF && text) {',
'            Y = y + (text.scrollHeight / 3);',
'        }',
'        return text;',
'    };',
'    //',
'    // Helps you get hold of the SPAN tag nodes that hold the text on the chart',
'    //',
'    RG.SVG.text.find = function (opt)',
'    {',
'        // Search criteria should include:',
'        //  o text (literal string and regex)',
'        if (typeof opt.object === \'object\' && opt.object.isRGraph) {',
'            var svg = opt.object.svg;',
'        } else if (typeof opt.svg === \'object\' && opt.svg.all) {',
'            var svg = opt.svg;',
'        }',
'        // Look for text nodes based on the text',
'        var nodes = svg.getElementsByTagName(\'text\');',
'        var found = [];',
'        for (var i=0,len=nodes.length; i<len; ++i) {',
'            var text = false,',
'                tag  = false;',
'            // Exact match or regex on the text',
'            if (typeof opt.text === \'string\' && nodes[i].innerHTML === opt.text) {',
'                text = true;',
'            } else if (typeof opt.text === \'object\' && nodes[i].innerHTML.match(opt.text)) {',
'                text = true;',
'            } else if (typeof opt.text === \'undefined\') {',
'                text = true;',
'            }',
'            // Exact match or regex on the tag',
'            if (typeof opt.tag === \'string\' && nodes[i].getAttribute(\'tag\') === opt.tag) {',
'                tag = true;',
'            } else if (typeof opt.tag === \'object\' && nodes[i].getAttribute(\'tag\').match(opt.tag)) {',
'                tag = true;',
'            } else if (typeof opt.tag === \'undefined\') {',
'                tag = true;',
'            }',
'            // Did all of the conditions pass?',
'            if (text === true && tag === true) {',
'                found.push(nodes[i])',
'            }',
'        }',
'        return found;',
'    };',
'    //',
'    // Creates a UID that is applied to the object',
'    //',
'    RG.SVG.createUID = function ()',
'    {',
'        return \'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\'.replace(/[xy]/g, function(c)',
'        {',
'            var r = ma.random()*16|0, v = c == \'x\' ? r : (r&0x3|0x8);',
'            return v.toString(16);',
'        });',
'    };',
'    //',
'    // Determines if the SVG DIV container is fixed',
'    //',
'    RG.SVG.isFixed = function (svg)',
'    {',
'        var obj = svg.parentNode,',
'            i   = 0;',
'        while (obj && obj.tagName.toLowerCase() != \'body\' && i < 99) {',
'            if (obj.style.position === \'fixed\') {',
'                return obj;',
'            }',
'            obj = obj.offsetParent;',
'        }',
'        return false;',
'    };',
'    /**',
'    * Sets an object in the RGraph registry',
'    * ',
'    * @param string name The name of the value to set',
'    */',
'    RG.SVG.REG.set = function (name, value)',
'    {',
'        RG.SVG.REG.store[name] = value;',
'        return value;',
'    };',
'    /**',
'    * Gets an object from the RGraph registry',
'    * ',
'    * @param string name The name of the value to fetch',
'    */',
'    RG.SVG.REG.get = function (name)',
'    {',
'        return RG.SVG.REG.store[name];',
'    };',
'    /**',
'    * Removes white-space from the start aqnd end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.trim = function (str)',
'    {',
'        return RG.SVG.ltrim(RG.SVG.rtrim(str));',
'    };',
'    /**',
'    * Trims the white-space from the start of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.ltrim = function (str)',
'    {',
'        return str.replace(/^(\\s|\\0)+/, \'\');',
'    };',
'    /**',
'    * Trims the white-space off of the end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.rtrim = function (str)',
'    {',
'        return str.replace(/(\\s|\\0)+$/, \'\');',
'    };',
'    //',
'    // Hides the currently shown tooltip',
'    //',
'    RG.SVG.hideTooltip = function ()',
'    {',
'        var tooltip = RG.SVG.REG.get(\'tooltip\');',
'        if (tooltip && tooltip.parentNode /*&& (!uid || uid == tooltip.__canvas__.uid)*/) {',
'            tooltip.parentNode.removeChild(tooltip);',
'            tooltip.style.display = \'none\';                ',
'            tooltip.style.visibility = \'hidden\';',
'            RG.SVG.REG.set(\'tooltip\', null);',
'        }',
'        if (tooltip && tooltip.__object__) {',
'            RG.SVG.removeHighlight(tooltip.__object__);',
'        }',
'    };',
'    //',
'    // Creates a shadow',
'    //',
'    RG.SVG.setShadow = function (options)',
'    {',
'        var obj     = options.object,',
'            offsetx = options.offsetx  || 0,',
'            offsety = options.offsety || 0,',
'            blur    = options.blur || 0,',
'            opacity = options.opacity || 0,',
'            id      = options.id;',
'        var filter = RG.SVG.create({',
'            svg: obj.svg,',
'            parent: obj.svg.defs,',
'            type: \'filter\',',
'            attr: {',
'                id: id,',
'                 width: "130%",',
'                 height: "130%"',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feOffset\',',
'            attr: {',
'                result: \'offOut\',',
'                \'in\': \'SourceGraphic\',',
'                dx: offsetx,',
'                dy: offsety',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feColorMatrix\',',
'            attr: {',
'                result: \'matrixOut\',',
'                \'in\': \'offOut\',',
'                type: \'matrix\',',
'                values: \'0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 {1} 0\'.format(',
'                    opacity',
'                )',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feGaussianBlur\',',
'            attr: {',
'                result: \'blurOut\',',
'                \'in\': \'matrixOut\',',
'                stdDeviation: blur',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feBlend\',',
'            attr: {',
'                \'in\': \'SourceGraphic\',',
'                \'in2\': \'blurOut\',',
'                mode: \'normal\'',
'            }',
'        });',
'    };',
'    /**',
'    * Takes a sequential index and returns the group/index variation of it. Eg if you have a',
'    * sequential index from a grouped bar chart this function can be used to convert that into',
'    * an appropriate group/index combination',
'    * ',
'    * @param nindex number The sequential index',
'    * @param data   array  The original data (which is grouped)',
'    * @return              The group/index information',
'    */',
'    RG.SVG.sequentialIndexToGrouped = function (index, data)',
'    {',
'        var group         = 0,',
'            grouped_index = 0;',
'        while (--index >= 0) {',
'            if (RG.SVG.isNull(data[group])) {',
'                group++;',
'                grouped_index = 0;',
'                continue;',
'            }',
'            // Allow for numbers as well as arrays in the dataset',
'            if (typeof data[group] == \'number\') {',
'                group++',
'                grouped_index = 0;',
'                continue;',
'            }',
'            grouped_index++;',
'            if (grouped_index >= data[group].length) {',
'                group++;',
'                grouped_index = 0;',
'            }',
'        }',
'        return [group, grouped_index];',
'    };',
'    //',
'    // This is the reverse of the above function - converting',
'    // group/index to a sequential index',
'    //',
'    // @return number The sequential index',
'    //',
'    RG.SVG.groupedIndexToSequential = function (opt)',
'    {',
'        var dataset = opt.dataset,',
'            index   = opt.index,',
'            obj     = opt.object;',
'        for (var i=0,seq=0; i<=dataset; ++i) {',
'            for (var j=0; j<obj.data[dataset].length; ++j) {',
'                if (i === dataset && j === index) {',
'                    return seq;',
'                }',
'                seq++;',
'            }',
'        }',
'        return seq;',
'    };',
'    //',
'    // This function converts coordinates into the type understood by',
'    // SVG for drawing arcs',
'    //',
'    RG.SVG.TRIG.toCartesian = function (options)',
'    {',
'        return {',
'            x: options.cx + (options.r * ma.cos(options.angle)),',
'            y: options.cy + (options.r * ma.sin(options.angle))',
'        };',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @patam object options The options/arg to the function',
'    //',
'    // NB ** Still used by the Pie chart and the semi-circular Meter **',
'    //',
'    RG.SVG.TRIG.getArcPath = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= 1.57;',
'        options.end   -= 1.57;',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start}',
'        );',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = options.end - options.start;',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        if (options.anticlockwise && diff > 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'0\';',
'        } else if (options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'0\';',
'        } else if (!options.anticlockwise && diff > 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'1\';',
'        } else if (!options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'1\';',
'        }',
'        if (options.start > options.end && options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'0\';',
'        }',
'        if (options.start > options.end && options.anticlockwise && diff > 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'1\';',
'        }',
'        if (typeof options.moveto === \'boolean\' && options.moveto === false) {',
'            var d = [',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "M", start.x, start.y, ',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @patam object options The options/arg to the function',
'    //',
'    RG.SVG.TRIG.getArcPath2 = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= 1.57;',
'        options.end   -= 1.57;',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start',
'        });',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = ma.abs(options.end - options.start);',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        //TODO Put various options here for the correct combination of flags to use',
'        if (!options.anticlockwise) {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'1\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'1\';',
'            }',
'        } else {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'0\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'0\';',
'            }',
'        }',
'        if (typeof options.lineto === \'boolean\' && options.lineto === false) {',
'            var d = [',
'                "M", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "M", options.cx, options.cy,',
'                "L", start.x, start.y, ',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @param object options The options/arg to the function',
'    //',
'    RG.SVG.TRIG.getArcPath3 = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= (ma.PI / 2);',
'        options.end   -= (ma.PI / 2);',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start',
'        });',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = ma.abs(options.end - options.start);',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        //TODO Put various options here for the correct combination of flags to use',
'        if (!options.anticlockwise) {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'1\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'1\';',
'            }',
'        } else {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'0\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'0\';',
'            }',
'        }',
'        if (typeof options.lineto === \'boolean\' && options.lineto === false) {',
'            var d = [',
'                "M", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "L", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    /**',
'    * This function gets the end point (X/Y coordinates) of a given radius.',
'    * You pass it the center X/Y and the radius and this function will return',
'    * the endpoint X/Y coordinates.',
'    * ',
'    * @param number cx    The center X coord',
'    * @param number cy    The center Y coord',
'    * @param number r     The length of the radius',
'    * @param number angle The anle to use',
'    */',
'    RG.SVG.TRIG.getRadiusEndPoint = function (opt)',
'    {',
'        // Allow for two arguments style',
'        if (arguments.length === 1) {',
'            var angle = opt.angle,',
'                r     = opt.r;',
'        } else if (arguments.length === 4) {',
'            var angle = arguments[0],',
'                r     = arguments[1];',
'        }',
'        var x = ma.cos(angle) * r,',
'            y = ma.sin(angle) * r;',
'        return [x, y];',
'    };',
'    /**',
'    * This function draws the title. This function also draws the subtitle.',
'    */',
'    RG.SVG.drawTitle = function (obj)',
'    {',
'        var prop                   = obj.properties,',
'            valign                 = \'bottom\',',
'            originalTitleX         = prop.titleX,',
'            originalTitleY         = prop.titleY,',
'            originalTitleSubtitleX = prop.titleSubtitleX,',
'            originalTitleSubtitleY = prop.titleSubtitleY;',
'        if (typeof originalTitleX === \'string\')         originalTitleX.replace(/^\\+/,\'\');',
'        if (typeof originalTitleY === \'string\')         originalTitleY.replace(/^\\+/,\'\');',
'        if (typeof originalTitleSubtitleX === \'string\') originalTitleSubtitleX.replace(/^\\+/,\'\');',
'        if (typeof originalTitleSubtitleY === \'string\') originalTitleSubtitleY.replace(/^\\+/,\'\');',
'        //',
'        // The Pie chart title should default to being above the centerx',
'        //',
'        if (obj.type === \'pie\') {',
'            if (RG.SVG.isNull(prop.titleX)) {',
'                prop.titleX         = obj.centerx;',
'                prop.titleSubtitleX = obj.centerx;',
'            }',
'            if (RG.SVG.isNull(prop.titleY)) {',
'                prop.titleY = obj.centery - obj.radius - 10;',
'            }',
'        }',
'        if (obj.scale && obj.scale.max <= 0 && obj.scale.min < 0 && typeof prop.titleY !== \'number\' && obj.type !== \'hbar\') {',
'            prop.titleY = obj.height - prop.gutterBottom + 10;',
'            var positionBottom = true;',
'            valign = \'top\';',
'        } else if (typeof prop.titleY !== \'number\') {',
'            var positionBottom = false;',
'            prop.titleY = prop.gutterTop - 10;',
'            valign      = \'bottom\';',
'            // Account for the key',
'            if (!RG.SVG.isNull(prop.key)) {',
'                prop.titleY -= (2 * (prop.keyTextSize || prop.textSize));',
'            }',
'        }',
'        // If a subtitle is specified move the title up a bit in',
'        // order to accommodate it',
'        if (prop.titleSubtitle && typeof prop.titleSubtitleY !== \'number\' && !positionBottom) {',
'            prop.titleY = prop.titleY - (prop.titleSubtitleSize * 1.5);',
'        }',
'        // Work out the subtitle size',
'        prop.titleSubTitleSize = prop.titleSubTitleSize || prop.textSize;',
'        // Work out the subtitle Y position',
'        prop.titleSubtitleY = prop.titleSubtitleY || prop.titleY + 18;',
'        if (positionBottom && typeof prop.titleSubtitleY !== \'number\') {',
'            prop.titleSubtitleY = prop.titleY + 26;',
'        }',
'        // Draw the title',
'        if (prop.title) {',
'            var x = typeof prop.titleX === \'number\' ? prop.titleX + (prop.variant3dOffsetx || 0) : prop.gutterLeft + (obj.graphWidth / 2) + (prop.variant3dOffsetx || 0);',
'            var y = prop.titleY + (prop.variant3dOffsety || 0);',
'            // Add any adjustment to the positioning',
'            if (typeof originalTitleX === \'string\') {',
'                x += parseFloat(originalTitleX);',
'            }',
'            if (typeof originalTitleY === \'string\') {',
'                y += parseFloat(originalTitleY);',
'            }',
'            RG.SVG.text({',
'                object: obj,',
'                svg:    obj.svg,',
'                parent: obj.svg.all,',
'                tag:    \'title\',',
'                text:   prop.title.toString(),',
'                size:   prop.titleSize   || (prop.textSize + 4) || 16,',
'                x:      x,',
'                y:      y,',
'                halign: prop.titleHalign || \'center\',',
'                valign: prop.titleValign || valign,',
'                color:  prop.titleColor  || prop.textColor || \'black\',',
'                bold:   prop.titleBold   || false,',
'                italic: prop.titleItalic || false,',
'                font:   prop.titleFont   || prop.textFont || \'Arial\'',
'            });',
'        }',
'        // Draw the subtitle',
'        if (typeof prop.title === \'string\' && typeof prop.titleSubtitle === \'string\') {',
'            // By default, the X and Y coordinates place the subtitle',
'            // underneath the title. Though the y coord is now adjusted',
'            // so that the subtitle sits underneath the title.',
'            y += (prop.titleSubtitleSize * 1.5);',
'            // Is the subtitleX or subtitleY are numbers then just use those',
'            if (typeof originalTitleSubtitleX === \'number\') {',
'                x = originalTitleSubtitleX;',
'            }',
'            if (typeof originalTitleSubtitleY === \'number\') {',
'                y = originalTitleSubtitleY;',
'            }',
'            // Add the subtitles adjustment to the position',
'            if (typeof originalTitleSubtitleX === \'string\') {',
'                x += parseFloat(originalTitleSubtitleX);',
'            }',
'            // Add the subtitles adjustment to the position',
'            if (typeof originalTitleSubtitleY === \'string\') {',
'                y += parseFloat(originalTitleSubtitleY);',
'            }',
'            RG.SVG.text({',
'                object: obj,',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                tag:    \'subtitle\',',
'                text:   prop.titleSubtitle,',
'                size:   prop.titleSubtitleSize,',
'                x:      x,',
'                y:      y,',
'                halign: prop.titleSubtitleHalign || \'center\',',
'                valign: prop.titleSubtitleValign || valign,',
'                color:  prop.titleSubtitleColor  || prop.textColor || \'#aaa\',',
'                bold:   prop.titleSubtitleBold   || false,',
'                italic: prop.titleSubtitleItalic || false,',
'                font:   prop.titleSubtitleFont   || prop.textFont || \'Arial\'',
'            });',
'        }',
'    };',
'    /**',
'    * Removes white-space from the start and end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.trim = function (str)',
'    {',
'        return RG.SVG.ltrim(RG.SVG.rtrim(str));',
'    };',
'    /**',
'    * Trims the white-space from the start of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.ltrim = function (str)',
'    {',
'        return String(str).replace(/^(\\s|\\0)+/, \'\');',
'    };',
'    /**',
'    * Trims the white-space off of the end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.rtrim = function (str)',
'    {',
'        return String(str).replace(/(\\s|\\0)+$/, \'\');',
'    };',
'    /**',
'    * This parses a single color value',
'    */',
'    RG.SVG.parseColorLinear = function (opt)',
'    {',
'        var obj   = opt.object,',
'            color = opt.color;',
'        if (!color || typeof color !== \'string\') {',
'            return color;',
'        }',
'        if (color.match(/^gradient\\((.*)\\)$/i)) {',
'            var parts = RegExp.$1.split(\':\'),',
'                diff  = 1 / (parts.length - 1);',
'            if (opt && opt.direction && opt.direction === \'horizontal\') {',
'                var grad = RG.SVG.create({',
'                    type: \'linearGradient\',',
'                    parent: obj.svg.defs,',
'                    attr: {',
'                        id: \'RGraph-linear-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                        x1: opt.start || 0,',
'                        x2: opt.end || \'100%\',',
'                        y1: 0,',
'                        y2: 0,',
'                        gradientUnits: "userSpaceOnUse"',
'                    }',
'                });',
'            } else {',
'                var grad = RG.SVG.create({',
'                    type: \'linearGradient\',',
'                    parent: obj.svg.defs,',
'                    attr: {',
'                        id: \'RGraph-linear-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                        x1: 0,',
'                        x2: 0,',
'                        y1: opt.start || 0,',
'                        y2: opt.end || \'100%\',',
'                        gradientUnits: "userSpaceOnUse"',
'                    }',
'                });',
'            }',
'            // Add the first color stop',
'            var stop = RG.SVG.create({',
'                type: \'stop\',',
'                parent: grad,',
'                attr: {',
'                    offset: \'0%\',',
'                    \'stop-color\': RG.SVG.trim(parts[0])',
'                }',
'            });',
'            // Add the rest of the color stops',
'            for (var j=1,len=parts.length; j<len; ++j) {',
'                RG.SVG.create({',
'                    type: \'stop\',',
'                    parent: grad,',
'                    attr: {',
'                        offset: (j * diff * 100) + \'%\',',
'                        \'stop-color\': RG.SVG.trim(parts[j])',
'                    }',
'                });',
'            }',
'        }',
'        color = grad ? \'url(#RGraph-linear-gradient-\' + obj.uid + \'-\' + (obj.gradientCounter++) + \')\' : color;',
'        return color;',
'    };',
'    /**',
'    * This parses a single color value',
'    */',
'    RG.SVG.parseColorRadial = function (opt)',
'    {',
'        var obj   = opt.object,',
'            color = opt.color;',
'        if (!color || typeof color !== \'string\') {',
'            return color;',
'        }',
'        if (color.match(/^gradient\\((.*)\\)$/i)) {',
'            var parts = RegExp.$1.split(\':\'),',
'                diff  = 1 / (parts.length - 1);',
'            var grad = RG.SVG.create({',
'                type: \'radialGradient\',',
'                parent: obj.svg.defs,',
'                attr: {',
'                    id: \'RGraph-radial-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                    gradientUnits: opt.gradientUnits || \'userSpaceOnUse\',',
'                    cx: opt.cx || obj.centerx,',
'                    cy: opt.cy || obj.centery,',
'                    fx: opt.fx || obj.centerx,',
'                    fy: opt.fy || obj.centery,',
'                    r:  opt.r  || obj.radius',
'                }',
'            });',
'            // Add the first color stop',
'            var stop = RG.SVG.create({',
'                type: \'stop\',',
'                parent: grad,',
'                attr: {',
'                    offset: \'0%\',',
'                    \'stop-color\': RG.SVG.trim(parts[0])',
'                }',
'            });',
'            // Add the rest of the color stops',
'            for (var j=1,len=parts.length; j<len; ++j) {',
'                RG.SVG.create({',
'                    type: \'stop\',',
'                    parent: grad,',
'                    attr: {',
'                        offset: (j * diff * 100) + \'%\',',
'                        \'stop-color\': RG.SVG.trim(parts[j])',
'                    }',
'                });',
'            }',
'        }',
'        color = grad ? \'url(#RGraph-radial-gradient-\' + obj.uid + \'-\' + (obj.gradientCounter++) + \')\' : color;',
'        return color;',
'    };',
'    /**',
'    * Reset all of the color values to their original values',
'    * ',
'    * @param object',
'    */',
'    RG.SVG.resetColorsToOriginalValues = function (opt)',
'    {',
'        var obj = opt.object;',
'        if (obj.originalColors) {',
'            // Reset the colors to their original values',
'            for (var j in obj.originalColors) {',
'                if (typeof j === \'string\') {',
'                    obj.properties[j] = RG.SVG.arrayClone(obj.originalColors[j]);',
'                }',
'            }',
'        }',
'        /**',
'        * If the function is present on the object to reset specific',
'        * colors - use that',
'        */',
'        if (typeof obj.resetColorsToOriginalValues === \'function\') {',
'            obj.resetColorsToOriginalValues();',
'        }',
'        // Hmmm... Should this be necessary? I don\'t think it will',
'        // do any harm to leave it in.',
'        obj.originalColors = {};',
'        // Reset the colorsParsed flag so that they\'re parsed for gradients again',
'        obj.colorsParsed = false;',
'        // Reset the gradient counter',
'        obj.gradientCounter = 1;',
'    };',
'    //',
'    // Clear the SVG tag by deleting all of its',
'    // child nodes',
'    //',
'    // @param object svg The SVG tag (same as what is returned',
'    //                   by document.getElementById() )',
'    //',
'    RG.SVG.clear = function (svg)',
'    {',
'        // Clear all the layer nodes',
'        for (var i=1; i<=100; ++i) {',
'            if (svg[\'background\' + i]) {',
'                // Clear all the nodes within this group',
'                while (svg[\'background\' + i].lastChild) {',
'                    svg[\'background\' + i].removeChild(svg[\'background\' + i].lastChild);',
'                }',
'            } else {',
'                break;',
'            }',
'        }',
'        // Clear all the node within the "all" group',
'        while (svg.all.lastChild) {',
'            svg.all.removeChild(svg.all.lastChild);',
'        }',
'        // Clear Line chart hotspots',
'        if (svg.all.line_tooltip_hotspots) {',
'            while (svg.all.line_tooltip_hotspots.lastChild) {',
'                svg.all.line_tooltip_hotspots.removeChild(svg.all.line_tooltip_hotspots.lastChild);',
'            }',
'        }',
'    };',
'    /**',
'    * Adds an event listener',
'    * ',
'    * @param object obj   The graph object',
'    * @param string event The name of the event, eg ontooltip',
'    * @param object func  The callback function',
'    */',
'    RG.SVG.addCustomEventListener = function (obj, name, func)',
'    {',
'        // Initialise the events array if necessary',
'        if (typeof RG.SVG.events[obj.uid] === \'undefined\') {',
'            RG.SVG.events[obj.uid] = [];',
'        }',
'        // Prepend "on" if necessary',
'        if (name.substr(0, 2) !== \'on\') {',
'            name = \'on\' + name;',
'        }',
'        RG.SVG.events[obj.uid].push({',
'            object: obj,',
'            event:  name,',
'            func:   func',
'        });',
'        return RG.SVG.events[obj.uid].length - 1;',
'    };',
'    /**',
'    * Used to fire one of the RGraph custom events',
'    * ',
'    * @param object obj   The graph object that fires the event',
'    * @param string event The name of the event to fire',
'    */',
'    RG.SVG.fireCustomEvent = function (obj, name)',
'    {',
'        if (obj && obj.isRGraph) {',
'            var uid = obj.uid;',
'            if (   typeof uid === \'string\'',
'                && typeof RG.SVG.events === \'object\'',
'                && typeof RG.SVG.events[uid] === \'object\'',
'                && RG.SVG.events[uid].length > 0) {',
'                for(var j=0,len=RG.SVG.events[uid].length; j<len; ++j) {',
'                    if (RG.SVG.events[uid][j] && RG.SVG.events[uid][j].event === name) {',
'                        RG.SVG.events[uid][j].func(obj);',
'                    }',
'                }',
'            }',
'        }',
'    };',
'    /**',
'    * Clears all the custom event listeners that have been registered',
'    * ',
'    * @param string optional Limits the clearing to this object UID',
'    */',
'    RG.SVG.removeAllCustomEventListeners = function ()',
'    {',
'        var uid = arguments[0];',
'        if (uid && RG.SVG.events[uid]) {',
'            RG.SVG.events[uid] = {};',
'        } else {',
'            RG.SVG.events = [];',
'        }',
'    };',
'    /**',
'    * Clears a particular custom event listener',
'    * ',
'    * @param object obj The graph object',
'    * @param number i   This is the index that is return by .addCustomEventListener()',
'    */',
'    RG.SVG.removeCustomEventListener = function (obj, i)',
'    {',
'        if (   typeof RG.SVG.events === \'object\'',
'            && typeof RG.SVG.events[obj.uid] === \'object\'',
'            && typeof RG.SVG.events[obj.uid][i] === \'object\') {',
'            RG.SVG.events[obj.uid][i] = null;',
'        }',
'    };',
'    //',
'    // Removes the highlight from the chart added by tooltips (possibly others too)',
'    //',
'    RG.SVG.removeHighlight = function (obj)',
'    {',
'        var highlight = RG.SVG.REG.get(\'highlight\');',
'        if (highlight && RG.SVG.isArray(highlight) && highlight.length) {',
'            for (var i=0,len=highlight.length; i<len; ++i) {',
'                if (highlight[i].parentNode) {',
'                    //obj.svg.removeChild(highlight[i]);',
'                    highlight[i].parentNode.removeChild(highlight[i]);',
'                }',
'            }',
'        } else if (highlight && highlight.parentNode) {',
'            if (obj.type === \'scatter\') {',
'                highlight.setAttribute(\'fill\', \'transparent\');',
'            } else {',
'                highlight.parentNode.removeChild(highlight);',
'            }',
'        }',
'    };',
'    //',
'    // Removes the highlight from the chart added by tooltips (possibly others too)',
'    //',
'    RG.SVG.redraw = function ()',
'    {',
'        if (arguments.length === 1) {',
'            var svg = arguments[0];',
'            RG.SVG.clear(svg);',
'            var objects = RG.SVG.OR.get(\'id:\' + svg.parentNode.id);',
'            for (var i=0,len=objects.length; i<len; ++i) {',
'                // Reset the colors to the original values',
'                RG.SVG.resetColorsToOriginalValues({object: objects[i]});',
'                objects[i].draw();',
'            }',
'        } else {',
'            var tags = RG.SVG.OR.tags();',
'            for (var i in tags) {',
'                RG.SVG.redraw(tags[i]);',
'            }',
'        }',
'    };',
'    //',
'    // A better, more flexible, date parsing function',
'    //',
'    //@param  string str The string to parse',
'    //@return number     A number, as returned by Date.parse()',
'    //',
'    RG.SVG.parseDate = function (str)',
'    {',
'        var d = new Date();',
'        // Initialise the default values',
'        var defaults = {',
'            seconds: \'00\',',
'            minutes: \'00\',',
'            hours: \'00\',',
'            date: d.getDate(),',
'            month: d.getMonth() + 1,',
'            year: d.getFullYear()',
'        };',
'        // Create the months array for turning textual months back to numbers',
'        var months       = [\'january\',\'february\',\'march\',\'april\',\'may\',\'june\',\'july\',\'august\',\'september\',\'october\',\'november\',\'december\'],',
'            months_regex = months.join(\'|\');',
'        for (var i=0; i<months.length; ++i) {',
'            months[months[i]] = i;',
'            months[months[i].substring(0,3)] = i;',
'            months_regex = months_regex + \'|\' + months[i].substring(0,3);',
'        }',
'        // These are the seperators allowable for d/m/y and y/m/d dates',
'        // (Its part of a regexp so the position of the square brackets',
'        //  is crucial)',
'        var sep = \'[-./_=+~#:;,]+\';',
'        // Tokenise the string',
'        var tokens = str.split(/ +/);',
'        // Loop through each token checking what is is',
'        for (var i=0,len=tokens.length; i<len; ++i) {',
'            if (tokens[i]) {',
'                // Year',
'                if (tokens[i].match(/^\\d\\d\\d\\d$/)) {',
'                    defaults.year = tokens[i];',
'                }',
'                // Month',
'                var res = isMonth(tokens[i]);',
'                if (typeof res === \'number\') {',
'                    defaults.month = res + 1; // Months are zero indexed',
'                }',
'                // Date',
'                if (tokens[i].match(/^\\d?\\d(?:st|nd|rd|th)?$/)) {',
'                    defaults.date = parseInt(tokens[i]);',
'                }',
'                // Time',
'                if (tokens[i].match(/^(\\d\\d):(\\d\\d):?(?:(\\d\\d))?$/)) {',
'                    defaults.hours   = parseInt(RegExp.$1);',
'                    defaults.minutes = parseInt(RegExp.$2);',
'                    if (RegExp.$3) {',
'                        defaults.seconds = parseInt(RegExp.$3);',
'                    }',
'                }',
'                // Dateformat: XXXX-XX-XX',
'                if (tokens[i].match(new RegExp(\'^(\\\\d\\\\d\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)$\', \'i\'))) {',
'                    defaults.date  = parseInt(RegExp.$3);',
'                    defaults.month = parseInt(RegExp.$2);',
'                    defaults.year  = parseInt(RegExp.$1);',
'                }',
'                // Dateformat: XX-XX-XXXX',
'                if (tokens[i].match(new RegExp(\'^(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d\\\\d\\\\d)$\',\'i\') )) {',
'                    defaults.date  = parseInt(RegExp.$1);',
'                    defaults.month = parseInt(RegExp.$2);',
'                    defaults.year  = parseInt(RegExp.$3);',
'                }',
'            }',
'        }',
'        // Now put the defaults into a format thats recognised by Date.parse()',
'        str = \'{1}/{2}/{3} {4}:{5}:{6}\'.format(',
'            defaults.year,',
'            String(defaults.month).length     === 1 ? \'0\' + (defaults.month) : defaults.month,',
'            String(defaults.date).length      === 1 ? \'0\' + (defaults.date)      : defaults.date,',
'            String(defaults.hours).length     === 1 ? \'0\' + (defaults.hours)     : defaults.hours,',
'            String(defaults.minutes).length   === 1 ? \'0\' + (defaults.minutes)   : defaults.minutes,',
'            String(defaults.seconds).length   === 1 ? \'0\' + (defaults.seconds)   : defaults.seconds',
'        );',
'        return Date.parse(str);',
'        //',
'        // Support functions',
'        //',
'        function isMonth(str)',
'        {',
'            var res = str.toLowerCase().match(months_regex);',
'            return res ? months[res[0]] : false;',
'        }',
'    };',
'    // The ObjectRegistry add function',
'    RG.SVG.OR.add = function (obj)',
'    {',
'        RG.SVG.OR.objects.push(obj);',
'        return obj;',
'    };',
'    // The ObjectRegistry function that returns all of the objects. Th argument',
'    // can aither be:',
'    //',
'    // o omitted  All of the registered objects are returned',
'    // o id:XXX  All of the objects on that SVG tag are returned',
'    // o type:XXX All the objects of that type are returned',
'    //',
'    RG.SVG.OR.get = function ()',
'    {',
'        // Fetch objects that are on a particular SVG tag',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 3).toLowerCase() === \'id:\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].id === arguments[0].substr(3)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        // Fetch objects that are of a particular type',
'        //',
'        // TODO Allow multiple types to be specified',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 4).toLowerCase() === \'type\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].type === arguments[0].substr(5)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        // Fetch an object that has a specific UID',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 3).toLowerCase() === \'uid\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].uid === arguments[0].substr(4)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        return RG.SVG.OR.objects;',
'    };',
'    // The ObjectRegistry function that returns all of the registeredt SVG tags',
'    //',
'    RG.SVG.OR.tags = function ()',
'    {',
'        var tags = [];',
'        for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'            if (!tags[RG.SVG.OR.objects[i].svg.parentNode.id]) {',
'                tags[RG.SVG.OR.objects[i].svg.parentNode.id] = RG.SVG.OR.objects[i].svg;',
'            }',
'        }',
'        return tags;',
'    };',
'    //',
'    // This function returns a two element array of the SVG x/y position in',
'    // relation to the page',
'    // ',
'    // @param object svg',
'    //',
'    RG.SVG.getSVGXY = function (svg)',
'    {',
'        var x  = 0,',
'            y  = 0,',
'            el = svg.parentNode; // !!!',
'        do {',
'            x += el.offsetLeft;',
'            y += el.offsetTop;',
'            // Account for tables in webkit',
'            if (el.tagName.toLowerCase() == \'table\' && (RG.SVG.ISCHROME || RG.SVG.ISSAFARI)) {',
'                x += parseInt(el.border) || 0;',
'                y += parseInt(el.border) || 0;',
'            }',
'            el = el.offsetParent;',
'        } while (el && el.tagName && el.tagName.toLowerCase() != \'body\');',
'        var paddingLeft = svg.style.paddingLeft ? parseInt(svg.style.paddingLeft) : 0,',
'            paddingTop  = svg.style.paddingTop ? parseInt(svg.style.paddingTop) : 0,',
'            borderLeft  = svg.style.borderLeftWidth ? parseInt(svg.style.borderLeftWidth) : 0,',
'            borderTop   = svg.style.borderTopWidth  ? parseInt(svg.style.borderTopWidth) : 0;',
'        if (navigator.userAgent.indexOf(\'Firefox\') > 0) {',
'            x += parseInt(document.body.style.borderLeftWidth) || 0;',
'            y += parseInt(document.body.style.borderTopWidth) || 0;',
'        }',
'        return [x + paddingLeft + borderLeft, y + paddingTop + borderTop];',
'    };',
'    //',
'    // This function is a compatibility wrapper around',
'    // the requestAnimationFrame function.',
'    //',
'    // @param function func The function to give to the',
'    //                      requestAnimationFrame function',
'    //',
'    RG.SVG.FX.update = function (func)',
'    {',
'        win.requestAnimationFrame =',
'            win.requestAnimationFrame ||',
'            win.webkitRequestAnimationFrame ||',
'            win.msRequestAnimationFrame ||',
'            win.mozRequestAnimationFrame ||',
'            (function (func){setTimeout(func, 16.666);});',
'        win.requestAnimationFrame(func);',
'    };',
'    /**',
'    * This function returns an easing multiplier for effects so they eas out towards the',
'    * end of the effect.',
'    * ',
'    * @param number frames The total number of frames',
'    * @param number frame  The frame number',
'    */',
'    RG.SVG.FX.getEasingMultiplier = function (frames, frame)',
'    {',
'        var multiplier = ma.pow(ma.sin((frame / frames) * RG.SVG.TRIG.HALFPI), 3);',
'        return multiplier;',
'    };',
'    /**',
'    * Measures text by creating a DIV in the document and adding the relevant',
'    * text to it, then checking the .offsetWidth and .offsetHeight.',
'    * ',
'    * @param  object opt An object containing the following:',
'    *                        o text( string) The text to measure',
'    *                        o bold (bool)   Whether the text is bold or not',
'    *                        o font (string) The font to use',
'    *                        o size (number) The size of the text (in pts)',
'    * ',
'    * @return array         A two element array of the width and height of the text',
'    */',
'    RG.SVG.measureText = function (opt)',
'    {',
'        //text, bold, font, size',
'        var text = opt.text || \'\',',
'            bold = opt.bold || false,',
'            font = opt.font || \'Arial\',',
'            size = opt.size || 10,',
'            str  = text + \':\' + bold + \':\' + font + \':\' + size;',
'        // Add the sizes to the cache as adding DOM elements is costly and causes slow downs',
'        if (typeof RG.SVG.measuretext_cache === \'undefined\') {',
'            RG.SVG.measuretext_cache = [];',
'        }',
'        if (typeof RG.SVG.measuretext_cache == \'object\' && RG.SVG.measuretext_cache[str]) {',
'            return RG.SVG.measuretext_cache[str];',
'        }',
'        if (!RG.SVG.measuretext_cache[\'text-span\']) {',
'            var span = document.createElement(\'SPAN\');',
'                span.style.position = \'absolute\';',
'                //span.style.backgroundColor = \'red\';',
'                span.style.padding    = 0;',
'                span.style.display    = \'inline\';',
'                span.style.top        = \'-200px\';',
'                span.style.left       = \'-200px\';',
'                span.style.lineHeight = \'1em\';',
'            document.body.appendChild(span);',
'            // Now store the newly created DIV',
'            RG.SVG.measuretext_cache[\'text-span\'] = span;',
'        } else if (RG.SVG.measuretext_cache[\'text-span\']) {',
'            var span = RG.SVG.measuretext_cache[\'text-span\'];',
'        }',
'        span.innerHTML        = text.replace(/\\r?\\n/g, \'<br />\');',
'        span.style.fontFamily = font;',
'        span.style.fontWeight = bold ? \'bold\' : \'normal\';',
'        span.style.fontSize   = String(size).replace(/pt$/, \'\') + \'pt\';',
'        var sizes = [span.offsetWidth, span.offsetHeight];',
'        //document.body.removeChild(span);',
'        RG.SVG.measuretext_cache[str] = sizes;',
'        return sizes;',
'    };',
'    /**',
'    * This function converts an array of strings to an array of numbers. Its used by the meter/gauge',
'    * style charts so that if you want you can pass in a string. It supports various formats:',
'    * ',
'    * \'45.2\'',
'    * \'-45.2\'',
'    * [\'45.2\']',
'    * [\'-45.2\']',
'    * \'45.2,45.2,45.2\' // A CSV style string',
'    * ',
'    * @param number frames The string or array to parse',
'    */',
'    RG.SVG.stringsToNumbers = function (str)',
'    {',
'        // An optional seperator to use intead of a comma',
'        var sep = arguments[1] || \',\';',
'        // If it\'s already a number just return it',
'        if (typeof str === \'number\') {',
'            return str;',
'        }',
'        if (typeof str === \'string\') {',
'            if (str.indexOf(sep) != -1) {',
'                str = str.split(sep);',
'            } else {',
'                str = parseFloat(str);',
'            }',
'        }',
'        if (typeof str === \'object\') {',
'            for (var i=0,len=str.length; i<len; i+=1) {',
'                str[i] = parseFloat(str[i]);',
'            }',
'        }',
'        return str;',
'    };',
'    // This function allows for numbers that are given as a +/- adjustment',
'    RG.SVG.getAdjustedNumber = function (opt)',
'    {',
'        var value = opt.value,',
'            prop  = opt.prop;',
'        if (typeof prop === \'string\' && match(/^(\\+|-)([0-9.]+)/)) {',
'            if (RegExp.$1 === \'+\') {',
'                value += parseFloat(RegExp.$2);',
'            } else if (RegExp.$1 === \'-\') {',
'                value -= parseFloat(RegExp.$2);',
'            }',
'        }',
'        return value;',
'    };',
'    // NOT USED ANY MORE',
'    RG.SVG.attribution=function(){return;};',
'    /**',
'    * Parse a gradient and returns the various parts',
'    * ',
'    * @param string str The gradient string',
'    */',
'    RG.SVG.parseGradient = function (str)',
'    {',
'    };',
'    /**',
'    * Generates a random number between the minimum and maximum',
'    * ',
'    * @param number min The minimum value',
'    * @param number max The maximum value',
'    * @param number     OPTIONAL Number of decimal places',
'    */',
'    RG.SVG.random = function (opt)',
'    {',
'        var min = opt.min,',
'            max = opt.max,',
'            dp  = opt.dp || opt.decimals || 0,',
'            r   = ma.random();',
'        return Number((((max - min) * r) + min).toFixed(dp));',
'    };',
'    /**',
'    * Fill an array full of random numbers',
'    */',
'    RG.SVG.arrayRand    =',
'    RG.SVG.arrayRandom  =',
'    RG.SVG.random.array = function (opt)',
'    {',
'        var num = opt.num,',
'            min = opt.min,',
'            max = opt.max,',
'            dp  = opt.dp || opt.decimals || 0;',
'        for(var i=0,arr=[]; i<num; i+=1) {',
'            arr.push(RG.SVG.random({min: min, max: max, dp: dp}));',
'        }',
'        return arr;',
'    };',
'    //',
'    // This function is called by each objects setter so that common BC',
'    // and adjustments are centralised. And there\'s less typing for me too.',
'    //',
'    // @param object opt An object of options to the function, which are:',
'    //                    object: The chart object',
'    //                    name:   The name of the config parameter',
'    //                    value:  The value thats being set',
'    //',
'    RG.SVG.commonSetter = function (opt)',
'    {',
'        var obj   = opt.object,',
'            name  = opt.name,',
'            value = opt.value;',
'        // The default event for tooltips is click',
'        if (name === \'tooltipsEvent\'&& value !== \'click\' && value !== \'mousemove\') {',
'            value = \'click\';',
'        }',
'        return {',
'            name:  name,',
'            value: value',
'        };',
'    };',
'    //',
'    // Generates logs for... log charts',
'    //',
'    // @param object opt The options:',
'    //                     o num  The number',
'    //                     o base The base',
'    //',
'    RG.SVG.log = function (opt)',
'    {',
'        var num  = opt.num,',
'            base = opt.base;',
'        return ma.log(num) / (base ? ma.log(base) : 1);',
'    };',
'    RG.SVG.donut = function (opt)',
'    {',
'        var arcPath1 = RG.SVG.TRIG.getArcPath3({',
'            cx: opt.cx,',
'            cy: opt.cy,',
'            r: opt.outerRadius,',
'            start: 0,',
'            end: RG.SVG.TRIG.TWOPI,',
'            anticlockwise: false,',
'            lineto: false',
'        });',
'        var arcPath2 = RG.SVG.TRIG.getArcPath3({',
'            cx: opt.cx,',
'            cy: opt.cy,',
'            r: opt.innerRadius,',
'            start: RG.SVG.TRIG.TWOPI,',
'            end: 0,',
'            anticlockwise: true,',
'            lineto: false',
'        });',
'        //',
'        // Create the red circle',
'        //',
'        var path = RG.SVG.create({',
'            svg: opt.svg,',
'            type: \'path\',',
'            attr: {',
'                d: arcPath1 + arcPath2,',
'                stroke: opt.stroke,',
'                fill: opt.fill',
'            }',
'        });',
'        return path;',
'    };',
'    //',
'    // Copy the globals (if any have been set) from the global object to',
'    // this instances configuration',
'    //',
'    RG.SVG.getGlobals = function (obj)',
'    {',
'        var prop = obj.properties;',
'        for (i in RG.SVG.GLOBALS) {',
'            if (typeof i === \'string\') {',
'                prop[i] = RG.SVG.arrayClone(RG.SVG.GLOBALS[i]);',
'            }',
'        }',
'    };',
'    //',
'    // This function adds a link to the SVG document',
'    //',
'    // @param object opt The various options to the function',
'    //',
'    RG.SVG.link = function (opt)',
'    {',
'        var a = RGraph.SVG.create({',
'            svg: bar.svg,',
'            type: \'a\',',
'            parent: bar.svg.all,',
'            attr: {',
'                \'xlink:href\': href,',
'                target:       target',
'            }',
'        });',
'        var text = RGraph.SVG.create({',
'            svg: bar.svg,',
'            type: \'text\',',
'            parent: a,',
'            attr: {',
'                x: x,',
'                y: y,',
'                fill: fill',
'            }',
'        });',
'        text.innerHTML = text;',
'    };',
'    // This function is used to get the errorbar MAXIMUM value. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsMaxValue = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'number\') {',
'            var value = prop.errorbars[index];',
'        } else if (   typeof prop.errorbars === \'object\'',
'                   && !RG.SVG.isNull(prop.errorbars)',
'                   && typeof prop.errorbars[index] === \'object\'',
'                   && !RG.SVG.isNull(prop.errorbars[index])',
'                   && typeof prop.errorbars[index].max === \'number\'',
'                  ) {',
'            var value = prop.errorbars[index].max;',
'        } else {',
'            var value = 0;',
'        }',
'        return value;',
'    };',
'    // This function is used to get the errorbar MINIMUM value. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsMinValue = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        if (   typeof prop.errorbars === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars)',
'            && typeof prop.errorbars[index] === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars[index])',
'            && typeof prop.errorbars[index].min === \'number\'',
'           ) {',
'            var value = prop.errorbars[index].min;',
'        } else {',
'            var value = null;',
'        }',
'        return value;',
'    };',
'    // This function is used to get the errorbar color. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsColor = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var color = prop.errorbarsColor || \'black\';',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'object\' && !RG.SVG.isNull(prop.errorbars[index]) && typeof prop.errorbars[index].color === \'string\') {',
'            color = prop.errorbars[index].color;',
'        }',
'        return color;',
'    };',
'    // This function is used to get the errorbar linewidth. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsLinewidth = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var linewidth = prop.errorbarsLinewidth || 1',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'object\' && !RG.SVG.isNull(prop.errorbars[index]) && typeof prop.errorbars[index].linewidth === \'number\') {',
'            linewidth = prop.errorbars[index].linewidth;',
'        }',
'        return linewidth;',
'    };',
'    // This function is used to get the errorbar capWidth. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsCapWidth = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var capwidth = prop.errorbarsCapwidth || 10',
'        if (   typeof prop.errorbars === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars)',
'            && typeof prop.errorbars[index] === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars[index])',
'            && typeof prop.errorbars[index].capwidth === \'number\'',
'            ) {',
'            capwidth = prop.errorbars[index].capwidth;',
'        }',
'        return capwidth;',
'    };',
'    //',
'    // This is here so that if the tooltip library has not',
'    // been included, this function will show an alert',
'    //informing the user',
'    //',
'    if (typeof RG.SVG.tooltip !== \'function\') {',
'        RG.SVG.tooltip = function ()',
'        {',
'            $$a(\'The tooltip library has not been included!\');',
'        };',
'    }',
'// End module pattern',
'})(window, document);',
'/**',
'* Loosly mimicks the PHP function print_r();',
'*/',
'window.$p = function (obj)',
'{',
'    var indent = (arguments[2] ? arguments[2] : \'    \');',
'    var str    = \'\';',
'    var counter = typeof arguments[3] == \'number\' ? arguments[3] : 0;',
'    if (counter >= 5) {',
'        return \'\';',
'    }',
'    switch (typeof obj) {',
'        case \'string\':    str += obj + \' (\' + (typeof obj) + \', \' + obj.length + \')\'; break;',
'        case \'number\':    str += obj + \' (\' + (typeof obj) + \')\'; break;',
'        case \'boolean\':   str += obj + \' (\' + (typeof obj) + \')\'; break;',
'        case \'function\':  str += \'function () {}\'; break;',
'        case \'undefined\': str += \'undefined\'; break;',
'        case \'null\':      str += \'null\'; break;',
'        case \'object\':',
'            // In case of null',
'            if (RGraph.SVG.isNull(obj)) {',
'                str += indent + \'null\\n\';',
'            } else {',
'                str += indent + \'Object {\' + \'\\n\'',
'                for (j in obj) {',
'                    str += indent + \'    \' + j + \' => \' + window.$p(obj[j], true, indent + \'    \', counter + 1) + \'\\n\';',
'                }',
'                str += indent + \'}\';',
'            }',
'            break;',
'        default:',
'            str += \'Unknown type: \' + typeof obj + \'\';',
'            break;',
'    }',
'    /**',
'    * Finished, now either return if we\'re in a recursed call, or alert()',
'    * if we\'re not.',
'    */',
'    if (!arguments[1]) {',
'        alert(str);',
'    }',
'    return str;',
'};',
'/**',
'* A shorthand for the default alert() function',
'*/',
'window.$$a = function (v)',
'{',
'    alert(v);',
'};',
'/**',
'* Short-hand for console.log',
'* ',
'* @param mixed v The variable to log to the console',
'*/',
'window.$cl = function (v)',
'{',
'    return console.log(v);',
'};',
'/**',
'* A basic string formatting function. Use it like this:',
'* ',
'* var str = \'{1} {2} {3}\'.format(\'a\', \'b\', \'c\');',
'* ',
'* Outputs: a b c',
'*/',
'if (!String.prototype.format) {',
'  String.prototype.format = function()',
'  {',
'    var args = arguments;',
'    return this.replace(/{(\\d+)}/g, function(str, idx)',
'    {',
'      return typeof args[idx - 1] !== \'undefined\' ? args[idx - 1] : str;',
'    });',
'  };',
'};',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph = window.RGraph || {isRGraph: true};',
'    RGraph.CSV = function (url, func)',
'    {',
'        var RG  = RGraph,',
'            ua  = navigator.userAgent,',
'            ma  = Math;',
'        /**',
'        * Some default values',
'        */',
'        this.url       = url;',
'        this.ready     = func;',
'        this.data      = null;',
'        this.numrows   = null;',
'        this.numcols   = null;',
'        this.seperator = arguments[2] || \',\';',
'        this.endofline = arguments[3] || /\\r?\\n/;',
'        /**',
'        * A Custom split function',
'        * ',
'        * @param string str  The CSV string to split',
'        * @param mixed  char The character to split on - or it can also be an object like this:',
'        *                    {',
'        *                        preserve: false, // Whether to preserve whitespace',
'        *                        char: \',\'        // The character to split on',
'        *                    }',
'        */',
'        this.splitCSV = function (str, split)',
'        {',
'            // Defaults',
'            var arr            = [];',
'            var field          = \'\';',
'            var inDoubleQuotes = false;',
'            var inSingleQuotes = false;',
'            var preserve       = (typeof split === \'object\' && split.preserve) ? true : false;',
'            // The character to split the CSV string on',
'            if (typeof split === \'object\') {',
'                if (typeof split.char === \'string\') {',
'                    split = split.char;',
'                } else {',
'                    split = \',\';',
'                }',
'            } // If not an object just leave the char as it\'s supplied',
'            for (var i=0,len=str.length; i<len; i+=1) {',
'                char = str.charAt(i);',
'                if ( (char === \'"\') && !inDoubleQuotes) {',
'                    inDoubleQuotes = true;',
'                    continue;',
'                } else if ( (char === \'"\') && inDoubleQuotes) {',
'                    inDoubleQuotes = false;',
'                    continue;',
'                }',
'                if ( (char === "\'") && !inSingleQuotes) {',
'                    inSingleQuotes = true;',
'                    continue;',
'                } else if ( (char === "\'") && inSingleQuotes) {',
'                    inSingleQuotes = false;',
'                    continue;',
'                } else if (char === split && !inDoubleQuotes && !inSingleQuotes) {',
'// TODO look ahead in order to allow for multi-character seperators',
'                    arr.push(field);',
'                    field = \'\';',
'                    continue;',
'                } else {',
'                    field = field + char;',
'                }',
'            }',
'            // Add the last field',
'            arr.push(field);',
'            // Now trim each value if necessary',
'            if (!preserve) {',
'                for (i=0,len=arr.length; i<len; i+=1) {',
'                    arr[i] = arr[i].trim();',
'                }',
'            }',
'            return arr;',
'        };',
'        /**',
'        * This function splits the CSV data into an array so that it can be useful.',
'        */',
'        this.fetch = function ()',
'        {',
'            var sep = this.seperator,',
'                eol = this.endofline,',
'                obj = this;',
'            if (this.url.substring(0,3) === \'id:\' || this.url.substring(0,4) === \'str:\') {',
'                // Get rid of any surrounding whitespace',
'                if (this.url.substring(0,3) === \'id:\') {',
'                    var data = document.getElementById(this.url.substring(3)).innerHTML.trim();',
'                } else if (this.url.substring(0,4) === \'str:\') {',
'                    var data = this.url.substring(4).trim();',
'                }',
'                // Store the CSV data on the CSV object (ie - this object)',
'                obj.data = data.split(eol);',
'                // Store the number of rows',
'                obj.numrows = obj.data.length;',
'                for (var i=0,len=obj.data.length; i<len; i+=1) {',
'                    /**',
'                    * Split the individual line',
'                    */',
'                    //var row = obj.data[i].split(sep);',
'                    var row = obj.splitCSV(obj.data[i], {preserve: false, char: sep});',
'                    if (!obj.numcols) {',
'                        obj.numcols = row.length;',
'                    }',
'                    /**',
'                    * If the cell is purely made up of numbers - convert it',
'                    */',
'                    for (var j=0; j<row.length; j+=1) {',
'                        if ((/^\\-?[0-9.]+$/).test(row[j])) {',
'                            row[j] = parseFloat(row[j]);',
'                        }',
'                        // Assign the split-up-row back to the data array',
'                        obj.data[i] = row;',
'                    }',
'                }',
'                // Call the ready function straight away',
'                obj.ready(obj);',
'            } else {',
'                RGraph.SVG.AJAX.getString(this.url, function (data)',
'                {',
'                    data = data.replace(/(\\r?\\n)+$/, \'\');',
'                    /**',
'                    * Split the lines in the CSV',
'                    */',
'                    obj.data = data.split(eol);',
'                    /**',
'                    * Store the number of rows',
'                    */',
'                    obj.numrows = obj.data.length;',
'                    /**',
'                    * Loop thru each lines in the CSV file',
'                    */',
'                    for (var i=0,len=obj.data.length; i<len; i+=1) {',
'                        /**',
'                        * Use the new split function to split each row NOT preserving whitespace',
'                        */',
'                        //var row = obj.data[i].split(sep);',
'                        var row = obj.splitCSV(obj.data[i], {preserve: false, char: sep});',
'                        if (!obj.numcols) {',
'                            obj.numcols = row.length;',
'                        }',
'                        /**',
'                        * If the cell is purely made up of numbers - convert it',
'                        */',
'                        for (var j=0; j<row.length; j+=1) {',
'                            if ((/^\\-?[0-9.]+$/).test(row[j])) {',
'                                row[j] = parseFloat(row[j]);',
'                            }',
'                            // Assign the split-up-row back to the data array',
'                            obj.data[i] = row;',
'                        }',
'                    }',
'                    // Call the ready function straight away',
'                    obj.ready(obj);',
'                });',
'            }',
'        };',
'        /**',
'        * Returns a row of the CSV file',
'        * ',
'        * @param number index The index of the row to fetch',
'        * @param        start OPTIONAL If desired you can specify a column to start at (which starts at 0 by default)',
'        */',
'        this.getRow = function (index)',
'        {',
'            var row   = [];',
'            var start = arguments[1] || 0;',
'            for (var i=start; i<this.numcols; i+=1) {',
'                row.push(this.data[index][i]);',
'            }',
'            return row;',
'        };',
'        /**',
'        * Returns a column of the CSV file',
'        * ',
'        * @param number index The index of the column to fetch',
'        * @param        start OPTIONAL If desired you can specify a row to start at (which starts at 0 by default)',
'        */',
'        this.getCol =',
'        this.getColumn = function (index)',
'        {',
'            var col   = [];',
'            var start = arguments[1] || 0;',
'            for (var i=start; i<this.numrows; i+=1) {',
'                col.push(this.data[i][index]);',
'            }',
'            return col;',
'        };',
'        // Fetch the CSV file',
'        this.fetch();',
'    };;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * This is a library of a few functions that make it easier to do',
'    * effects like fade-ins or eaxpansion.',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph        = window.RGraph || {isRGraph: true};',
'    RGraph.SVG    = RGraph.SVG    || {};',
'    RGraph.SVG.FX = RGraph.SVG.FX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG = RGraph,',
'        ua = navigator.userAgent,',
'        ma = Math;',
'    /**',
'    * This functions adds the generic effects to thechart object',
'    * ',
'    * @param object obj The chart object',
'    */',
'    RG.SVG.FX.decorate = function (obj)',
'    {',
'        for (i in RG.SVG.FX) {',
'            if (typeof RG.SVG.FX[i] === \'function\') {',
'                obj[i] = RG.SVG.FX[i];',
'            }',
'        }',
'    };',
'    /**',
'    * fadeIn',
'    * ',
'    * This function simply uses the CSS opacity property - initially set to zero and',
'    * increasing to 1 over the period of 0.5 second',
'    */',
'    RG.SVG.FX.fadein = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {};',
'        // Initially the opacity should be zero',
'        obj.svg.style.opacity = 0;',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Now fade the chart in',
'        for (var i=1; i<=frames; ++i) {',
'            (function (index)',
'            {',
'                setTimeout(function ()',
'                {',
'                    obj.svg.style.opacity = (index / frames);',
'                    if (index >= frames) {',
'                        callback(obj);',
'                    }',
'                }, (index / frames) * duration);',
'            })(i)',
'        }',
'        return this;',
'    };',
'    /**',
'    * fadeOut',
'    * ',
'    * This function is a reversal of the above function - fading out instead of in',
'    */',
'    RG.SVG.FX.fadeout = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {};',
'         //RG.SVG.redraw()',
'        // Now fade the chart out',
'        for (var i=1; i<=frames; ++i) {',
'            (function (index)',
'            {',
'                setTimeout(function ()',
'                {',
'                    obj.svg.style.opacity = 1 - (index / frames);',
'                    if (index >= frames) {',
'                        callback(obj);',
'                    }',
'                }, (index / frames) * duration);',
'            })(i)',
'        }',
'        return this;',
'    };',
'    /**',
'    * fadeSlideIn',
'    * ',
'    * This function fades the canvas in in a sliding motion',
'    */',
'    RG.SVG.FX.fadeslidein = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            pc       = -20,',
'            step     = (120 - pc) / frames,',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'linear-gradient(135deg, rgba(255,255,255,0) \' + pc + \'%, \' + color + \' \' + (pc + 20) + \'%)\',',
'            width:      width  + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(this.container));',
'        function iterator ()',
'        {',
'            if (pc < 120) {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                    background: \'linear-gradient(135deg, rgba(255,255,255,0) \' + pc + \'%, \' + color + \' \' + (pc + 20) + \'%)\'',
'                });',
'                pc += step;',
'                RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeSlideOut',
'    //',
'    // Fades the canvas out in a sliding motion. This function gets added',
'    // to the chart object - so the this variable is the chart object',
'    //',
'    RG.SVG.FX.fadeslideout = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            pc       = -20,',
'            step     = (120 - pc) / frames,',
'            canvasXY = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'linear-gradient(135deg, \' + color + \' \' + pc + \'%, rgba(255,255,255,0) \' + (pc + 20) + \'%)\',',
'            width:      width + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (pc < 120) {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                                                               background: \'linear-gradient(135deg, \' + color + \' \' + pc + \'%, rgba(255,255,255,0) \' + (pc + 20) + \'%)\'',
'                                                              });',
'                pc += step;',
'                RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeCircularIn',
'    // ',
'    // This function uses radial CSS gradients to cover the canvas with a radial fade in effect',
'    // (from the center outwards)',
'    //',
'    RG.SVG.FX.fadecircularinoutwards = function ()',
'    {',
'        // This function gets added to the chart object - so the \'this\'',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 1,',
'            radius   = 0,',
'            svgXY    = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadecircularinoutwards_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, \' + color + \' \' + radius + \'%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadecircularinoutwards_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(rgba(255,255,255,0) \' + ((frame++ / frames) * 100) + \'%, \' + color + \' \' + ((frame++ / frames) * 150) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadecircularinoutwards_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadecircularoutoutwards',
'    // ',
'    // This function uses radial CSS gradients to cover the canvas with a radial fade out effect',
'    // (from the center outwards)',
'    //',
'    RG.SVG.FX.fadecircularoutoutwards = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            canvasXY = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, transparent 0%)\',',
'            width:      width + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(\' + color + \' \' + ((frame++ / frames) * 100) + \'%, rgba(255,255,255,0) \' + ((frame++ / frames) * 150) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeCircularInInwards',
'    //',
'    // This function gets added to the chart object - so the \'this\'',
'    // variable is the chart object',
'    //',
'    RG.SVG.FX.fadecircularininwards = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            radius   = ma.max(',
'                obj.container.offsetWidth,',
'                obj.container.offsetHeight',
'            ),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 100%, rgba(255,255,255,0) 0%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(\' + color + \' \' + (( (frames - frame++) / frames) * 100) + \'%, rgba(255,255,255,0) \' + (( (frames - frame++) / frames) * 120) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadecircularoutinwards',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    //',
'    RG.SVG.FX.fadecircularoutinwards = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            radius   = ma.max(',
'                this.container.offsetWidth,',
'                this.container.offsetHeight',
'            ),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + this.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, rgba(255,255,255,0) 0%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(rgba(255,255,255,0) \' + (( (frames - frame++) / frames) * 100) + \'%, \' + color + \' \' + (( (frames - frame++) / frames) * 120) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // Reveal',
'    // ',
'    // With this effect the chart is slowly revealed from the centre outwards. This',
'    // function gets added to the chart object - so the \'this\' variable is the chart',
'    // object',
'    // ',
'    // @param object    Options for the effect. You can give frames here',
'    // @param function  An optional callback function',
'    //',
'    RG.SVG.FX.reveal = function ()',
'    {',
'        var obj       = this,',
'            opt       = arguments[0] || {}',
'            color     = opt.color    || \'white\',',
'            frames    = opt.frames   || 90,',
'            duration  = (frames / 60) * 1000,',
'            callback  = opt.callback || function () {}',
'        var divs = [',
'            [\'rgraph_reveal_left_\'   + this.id, 0, 0, this.container.offsetWidth  / 2, this.container.offsetHeight],',
'            [\'rgraph_reveal_right_\'  + this.id,(this.container.offsetWidth  / 2),0,(this.container.offsetWidth  / 2),this.container.offsetHeight],',
'            [\'rgraph_reveal_top_\'    + this.id,0,0,this.container.offsetWidth,(this.container.offsetHeight / 2)],',
'            [\'rgraph_reveal_bottom_\' + this.id,0,(this.container.offsetHeight  / 2),this.container.offsetWidth,(this.container.offsetHeight / 2)]',
'        ];',
'        for (var i=0,len=divs.length; i<len; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = divs[i][0];',
'                div.style.left            = divs[i][1] + \'px\';',
'                div.style.top             = divs[i][2] + \'px\';',
'                div.style.width           = divs[i][3] + \'px\';',
'                div.style.height          = divs[i][4] + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'        }',
'        // Redraw',
'        RG.SVG.redraw(obj.svg);',
'        // Animate the shrinking of the DIVs',
'        jQuery(\'#rgraph_reveal_left_\'   + obj.id).animate({width: 0}, duration);',
'        jQuery(\'#rgraph_reveal_right_\'  + obj.id).animate({left: \'+=\' + (this.container.offsetWidth / 2),width: 0}, duration);',
'        jQuery(\'#rgraph_reveal_top_\'    + obj.id).animate({height: 0}, duration);',
'        jQuery(\'#rgraph_reveal_bottom_\' + obj.id).animate({top: \'+=\' + (this.container.offsetHeight / 2),height: 0}, duration);',
'        // Remove the DIVs from the DOM 100ms after the animation ends',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_top_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_bottom_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_left_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_right_" + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Conceal',
'    // ',
'    // This effect is the reverse of the Reveal effect - instead of revealing',
'    // the canvas it conceals it. Combined with the reveal effect would make',
'    // for a nice wipe effect.',
'    // ',
'    // @param object obj The chart object',
'    ///',
'    RG.SVG.FX.conceal = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames   || 90,',
'            callback = opt.callback || function () {},',
'            color    = opt.color    || \'white\',',
'            duration = (frames / 60) * 1000,',
'            frame    = 0;',
'        var divs = [',
'            [\'rgraph_conceal_left_\' + obj.id, 0, 0, 0, this.container.offsetHeight],',
'            [\'rgraph_conceal_right_\' + obj.id,this.container.offsetWidth,0,0,this.container.offsetHeight],',
'            [\'rgraph_conceal_top_\' + obj.id,0,0,this.container.offsetWidth,0],',
'            [\'rgraph_conceal_bottom_\' + obj.id,0,this.container.offsetHeight,this.container.offsetWidth,0]',
'        ];',
'        for (var i=0,len=divs.length; i<len; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = divs[i][0];',
'                div.style.left            = divs[i][1] + \'px\';',
'                div.style.top             = divs[i][2] + \'px\';',
'                div.style.width           = divs[i][3] + \'px\';',
'                div.style.height          = divs[i][4] + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'        }',
'        jQuery(\'#rgraph_conceal_left_\' + obj.id).animate({width: \'+=\' + (this.container.offsetWidth / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_right_\' + obj.id).animate({left: \'-=\' + (this.container.offsetWidth / 2),width: (this.container.offsetWidth / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_top_\' + obj.id).animate({height: \'+=\' + (this.container.offsetHeight / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_bottom_\' + obj.id).animate({top: \'-=\' + (this.container.offsetHeight / 2),height: (this.container.offsetHeight / 2)}, duration);',
'        // Remove the DIVs from the DOM 100ms after the animation ends',
'        setTimeout(',
'            function ()',
'            {',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_top_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_bottom_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_left_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_right_" + obj.id));',
'                RG.SVG.clear(obj.svg);',
'                callback(obj);',
'            },',
'            duration',
'        );',
'        return this;',
'    };',
'    //',
'    // Horizontal Blinds (open)',
'    // ',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.hblindsopen = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = 0;',
'                div.style.top             = ((this.container.offsetHeight * (i / 5))) + \'px\';',
'                div.style.width           = this.container.offsetWidth + \'px\';',
'                div.style.height          = (this.container.offsetHeight / 5) + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_hblinds_\' + i + \'_\' + obj.id).animate({height: 0}, duration);',
'        }',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_0_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_1_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_2_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_3_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_4_\' + obj.id));}, duration);',
'        setTimeout(function () {callback(obj);}, duration);',
'        return this;',
'    };',
'    //',
'    // Horizontal Blinds (close)',
'    // ',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    //',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.hblindsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color = \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = 0;',
'                div.style.top             = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                div.style.width           = this.container.offsetWidth + \'px\';',
'                div.style.height          = 0;',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_hblinds_\' + i + \'_\' + obj.id)',
'                .animate({',
'                    height: height + \'px\'',
'                }, duration);',
'        }',
'        setTimeout(function () {RG.SVG.clear(obj.svg);}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'    };',
'    //',
'    // Vertical Blinds (open)',
'    // ',
'    // @params object obj The graph object',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    RG.SVG.FX.vblindsopen = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(obj.svg);',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id = \'rgraph_vblinds_\' + i + \'_\' + obj.id;',
'                div.style.width           =  width + \'px\';',
'                div.style.height          = this.container.offsetHeight + \'px\';',
'                div.style.left            = (this.container.offsetWidth * (i / 10)) + \'px\';',
'                div.style.top             = 0;',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            obj.container.appendChild(div);',
'            jQuery(\'#rgraph_vblinds_\' + i + \'_\' + obj.id).animate({width: 0}, duration);',
'        }',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_5_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_6_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_7_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_8_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_9_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'        return this;',
'    };',
'    //',
'    // Vertical Blinds (close)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.vblindsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        // Create the blinds',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_vblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = (this.container.offsetWidth * (i / 10)) + \'px\';',
'                div.style.top             = 0;',
'                div.style.width           = 0;',
'                div.style.height          = this.container.offsetHeight + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_vblinds_\' + i + \'_\' + obj.id).animate({width: width}, duration);',
'        }',
'        setTimeout(function () {RG.SVG.clear(obj.svg);}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_5_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_6_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_7_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_8_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_9_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'        return this;',
'    };',
'    //',
'    // Slide in',
'    // ',
'    // This function is a wipe that can be used when switching the canvas to a',
'    // new graph',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param object obj The graph object',
'    //',
'    RG.SVG.FX.slidein = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10,',
'            from     = opt.from || \'left\';',
'        this.container.style.overflow = \'hidden\';',
'        RG.SVG.redraw(this.svg);',
'        this.svg.style.position = \'relative\';',
'        if (from == \'left\') {',
'            this.svg.style.left = (0 - this.container.offsetWidth) + \'px\';',
'            this.svg.style.top  = 0;',
'        } else if (from == \'top\') {',
'            this.svg.style.left = 0;',
'            this.svg.style.top  = (0 - this.container.offsetHeight) + \'px\';',
'        } else if (from == \'bottom\') {',
'            this.svg.style.left = 0;',
'            this.svg.style.top  = this.container.offsetHeight + \'px\';',
'        } else {',
'            this.svg.style.left = this.container.offsetWidth + \'px\';',
'            this.svg.style.top  = 0;',
'        }',
'        jQuery(this.svg).animate({left:0,top:0}, duration, function ()',
'        {',
'            callback(obj);',
'        });',
'        return this;',
'    };',
'    //',
'    // Slide out',
'    // ',
'    // This function is a wipe that can be used when switching the canvas to a new graph',
'    // ',
'    // @param object   Optional object containing configuration.',
'    // @param function Optional callback function',
'    //',
'    RG.SVG.FX.slideout = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var opt      = arguments[0] || {},',
'            frames   = opt.frames   || 90,',
'            color    = opt.color    || \'white\',',
'            to       = opt.to       || \'left\',',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            width    = this.container.offetsWidth / 10;',
'        this.container.style.overflow= \'hidden\';',
'        this.svg.style.position = \'relative\';',
'        this.svg.style.left     = 0;',
'        this.svg.style.top      = 0;',
'        if (to == \'left\') {',
'            jQuery(this.svg).animate({left: (0 - this.container.offsetWidth) + \'px\'}, duration, function () {callback(this);});',
'        } else if (to == \'top\') {',
'            jQuery(this.svg).animate({left: 0, top: (0 - this.container.offsetHeight) + \'px\'}, duration, function () {callback(this);});',
'        } else if (to == \'bottom\') {',
'            jQuery(this.svg).animate({top: (0 + this.container.offsetHeight) + \'px\'}, duration, function () {callback(this);});',
'        } else {',
'            jQuery(this.svg).animate({left: (0 + this.container.offsetWidth) + \'px\'}, duration, function () {callback(this);});',
'        }',
'        return this;',
'    };',
'    //',
'    // Horizontal Scissors (open)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param object      Optional array of options',
'    // @param function     Optional callback function',
'    // ',
'    //',
'    RG.SVG.FX.hscissorsopen = function ()',
'    {',
'        var opt      = arguments[0] || {},',
'            obj      = this,',
'            frames   = opt.frames   || 90,',
'            callback = opt.callback || function () {},',
'            color    = opt.color    || \'white\',',
'            to       = opt.to       || \'left\',',
'            frame    = 0,',
'            duration = (frames / 60) * 1000,',
'            width    = this.container.offsetWidth / 10,',
'            height   = this.container.offsetHeight / 5;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.getElementById("rgraph_hscissors_" + i + \'_\' + this.id)',
'            if (!div) {',
'                var div    = doc.createElement(\'DIV\');',
'                    div.id = \'rgraph_hscissors_\' + i + \'_\' + this.id;',
'                    div.style.width =  this.container.offsetWidth + \'px\';',
'                    div.style.height = (this.container.offsetHeight / 5) + \'px\';',
'                    div.style.left   = 0;',
'                    div.style.top   = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                    div.style.position = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({left: this.container.offsetWidth + \'px\', width: 0}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({width: 0}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_0_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_1_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_2_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_3_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_4_\' + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Horizontal Scissors (Close)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param @object      Optional object of options',
'    // @param function     Optional callback function',
'    // ',
'    //',
'    RG.SVG.FX.hscissorsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 60,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        for (var i=0; i<5; ++i) {',
'            var div                       = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hscissors_\' + i + \'_\' + this.id;',
'                div.style.width           = 0;',
'                div.style.height          = height + \'px\';',
'                div.style.left            = (i % 2 == 0 ? this.container.offsetWidth : 0) + \'px\';',
'                div.style.top             = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({left: 0, width: this.container.offsetWidth + \'px\'}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({width: this.container.offsetWidth + \'px\'}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            RG.SVG.clear(obj.svg);',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 0 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 1 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 2 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 3 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 4 + \'_\' + obj.id).remove();',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Vertical Scissors (open)',
'    // ',
'    // @param @object  Optional An object of options. It can consist of:',
'    //                  o color    - The color of the scissors. The default is white',
'    //                  o frames   - Number of animation frames in the effect. Default',
'    //                               is 60',
'    //                  o callback - A function that\'s called when the effect is',
'    //                               finished',
'    //',
'    RG.SVG.FX.vscissorsopen = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        //',
'        // First (re)draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.getElementById("rgraph_vscissors_" + i + \'_\' + this.id);',
'            if (!div) {',
'                var div = doc.createElement(\'DIV\');',
'                    div.id = \'rgraph_vscissors_\' + i + \'_\' + this.id;',
'                    div.style.width           =  width + \'px\';',
'                    div.style.height          = this.container.offsetHeight + \'px\';',
'                    div.style.left            = this.container.offsetWidth * (i / 10) + \'px\';',
'                    div.style.top             = 0;',
'                    div.style.position        = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({top: this.container.offsetHeight + \'px\', height: 0}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({height: 0}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_0\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_1\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_2\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_3\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_4\' + \'_\' + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Vertical Scissors (close)',
'    //',
'    RG.SVG.FX.vscissorsclose = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color  || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.getElementById("rgraph_vscissors_" + i + \'_\' + this.id)',
'            if (!div) {',
'                var div                = doc.createElement(\'DIV\');',
'                    div.id             = \'rgraph_vscissors_\' + i + \'_\' + this.id;',
'                    div.style.width    =  width + \'px\';',
'                    div.style.height   = 0;',
'                    div.style.left     = (width * i) + \'px\';',
'                    div.style.top      = (i % 2 == 0 ? this.container.offsetHeight : 0) + \'px\';',
'                    div.style.position = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({top: 0, height: this.container.offsetHeight + \'px\'}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({height: this.container.offsetHeight + \'px\'}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            RG.SVG.clear(obj.svg);',
'            for (var i=0; i<10; i++) {',
'                jQuery(\'#rgraph_vscissors_\' + i + \'_\' + obj.id).remove();',
'            }',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'// End Module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph          = window.RGraph || {isRGraph: true};',
'    RGraph.SVG      = RGraph.SVG || {};',
'    RGraph.SVG.HTML = RGraph.SVG.HTML || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG = RGraph,',
'        ua = navigator.userAgent,',
'        ma = Math;',
'    /**',
'    * Draws the graph key (used by various graphs)',
'    * ',
'    * @param object obj The graph object',
'    * @param array  key An array of the texts to be listed in the key',
'    * @param colors An array of the colors to be used',
'    */',
'    RG.SVG.drawKey = function (obj)',
'    {',
'        var prop          = obj.properties,',
'            key           = prop.key,',
'            colors        = prop.keyColors || prop.colors,',
'            defaultFont   = \'Arial\',',
'            blobSize      = 0,',
'            width         = 0,',
'            keyColorShape = prop.keyColorShape;',
'        // Work out the center point of the SVG tag',
'        var centerx = obj.svg.getAttribute(\'width\') / 2;',
'        // If we\'re drawing a key on a funnel then work out the center of',
'        // the chart differently. This may be useful to other chart types',
'        // too',
'        if (obj.type === \'funnel\') {',
'            centerx = (obj.graphWidth / 2) + prop.gutterLeft;',
'        }',
'        // Loop thru the key and draw them',
'        if (key && key.length) {',
'            // First measure the length so that the key can be centered',
'            for (var i=0,length = 0; i<key.length; i++) {',
'                // First measure the text',
'                var textDimensions = RG.SVG.measureText({',
'                    text: key[i],',
'                    bold: prop.keyTextBold || false,',
'                    font: prop.keyTextFont || prop.textFont || defaultFont,',
'                    size: prop.keyTextSize || prop.textSize',
'                });',
'                blobSize = ma.max(blobSize, textDimensions[1]);',
'                width = width + 10 + blobSize + 5 + textDimensions[0];',
'            }',
'            // Center the key',
'            x = centerx - width / 2;',
'            for (var i=0,y=prop.gutterTop - 5; i<key.length; ++i) {',
'                // Do this on the first iteration only',
'                if (i === 0) {',
'                    if (obj.type === \'pie\' && prop.highlightStyle == \'outline\') {',
'                        y -= prop.highlightStyleOutlineWidth;',
'                    }',
'                }',
'                // First measure the text',
'                var textDimensions = RG.SVG.measureText({',
'                    text: key[i],',
'                    bold: prop.keyTextBold || false,',
'                    font: prop.keyTextFont || prop.textFont || defaultFont,',
'                    size: prop.keyTextSize || prop.textSize',
'                });',
'                //',
'                // Draw the blob of color (accounting for it being an array first)',
'                //',
'                var shape = prop.keyColorShape;',
'                if (typeof shape === \'object\') {',
'                    shape = prop.keyColorShape[i];',
'                }',
'                // A circle',
'                if (shape === \'circle\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'circle\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            cx: x + (blobSize / 2)  + prop.keyOffsetx,',
'                            cy: y - (blobSize / 2) + prop.keyOffsety,',
'                            r: blobSize / 2,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A triangle',
'                } else if (shape === \'triangle\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4} L {5} {6} z\'.format(',
'                                x + prop.keyOffsetx + (blobSize / 2),',
'                                y - blobSize + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y + prop.keyOffsety,',
'                                x + prop.keyOffsetx,',
'                                y + prop.keyOffsety                                ',
'                            ),',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A line',
'                } else if (shape === \'line\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                // A dot',
'                } else if (shape === \'dot\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'circle\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            cx: x + (blobSize / 2)  + prop.keyOffsetx,',
'                            cy: y - (blobSize / 2) + prop.keyOffsety,',
'                            r: blobSize / 4,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A dot',
'                } else if (shape === \'squaredot\' || shape === \'rectdot\') {',
'                    // Create the line',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'rect\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            x: x + (blobSize / 4) + prop.keyOffsetx,',
'                            y: y + (blobSize / 4) - blobSize + prop.keyOffsety,',
'                            width: blobSize / 2,',
'                            height: blobSize / 2,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // Ccustom',
'                } else if (typeof shape === \'function\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                // A rectangle default',
'                } else {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'rect\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            x: x + prop.keyOffsetx,',
'                            y: y - blobSize + prop.keyOffsety,',
'                            width: blobSize,',
'                            height: blobSize,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                }',
'                //',
'                // Add the text',
'                //',
'                RGraph.SVG.text({',
'                    object:     obj,',
'                    parent:     obj.svg.all,',
'                    tag:        \'key\',',
'                    size:       prop.keyTextSize || prop.textSize,',
'                    bold:       typeof prop.keyTextBold === \'boolean\' ? prop.keyTextBold : prop.textBold,',
'                    italic:     typeof prop.keyTextItalic === \'boolean\' ? prop.keyTextItalic : prop.textItalic,',
'                    font:       prop.keyTextFont || prop.textFont,',
'                    halign:     \'left\',',
'                    valign:     \'bottom\',',
'                    text:       key[i],',
'                    x:          x + blobSize + 5 + prop.keyTextOffsetx + prop.keyOffsetx,',
'                    y:          y + prop.keyTextOffsety + prop.keyOffsety,',
'                    color:      prop.keyTextColor || \'black\',',
'                    background: prop.keyTextBackground || \'white\',',
'                    padding:    0',
'                })',
'                x += 10 + blobSize + 5 + textDimensions[0];',
'            }',
'        }',
'    };',
'    /**',
'    * Create a TABLE based HTML key. There\'s lots of options so it\'s',
'    * suggested that you consult the documentation page',
'    * ',
'    * @param mixed id   This should be a string consisting of the ID of the container',
'    * @param object prop An object map of the various properties that you can use to',
'    *                    configure the key. See the documentation page for a list.',
'    */',
'    RG.SVG.HTML.key = function (id, prop)',
'    {',
'        var div = doc.getElementById(id);',
'        /**',
'        * Create the table that becomes the key',
'        */',
'        var str = \'<table border="0" cellspacing="0" cellpadding="0" id="rgraph_key" style="display: inline;\' + (function ()',
'            {',
'                var style = \'\'',
'                for (i in prop.tableCss) {',
'                    if (typeof i === \'string\') {',
'                        style = style + i + \': \' + prop.tableCss[i] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'" \' + (prop.tableClass ? \'class="\' + prop.tableClass + \'"\' : \'\') + \'>\';',
'        /**',
'        * Add the individual key elements',
'        */',
'        for (var i=0; i<prop.labels.length; i+=1) {',
'            str += \'<tr><td><div style="\' + (function ()',
'            {',
'                var style = \'\';',
'                for (var j in prop.blobCss) {',
'                    if (typeof j === \'string\') {',
'                        style = style + j + \': \' + prop.blobCss[j] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'display: inline-block; margin-right: 5px; margin-top: 4px; width: 15px; height: 15px; background-color: \' + prop.colors[i] + \'"\' + (prop.blobClass ? \'class="\' + prop.blobClass + \'"\' : \'\') + \'>&nbsp;</div><td>\' + (prop.links && prop.links[i] ? \'<a href="\' + prop.links[i] + \'">\' : \'\') + \'<span \' + (prop.labelClass ? \'class="\' + prop.labelClass + \'"\' : \'\') + \'" style="\' + (function ()',
'            {',
'                var style = \'\';',
'                for (var j in prop.labelCss) {',
'                    if (typeof j === \'string\') {',
'                        style = style + j + \': \' + prop.labelCss[j] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'" \' + (function ()',
'            {',
'                var style = \'\';',
'                if (prop[\'labelCss_\' + i]) {',
'                    for (var j in prop[\'labelCss_\' + i]) {',
'                        style = style + j + \': \' + prop[\'labelCss_\' + i][j] + \';\';',
'                    }',
'                }',
'                return style ? \'style="\' + style + \'"\' : \'\';',
'            })() + \'>\' + prop.labels[i] + \'</span>\' + (prop.links && prop.links[i] ? \'</a>\' : \'\') + \'</td></tr>\';',
'        }',
'        div.innerHTML += (str + \'</table>\');',
'        // Return the TABLE object that is the HTML key',
'        return doc.getElementById(\'rgraph_key\');',
'    };',
'// End module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph = window.RGraph || {isRGraph: true};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    RGraph.Sheets = function (key)',
'    {',
'        var worksheet,',
'            callback,',
'            letters = \'ABCDEFGHIJKLMNOPQRSTUVWXYZ\';',
'        // 3 arguments',
'        if (arguments.length === 3) {',
'            worksheet = Number(arguments[1]);',
'            callback  = arguments[2];',
'        // 2 arguments',
'        } else {',
'            worksheet = 1;',
'            callback  = arguments[1];',
'        }',
'        var url = \'https://spreadsheets.google.com/feeds/cells/[KEY]/[WORKSHEET]/public/full?alt=json-in-script&callback=__rgraph_JSONPCallback\'.replace(/\\[KEY\\]/, key).replace(/\\[WORKSHEET\\]/, worksheet);',
'        /*',
'        * https://spreadsheets.google.com/feeds/cells/1q_BMjvKO_kKbAO3VjoaITSDyrLAk8f0SK5UFMmE3oRs/2/public/full?alt=json-in-script',
'        */',
'        //',
'        // Loads the spreadsheet',
'        //',
'        this.load = function(url, userCallback)',
'        {',
'            var obj = this;',
'            // A global on purpose',
'            __rgraph_JSONPCallback = function (json)',
'            {',
'                // Save the JSON on the RGraph.Sheets object',
'                obj.json = json;',
'                //',
'                // Put the entries in the JSON feed into a grid',
'                //',
'                var grid = [], row = 0, col = 0;',
'                for (var i=0; i<json.feed.entry.length; ++i) {',
'                    row = json.feed.entry[i].gs$cell.row - 1;',
'                    col = json.feed.entry[i].gs$cell.col - 1;',
'                    if (!grid[row]) {',
'                        grid[row] = [];',
'                    }',
'                    grid[row][col] = json.feed.entry[i].content.$t;',
'                }',
'                //',
'                // Determine the longest row',
'                //',
'                var maxcols = 0; // The max length of the rows',
'                for (var i=0; i<grid.length; ++i) {',
'                    maxcols = grid[i] ? Math.max(maxcols, grid[i].length) : maxcols;',
'                }',
'                //',
'                // Now go through the array and fill in any blank holes.',
'                //',
'                for (var i=0; i<grid.length; ++i) {',
'                    if (typeof grid[i] === \'undefined\') {',
'                        grid[i] = new Array(maxcols);',
'                    }',
'                    for (var j=0; j<maxcols; j++) {',
'                        if (typeof grid[i][j] === \'undefined\') {',
'                            grid[i][j] = \'\';',
'                        }',
'                        // Convert numbers to real numbers and floats here too',
'                        if (grid[i][j].match(/^[0-9]+$/)) {',
'                            grid[i][j] = parseInt(grid[i][j]);',
'                        } else if (grid[i][j].match(/^[0-9.]+$/)) {',
'                            grid[i][j] = parseFloat(grid[i][j]);',
'                        }',
'                    }',
'                }',
'                //',
'                // Save the grid on the object',
'                //',
'                obj.data = grid;',
'                //',
'                // Call the users callback function. Users can access the raw data if',
'                // they want with the obj.data property or by using the accessor',
'                // methods (better)',
'                //',
'                userCallback(obj);',
'            };',
'            // Add the new script tag to the document that pulls in the JSON',
'            //',
'            // With jQuery...',
'            //',
'            //jQuery(\'body\').append("<script src=\'" + url + "\'></script>");',
'            //',
'            // And without jQuery...',
'            var scriptNode = document.createElement(\'SCRIPT\');',
'            scriptNode.src = url;',
'            document.body.appendChild(scriptNode);',
'        };',
'        //',
'        // Fetches a row of data and returns it',
'        //',
'        // @param id    number The numeric index of the column to fetch (starts at 1)',
'        // @param start number The index to start fetching/returning at. The first',
'        //                     character is 1',
'        // @param opt        An option object containing options',
'        //',
'        this.row = function (index, start)',
'        {',
'            var opt = {}, row;',
'            // Default for start is 1',
'            start = start || 1;',
'            //',
'            // Parse the .trim argument',
'            //',
'            if (arguments && typeof arguments[2] === \'object\' && typeof arguments[2].trim === \'boolean\') {',
'                opt.trim = arguments[2].trim;',
'            } else {',
'                opt.trim = true;',
'            }',
'            row = this.data[index - 1].slice(start - 1);',
'            // Trim the array if required',
'            if (opt.trim) {',
'                row = RGraph.SVG.arrayTrim(row);',
'            }',
'            return row;',
'        };',
'        //',
'        // Fetches a column of data and returns it',
'        //',
'        // @param id    number The letter that corresponds to the column',
'        // @param start number The index to start fetching/returning at. The first',
'        //                     character is 1',
'        // @param opt        An option object containing options',
'        //',
'        this.col = function (index, start)',
'        {',
'            var opt = {},',
'                col = [];',
'            // Default for start is 1',
'            start = start || 1;',
'            if (arguments && typeof arguments[2] === \'object\' && typeof arguments[2].trim === \'boolean\') {',
'                opt.trim = arguments[2].trim;',
'            } else {',
'                opt.trim = true;',
'            }',
'            for (var i=0; i<this.data.length; ++i) {',
'                col.push(this.data[i][index - 1]);',
'            }',
'            // Trim the array if required',
'            if (opt.trim) {',
'                col = RGraph.SVG.arrayTrim(col);',
'            }',
'            // Now account for the start index',
'            col = col.slice(start - 1);',
'            return col;',
'        };',
'        //',
'        // Returns the index (zero index) of the given letters',
'        //',
'        this.getIndexOfLetters = function (l)',
'        {',
'            var parts = l.split(\'\');',
'            if (parts.length === 1) {',
'                return letters.indexOf(l) + 1;',
'            } else if (parts.length === 2){',
'                var idx = ((letters.indexOf(parts[0]) + 1) * 26) + (letters.indexOf(parts[1]) + 1);',
'                return idx;',
'            }',
'        }',
'        //',
'        // The get method makes retrieving cells very straightforward,',
'        // for example: obj.get(\'B1\');',
'        //',
'        // @param str string The cells(s) to fetch',
'        // @param     string Optional set of options that are passed',
'        //                   to the relevant row/col function',
'        //',
'        this.get = function (str)',
'        {',
'            // Uppercase letters please!',
'            str = str.toUpperCase();',
'            //',
'            // Handle the style of .get(\'C\') or .get(\'AA\'',
'            //',
'            if (str.match(/^[a-z]+$/i)) {',
'                if (str.length === 1) {',
'                    var index = letters.indexOf(str) + 1;',
'                    return this.col(index, 1, arguments[1]);',
'                } else if (str.length === 2) {',
'                    var index = ((letters.indexOf(str[0]) + 1) * 26) + letters.indexOf(str[1]) + 1;',
'                    return this.col(index, 1, arguments[1]);',
'                }',
'            }',
'            //',
'            // Handle the style of .get(\'2\');',
'            //(fetching a whole row',
'            //',
'            if (str.match(/^[0-9]+$/i)) {',
'                return this.row(str, null, arguments[1]);',
'            }',
'            //',
'            // Handle the style of .get(\'E2\');',
'            //(fetching a single cell)',
'            //',
'            if (str.match(/^([a-z]{1,2})([0-9]+)$/i)) {',
'                var letter = RegExp.$1,',
'                    number = RegExp.$2,',
'                    col    = this.get(letter, {trim: false});',
'                return col[number - 1];',
'            }',
'            //',
'            // Handle the style of .get(\'B2:E2\');',
'            //(fetching the E2 cell to the E2 cell)',
'            //',
'            if (str.match(/^([a-z]{1,2})([0-9]+):([a-z]{1,2})([0-9]+)$/i)) {',
'                var letter1 = RegExp.$1,',
'                    number1 = RegExp.$2,',
'                    letter2 = RegExp.$3,',
'                    number2 = RegExp.$4',
'                if (letter1 === letter2) {',
'                    var cells = [],',
'                        index = this.getIndexOfLetters(letter1),',
'                        col   = this.col(index, null, {trim: false});',
'                    for (var i=(number1 - 1); i<=(number2 - 1); ++i) {',
'                        cells.push(col[i]);',
'                    }',
'                } else if (number1 === number2) {',
'                    var cells = [],',
'                        row   = this.row(number1, null, {trim: false}),',
'                        index1 = this.getIndexOfLetters(letter1),',
'                        index2 = this.getIndexOfLetters(letter2)',
'                    for (var i=(index1 - 1); i<=(index2 - 1); ++i) {',
'                        cells.push(row[i]);',
'                    }',
'                }',
'                // Trim the results',
'                if (arguments[1] && arguments[1].trim === false) {',
'                    // Nada',
'                } else {',
'                    cells = RGraph.SVG.arrayTrim(cells);',
'                }',
'                return cells;',
'            }',
'        };',
'        //',
'        // Load the data',
'        //',
'        this.load(url, callback);',
'    };',
'// End module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph     = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG = RGraph.SVG || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    /**',
'    * This is used in two functions, hence it\'s here',
'    */',
'    RG.SVG.tooltips       = {};',
'    RG.SVG.tooltips.style = {',
'        display:    \'inline-block\',',
'        position:   \'absolute\',',
'        padding:    \'6px\',',
'        fontFamily: \'Arial\',',
'        fontSize:   \'12pt\',',
'        fontWeight: \'normal\',',
'        textAlign:  \'center\',',
'        left:       0,',
'        top:        0,',
'        backgroundColor: \'rgb(255,255,239)\',',
'        color:      \'black\',',
'        visibility: \'visible\',',
'        zIndex:     3,',
'        borderRadius: \'5px\',',
'        boxShadow:  \'rgba(96,96,96,0.5) 0 0 5px\',',
'        transition: \'left ease-out .25s, top ease-out .25s\'',
'    };',
'    //',
'    // Shows a tooltip',
'    //',
'    // @param obj The chart object',
'    // @param opt The options',
'    //',
'    RG.SVG.tooltip = function (opt)',
'    {',
'        var obj = opt.object;',
'        // Fire the beforetooltip event',
'        RG.SVG.fireCustomEvent(obj, \'onbeforetooltip\');',
'        if (!opt.text || typeof opt.text === \'undefined\' || RG.SVG.trim(opt.text).length === 0) {',
'            return;',
'        }',
'        var prop = obj.properties;',
'        /**',
'        * chart.tooltip.override allows you to totally take control of rendering the tooltip yourself',
'        */',
'        if (typeof prop.tooltipsOverride === \'function\') {',
'            // Add the body click handler that clears the highlight if necessary',
'            //',
'            document.body.addEventListener(\'mouseup\', function (e)',
'            {',
'                obj.removeHighlight();',
'            }, false);',
'            return (prop.tooltipsOverride)(obj, opt);',
'        }',
'        // Create the tooltip DIV element',
'        if (!RG.SVG.REG.get(\'tooltip\')) {',
'            var tooltipObj        = document.createElement(\'DIV\');',
'            tooltipObj.className  = prop.tooltipsCssClass;',
'            // Add the default CSS to the tooltip',
'            for (var i in RG.SVG.tooltips.style) {',
'                if (typeof i === \'string\') {',
'                    tooltipObj.style[i] = RG.SVG.tooltips.style[i];',
'                }',
'            }',
'        // Reuse an existing tooltip',
'        } else {',
'            var tooltipObj = RG.SVG.REG.get(\'tooltip\');',
'            tooltipObj.__object__.removeHighlight();',
'            // This prevents the object from continuously growing',
'            tooltipObj.style.width = \'\';',
'        }',
'        if (RG.SVG.REG.get(\'tooltip-lasty\')) {',
'            tooltipObj.style.left = RG.SVG.REG.get(\'tooltip-lastx\') + \'px\';',
'            tooltipObj.style.top  = RG.SVG.REG.get(\'tooltip-lasty\') + \'px\';',
'        }',
'        tooltipObj.innerHTML  = opt.text;',
'        tooltipObj.__text__   = opt.text; // This is set because the innerHTML can change when it\'s set',
'        tooltipObj.id         = \'__rgraph_tooltip_\' + obj.id + \'_\' + obj.uid + \'_\'+  opt.index;',
'        tooltipObj.__event__  = prop.tooltipsEvent || \'click\';',
'        tooltipObj.__object__ = obj;',
'        // Add the index',
'        if (typeof opt.index === \'number\') {',
'            tooltipObj.__index__ = opt.index;',
'        }',
'        // Add the dataset',
'        if (typeof opt.dataset === \'number\') {',
'            tooltipObj.__dataset__ = opt.dataset;',
'        }',
'        // Add the group',
'        if (typeof opt.group === \'number\' || RG.SVG.isNull(opt.group)) {',
'            tooltipObj.__group__ = opt.group;',
'        }',
'        // Add the sequentialIndex',
'        if (typeof opt.sequentialIndex === \'number\') {',
'            tooltipObj.__sequentialIndex__ = opt.sequentialIndex;',
'        }',
'        // Add the tooltip to the document',
'        document.body.appendChild(tooltipObj);',
'        var width  = tooltipObj.offsetWidth,',
'            height = tooltipObj.offsetHeight;',
'        // Move the tooltip into position',
'        tooltipObj.style.left = opt.event.pageX - (width / 2) + \'px\';',
'        tooltipObj.style.top  = opt.event.pageY - height - 15 + \'px\';',
'        /**',
'        * Set the width on the tooltip so it doesn\'t resize if the window is resized',
'        */',
'        tooltipObj.style.width = width + \'px\';',
'        // Fade the tooltip in if the tooltip is not the first view',
'        if (!RG.SVG.REG.get(\'tooltip-lastx\')) {',
'            for (var i=0; i<=30; ++i) {',
'                (function (idx)',
'                {',
'                    setTimeout(function ()',
'                    {',
'                        tooltipObj.style.opacity = (idx / 30) * 1;',
'                    }, (idx / 30) * 200);',
'                })(i);',
'            }',
'        }',
'        // If the left is less than zero - set it to 5',
'        if (parseFloat(tooltipObj.style.left) <= 5) {',
'            tooltipObj.style.left = \'5px\';',
'        }',
'        // If the tooltip goes over the right hand edge then',
'        // adjust the positioning',
'        if (parseFloat(tooltipObj.style.left) + parseFloat(tooltipObj.style.width) > window.innerWidth) {',
'            tooltipObj.style.left  = \'\'',
'            tooltipObj.style.right = \'5px\'',
'        }',
'        // If the canvas has fixed positioning then set the tooltip position to',
'        // fixed too',
'        if (RG.SVG.isFixed(obj.svg)) {',
'            var scrollTop = window.scrollY || document.documentElement.scrollTop;',
'            tooltipObj.style.position = \'fixed\';',
'            tooltipObj.style.top      = opt.event.pageY - scrollTop - height - 10 + \'px\';',
'        }',
'        // Cancel the mousedown event',
'        tooltipObj.onmousedown = function (e)',
'        {',
'            e.stopPropagation();',
'        };',
'        // Cancel the mouseup event',
'        tooltipObj.onmouseup = function (e)',
'        {',
'            e.stopPropagation();',
'        };',
'        // Cancel the click event',
'        tooltipObj.onclick  = function (e)',
'        {',
'            if (e.button == 0) {',
'                e.stopPropagation();',
'            }',
'        };',
'        // Add the body click handler that clears the tooltip',
'        document.body.addEventListener(\'mouseup\', function (e)',
'        {',
'            RG.SVG.hideTooltip();',
'        }, false);',
'        /**',
'        * Keep a reference to the tooltip in the registry',
'        */',
'        RG.SVG.REG.set(\'tooltip\', tooltipObj);',
'        RG.SVG.REG.set(\'tooltip-lastx\', parseFloat(tooltipObj.style.left));',
'        RG.SVG.REG.set(\'tooltip-lasty\', parseFloat(tooltipObj.style.top));',
'        //',
'        // Fire the tooltip event',
'        //',
'        RG.SVG.fireCustomEvent(obj, \'ontooltip\');',
'    };',
'// End module pattern',
'})(window, document);;',
'RGraph.SVG.tooltips.style.zIndex     = \'10000\';',
'{UXPRERENDEREDALIAS}_DlgObj._navigationBar = function(id) {',
'\t\tvar styleName = this.styleName;',
'\t\tvar _id = id //specify the id of the element where the viewbox should be rendered. Typically a div on the component. Set the div style height and width properties',
'\t\tvar _settings = {',
'\t\t\t"dialogId" : this.dialogId + \'_DlgObj\',',
'\t\t\t"inputId": "",',
'\t\t\t"variableName": "",',
'\t\t\t"theme": this.styleName,',
'\t\t\t"animation": {',
'\t\t\t\t"allow": true',
'\t\t\t},',
'\t\t\t"datasource": {',
'\t\t\t\t"lowLevel": "Data",',
'\t\t\t\t"type": "Static JSON"',
'\t\t\t},',
'\t\t\t"multiple": false,',
'\t\t\t"loopNavigate": false,',
'\t\t\t"loopNavigateNullSelection": true,',
'\t\t\t"allowNullSelection": false,',
'\t\t\t"allowTextSelection": false,',
'\t\t\t"allowNullDeselection": false,',
'\t\t\t"autoRefresh": false,',
'\t\t\t"allowAnyValue": false,',
'\t\t\t"captureFocus": false,',
'\t\t\t"scroll": false,',
'\t\t\t"generateLinks": function(data) {',
'\t\t\t\tvar buttonSubTheme = \'circle\';',
'\t\t\t\tvar buttonSubThemeDisabled = \'circleSubtle\'',
'\t\t\t\t//var buttonSubTheme = \'deny\';',
'\t\t\t\t//var buttonSubThemeDisabled = \'deny\';',
'\t\t\t\tif(typeof data.settings == \'undefined\') return \'\';',
'\t\t\t\tvar _ss = data.settings;',
'\t\t\t\tif(_ss.buttonsubtheme != \'undefined\') { ',
'\t\t\t\t\tvar buttonSubTheme = _ss.buttonsubtheme',
'\t\t\t\t\tvar buttonSubThemeDisabled = _ss.buttonsubtheme',
'\t\t\t\t}',
'\t\t\t\tvar listName = data.listName;',
'\t\t\t\t//var listObj = _dlgObj.getControl(listName);',
'\t\t\t\tvar listObj = window[this.dialogId].getControl(listName);',
'\t\t\t\tvar suffix = \'&nbsp;&nbsp;&nbsp;\';',
'\t\t\t\tvar _type = \'list\';',
'\t\t\t\tif(typeof listObj.listVariableName == \'undefined\') _type = \'ss\';',
'\t\t\t\tvar recordsPerPage = \'\';',
'\t\t\t\tif(_ss.showPageSizeSelector) {',
'\t\t\t\t\tvar recordsPerPageOptions = _ss.pageSizes;',
'\t\t\t\t\tvar _s = [];',
'\t\t\t\t\tvar _r = recordsPerPageOptions.split(\',\');',
'\t\t\t\t\tif(_type == \'list\') { ',
'\t\t\t\t\t\tif(_r.indexOf(\'\'+listObj._state.pageSize) == -1) _r.push(\'\'+listObj._state.pageSize);',
'\t\t\t\t\t} else { ',
'\t\t\t\t\t\tif(_r.indexOf(\'\'+listObj.pagination.__pageSize) == -1) _r.push(\'\'+listObj.pagination.__pageSize);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(_type == \'list\') { ',
'\t\t\t\t\t\tfor(var i = 0; i < _r.length; i++) {',
'\t\t\t\t\t\t\tif(_r[i] ==listObj._state.pageSize) {',
'\t\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'" selected="selected">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}\telse {',
'\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} ',
'\t\t\t\t\tif(_type == \'ss\') { ',
'\t\t\t\t\t\tfor(var i = 0; i < _r.length; i++) {',
'\t\t\t\t\t\t\tif(_r[i] == listObj.pagination.__pageSize) {',
'\t\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'" selected="selected">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}\telse {',
'\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} ',
'\t\t\t\t\t_s = _s.join(\' \');',
'\t\t\t\t\tvar _classEdit;',
'\t\t\t\t\tif(window[this.dialogId].styleVersion >=4) {',
'\t\t\t\t\t\t_classEdit = \'edit\';',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\t_classEdit = styleName + \'Edit\';',
'\t\t\t\t\t}',
'\t\t\t\t\trecordsPerPage = \'<select id="s1" value="{pageSize}" class="\'+_classEdit+\'" onchange="var listObj = window[\\\'\'+this.dialogId+\'\\\'].getControl(\\\'\'+listName+\'\\\');listObj._setPageSize(this.value);">\' + _s + \'</select>\';',
'\t\t\t\t\tvar templatePageSize = _ss.pageSizeSelectorTemplate',
'\t\t\t\t\trecordsPerPage = templatePageSize.replace(\'{pageSizeSelector}\',recordsPerPage) + suffix;',
'\t\t\t\t}',
'\t\t\t\tvar _classEdit;',
'\t\t\t\tif(window[this.dialogId].styleVersion >=4) {',
'\t\t\t\t\t_classEdit = \'editPrimary\';',
'\t\t\t\t} else {',
'\t\t\t\t\t_classEdit = styleName + \'Edit\';',
'\t\t\t\t}',
'\t\t\t\tvar pageNavigator = \'<input class="\'+_classEdit+\'" style="width: \'+_ss.currentPageNumberInputControlSize+\'" value="{pageNumber}"  onkeyup="if(event.keyCode == 13) {window[\\\'\'+this.dialogId+\'\\\']._listNavigateToPage(\\\'\'+listName+\'\\\',this.value)}" />\'',
'\t\t\t\t//var pageNumberTemplateButton = A5.buttons.html("",{theme: styleName + ":"+buttonSubThemeDisabled,html: "{pageNumber}",layout: "text"});',
'\t\t\t\tvar pageNumberTemplateButton = A5.buttons.html("",{theme: styleName + ":"+buttonSubTheme,html: "{pageNumber}",layout: "text"},"","disabled");',
'\t\t\t\tvar pnTemplate = \'\';',
'\t\t\t\tif(_ss.showCurrentPageNumber) {',
'\t\t\t\t\tpnTemplate = _ss.currentPageNumberTemplate;',
'\t\t\t\t\tif(_ss.showCurrentPageNumberasInputControl) {',
'\t\t\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageNumber}\',pageNavigator);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageNumber}\',pageNumberTemplateButton);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar firstButtonImage, prevButtonImage, nextButtonImage, lastButtonImage;',
'\t\t\t\tfirstButtonImage = _ss.firstIcon;',
'\t\t\t\tprevButtonImage = _ss.prevIcon;',
'\t\t\t\tlastButtonImage = _ss.lastIcon',
'\t\t\t\tnextButtonImage = _ss.nextIcon',
'\t\t\t\tvar flagShowCurrentPageNumber = _ss.showCurrentPageNumber;',
'\t\t\t\tvar totalPagesTemplate = _ss.currentPageNumberTemplate;',
'\t\t\t\tif(flagShowCurrentPageNumber) {',
'\t\t\t\t\tvar flagShowpageNavigator = _ss.showCurrentPageNumberasInputControl;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar flagShowpageNavigator = false;',
'\t\t\t\t\ttotalPagesTemplate = \'\';',
'\t\t\t\t}',
'\t\t\t\tvar template =  A5.buttons.html("",{theme: styleName + ":"+buttonSubTheme,html: "{pageNumber}",layout: "text"},\'a5-item=\\\'clickNavigationLink:{listName}|{pageNumber}\\\'\');',
'\t\t\t\tvar firstbutton, prevbutton,nextbutton,lastbutton;',
'\t\t\t\tif(data.pageNumber == 1) {',
'\t\t\t\t\t//firstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:firstButtonImage},"") + suffix;',
'\t\t\t\t\t//prevbutton = A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:prevButtonImage},"") + suffix;',
'\t\t\t\t\tfirstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:firstButtonImage},"","disabled") + suffix;',
'\t\t\t\t\tprevbutton = A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:prevButtonImage},"","disabled") + suffix;',
'\t\t\t\t} else {',
'\t\t\t\t\tfirstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:firstButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|first\\\'\') + suffix;',
'\t\t\t\t\tprevbutton =  A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:prevButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|prev\\\'\') + suffix;',
'\t\t\t\t}',
'\t\t\t\tif(data.pageNumber == data.totalPages) {',
'\t\t\t\t\t//lastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:lastButtonImage},"") + suffix;',
'\t\t\t\t\t//nextbutton = A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:nextButtonImage},"") + suffix;',
'\t\t\t\t\tlastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:lastButtonImage},"","disabled") + suffix;',
'\t\t\t\t\tnextbutton = A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:nextButtonImage},"","disabled") + suffix;',
'\t\t\t\t} else {',
'\t\t\t\t\tlastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:lastButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|last\\\'\') + suffix;',
'\t\t\t\t\tnextbutton =  A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:nextButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|next\\\'\') + suffix;',
'\t\t\t\t}',
'\t\t\t\tvar pageNumber = data.pageNumber;',
'\t\t\t\tvar links = _ss.numberOfLinks',
'\t\t\t\tvar totalPages = data.totalPages;',
'\t\t\t\tvar totalRecords = data.totalRecords;',
'\t\t\t\tvar selectedClass = data.selectedClass;',
'\t\t\t\tvar before = [];',
'\t\t\t\tvar after = [];',
'\t\t\t\tvar linksBefore = \'\';',
'\t\t\t\tvar linksAfter = \'\';',
'\t\t\t\tvar totalPagesText = totalPagesTemplate.replace(/{pageCount}/g,\'\'+totalPages);',
'\t\t\t\tvar totalPagesText = totalPagesText.replace(/{recordCount}/g,\'\'+totalRecords);',
'\t\t\t\tif(template == \'\') template = \'{pageNumber}\';',
'\t\t\t\tlinks = $u.n.round((links/2),0,\'d\');',
'\t\t\t\tif( (data.totalPages - data.pageNumber) <=links ) {',
'\t\t\t\t\tlinksAfter = data.totalPages - data.pageNumber',
'\t\t\t\t\tlinksBefore = (links * 2) - linksAfter;',
'\t\t\t\t} else if (pageNumber>links) {',
'\t\t\t\t\tlinksBefore = links',
'\t\t\t\t\tlinksAfter = links',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _p = \'\';',
'\t\t\t\t\tfor(var i = links; i > 0; i--) {',
'\t\t\t\t\t\t_p = pageNumber - i;',
'\t\t\t\t\t\tif(_p >0) {',
'\t\t\t\t\t\t\tbefore.push(_p);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tlinksBefore = before.length',
'\t\t\t\t\tif(linksBefore > links) {',
'\t\t\t\t\t\tlinksBefore = links;',
'\t\t\t\t\t}',
'\t\t\t\t\tlinksAfter = ( (links*2) - linksBefore)',
'\t\t\t\t}',
'\t\t\t\tbefore = [];',
'\t\t\t\tafter = [];',
'\t\t\t\tvar _p = \'\';',
'\t\t\t\tvar _template_i = \'\';',
'\t\t\t\tfor(var i = linksBefore; i > 0; i--) {',
'\t\t\t\t\tif((pageNumber-i) > 0){',
'\t\t\t\t\t\tvar _pn = \'\' + (pageNumber-i);',
'\t\t\t\t\t\t_p = template.replace(/{pageNumber}/g, _pn) + suffix;',
'\t\t\t\t\t\tbefore.push(_p);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tfor(var i = 1; i <= linksAfter; i++) {',
'\t\t\t\t\tif( (pageNumber + i) <= totalPages) {',
'\t\t\t\t\t\tvar _pn = \'\' + (pageNumber + i);',
'\t\t\t\t\t\t_p =  template.replace(/{pageNumber}/g, _pn) + suffix;',
'\t\t\t\t\t\tafter.push(_p);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageCount}\',totalPages);',
'\t\t\t\tvar pageNumberText = pnTemplate.replace(/{pageNumber}/g, pageNumber);',
'\t\t\t\tpageNumberText = pageNumberText.replace(/{recordCount}/g,\'\'+totalRecords);',
'\t\t\t\tif(pageNumberText != \'\') {',
'\t\t\t\t\tpageNumberText = pageNumberText + suffix;',
'\t\t\t\t};',
'\t\t\t\tvar string = recordsPerPage + firstbutton + prevbutton + before.join(\' \') +  pageNumberText +    after.join(\' \') + nextbutton + lastbutton;',
'\t\t\t\tvar _class = \'\';',
'\t\t\t\tif(_ss.buttonSize == "Compact") _class = \'compact\';',
'\t\t\t\tstring = \'<div class="\'+_class+\'">\' + string.replace(/{listName}/g,listName) + \'</div>\'',
'\t\t\t\treturn string;',
'\t\t\t},',
'\t\t\t"layout": "default",',
'\t\t\t"layouts": {',
'\t\t\t\t\'default\' : {',
'\t\t\t\t\ttype: \'template\',',
'\t\t\t\t\ttemplate: [',
'\t\t\t\t\t\'{@[scope].generateLinks}\'',
'\t\t\t\t\t].join(\'\')',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\t"_onInitialize": function() { $acn(listObj.contId,\'{UXPRERENDEREDALIAS}_\' + this.variableName); },',
'\t\t\t"items": {',
'\t\t\t\t\'clickNavigationLink\' : {',
'\t\t\t\t\titemName: \'clickNavigationLink\',',
'\t\t\t\t\tselectable: false,',
'\t\t\t\t\tonClick: function(v,ia,i,ele) {',
'\t\t\t\t\t\tia = ia.split(\'|\');',
'\t\t\t\t\t\tvar list = ia[0];',
'\t\t\t\t\t\tvar target = ia[1];',
'\t\t\t\t\t\tif(target == \'first\' || target == \'prev\' || target == \'next\' || target == \'last\') {',
'\t\t\t\t\t\t\twindow[this.dialogId]._listNavigate(list,target)',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\twindow[this.dialogId]._listNavigateToPage(list,target)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t},',
'\t\t\t\t\'setRecordsPerPage\' : {',
'\t\t\t\t\titemName: \'setRecordsPerPage\',',
'\t\t\t\t\tselectable: false,',
'\t\t\t\t\tonClick: function(v,ia,i,ele) {',
'\t\t\t\t\t\talert(ia);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t}',
'\t\t}',
'\t\tvar _data = {};',
'\t\t//_settings.onBeforePopulate = function() { debugger;}',
'\t\tvar navBar =  new A5.ViewBox(_id,_data,_settings);',
'\t\treturn navBar',
'\t}',
'{UXPRERENDEREDALIAS}_DlgObj._layoutMode = \'containerwidth\';',
'{UXPRERENDEREDALIAS}_DlgObj._responsiveRulesMode = \'firsttrue\';',
'{UXPRERENDEREDALIAS}_DlgObj.__controlNesting = {',
'CONTAINER_1: [\'FromDate\',\'ToDate\',\'MEDREPN\'],',
'PANELHEADER_2: []',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._listsDV = [];',
'{UXPRERENDEREDALIAS}_DlgObj._listControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._formBoxControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._localStorageSettings = {namespace: \'ALPHA_b48f23963f2540c8a109820f8de8d33f\',friendlyName: \'\',description: \'\',persistVariableValues: false,__version: 1,persistComponentState: false,workingPreviewTestingFolder: \'\',restore: {variables: false,data: false,state: false},compressData: false,minify: false,variablesToNotPersist: \'\',workingPreviewTestingMode: \'Browser\',compressListData: false}',
';',
'{UXPRERENDEREDALIAS}_DlgObj.__r = [];',
'{UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML = false;',
'{UXPRERENDEREDALIAS}_DlgObj._EDITOR_EDITORSET = {};',
'{UXPRERENDEREDALIAS}_DlgObj.styleName = \'Alpha-Magenta\';',
'{UXPRERENDEREDALIAS}_DlgObj.styleVersion = 4',
'{UXPRERENDEREDALIAS}_DlgObj.framesInfo = {',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._beforePrepare = function(e) { ;if({UXPRERENDEREDALIAS}_DlgObj.styleVersion < 3) {',
'\tA5.themes.add(\'Alpha-Magenta\', {edit: {base: { className: \'Alpha-MagentaEdit\', errorClassName: \'Alpha-MagentaEditError\', watermark: {className: \'Alpha-MagentaEditWatermark\'}}}});',
'}',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._noPersist = []',
'{UXPRERENDEREDALIAS}_DlgObj._ssdecimal = \'.\';',
'var ele = \'\';',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'MedrepId\'); $sa(ele,\'tabIndex\',1); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'FromDate\'); $sa(ele,\'tabIndex\',2); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'ToDate\'); $sa(ele,\'tabIndex\',3); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'BUTTON_1\'); $sa(ele,\'tabIndex\',4); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'BUTTON_2\'); $sa(ele,\'tabIndex\',5); ',
'ele = {UXPRERENDEREDALIAS}_DlgObj.getPointer(\'MedrepId\'); if(ele) ele.focus();',
'var ele = \'\';',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'MedrepId\'); $sa(ele,\'tabIndex\',1); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'FromDate\'); $sa(ele,\'tabIndex\',2); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'ToDate\'); $sa(ele,\'tabIndex\',3); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'BUTTON_1\'); $sa(ele,\'tabIndex\',4); ',
'ele ={UXPRERENDEREDALIAS}_DlgObj.getPointer(\'BUTTON_2\'); $sa(ele,\'tabIndex\',5); ',
'ele = {UXPRERENDEREDALIAS}_DlgObj.getPointer(\'MedrepId\'); if(ele) ele.focus();',
'{UXPRERENDEREDALIAS}_DlgObj._modernFrames = {};',
'{UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls = {UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls = {}',
'{UXPRERENDEREDALIAS}_DlgObj.__r = [];',
'var ele2 = $(\'{UXPRERENDEREDALIAS}.R1\'); if(ele2) {',
'var ele = document.createElement(\'div\');',
'ele.innerHTML = \'\\n<div style="display:none;"><span><input\\ttype="text" id="{UXPRERENDEREDALIAS}.V.R1.CURRENTUSER" title=""     class="[theme:edit.base.className|class.dialogInput] " style=""  onchange="var tfunc = function() {onChange_currentuser_5020163a25df48acbbac46af43b34c1a.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   name="V.R1.CURRENTUSER"    value=""    />\\n</span>\\n</div>\\n\';',
'ele2.appendChild(ele);',
'};',
'window.__preventDefault = function(event) { event.preventDefault()};',
'setTimeout(function() {; },100);',
'{UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML = false;',
'{UXPRERENDEREDALIAS}_DlgObj._listInsideCards = {',
'}',
';{UXPRERENDEREDALIAS}_DlgObj.__workingPreviewProject = \'C:/amigacloud/AMIGACLOUD/AMIGACLOUD.WebProjects/Default.WebProject\';',
'{UXPRERENDEREDALIAS}_DlgObj._freeformLayoutLists = {',
'};',
'var ele = {UXPRERENDEREDALIAS}_DlgObj.getPointer(\'CONTAINER_FORGOTPASSWORDLINK\'); if(ele) ele.style.display = \'none\';{UXPRERENDEREDALIAS}_DlgObj.____passwordReset = false;{UXPRERENDEREDALIAS}_DlgObj.____createAccount = false;;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHGOOGLE\',false);;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHCOGNITO\',false);;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHFIREBASE\',false);',
'{UXPRERENDEREDALIAS}_DlgObj.__serverVersion = \'9305-5711\';',
'{UXPRERENDEREDALIAS}_DlgObj.__guid = \'b48f2396-3f25-40c8-a109-820f8de8d33f\';',
'{UXPRERENDEREDALIAS}_DlgObj._watchEvents = []',
'{UXPRERENDEREDALIAS}_DlgObj._csDateFormats = {',
'\t\'FROMDATE\' : {dateformat: \'<DefaultDateOnlyFormat>\'}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._dataBindingJSONForm = \'\';',
'var href = window.location.href;',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \'locationHref\' : href}); ',
'{UXPRERENDEREDALIAS}_DlgObj.__panelLayouts = []',
';{UXPRERENDEREDALIAS}_DlgObj.__parentAlias = \'__parentAliasNotDefined\'; ',
'{UXPRERENDEREDALIAS}_DlgObj.__info = {',
'\t"description": "",',
'\t"createdBy": "WarrenD",',
'\t"lastUpdatedBy": "",',
'\t"dateCreated": "2019-10-10",',
'\t"dateLastEdited": "2024-9-2",',
'\t"comments": "",',
'\t"revisionnumber": 42',
'}',
'A5.__csdfmt = (obj) =>{ if(obj) return obj.stateInfo.__dtfmt};{UXPRERENDEREDALIAS}_DlgObj._workingPreview = false;',
'$u.decimal = \'.\';',
'$u.comma = \',\';',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_1\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {{UXPRERENDEREDALIAS}_O_B1CA1F40726C45E393970E7FC0CBB884(1,\'1\',this); } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_1\');',
'',
'{UXPRERENDEREDALIAS}_DlgObj.prepare();',
'{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'',
'',
'if(!A5.flags.isMobile) $e.add(window,\'resize\',{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation,null,false,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'else $e.add(window,\'orientationchange\',{UXPRERENDEREDALIAS}_DlgObj._orientationChangeHandler,{UXPRERENDEREDALIAS}_DlgObj,true,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation();',
'',
'{UXPRERENDEREDALIAS}_DlgObj._functions._windowResize = function() {',
'\tvar _d = 50;',
'',
'',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._windowResizeDelay != \'undefined\') _d = {UXPRERENDEREDALIAS}_DlgObj._windowResizeDelay;',
'\tclearTimeout({UXPRERENDEREDALIAS}_DlgObj._wrTO);',
'\t{UXPRERENDEREDALIAS}_DlgObj._wrTo = setTimeout(function() {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWindowResize\',{});',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule) {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule() ',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes) { {UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes(); }',
'\t},_d);',
'}',
'$e.add(window,\'resize\',{UXPRERENDEREDALIAS}_DlgObj._functions._windowResize,null,false,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'setTimeout(function() {',
'\tif({UXPRERENDEREDALIAS}_DlgObj.resizeLists) { {UXPRERENDEREDALIAS}_DlgObj.resizeLists(); }  ;',
'\t//do initial formbox resize',
'\tif({UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes) { {UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes(); }',
'\t',
'\t',
'},0);',
'',
';',
'',
'',
'',
'',
'',
'setTimeout(function() { },0);',
'',
'',
'{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onInitializeComplete\');',
'{UXPRERENDEREDALIAS}_DlgObj.initialized = true;',
'',
'',
'',
'',
';{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \t__args_c_MUSERNAME: \'kozahaya Diab\', \targValuesENC: \'7C3tO+HPao1tWcIGokmhVUuRKT8xaBCUWW/GLDZ/UIhwOiE8+W+qpCorHx1/aC/j\', \t__debugInfo: \'ssi-6014\' });//ssi-6014;',
';',
'',
'',
'setTimeout(function() { ;',
';',
'{UXPRERENDEREDALIAS}_DlgObj._onRenderComplete = function() { var a = {UXPRERENDEREDALIAS}_DlgObj._listControls;',
'if(typeof a != \'undefined\') { ',
'\tfor(var i = 0; i < a.length; i++) {',
'\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(a[i])',
'\t\tif(obj._refreshStateMessages) obj._refreshStateMessages();',
'\t}',
'};',
'var flagStaticHTML = {UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML',
'if(typeof flagStaticHTML == \'undefined\') flagStaticHTML = false; ',
'if(flagStaticHTML) { ',
'',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'a5dialogHelper_staticHTMLInitialCallback\')',
'}',
'',
'var href = window.location.href;',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \'locationHref\' : href}); ',
'',
'{UXPRERENDEREDALIAS}_DlgObj._runJSOnLoad(); {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule(); }; ',
'',
'var winObj = A5.windows.getFromElement({UXPRERENDEREDALIAS}_DlgObj.dialogId + \'.R1\');',
'if(winObj) { ',
'\tif(typeof winObj._uxComponents == \'undefined\') winObj._uxComponents = [];',
'\twinObj._uxComponents.push({UXPRERENDEREDALIAS}_DlgObj.dialogId);',
'\t',
'',
'\t',
'}',
';',
'var pObj = window[\'{UXPRERENDEREDALIAS}_PanelObj\'];',
'if(pObj) pObj.refresh(true);',
';\t',
'//this code ensures that content is shown in the mobile peview window even if the content does not use Panels',
'var eled = $(\'device.screen\')',
'if(eled) { ',
'\teled2 = eled.firstChild ',
'\teles = $(\'{UXPRERENDEREDALIAS}.R1\');',
'\ttry{eled2.appendChild(eles);}catch(e) { };',
'};',
'',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({\'__locationhref\':location.href})',
'',
'///////////',
'if({UXPRERENDEREDALIAS}_DlgObj.__restorePanelSizes) {{UXPRERENDEREDALIAS}_DlgObj.__restorePanelSizes();}',
'setTimeout(function(){ var pObj = window[\'{UXPRERENDEREDALIAS}_PanelObj\']; if(pObj) pObj.refresh();},100);;setTimeout(function() { if({UXPRERENDEREDALIAS}_DlgObj) {var obj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();\t\tif(obj && obj.resize && typeof obj.resize == \'function\') obj.resize();\t\t\t}},100);',
'setTimeout(function() {',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onRenderComplete\'); ',
'\tvar ele = window.frameElement;',
'if (ele) {',
'\tvar panelCardName = $ga(ele,\'A5-PARENTPANEL\');',
'\tvar flagDoResize = true;',
'\tvar flagResize = $ga(ele,\'A5-RESIZE\');',
'\tif(flagResize ==\'NO\') flagDoResize = false',
'\t',
'\tif(panelCardName) {',
'\t\tvar po = {UXPRERENDEREDALIAS}_DlgObj.getParentObject();',
'\t\tif(po) var pId = po.panelGetId(panelCardName,\'body\');',
'\t\tvar pEle = parent.$(pId);',
'\t\tele.style.width = \'100%\';',
'\t\tif(pEle) ele.style.height = pEle.style.height;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc = function() {',
'\t\t\tvar ele = parent.$(this.getAttribute(\'CHILDUXIFRAME\'));',
'\t\t\tif(ele) ele.style.height = this.style.height;',
'\t\t }',
'\t\tparent.$e.add(pEle,\'a5resize\',{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc);',
'\t\tif(pEle) pEle.setAttribute(\'CHILDUXIFRAME\',ele.id);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._onDestroy = function() { ',
'\t\t\tparent.$e.remove(pEle,\'a5resize\',{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc);',
'\t\t}',
'\t} else if(flagDoResize) { ',
'\t\tele.style.width = \'100%\';',
'\t\tvar _height = ele.contentDocument.documentElement.scrollHeight + \'px\';',
'\t\tele.style.height = _height;',
'\t\tvar observer = new ResizeObserver(function(){',
'\t\t\tvar _height = ele.contentDocument.documentElement.scrollHeight + \'px\';',
'\t\t\tele.style.height = _height;',
'\t\t\t});',
'\t\tobserver.observe(ele.contentDocument.documentElement);',
'\t}',
'}',
';;',
'\t{UXPRERENDEREDALIAS}_DlgObj.flagRenderComplete = true;',
'\tvar _flagPGApp = false;',
'\tif(typeof _phoneGapSettings == \'function\') {',
'\t\t_flagPGApp = true;',
'\t\t/*',
'\t\tif(typeof cordova == \'object\') {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = true;',
'\t\t} else {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = false;',
'\t\t};',
'\t\t*/',
'\t};',
'',
'',
'',
'\t//alert(\'is a pg app: \' + _flagPGApp + \'  _cordovaReady: \' + {UXPRERENDEREDALIAS}_DlgObj._cordovaReady );',
'\tif(!_flagPGApp) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._restoreFromLocalStorage();',
'\t} else {',
'',
'\t\t//phonegap app, but phonegap may not yet be loaded',
'\t\t//alert(\'register the _restoreFormLocalStorage to fire when phonegap is ready\');',
'',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._delayTillPhoneGapReady({UXPRERENDEREDALIAS}_DlgObj._restoreFromLocalStorage,{UXPRERENDEREDALIAS}_DlgObj);',
'\t}',
'',
' },0);',
' ',
' ',
' ',
';',
'setTimeout(function() { ',
'\tvar key = \'INSTANCEGUID_\' + {UXPRERENDEREDALIAS}_DlgObj.componentGUID;',
'\tvar instanceGuid = localStorage.getItem(key)',
'\tif(instanceGuid == null || instanceGuid == \'\' || typeof instanceGuid == \'undefined\') { ',
'\t\tvar instanceGuid = A5.UUID()',
'\t\tlocalStorage.setItem(key,instanceGuid)',
'\t} else { ',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.instanceGUID = instanceGuid;',
'},0);',
';',
'',
'var o2 = \'portrait\';',
'if(window.innerHeight < window.innerWidth) o2 = \'landscape\';',
'{UXPRERENDEREDALIAS}_DlgObj._screen = {h: window.innerHeight, w: window.innerWidth, o: o2};',
'',
'{UXPRERENDEREDALIAS}_DlgObj._getOnlineStatus();',
'try {',
'$e.removeGroup(\'window_offline_event\');',
'$e.add(window,\'offline\',function() { if({UXPRERENDEREDALIAS}_DlgObj) {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'offline\') }, null,false,\'window_offline_event\');',
'$e.add(window,\'online\',function() {  if({UXPRERENDEREDALIAS}_DlgObj) {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'online\') }, null,false,\'window_offline_event\')',
'//window.addEventListener("offline",function() {  {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'offline\') });',
'//window.addEventListener("online",function() { {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'online\') });',
'} catch(err){}',
'',
'',
'',
'setTimeout(function() {$e.execute(\'device.screen\',\'a5resize\')},1);',
';',
'',
'if({UXPRERENDEREDALIAS}_DlgObj.restoreListLayouts) {UXPRERENDEREDALIAS}_DlgObj.restoreListLayouts();',
'',
'},0);;',
'{UXPRERENDEREDALIAS}_DlgObj._controlBarData = {',
'\t"CONTROLBAR_1": {',
'\t}',
'}',
';;',
'{UXPRERENDEREDALIAS}_DlgObj._controlBarExpandingMenuSettings = {',
'\t"CONTROLBAR_1": {',
'\t}',
'}',
';setTimeout(function() { },10);;',
'{UXPRERENDEREDALIAS}_DlgObj._activeLanguage = \'\';',
''].join('\n');
jsout = jsout.replace(/\{UXPRERENDERAJAXURL\}/g,'');
jsout = jsout.replace(/\{UXPRERENDEREDALIAS\}/g,go.alias);
jsout = jsout.replace(/\{UXPRERENDEROUTPUTDIV\}/g,go.dialog2Div);
;return jsout}; 
function PRECOMPUTEDUX_f893cadd071642ecb30a586c2775a9ce_MessagesMobile(go) { 
var jsout = [
'A5.u.element.setContent(\'{UXPRERENDEROUTPUTDIV}\',\'<div class="page  compact "><style type="text/css">\\n.iconSizeable {\\n  vertical-align: middle;\\n  height: auto;\\n  width: auto;\\n  fill: #000;\\n  stroke: #000; }\\n.iconDisabled {\\n  opacity: .75; }\\n.icon {\\n  vertical-align: middle;\\n  width: 26px;\\n  height: 26px; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRow {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRow:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  opacity: 1;\\n  border: 10px solid orange;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_newRow {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_newRow:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  opacity: 1;\\n  border: 10px solid blue;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_hasError {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_hasError:after {\\n  content: "";\\n  position: absolute;\\n  bottom: 0px;\\n  right: 0px;\\n  opacity: 1;\\n  border: 10px solid red;\\n  border-bottom-width: 0px;\\n  border-left-width: 0px;\\n  border-top-color: transparent; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRow {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRow:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  opacity: 1;\\n  border: 10px solid purple;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowInherited {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowInherited:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  border: 10px solid orange;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent;\\n  opacity: .3; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRowInherited {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRowInherited:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  border: 10px solid purple;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent;\\n  opacity: .3; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_newRowInherited {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_newRowInherited:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  border: 10px solid blue;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent;\\n  opacity: .3; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_hasErrorInherited {\\n  position: relative; }\\n._{UXPRERENDEREDALIAS}_LSTMESSAGE_hasErrorInherited:after {\\n  content: "";\\n  position: absolute;\\n  bottom: 0px;\\n  right: 0px;\\n  border: 10px solid red;\\n  border-bottom-width: 0px;\\n  border-left-width: 0px;\\n  border-top-color: transparent;\\n  opacity: .3; }\\n.parentDeleted {\\n  position: relative; }\\n.parentIsDeleted .parentDeleted:before {\\n  content: "";\\n  position: absolute;\\n  top: 0px;\\n  right: 0px;\\n  border: 10px solid purple;\\n  border-top-width: 0px;\\n  border-left-width: 0px;\\n  border-bottom-color: transparent;\\n  opacity: .3; }\\n</style>\\n<style>\\n</style><iframe style="display:none;" id="{UXPRERENDEREDALIAS}.__IFRAME1"></iframe>\\n<input type="hidden" value="" id="{UXPRERENDEREDALIAS}.PARAMETERBUCKET"/>\\n<input type="file" style="position:absolute; top:-1000px;visibility:hidden;" capture accept="image/*" id="{UXPRERENDEREDALIAS}._GETPHOTO"/><input type="file" style="position:absolute; top:-1000px;visibility:hidden;" name="files[]" multiple = "" id="{UXPRERENDEREDALIAS}._GETFILEMULTI"/><input type="file" style="position:absolute; top:-1000px;visibility:hidden;" name="files[]" id="{UXPRERENDEREDALIAS}._GETFILE"/><input type="hidden" id="{UXPRERENDEREDALIAS}.V.R1.LSTMESSAGE" name="V.R1.LSTMESSAGE" />\\n<input type="hidden" id="{UXPRERENDEREDALIAS}.V.R1.LIST1" name="V.R1.LIST1" />\\n</div>\');',
'',
'//mark 2',
'',
'if(typeof A5.pickers == \'undefined\'){\t',
'/*',
'Copyright (c) 2001, 2024 Alpha Software Corporation',
'All Rights Reserved.',
'This JavaScript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'A5.pickers={_:{pi:0,pci:{}},u:{get:function(id){var p=A5.pickers._.pci[id];if(!p)p=null;return p;}},guides:{\'list\':{display:{mode:\'flex\',width:\'stretch\',height:\'max\'},settings:{height:\'300px\',multiple:false,separator:\', \',selectionMode:\'default\',allowNullSelection:true,allowNullDeselection:true,filter:{allow:false,edit:{className:\'\'}},data:{filter:false,order:false,wait:{message:\'Loading...\'},empty:{message:\'No Results...\'}},item:{className:\'\',style:\'\'},onSelect:false},autoFilter:function(d){if(!this._.re)return true;if(typeof d==\'object\'&&d!=null){if(typeof d.type==\'string\'&&d.type==\'title\')return false;if(typeof d.value==\'string\'&&d.value.search(this._.re)!=-1)return true;if(typeof d.html==\'string\'&&d.html.search(this._.re)!=-1)return true;}else if(typeof d==\'string\'&&d.search(this._.re)!=-1)return true;return false;},processData:function(d,s,c){if(!d||d.constructor!=Array)return[];var f=s.data.filter;var changed=false;c._.re=false;if(f==\'contains\'||f==\'starts-with\'){var v=c.state.value.current;if(v!=\'\'&&v!=null){var re=\'\';if(f==\'contains\')re=new RegExp(String(v).escapeRegExp(),\'i\');else if(f==\'starts-with\')re=new RegExp(\'^\'+String(v).escapeRegExp(),\'i\');f=this.autoFilter;c._.re=re;}else f=false;}',
'if(typeof f==\'function\'){var td=[];for(var i=0;i<d.length;i++){if(f.call(c,d[i]))td.push(d[i]);}',
'if(!c._.re)changed=true;else{if(td.length!=1)changed=true;else if(typeof td[0]==\'string\'&&td[0]!=v)changed=true;else if(typeof td[0]==\'object\'&&td[0].value!=v)changed=true;}',
'if(changed)d=td;}',
'if(s.data.order){A5.u.array.order(d,s.data.order,this);changed=true;}',
'if(changed){var td=[];var di=null;for(var i=0;i<d.length;i++){di=d[i];if(typeof di==\'string\'||(typeof di==\'object\'&&!(typeof di.type==\'string\'&&di.type==\'title\')))td.push(di);}',
'd=td;}',
'return d;},init:function(ele,inst){var tl={};A5.themes.assign(tl,this.theme,\'listbox\');var id=ele.id+\'.\';inst.ctrl=new A5.ViewBox(ele.id,[],{pid:inst.id,allowAnyValue:true,allowNullSelection:true,allowNullDeselection:true,onChange:function(){var p=A5.pickers.u.get(this.pid);var c=[];var dj=null;var vi=null;for(var i=0;i<this.value.length;i++){vi=this.value[i];for(var j=0;j<this.data.length;j++){dj=this.data[j];if(typeof dj==\'object\'&&dj!=null){if(typeof dj.type==\'undefined\'||dj.type!=\'title\'){if(dj.value==vi)c.push(dj);}}else if(vi==dj)c.push(dj);}}',
'p.state.value.context=c;},items:{\'list-item\':{selectable:true,selectedClassName:tl.item.selectedClassName,onClick:function(v,ia,ele,e){A5.pickers.u.get(this.pid).commit(!this.multiple);}}},wrapper:{allow:true,html:\'<div class="\'+tl.header.className+\'" style="display: none;">Header</div><div a5-layout-target="true" style="flex: 1 1;"></div>\'},layout:\'list\',layouts:{\'list\':{type:\'template\',template:[\'{*if [root].length == 0}<div id="\'+id+\'EMPTY" class="\'+tl.item.className+\'"">{[scope].emptyMsg}</div>{*endif}\',\'{*root}\',\'{*if typeof [value] != \\\'object\\\'}\',\'<div id="\'+id+\'{[count]}" class="\'+tl.item.className+\' {[scope].getItemClassName([value])}" style="{[scope].getItemStyle([value])}" onmouseover="A5.u.element.cls(this,\\\'+=\'+tl.item.hoverClassName+\'\\\')" onmouseout="A5.u.element.cls(this,\\\'-=\'+tl.item.hoverClassName+\'\\\')" a5-item="list-item:{[count]}" a5-value="{[value]}">{[value]}</div>\',\'{*elseif <defined<type>> && type == \\\'title\\\'}\',\'<div class="\'+tl.item.titleClassName+\'">{html}</div>\',\'{*else}\',\'<div id="\'+id+\'{[count]}" class="\'+tl.item.className+\' {[scope].getItemClassName([value])}" style="{[scope].getItemStyle([value])}" onmouseover="A5.u.element.cls(this,\\\'+=\'+tl.item.hoverClassName+\'\\\')" onmouseout="A5.u.element.cls(this,\\\'-=\'+tl.item.hoverClassName+\'\\\')" a5-item="list-item:{[count]}" a5-value="{value}">{*if <defined<[value].html>>}{html}{*else}{text:escape}{*endif}</div>\',\'{*endif}\',\'{/*root}\'].join(\'\')},\'wait\':{type:\'template\',template:\'<div id="\'+id+\'WAIT" class="\'+tl.item.className+\'"">{[scope].waitMsg}</div>{*root}{/*root}\'}},getItemClassName:function(d){var v=this._itemCls;var t=typeof v;if(t==\'function\')return v(d);else if(t==\'string\')return v;return\'\';},getItemStyle:function(d){var v=this._itemStyle;var t=typeof v;if(t==\'function\')return v(d);else if(t==\'string\')return v;return\'\';}});ele.style.flexDirection=\'column\';A5.u.drag.add(ele,\'scroll\',{axis:\'y\'});},show:function(inst,st){var s=st.picker.settings;inst.element.style.maxHeight=s.height;inst.ctrl.multiple=s.multiple;inst.ctrl.selectionMode=s.selectionMode;inst.ctrl.allowNullSelection=s.allowNullSelection;inst.ctrl.allowNullDeselection=s.allowNullDeselection;inst.ctrl._itemCls=s.item.className;inst.ctrl._itemStyle=s.item.style;var d=null;if(st.data&&st.data.constructor==Array)d=st.data;else{if(inst.ctrl.layout!=\'wait\')inst.ctrl.layout=\'wait\';inst.ctrl.waitMsg=s.data.wait.message;inst.ctrl.refresh();return false;}',
'inst.ctrl.emptyMsg=s.data.empty.message;if(inst.ctrl.layout==\'wait\')inst.ctrl.layout=\'list\';d=inst.def.processData(d,s,this);inst.ctrl.populate(d);var vals=st.value.current;if(s.multiple&&vals.constructor!=Array){if(s.separator)vals=vals.split(s.separator);else vals=[vals];if(vals.join(\'\')==\'\')vals=[];}',
'inst.ctrl.setValue(vals);},update:function(type,inst,st){var s=st.picker.settings;var ud=type.indexOf(\'data\')!=-1;if(s.data.filter||s.data.order||ud){if(ud)inst.ctrl.layout=st.data?\'list\':\'wait\';var d=inst.def.processData(st.data,s,this);inst.ctrl.populate(d);var vals=st.value.current;if(s.multiple&&vals.constructor!=Array){if(s.separator)vals=vals.split(s.separator);else vals=[vals];}',
'inst.ctrl.setValue(vals);}},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst&&(name==\'first\'||name==\'last\'||name==\'prev\'||name==\'previous\'||name==\'next\')){if(inst.ctrl.selectionInfo.active.has)inst.ctrl.navigate(name);else inst.ctrl.navigate(\'first\');}},commit:function(inst,st){var s=st.picker.settings;if(s.multiple){var v=A5.u.array.unique(inst.ctrl.value);if(s.separator)return v.join(s.separator);else return v;}else return inst.ctrl.value.length>0?inst.ctrl.value[0]:null;}},\'date-time\':{display:{mode:\'\',width:\'\',height:\'max\'},settings:{format:A5.d.date.format},init:function(ele,inst){ele.style.textAlign=\'center\';ele.innerHTML=\'<div id="\'+ele.id+\'.C" style="display: inline-block;"></div>\'',
'inst.ctrl=new A5.DateTimePicker(ele.children[0].id,{theme:this.theme,pid:inst.id,datePicker:{navigator:{header:{todayButton:{show:true}}}},combinedContainer:{buttons:{show:\'auto\'}},onCommit:function(){A5.pickers.u.get(this.pid).commit();},onCancel:function(){A5.pickers.u.get(this.pid).cancel();}});},show:function(inst,st){var s=st.picker.settings;inst.ctrl.setFormat(s.format);var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},update:function(type,inst,st){var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst){var dpp=inst.ctrl._dp._curPane[0];if(name[0]==\'p\'){if(dpp==\'y\')inst.ctrl._dp.prevDecade();else if(dpp==\'m\')inst.ctrl._dp.prevYear();else inst.ctrl._dp.prevMonth();}else if(name[0]==\'n\'){if(dpp==\'y\')inst.ctrl._dp.nextDecade();else if(dpp==\'m\')inst.ctrl._dp.nextYear();else inst.ctrl._dp.nextMonth();}}},commit:function(inst,st){return inst.ctrl.date.toFormat(st.picker.settings.format);}},\'date\':{display:{mode:\'\',width:\'\',height:\'max\'},settings:{format:A5.d.date.format},init:function(ele,inst){ele.style.textAlign=\'center\';ele.innerHTML=\'<div id="\'+ele.id+\'.C" style="display: inline-block;"></div>\';inst.ctrl=new A5.DatePicker(ele.children[0].id,{theme:this.theme,pid:inst.id,navigator:{header:{todayButton:{show:true}}},onClick:function(){A5.pickers.u.get(this.pid).commit();}});},show:function(inst,st){var s=st.picker.settings;inst.ctrl.setFormat(s.format);var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},update:function(type,inst,st){var v=this.state.value.current||new Date();inst.ctrl.setValue(v);},action:function(name,args,inst,st,sameInst,samePicker){if(sameInst){var dpp=inst.ctrl._curPane[0];if(name[0]==\'p\'){if(dpp==\'y\')inst.ctrl.prevDecade();else if(dpp==\'m\')inst.ctrl.prevYear();else inst.ctrl.prevMonth();}else if(name[0]==\'n\'){if(dpp==\'y\')inst.ctrl.nextDecade();else if(dpp==\'m\')inst.ctrl.nextYear();else inst.ctrl.nextMonth();}}},commit:function(inst,st){return inst.ctrl.date.toFormat(st.picker.settings.format);}}}}',
'A5.Picker=Class.create({initialize:function(s){A5.u.object.assign(this,{theme:\'\',layout:\'\',layouts:{},onBeforeShow:false,onShow:false,onBeforeCommit:false,onCommit:false,onBeforeCancel:false,onCancel:false,onBeforeHide:false,onHide:false,onBeforeDestroy:false,onDestroy:false,state:{}});A5.u.object.assign(this,s);this._={id:\'A5PICKER.\'+A5.pickers._.pi,update:function(p,st,val){var stb=st.binding;if(stb.type==\'element\'){var be=$(stb.id);val=$gvs(be);var tn=be.tagName.toLowerCase()',
'if(this.state==\'show\'&&(tn==\'input\'||tn==\'textarea\')){be.focus();be.select();}}else if(stb.type==\'path\')val=A5.u.object.get(st.context,stb.path);if(this.process)val=this.process.call(p,val,st.data,st.context,st.scope);if(this.state==\'show\')st.value.initial=val;st.value.current=val;},hide:function(p){if(p.state.shown){if(typeof p.onBeforeHide==\'function\'){var res=p.onBeforeHide();if(typeof res==\'boolean\'&&!res)return false;}',
'var st=p.state;st.shown=false;var stb=st.binding;var def=p._.picker.def;if(typeof def.hide==\'function\')def.hide.call(p,p._.picker,st);p._.trans.hide();if(typeof p.onHide==\'function\')p.onHide();}},state:\'\',pickers:{},dState:{shown:false,instanceId:\'\',picker:{type:\'\',settings:null},target:{type:\'\',id:\'\',data:null,position:null},binding:{type:\'\',path:\'\',id:\'\'},value:{initial:\'\',current:\'\',context:null},data:null,context:null,scope:null}}',
'A5.u.object.assign(this.state,this._.dState);this._.trans=new A5.Transient({theme:this.theme,pickerId:this._.id,layout:this.layout,layouts:this.layouts,onShown:function(){var pObj=A5.pickers._.pci[this.pickerId];var def=pObj._.picker.def;if(typeof def.shown==\'function\')def.shown.call(pObj,pObj._.picker,pObj.state);},onHidden:function(){var pObj=A5.pickers._.pci[this.pickerId];pObj.state.shown=false;pObj._.state=\'hidden\';var def=pObj._.picker.def;if(typeof def.hidden==\'function\')def.hidden.call(pObj,pObj._.picker,pObj.state);pObj._.bs=null;pObj._.picker=null;A5.u.object.assign(pObj.state,pObj._.dState);}});this._.trans._.ele.style.zIndex=\'500\';A5.pickers._.pi++;A5.pickers._.pci[this._.id]=this;},destroy:function(){if(typeof this.onBeforeDestroy==\'function\')this.onBeforeDestroy.call(this);var po=null;for(var pn in this._.pickers){po=this._.pickers[pn];if(typeof po.destroy==\'function\')po.destroy();}',
'this._.trans.destroy();if(typeof this.onDestroy==\'function\')this.onDestroy.call(this);},setLayout:function(l){this._.trans.setLayout(l);},show:function(pt,t,b,d,ps,c,sc){var zIndx=500;if(typeof A5.Window!=\'undefined\')zIndx=Math.max(zIndx,A5.Window.prototype._maxDlgZIndx[0]);this._.trans._.ele.style.zIndex=\'\'+(zIndx+1);var def=A5.pickers.guides[pt];if(!def)return false;var s=null;if(!ps)var ps=def.settings;else A5.u.object.assign(ps,def.settings,true);if(!this._.pickers[pt]){var ele=document.createElement(\'div\');ele.id=this._.id+\'.\'+pt;ele.style.display=\'none\';this._.pickers[pt]={element:ele,def:def,id:this._.id};s=this._.pickers[pt];var cEle=this._.trans.getElement(\'content\');cEle.appendChild(ele);def.init.call(this,ele,s);}else s=this._.pickers[pt];if(s){if(typeof this.onBeforeShow==\'function\'){var res=this.onBeforeShow();if(typeof res==\'boolean\'&&!res)return false;}',
'this._.state=\'show\';var cEle=this._.trans.getElement(\'content\');for(var i=0;i<cEle.children.length;i++)cEle.children[i].style.display=\'none\';var st=this.state;st.picker.settings=ps;if(typeof d==\'string\'){if(this.data[d])d=this.data[d];else if(d[0]==\'*\'){d=d.substr(1);var dlc=d.toLowerCase();var td=null;var mIndx=[\'month\',\'month:0\',\'month:1\',\'mon\',\'mon:0\',\'mon:1\'].indexOf(dlc)',
'if(mIndx>=0&&mIndx<6){if(mIndx<3)td=[].concat(A5.d.date.months);else td=[].concat(A5.d.date.monthsShort);if(d[0]==\'M\'){var tc=\'proper\';if(d[1]==\'O\')tc=\'upper\'',
'for(var i=0;i<td.length;i++)td[i]=td[i].toCase(tc);}',
'if(mIndx==1||mIndx==4){for(var i=0;i<td.length;i++)td[i]={html:td[i],value:i};}else if(mIndx==2||mIndx==5){for(var i=0;i<td.length;i++)td[i]={html:td[i],value:i+1};}else{for(var i=0;i<td.length;i++)td[i]={html:td[i],value:td[i]};}',
'this.data[\'*\'+d]=td;d=td;}else return false;}else d=null;}',
'st.data=typeof d==\'object\'?d:null;st.context=typeof c==\'object\'?c:null;st.scope=typeof sc==\'object\'||typeof sc==\'function\'?sc:null;if(typeof t==\'object\'&&t!=null&&typeof t.id==\'string\'){if(t.id==\'\')t.id=A5.u.getUniqueId();t=t.id;}',
'if(typeof t==\'string\'){st.target.type=\'element\';st.target.id=t;}else if(typeof t==\'object\'&&t!=null){st.target.type=\'custom\';st.target.data=t;}else st.target.type=\'none\';var cancel=false;var val=null;if(typeof b==\'string\')b=$(b);if(typeof b==\'object\'){if(b.tagName){st.binding.type=\'element\';st.binding.id=b.id;}else{if(b.path){st.binding.type=\'path\';st.binding.path=b.path;}else if(b.element){st.binding.type=\'element\';var be=$(b.element);if(!be)cancel=true;st.binding.id=be.id;}else{b.type=\'custom\';if(typeof b.value!=\'undefined\')val=b.value;else cancel=true;}',
'this._.process=b.process||null;}}',
'if(cancel){A5.u.object.assign(st,this._.dState);this._.state=\'hidden\';return false;}',
'this._.picker=s;st.instanceId=pt+\'@\'+Date.now();this._.update(this,st,val);if(typeof def.show==\'function\')def.show.call(this,s,st);s.element.style.display=def.display.mode;this._.trans.show(t);st.shown=true;this._.state=\'shown\';if(typeof this.onShow==\'function\')this.onShow();return st.instanceId;}',
'return false;},update:function(t,d){if(this.state.shown){var st=this.state;var iid=typeof arguments[2]!=\'undefined\'?arguments[2]:st.instanceId;if(iid==st.instanceId){if(typeof t==\'string\'){t=[t];d=[d];}',
'var tt=\'\';var td=\'\';for(var i=0;i<t.length;i++){tt=t[i];td=d[i]||null;if(tt==\'value\')this._.update(this,st,td);else if(td){if(tt==\'data\')st.data=td;else if(tt==\'context\')st.context=td;else if(tt==\'scope\')st.scope=td;}}',
'var def=this._.picker.def;if(typeof def.update==\'function\')def.update.call(this,t,this._.picker,st);this._.trans.refresh();}}},focus:function(){var s=false;var iid=arguments[2]||this.state.instanceId;var pt=iid.split(\'@\')[0];s=this._.pickers[pt];if(s){var def=A5.pickers.guides[pt];if(typeof def.focus==\'function\')return def.focus.call(this,s,this.state,iid==this.state.instanceId,pt==this.state.type);}',
'return false;},action:function(an){var s=false;var args=arguments[1]||null;var iid=arguments[2]||this.state.instanceId;var pt=iid.split(\'@\')[0];s=this._.pickers[pt];if(s){var def=A5.pickers.guides[pt];if(typeof def.action==\'function\'){var res=def.action.call(this,an,args,s,this.state,iid==this.state.instanceId,pt==this.state.type);if(res||typeof res==\'undefined\')this._.trans.refresh();}}},commit:function(){if(this.state.shown){var hide=typeof arguments[0]==\'boolean\'?arguments[0]:true;var iid=typeof arguments[1]==\'string\'?arguments[1]:this.state.instanceId;if(iid==this.state.instanceId){if(typeof this.onBeforeCommit==\'function\'){var res=this.onBeforeCommit(hide);if(typeof res==\'boolean\'&&!res)return false;}',
'this._.state=\'commit\';var val=this._.picker.def.commit.call(this,this._.picker,this.state);var st=this.state;var stb=st.binding;if(typeof st.value.initial==\'number\'&&typeof val==\'string\'&&val==Number(val))val=Number(val);st.value.current=val;if(stb.type==\'element\'){$svs(stb.id,val);$e.execute(stb.id,\'change\');}else if(stb.type==\'path\')A5.u.object.set(st.context,stb.path,val);if(typeof this.onCommit==\'function\')this.onCommit(hide);if(hide){if(!this._.hide(this))return false;}',
'return val;}}},cancel:function(){if(this.state.shown){var iid=typeof arguments[0]!=\'undefined\'?arguments[0]:this.state.instanceId;if(iid==this.state.instanceId){if(typeof this.onBeforeCancel==\'function\'){var res=this.onBeforeCancel();if(typeof res==\'boolean\'&&!res)return false;}',
'if(!this._.hide(this))return false;if(typeof this.onCancel==\'function\')this.onCancel();}}}});}',
'if(!A5.controlBar) { \t',
'/*',
'Copyright (c) 2001, 2024 Alpha Software Corporation',
'All Rights Reserved.',
'This JavaScript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'A5.controlBar={disclosure:{defaultContainer:\'\'},items:{\'html\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',html:\'\',bind:{show:\'\'}},true);var html=s.html;html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;}},\'button\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,style:\'\'},actions:{},bind:{show:\'\',disabled:\'\'},autoHideDisclosure:\'auto\'},true);s.settings.style=\'width: 100%;\'+s.settings.style;if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;var html=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'\',true);if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'disabled\',true);html=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+html+\'{*endif}\';}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(item.settings.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),item.settings.pressedIcon);A5.buttons._p[id]={c:pcn,i:item.settings.icon};}else A5.buttons._p[id]=pcn;}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'button-toggle\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,style:\'\',type:\'two-state\',keepPressed:true},actions:{},bind:{value:\'\',data:\'\',show:\'\',disabled:\'\'},autoHideDisclosure:\'auto\'},true);s.settings.style=\'width: 100%;\'+s.settings.style;if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;if(s.settings.type==\'multi-state\'){var sStr=JSON.stringify(s.settings);sStr=sStr.replace(/\\{/g,\'\\\\{\');sStr=sStr.replace(/\\}/g,\'\\\\}\');sStr=sStr.replace(/:/g,\'\\\\:\');var html=\'{A5.buttons.html(\\\'\'+id+\'\\\',function(od)\\\\{var o = \'+sStr+\'; $u.o.assign(o,od); return o;\\\\}(\'+s.bind.data+\'[\'+s.bind.value+\']),\\\'a5-item="\'+name+\'"\\\')}\';}else{var html=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'\',true);if(s.settings.keepPressed){html=\'{*if \'+s.bind.value+\'}\'+A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'pressed\',true)+\'{*else}\'+html+\'{*endif}\';}',
'if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings,\'a5-item="\'+name+\'"\',\'disabled\',true);html=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+html+\'{*endif}\';}}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(item.settings.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),item.settings.pressedIcon);A5.buttons._p[id]={c:pcn,i:item.settings.icon};}else A5.buttons._p[id]=pcn;}',
'if(type==\'click\'){var curV=A5.u.object.get(this.data,item.bind.value);if(item.settings.type==\'multi-state\'){curV++;var d=A5.u.object.get(this.data,item.bind.data);if(curV>=d.length)curV=0;this.update(item.bind.value,curV);}else{this.update(item.bind.value,!curV);}}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'button-list\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',settings:{theme:theme,allowNullSelection:false,multiple:false,className:\'\',nullSelectionClassName:\'\',button:{keepPressed:true}},actions:{},bind:{data:\'\',value:\'\',show:\'\'},autoHideDisclosure:\'auto\'},true);var ts={};A5.themes.assign(ts,s.settings.theme,\'buttonList\');$u.o.assign(s.settings,ts,true);var sStr=JSON.stringify(s.settings);sStr=sStr.replace(/\\{/g,\'\\\\{\');sStr=sStr.replace(/\\}/g,\'\\\\}\');sStr=sStr.replace(/:/g,\'\\\\:\');var html=\'{A5.buttonLists.html(\\\'\'+id+\'\\\',\'+sStr+\',\'+s.bind.data+\',\'+$if(s.settings.button.keepPressed,s.bind.value,\'\\\'\\\'\')+\',\\\'a5-item="\'+name+\'" a5-value="\\\\{index\\\\}"\\\')}\';var cStyle=\'\';if(s.size==\'\')cStyle=\' style="display: inline-block;"\';if(s.settings.nullSelectionClassName!=\'\'){html=\'<div class="\'+s.settings.className+\'{*if (\'+s.bind.value+\').toString() == \\\'\\\'}\'+s.settings.nullSelectionClassName+\'{*endif}"\'+cStyle+\'>\'+html+\'</div>\';}else{html=\'<div class="\'+s.settings.className+\'"\'+cStyle+\'>\'+html+\'</div>\';}',
'html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(type==\'down\'){var id=ele.id;var pcn=item.settings.button.pressedClassName;if(pcn!=\'\'){$acn(ele,pcn);A5.buttons._p[id]=pcn;}}',
'if(type==\'click\'){var d=A5.u.object.get(this.data,item.bind.data);var v=d[Number(value)];if(v){if(typeof v==\'object\'){v=v.value;}',
'var curV=A5.u.object.get(this.data,item.bind.value);if(item.settings.multiple){if(curV.constructor==Array){var cIndx=curV.indexOf(v);if(cIndx==-1){curV.push(v);v=curV;}else curV.splice(cIndx,1);if(item.settings.allowNullSelection===false&&curV.length==0)v=[v];else v=curV;}else console.log(\'ERROR - button-list value must be array if multiple select is set to true.\');}else{if(item.settings.allowNullSelection===true&&v.toString()==curV.toString()){if(curV.constructor==Array)v=[];else v=\'\';}else if(curV.constructor==Array)v=[v];}',
'this.update(item.bind.value,v);}}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'disclosure-button\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',autoHideDisclosure:\'always\',disclosure:{name:\'\',type:\'\'},actions:{},settings:{show:{theme:theme,style:\'\'},hide:{theme:theme,style:\'\'}},bind:{show:\'\',disabled:\'\'}},true);s.settings.show.style=\'width: 100%;\'+s.settings.show.style;s.settings.hide.style=\'width: 100%;\'+s.settings.hide.style;if(s.size!=\'\'){s.settings.show.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.show.style;s.settings.hide.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.hide.style;}',
'var showHTML=A5.buttons.html(id,s.settings.show,\'a5-item="\'+name+\'"\',\'\',true);var hideHTML=A5.buttons.html(id,s.settings.hide,\'a5-item="\'+name+\'"\',\'\',true);if(s.bind.disabled!=\'\'){var dHTML=A5.buttons.html(id,s.settings.show,\'a5-item="\'+name+\'"\',\'disabled\',true);showHTML=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+showHTML+\'{*endif}\';dHTML=A5.buttons.html(id,s.settings.hide,\'a5-item="\'+name+\'"\',\'disabled\',true);hideHTML=\'{*if \'+s.bind.disabled+\'}\'+dHTML+\'{*else}\'+hideHTML+\'{*endif}\';}',
'var html=\'{*if [temp].state.disclosure.shown && [temp].state.disclosure.name == \\\'\'+s.disclosure.name+\'\\\'}\'+hideHTML+\'{*else}\'+showHTML+\'{*endif}\';html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){var id=ele.id;if(this._d.shown)var bs=item.settings.hide;else var bs=item.settings.show;if(type==\'down\'){var pcn=bs.pressedClassName;if(pcn!=\'\')$acn(ele,pcn);if(bs.pressedIcon!=\'\'){A5.u.icon.update($(ele.id+\'.ICON\'),bs.pressedIcon);A5.buttons._p[id]={c:pcn,i:bs.icon};}else A5.buttons._p[id]=pcn;}',
'if(type==\'click\'){if(this._d.shown)var html=A5.buttons.html(id,item.settings.hide,\'a5-item="\'+name+\'"\',\'\',true);else var html=A5.buttons.html(id,item.settings.show,\'a5-item="\'+name+\'"\',\'\',true);var pEle=ele.parentNode;pEle.innerHTML=A5.u.template.expand(this.data,html);A5.buttons._p[id]=pcn;}',
'if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}},\'edit\':{initialize:function(name,id,s,theme){$u.o.assign(s,{size:\'\',update:\'default\',actions:{},settings:{theme:theme,style:\'\',watermark:{text:\'\',className:\'\'}},bind:{value:\'\',show:\'\'}},true);var ts={};A5.themes.assign(ts,s.settings.theme,\'edit\');$u.o.assign(s.settings,ts,true);if(s.size!=\'\')s.settings.style=\'A5CONTROLBARITEMSIZE: 100%;\'+s.settings.style;s.settings.style=\'display: inline-block; overflow: hidden;\'+s.settings.style;var wm=s.settings.watermark.text;if(wm==\'\')wm=\'&nbsp;\';var html=\'{*if \'+s.bind.value+\' != \\\'\\\'}<div id="\'+id+\'" a5-item="\'+name+\'" class="\'+s.settings.className+\'" style="box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \'+s.settings.style+\'{*if [temp].state.edit.shown && [temp].state.edit.item == \\\'\'+name+\'\\\'}visibility: hidden;{*endif}">{\'+s.bind.value+\'}</div>{*else}<div id="\'+id+\'" a5-item="\'+name+\'" class="\'+s.settings.className+\' \'+s.settings.watermark.className+\'" style="box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \'+s.settings.style+\'{*if [temp].state.edit.shown && [temp].state.edit.item == \\\'\'+name+\'\\\'}visibility: hidden;{*endif}"><escape<\'+wm+\'>></div>{*endif}\';html=\'<div class="A5ControlBarItem" style="\'+$if(s.size!=\'\',\'A5CONTROLBARITEMSIZE: \'+s.size+\';\',\'\')+\'; text-align: left;">\'+html+\'</div>\';if(s.bind.show!=\'\'){html=\'{*if \'+s.bind.show+\'}\'+html+\'{*endif}\';}',
's.template=html;},event:function(type,name,value,item,ele,e){if(item.actions[type]){var data={item:{name:name,value:value,def:item},element:ele,event:e}',
'this.action(item.actions[type],data);}}}},_:{lDefs:{type:\'default\',className:\'\',style:\'\',bind:{show:\'\'},before:{items:[]},middle:{items:[]},after:{items:[]}},initDone:false,init:function(){if(!A5.controlBar._.initDone){A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLine\',\'position: relative; text-align: center;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineCust\',\'position: relative;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineBefore\',\'text-align: left;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineAfter\',\'text-align: right;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarItem\',\'display: inline-block;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineContentBefore\',\'position: absolute; top: 0px; left: 0px;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineContentAfter\',\'position: absolute; top: 0px; right: 0px;\');A5.u.css.setSelector(\'.A5ControlBarHorz .A5ControlBarLineBefore .A5ControlBarLineContentBefore, .A5ControlBarHorz .A5ControlBarLineAfter .A5ControlBarLineContentAfter\',\'position: static;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarHorz .A5ControlBarLine > div\',\'position: static; display: inline;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarHorz .A5ControlBarLine\',\'text-align: inherit;\');A5.u.css.setSelector(\'.A5ControlBarVert\',\'display: table; height: 100%;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLine\',\'display: table-cell; vertical-align: middle;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineCust\',\'display: table-cell;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineBefore\',\'display: table-cell; vertical-align: top;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineAfter\',\'display: table-cell; vertical-align: bottom;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineContentBefore\',\'position: absolute; top: 0px;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineContentAfter\',\'position: absolute; bottom: 0px;\');A5.u.css.setSelector(\'.A5ControlBarVert .A5ControlBarLineBefore .A5ControlBarLineContentBefore, .A5ControlBarVert .A5ControlBarLineAfter .A5ControlBarLineContentAfter\',\'position: static;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarVert .A5ControlBarLine > div\',\'position: static; display: block;\');A5.u.css.setSelector(\'.A5ControlBarCollapse .A5ControlBarVert .A5ControlBarLine\',\'vertical-align: top;\');A5.controlBar._.initDone=true;}}}}',
'A5.ControlBar=Class.create({initialize:function(contId,data,settings){if(typeof settings==\'undefined\'){settings=data;data=null;}',
'this.contId=contId;A5.controlBar._.init();$u.o.assign(this,{theme:\'\',override:\'base\',edge:\'top\',className:\'\',disclosuresClassName:\'\',topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\',separator:{horizontalClassName:\'\',verticalClassName:\'\'},items:{},actions:{},layout:\'\',layouts:{},disclosure:{container:A5.controlBar.disclosure.defaultContainer,animation:{duration:300,tween:\'ease-in-out\'},coverClassName:\'\',cover:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},extend:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},expand:{topClassName:\'\',bottomClassName:\'\',leftClassName:\'\',rightClassName:\'\'},defaults:{type:\'static\',html:\'\',className:\'\',onInitialize:false,onBeforeDraw:false,onDraw:false,onSize:false,onShow:false,onShowComplete:false,onHide:false}},disclosures:{},data:{},state:{layout:\'\',edit:{shown:false,item:\'\',part:\'\',path:\'\'},disclosure:{shown:false,name:\'\',type:\'\',edge:\'\'}},onDraw:false,onBeforeDraw:false,onPopulate:false,onBeforePopulate:false,onChange:false});if(typeof settings.theme!=\'undefined\')A5.themes.assign(this,settings.theme,\'controlBar\');$u.o.assign(this,settings);A5.overrides.assign(this,\'controlBar\',this.override);this.initializeItems();var cEle=$(contId);cEle.innerHTML=\'<div></div><input id="\'+this.contId+\'.EDIT" style="position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\';if(cEle.style.position!=\'absolute\')cEle.style.position=\'relative\';cEle.style.padding=\'0px\';cEle.style.overflow=\'hidden\';$acn(cEle,this.className);this._bindEvents(cEle);this._m={anim:false,next:{has:false,args:[]},async:{}};var egName=\'CONTROLBAR.\'+this.contId;var dEle=document.createElement(\'div\');dEle.id=this.contId+\'.DISCLOSURES\';$ss(dEle,\'z-index: 100000; position: absolute; top: 0px; left: 0px; right: 0px; bottom: 0px; display: none;\');dEle.innerHTML=\'<div style="position: absolute; overflow: hidden;"><div class="\'+this.disclosure.defaults.className+\'" id="\'+this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC" style="z-index: 100002; position: absolute; display: none;"><div></div><input id="\'+this.contId+\'.EDITDIS" style="position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" /></div></div><div id="\'+this.contId+\'.DISCLOSURE.CLOSE" style="z-index: 100001; position: absolute; display: none;">&nbsp;</div>\';$acn(dEle,this.disclosuresClassName);if(this.disclosure.container!=\'\')$(this.disclosure.container).appendChild(dEle);else document.body.insertBefore(dEle,document.body.firstChild);this._bindEvents(dEle.children[0].children[0]);$e.add(dEle,A5.d.evnts.click,this._disClick,this,false,egName);$e.add(this.contId+\'.DISCLOSURE.CLOSE\',A5.d.evnts.click,this._disCloseClick,this,false,egName);if(A5.flags.supportsTouch){$e.add(dEle,\'touchmove\',function(e){var tempT=$e.getTouches(e);var pDef=true;if(tempT){if(tempT.length){if(tempT.length>1)pDef=false;}}',
'if(pDef)$e.preventDefault(e);});}',
'this._d={ele:dEle,shown:false,current:false,next:false};var dd=null;for(var d in this.disclosures){dd=this.disclosures[d];this.addDisclosure(d,dd,true);}',
'var eEle=$(this.contId+\'.EDIT\');var edEle=$(this.contId+\'.EDITDIS\');$e.add(eEle,\'keyup\',this._editKeyup,this,false,egName);$e.add(edEle,\'keyup\',this._editKeyup,this,false,egName);$e.add(eEle,\'blur\',this._editBlur,this,false,egName);$e.add(edEle,\'blur\',this._editBlur,this,false,egName);this._e={ele:eEle,dEle:edEle,shown:0,current:false};if(data!=null)this.populate(data);else this.refresh();if(!A5.flags.isMobile)$e.add(window,\'resize\',this._relayout,this,true,egName);else{$e.add(window,\'orientationchange\',this._relayout,this,true,egName);if(A5.flags.iOSVersion==-1)$e.add(window,\'resize\',this._relayout,this,true,egName);}',
'$e.add(document,\'webkitfullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'mozfullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'fullscreenchange\',this._relayout,this,true,egName);$e.add(document,\'fullscreenchange\',this._relayout,this,true,egName);},initializeItems:function(){var iObj=null;var iTObj=null;var theme=this.theme;theme=theme.split(\':\').shift();for(var item in this.items){iObj=this.items[item];iTObj=A5.controlBar.items[iObj.type];if(iTObj)iTObj.initialize(item,this.contId+\'.\'+item,iObj,theme);else iObj.template=\'ERROR \'+item+\' - Item type "\'+iObj.type+\'" not found!\';}',
'for(var layout in this.layouts){if(typeof this.layouts[layout]._t!=\'undefined\'){delete this.layouts[layout]._t.top;delete this.layouts[layout]._t.bottom;delete this.layouts[layout]._t.left;delete this.layouts[layout]._t.right;}}},destroy:function(){$e.removeGroup(\'CONTROLBAR.\'+this.contId);var dEle=this._d.ele;if(dEle){var pEle=dEle.parentNode;if(pEle)pEle.removeChild(dEle);}},populate:function(data){var anim=typeof arguments[1]!=\'undefined\'?arguments[1]:false;var fEvnts=typeof arguments[2]!=\'undefined\'?arguments[2]:true;var async=typeof arguments[3]!=\'undefined\'?arguments[3]:false;if(this.onBeforePopulate.constructor==Function&&fEvnts){var res=this.onBeforePopulate.call(this,data);if(typeof res==\'boolean\'){if(!res)return false;}}',
'this.data={};$u.o.assign(this.data,data);this.refresh(anim,async);if(this.onPopulate.constructor==Function&&fEvnts)this.onPopulate.call(this,data);},update:function(p,v){var anim=typeof arguments[2]!=\'undefined\'?arguments[2]:false;var fEvnts=typeof arguments[3]!=\'undefined\'?arguments[3]:true;var async=typeof arguments[4]!=\'undefined\'?arguments[4]:false;if(typeof p==\'string\'){p=[p];v=[v];}',
'for(var i=0;i<p.length;i++)A5.u.object.set(this.data,p[i],v[i],true);if(fEvnts){if(this.onChange.constructor==Function)this.onChange.call(this,p,v);}',
'this.refresh(anim,async);},setLayout:function(l){if(this.layouts[l]){var anim=typeof arguments[1]!=\'undefined\'?arguments[1]:false;var async=typeof arguments[2]!=\'undefined\'?arguments[2]:false;this.layout=l;this.refresh(anim,async);}else console.log(\'ERROR - control bar layout "\'+l+\'" not found\');},refresh:function(){var anim=typeof arguments[0]!=\'undefined\'?arguments[0]:false;var async=typeof arguments[1]!=\'undefined\'?arguments[1]:false;if(this._m.anim){this._m.next.has=true;this._m.next.args=[anim,async];return false;}',
'if(async){clearTimeout(this._m.async.to);var ci=this;this._m.async.to=setTimeout(function(){ci.refresh.apply(ci,ci._m.async.args);delete ci;},0);this._m.async.args=[anim];return false;}',
'if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'main\');var l=\'\';if(this.layout.constructor==Function)l=this.layout.call(this);else l=this.layout;this._cl=this.layouts[l];this.state.layout=l;this._compileTemplate(this._cl,this.edge);var cEle=$(this.contId);var html=A5.u.template.expand(this.data,{template:this._cl._t[this.edge]},{state:this.state},this);var animDo=false;var cn=\'class="\'+this[this.edge+\'ClassName\']+\'" \';var hCSS=\'\';if(this.edge==\'left\'||this.edge==\'right\')hCSS=\' height: 100%;\';if(anim){if(typeof anim!=\'object\')anim={type:anim,duration:500};if(!anim.tween)anim.tween=\'ease-in-out\';if(anim.type.indexOf(\'-in\')!=-1||anim.type.indexOf(\'-out\')!=-1||anim.type.indexOf(\'-before\')!=-1||anim.type.indexOf(\'-after\')!=-1){if(this.edge==\'top\'){anim.type=anim.type.replace(\'-in\',\'-top\').replace(\'-out\',\'-bottom\').replace(\'-before\',\'-left\').replace(\'-after\',\'-right\');}else if(this.edge==\'bottom\'){anim.type=anim.type.replace(\'-in\',\'-bottom\').replace(\'-out\',\'-top\').replace(\'-before\',\'-left\').replace(\'-after\',\'-right\');}else if(this.edge==\'left\'){anim.type=anim.type.replace(\'-in\',\'-left\').replace(\'-out\',\'-right\').replace(\'-before\',\'-top\').replace(\'-after\',\'-bottom\');}else if(this.edge==\'right\'){anim.type=anim.type.replace(\'-in\',\'-right\').replace(\'-out\',\'-left\').replace(\'-before\',\'-top\').replace(\'-after\',\'-bottom\');}}',
'var oldHTML=\'\';var ccEle=$(this.contId+\'.CONTENT\');if(ccEle){oldHTML=ccEle.innerHTML;oldHTML=oldHTML.replace(/id="[^"]+"/g,\'\').replace(/a5-item="[^"]+"/g,\'\');}',
'var tProp=A5.u.css.properties.transform;var tPropDOM=A5.u.css.properties.transformDOM;var taProp=tProp.replace(\'transform\',\'transition\');if(anim.type.indexOf(\'slide-\')==0){var vals=[\'0px\',\'100%\',\'0px\',\'-100%\'];if(anim.type==\'slide-left\')vals=[\'100%\',\'0px\',\'-100%\',\'0px\'];else if(anim.type==\'slide-right\')vals=[\'-100%\',\'0px\',\'100%\',\'0px\'];else if(anim.type==\'slide-bottom\')vals=[\'0px\',\'-100%\',\'0px\',\'100%\'];var taVal=taProp+\': \'+tProp+\' \'+anim.duration+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' \'+tProp+\': \'+A5.u.css.transform2D(\'0px\',\'0px\')+\'; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'\'+tProp+\': \'+A5.u.css.transform2D(vals[0],vals[1])+\'; \'+taVal+\'">\'+html+\'</div>\';animDo=[{p:tPropDOM,v:A5.u.css.transform2D(\'0px\',\'0px\')},{p:tPropDOM,v:A5.u.css.transform2D(vals[2],vals[3])}];}else if(anim.type.indexOf(\'swap-\')==0){var vals=[\'0px\',\'-100%\'];if(anim.type==\'swap-left\')vals=[\'-100%\',\'0px\'];else if(anim.type==\'swap-right\')vals=[\'100%\',\'0px\'];else if(anim.type==\'swap-bottom\')vals=[\'0px\',\'100%\'];var hDur=(anim.duration/2);var taVal=taProp+\': \'+tProp+\' \'+hDur+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' \'+tProp+\': \'+A5.u.css.transform2D(\'0px\',\'0px\')+\'; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'\'+tProp+\': \'+A5.u.css.transform2D(vals[0],vals[1])+\'; \'+taVal+\' transition-delay: \'+hDur+\'ms;">\'+html+\'</div>\';animDo=[{p:tPropDOM,v:A5.u.css.transform2D(\'0px\',\'0px\')},{p:tPropDOM,v:A5.u.css.transform2D(vals[0],vals[1])}];}else if(anim.type==\'fade\'){var taVal=taProp+\': opacity \'+anim.duration+\'ms \'+anim.tween+\';\';html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENTOLD" style="position: absolute; width: 100%;\'+hCSS+\' opacity: 1; \'+taVal+\'">\'+oldHTML+\'</div><div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'opacity: 0; \'+taVal+\'">\'+html+\'</div>\';animDo=[{p:\'opacity\',v:\'1\'},{p:\'opacity\',v:\'0\'}];}else html=\'<div id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'">\'+html+\'</div>\';}else html=\'<div \'+cn+\'id="\'+this.contId+\'.CONTENT" style="\'+hCSS+\'">\'+html+\'</div>\';if(hCSS==\'\')cEle.children[0].style.height=\'\';else cEle.children[0].style.height=\'100%\';cEle.children[0].innerHTML=html;this._m.anim=false;if(animDo){var lcEle=$(this.contId+\'.CONTENT\');var lcoEle=$(this.contId+\'.CONTENTOLD\');lcEle.offsetWidth;lcEle.style[animDo[0].p]=animDo[0].v;lcoEle.style[animDo[1].p]=animDo[1].v;var ci=this;setTimeout(function(){var ele=$(ci.contId+\'.CONTENTOLD\');pEle=ele.parentNode;pEle.removeChild(ele);ci._refreshAnimComplete();delete ci;delete ele;delete pEle;},anim.duration);this._m.anim=true;}',
'if(this.onDraw.constructor==Function)this.onDraw.call(this,\'main\',cEle);if(this._d.shown){if(this._d.current.s.isTemplate){if(this._d.current.s.name.substr(0,7)==\'layout:\'){var dEle=$(this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC\');if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'disclosure\');var layoutEdge=this._d.current.layoutEdge;var cn=\'class="\'+this[layoutEdge+\'ClassName\']+\'" \';var hCSS=\'\';if(layoutEdge==\'left\'||layoutEdge==\'right\')hCSS=\'height: 100%;\';if(hCSS==\'\')dEle.children[0].style.height=\'\';else dEle.children[0].style.height=\'100%\';dEle.children[0].innerHTML=\'<div \'+cn+\' style="\'+hCSS+\'">\'+A5.u.template.expand(this.data,{template:this._cdl._t[layoutEdge]},{state:this.state},this)+\'</div>\';if(this.onDraw.constructor==Function)this.onDraw.call(this,\'disclosure\',dEle);}else{var dd=this.disclosures[this._d.current.s.name];var dEle=$(this.contId+\'.DISCLOSURE.\'+this._d.current.s.name);if(dd.onBeforeDraw.constructor==Function)dd.onBeforeDraw.call(this,dEle);A5.u.element.setContent(dEle,A5.u.template.expand(this.data,{template:dd._t},{state:this.state},this));if(dd.onDraw.constructor==Function)dd.onDraw.call(this,dEle);}}}},action:function(action){if(this.actions[action]){var data=typeof arguments[1]!=\'undefined\'?arguments[1]:false;this.actions[action].call(this,data);}else console.log(\'ERROR - control bar action "\'+action+\'" not found\');},focus:function(name){var iObj=this.items[name];if(iObj){var id=this.contId+\'.\'+name;var ele=$(id);if(iObj.type==\'edit\'){if(ele){var part=\'disclosure\';while(ele!=document.body){if(ele.id==this.contId){part=\'main\';break;}',
'ele=ele.parentNode;}',
'if(this.state.edit.shown){var tEle=$(this._e.current.id);tEle.innerHTML=this._e.ele.value;tEle.style.visibility=\'\';}',
'this._e.current={item:iObj,id:id,p:part};if(part==\'main\')var eEle=this._e.ele;else var eEle=this._e.dEle;eEle.className=iObj.settings.className;$ss(eEle,iObj.settings.style+\'; position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\');var ev=A5.u.object.get(this.data,iObj.bind.value);eEle.value=ev;this._editPos();eEle.focus();eEle.select();this.state.edit.shown=true;this.state.edit.item=name;this.state.edit.part=part;this.state.edit.path=iObj.bind.value;}}else ele.focus();}},addDisclosure:function(n,s,ow){if(this.disclosures[n]&&!ow)return false;var cdEle=$(this.contId+\'.DISCLOSURES\').children[0];A5.u.object.assign(s,this.disclosure.defaults,true);if(!ow)this.disclosures[n]=s;var tdEle=document.createElement(\'div\');tdEle.id=this.contId+\'.DISCLOSURE.\'+n;tdEle.className=s.className;tdEle.style.position=\'absolute\';tdEle.style.display=\'none\';tdEle.style.zIndex=\'100002\';cdEle.appendChild(tdEle);if(s.type==\'template\')this._bindEvents(tdEle);else tdEle.innerHTML=s.html;if(s.onInitialize.constructor==Function)s.onInitialize.call(this,tdEle);return true;},showDisclosure:function(s){if(this._d.shown){this._d.next=s;this.hideDisclosure();}else{var ele=typeof arguments[1]!=\'undefined\'?arguments[1]:false;ele=$(ele);$u.o.assign(s,{name:\'\',type:\'extend\',size:false,margin:{top:0,left:0,right:0,bottom:0},animation:true,autoHide:true,className:\'\',coverClassName:this.disclosure.coverClassName},true);if(typeof s.margin.top!=\'number\')s.margin.top=A5.u.convertUnits(s.margin.top.toString(),\'px\');if(typeof s.margin.left!=\'number\')s.margin.left=A5.u.convertUnits(s.margin.left.toString(),\'px\');if(typeof s.margin.right!=\'number\')s.margin.right=A5.u.convertUnits(s.margin.right.toString(),\'px\');if(typeof s.margin.bottom!=\'number\')s.margin.bottom=A5.u.convertUnits(s.margin.bottom.toString(),\'px\');var type=s.type;if(type.indexOf(\'element\')!=-1&&!ele){type=type.split(\'-\').shift();if(type==\'expand\')type=\'expand-after\';}',
'this._cdl=false;var dd=false;if(s.name.substr(0,7)==\'layout:\'){var dEle=$(this.contId+\'.DISCLOSURE.A5CONTROLBARDYNAMIC\');this._cdl=this.layouts[s.name.substr(7)];if(!this._cdl)return false;if(s.className==\'\')s.className=this.disclosure.defaults.className;s.isTemplate=true;}else{dd=this.disclosures[s.name];if(!dd)return false;var dEle=$(this.contId+\'.DISCLOSURE.\'+s.name);if(s.className==\'\')s.className=dd.className;if(dd.type==\'template\'){s.isTemplate=true;if(typeof dd._t==\'undefined\'){var tPH=\'\';var tHTML=dd.html;for(var item in this.items){tPH=\'[\'+item+\']\';if(tHTML.indexOf(tPH)!=-1)tHTML=tHTML.split(tPH).join(this.items[item].template);}',
'tHTML=tHTML.replace(/A5CONTROLBARITEMSIZE/gi,\'width\');tHTML=tHTML.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.horizontalClassName);dd._t=A5.u.template.parse(tHTML);}',
'if(dd.onBeforeDraw.constructor==Function)dd.onBeforeDraw.call(this,dEle);A5.u.element.setContent(dEle,A5.u.template.expand(this.data,{template:dd._t},{state:this.state},this));if(dd.onDraw.constructor==Function)dd.onDraw.call(this,dEle);}else s.isTemplate=false;}',
'dEle.className=s.className;dEle.style.top=\'\';dEle.style.bottom=\'\';dEle.style.left=\'\';dEle.style.right=\'\';dEle.style.width=\'\';dEle.style.height=\'\';if(type==\'explicit\'){if(s.rectangle.constructor==Function)var rect=s.rectangle.call(this,s,ele);else var rect=s.rectangle;}else var rect=this._getDisclosureRect(type,ele);var layoutEdge=this.edge;if(s.name.substr(0,7)==\'layout:\'){if(type==\'outside-before\'||type==\'outside-after\'||type.split(\'-\').shift()==\'screen\')layoutEdge=rect.edge;this._compileTemplate(this._cdl,layoutEdge);if(this.onBeforeDraw.constructor==Function)this.onBeforeDraw.call(this,\'disclosure\');var cn=\'class="\'+this[layoutEdge+\'ClassName\']+\'" \';var hCSS=\'\';if(layoutEdge==\'left\'||layoutEdge==\'right\')hCSS=\'height: 100%;\';if(hCSS==\'\')dEle.children[0].style.height=\'\';else dEle.children[0].style.height=\'100%\';dEle.children[0].innerHTML=\'<div \'+cn+\' style="\'+hCSS+\'">\'+A5.u.template.expand(this.data,{template:this._cdl._t[layoutEdge]},{state:this.state},this)+\'</div>\';if(this.onDraw.constructor==Function)this.onDraw.call(this,\'disclosure\',dEle);}',
'var dcEle=this._d.ele.children[0];if(typeof rect.className!=\'undefined\')dcEle.className=rect.className;else dcEle.className=\'\';dcEle.style.top=(rect.top+s.margin.top)+\'px\';dcEle.style.bottom=(rect.bottom+s.margin.bottom)+\'px\';dcEle.style.left=(rect.left+s.margin.left)+\'px\';dcEle.style.right=(rect.right+s.margin.right)+\'px\';var setMargin=false;dEle.style[rect.edge]=\'0px\';dEle.style.marginLeft=\'\';dEle.style.marginTop=\'\';if(rect.fill==\'both\'||s.size==\'fill\'){dEle.style.top=\'0px\';dEle.style.bottom=\'0px\';dEle.style.left=\'0px\';dEle.style.right=\'0px\';}else if(rect.fill==\'width\'){dEle.style.left=\'0px\';dEle.style.right=\'0px\';}else if(rect.fill==\'height\'){dEle.style.top=\'0px\';dEle.style.bottom=\'0px\';}else{if(!rect.align)rect.align=\'middle\';if(rect.align==\'before\'){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.left=\'0px\';else dEle.style.top=\'0px\';}else if(rect.align==\'after\'){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.right=\'0px\';else dEle.style.bottom=\'0px\';}else{if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.left=\'50%\';else dEle.style.top=\'50%\';setMargin=true;}}',
'var startTrans=\'\';if(rect.edge==\'top\'){startTrans=A5.u.css.transform2D(\'0px\',\'-100%\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.height=s.size;}}else if(rect.edge==\'bottom\'){startTrans=A5.u.css.transform2D(\'0px\',\'100%\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.height=s.size;}}else if(rect.edge==\'left\'){startTrans=A5.u.css.transform2D(\'-100%\',\'0px\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.width=s.size;}}else if(rect.edge==\'right\'){startTrans=A5.u.css.transform2D(\'100%\',\'0px\');if(s.size&&s.size!=\'fill\'&&type!=\'cover\'){dEle.style.width=s.size;}}',
'dEle.style.display=\'\';if(type.split(\'-\').shift()==\'expand\'&&!s.size)this._d.ele.className=this.disclosuresClassName+\' \'+s.coverClassName+\' A5ControlBarCollapse\';else this._d.ele.className=this.disclosuresClassName+\' \'+s.coverClassName;var dur=this.disclosure.animation.duration;var tween=this.disclosure.animation.tween;var completeDelay=false;if(s.animation){if(typeof s.animation==\'object\'){if(s.animation.duration)dur=s.animation.duration;if(s.animation.tween)tween=s.animation.tween;}',
'var cssDOMProp=A5.u.css.properties.transformDOM;var cssAnimProp=A5.u.css.properties.transitionDOM;dEle.style[cssDOMProp]=startTrans;dEle.style[cssAnimProp]=\'\';this._d.ele.style.display=\'\';dEle.offsetHeight;dEle.style[cssAnimProp]=A5.u.css.properties.transform+\' \'+dur+\'ms \'+tween;dEle.style[cssDOMProp]=A5.u.css.transform2D(\'0px\',\'0px\');completeDelay=true;}else{var cssDOMProp=A5.u.css.properties.transformDOM;var cssAnimProp=A5.u.css.properties.transitionDOM;dEle.style[cssDOMProp]=A5.u.css.transform2D(\'0px\',\'0px\');dEle.style[cssAnimProp]=\'\';this._d.ele.style.display=\'\';dEle.offsetHeight;dEle.style[cssAnimProp]=A5.u.css.properties.transform+\' \'+dur+\'ms \'+tween;}',
'if(setMargin){if(rect.edge==\'top\'||rect.edge==\'bottom\')dEle.style.marginLeft=\'-\'+(dEle.offsetWidth/2)+\'px\';else dEle.style.marginTop=\'-\'+(dEle.offsetHeight/2)+\'px\';}',
'var eleId=false',
'if(ele)eleId=ele.id;this._d.current={s:s,eleId:eleId,dEle:dEle,trans:startTrans,dur:dur,layoutEdge:layoutEdge,internalShow:false};this._d.next=false;this._d.shown=true;var dbcEle=$(this.contId+\'.DISCLOSURE.CLOSE\');dbcEle.style.display=\'none\';if(this._d.internalShow&&ele){this._d.current.internalShow=true;var eBRect=ele.getBoundingClientRect();var tOff=0;var lOff=0;if(this.disclosure.container!=\'\'){var cEle=$(this.disclosure.container);if(cEle){var ceBRect=cEle.getBoundingClientRect();tOff=ceBRect.top;lOff=ceBRect.left;}}',
'dbcEle.style.top=(eBRect.top-tOff)+\'px\';dbcEle.style.left=(eBRect.left-lOff)+\'px\';dbcEle.style.width=eBRect.width+\'px\';dbcEle.style.height=eBRect.height+\'px\';dbcEle.style.display=\'block\';}',
'this.state.disclosure.shown=true;this.state.disclosure.name=s.name;this.state.disclosure.type=type;this.state.disclosure.edge=layoutEdge;if(dd){$e.execute(dEle,\'a5resize\');if(dd.onShow.constructor==Function)dd.onShow.call(this,dEle);if(dd.onSize.constructor==Function)dd.onSize.call(this,dEle);if(completeDelay){var ci=this;setTimeout(function(){ci._showDisclosureComplete();delete ci;},dur+10);}else this._showDisclosureComplete();}}},hideDisclosure:function(){if(this._d.shown){if(this.state.edit.shown&&this.state.edit.part!=\'main\'){this._e.dEle.blur();this._editBlur.call(this._e.dEle,false,this);}',
'var anim=typeof arguments[0]!=\'undefined\'?arguments[0]:true;var dur=0;if(anim){this._d.current.dEle.style[A5.u.css.properties.transformDOM]=this._d.current.trans;dur=this._d.current.dur;}',
'clearTimeout(this._hdcTO);var ci=this;this._hdcTO=setTimeout(function(){ci._hideDisclosureComplete();delete ci;},dur);}},resizeDisclosure:function(){if(this._d.shown){var s=this._d.current.s;var type=s.type',
'if(type==\'explicit\'){if(s.rectangle.constructor==Function)var rect=s.rectangle.call(this,s,$(this._d.current.eleId));else var rect=s.rectangle;}else var rect=this._getDisclosureRect(type,$(this._d.current.eleId));var dcEle=this._d.ele.children[0];dcEle.style.top=(rect.top+s.margin.top)+\'px\';dcEle.style.bottom=(rect.bottom+s.margin.bottom)+\'px\';dcEle.style.left=(rect.left+s.margin.left)+\'px\';dcEle.style.right=(rect.right+s.margin.right)+\'px\';var dd=this.disclosures[s.name];if(dd){$e.execute(this._d.current.dEle,\'a5resize\');if(dd.onSize.constructor==Function)dd.onSize.call(this,this._d.current.dEle);}',
'if(this._d.current.internalShow){var dbcEle=$(this.contId+\'.DISCLOSURE.CLOSE\');var eBRect=$(this._d.current.eleId).getBoundingClientRect();var tOff=0;var lOff=0;if(this.disclosure.container!=\'\'){var cEle=$(this.disclosure.container);if(cEle){var ceBRect=cEle.getBoundingClientRect();tOff=ceBRect.top;lOff=ceBRect.left;}}',
'dbcEle.style.top=(eBRect.top-tOff)+\'px\';dbcEle.style.left=(eBRect.left-lOff)+\'px\';dbcEle.style.width=eBRect.width+\'px\';dbcEle.style.height=eBRect.height+\'px\';}}},_getDisclosureRect:function(type,ele){var rect={top:0,left:0,right:0,bottom:0,edge:this.edge,fill:\'\',className:\'\'};var cBRect=$(this.contId).getBoundingClientRect();var eBRect=false;if(ele)eBRect=ele.getBoundingClientRect();if(this.disclosure.container!=\'\'){var tBRect=$(this.disclosure.container).getBoundingClientRect();var leftOff=tBRect.left;var topOff=tBRect.top;var docWidth=tBRect.width;var docHeight=tBRect.height;}else{var leftOff=0;var topOff=0;var docWidth=document.documentElement.clientWidth;var docHeight=document.documentElement.clientHeight;}',
'if(type.split(\'-\').shift()==\'expand\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;if(this.edge==\'top\'||this.edge==\'bottom\'){rect.fill=\'height\';if(type==\'expand-before\'){rect.edge=\'left\';}else if(type==\'expand-after\'){rect.edge=\'right\';}else if(type==\'expand-element\'||type==\'expand-element-cover\'){if(eBRect.left>(cBRect.left+(cBRect.width/2))){rect.edge=\'right\';if(type==\'expand-element\')rect.right=(docWidth-eBRect.left+leftOff);else rect.right=(docWidth-eBRect.right+leftOff);}else{rect.edge=\'left\';if(type==\'expand-element\')rect.left=eBRect.right-leftOff;else rect.left=eBRect.left-leftOff;}}}else{rect.fill=\'width\';if(type==\'expand-before\'){rect.edge=\'top\';}else if(type==\'expand-after\'){rect.edge=\'bottom\';}else if(type==\'expand-element\'||type==\'expand-element-cover\'){if(eBRect.top>(cBRect.top+(cBRect.height/2))){rect.edge=\'bottom\';if(type==\'expand-element\')rect.bottom=(docHeight-eBRect.top+topOff);else rect.bottom=(docHeight-eBRect.bottom+topOff);}else{rect.edge=\'top\';if(type==\'expand-element\')rect.top=eBRect.bottom-topOff;else rect.top=eBRect.top-topOff;}}}',
'rect.className=this.disclosure.expand[rect.edge+\'ClassName\'];}else if(type.split(\'-\').shift()==\'flyout\'){if(this.edge==\'top\'||this.edge==\'bottom\'){if(this.edge==\'top\'){if(type==\'flyout-element\')rect.top=eBRect.bottom-topOff;else if(type==\'flyout-element-cover\')rect.top=eBRect.top-topOff;else rect.top=cBRect.bottom-topOff;}else{if(type==\'flyout-element\')rect.bottom=docHeight-eBRect.top+topOff;else if(type==\'flyout-element-cover\')rect.bottom=docHeight-eBRect.bottom+topOff;else rect.bottom=docHeight-cBRect.top+topOff;}',
'if(eBRect.left>(cBRect.left+(cBRect.width/2))){rect.align=\'after\';rect.right=(docWidth-eBRect.right+leftOff);}else{rect.align=\'before\';rect.left=eBRect.left-leftOff;}}else{if(this.edge==\'left\'){if(type==\'flyout-element\')rect.left=eBRect.right-leftOff;else if(type==\'flyout-element-cover\')rect.left=eBRect.left-leftOff;else rect.left=cBRect.right-leftOff;}else{if(type==\'flyout-element\')rect.right=docWidth-eBRect.left+leftOff;else if(type==\'flyout-element-cover\')rect.right=docWidth-eBRect.right+leftOff;else rect.right=docWidth-cBRect.left+leftOff;}',
'if(eBRect.top>(cBRect.top+(cBRect.height/2))){rect.align=\'after\';rect.bottom=(docHeight-eBRect.bottom+topOff);}else{rect.align=\'before\';rect.top=eBRect.top-topOff;}}}else if(type==\'cover\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'both\';rect.className=this.disclosure.cover[rect.edge+\'ClassName\'];}else if(type.split(\'-\').shift()==\'screen\'){rect.edge=type.split(\'-\').pop();if(rect.edge==\'left\'||rect.edge==\'right\')rect.fill=\'height\';else rect.fill=\'width\';}else{if(this.edge==\'top\'){rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'width\';if(type==\'extend-element\'){rect.top=eBRect.bottom-topOff;}else if(type==\'extend-element-cover\'){rect.top=eBRect.top-topOff;}else{rect.top=cBRect.bottom-topOff;if(type==\'outside-before\'){rect.fill=\'height\';rect.edge=\'left\';}else if(type==\'outside-after\'){rect.fill=\'height\';rect.edge=\'right\';}}}else if(this.edge==\'bottom\'){rect.left=cBRect.left-leftOff;rect.right=docWidth-cBRect.right+leftOff;rect.fill=\'width\';if(type==\'extend-element\'){rect.bottom=docHeight-eBRect.top+topOff;}else if(type==\'extend-element-cover\'){rect.bottom=docHeight-eBRect.bottom+topOff;}else{rect.bottom=docHeight-cBRect.top+topOff;if(type==\'outside-before\'){rect.fill=\'height\';rect.edge=\'left\';}else if(type==\'outside-after\'){rect.fill=\'height\';rect.edge=\'right\';}}}else if(this.edge==\'left\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.fill=\'height\';if(type==\'extend-element\'){rect.left=eBRect.right-leftOff;}else if(type==\'extend-element-cover\'){rect.left=eBRect.left-leftOff;}else{rect.left=cBRect.right-leftOff;if(type==\'outside-before\'){rect.fill=\'width\';rect.edge=\'top\';}else if(type==\'outside-after\'){rect.fill=\'width\';rect.edge=\'bottom\';}}}else if(this.edge==\'right\'){rect.top=cBRect.top-topOff;rect.bottom=docHeight-cBRect.bottom+topOff;rect.fill=\'height\';if(type==\'extend-element\'){rect.right=docWidth-eBRect.left+leftOff;}else if(type==\'extend-element-cover\'){rect.right=docWidth-eBRect.right+leftOff;}else{rect.right=docWidth-cBRect.left+leftOff;if(type==\'outside-before\'){rect.fill=\'width\';rect.edge=\'top\';}else if(type==\'outside-after\'){rect.fill=\'width\';rect.edge=\'bottom\';}}}',
'rect.className=this.disclosure.extend[rect.edge+\'ClassName\'];}',
'return rect;},_showDisclosureComplete:function(){if(this._d.shown){var dd=this.disclosures[this._d.current.s.name];if(dd){if(dd.onShowComplete.constructor==Function)dd.onShowComplete.call(this,this._d.current.dEle);}}},_hideDisclosureComplete:function(){if(this._d.shown){this._d.shown=false;this.state.disclosure.shown=false;this._d.current.dEle.style.display=\'none\';var dd=this.disclosures[this._d.current.s.name];if(dd){if(dd.onHide.constructor==Function)dd.onHide.call(this,this._d.current.dEle);}',
'if(this._d.next){this.showDisclosure(this._d.next,this._d.current.eleId);}else{this._d.ele.style.display=\'none\';this._d.current=false;}',
'this.refresh();}},_refreshAnimComplete:function(){this._m.anim=false;if(this._m.next.has){this._m.next.has=false;this.refresh.apply(this,this._m.next.args);delete this._m.next.args;}},_relayout:function(){if(this._d.shown){var ci=this',
'clearTimeout(this._rdTO);this._rdTO=setTimeout(function(){ci.resizeDisclosure();delete ci},50);}',
'if(this._e.shown){var ci=this',
'clearTimeout(this._reTO);this._reTO=setTimeout(function(){ci._editPos();delete ci},50);}},_disClick:function(e,ci){if(ci._d.current){var cEle=$(ci.contId);var coor=$e.getCoors(e);var ele=document.elementFromPoint(coor.clientX,coor.clientY);if(!ele)return true;while(ele!=cEle&&ele!=document.body){if(ele.hasAttribute(\'a5-action\'))ci.action(ele.getAttribute(\'a5-action\'),{element:ele,event:e});else if(ele==ci._d.current.dEle)return true;ele=ele.parentNode;}',
'if(ci._d.current){if(!ci._d.current.s.autoHide)return true;ci.hideDisclosure();}}},_disCloseClick:function(e,ci){ci.hideDisclosure();},_editKeyup:function(e,ci){if(ci.state.edit.item!=\'\'){if(ci._e.current.item.update!=\'done\')ci.update(ci.state.edit.path,this.value);A5.controlBar.items.edit.event.call(ci,\'keyup\',ci.state.edit.item,this.value,ci.items[ci.state.edit.item],this,e);var keyCode=e.charCode||e.keyCode;if(keyCode==13)this.blur();}},_editBlur:function(e,ci){if(document.activeElement!=ci._e.ele&&document.activeElement!=ci._e.dEle&&ci.state.edit.item!=\'\'){ci._e.shown=false;$(ci._e.current.id).style.visibility=\'\';A5.controlBar.items.edit.event.call(ci,\'done\',ci.state.edit.item,this.value,ci.items[ci.state.edit.item],this,e);this.style.display=\'none\';ci.state.edit.shown=false;ci.state.edit.item=\'\';ci.state.edit.part=\'\';if(ci._e.current.item.update==\'done\')ci.update(ci.state.edit.path,this.value);}},_editPos:function(){var tEle=$(this._e.current.id);if(tEle){if(this._e.current.p==\'main\')var ele=this._e.ele;else var ele=this._e.dEle;var eBRect=tEle.getBoundingClientRect();var peBRect=ele.parentNode.getBoundingClientRect();ele.style.top=(eBRect.top-peBRect.top)+\'px\';ele.style.left=(eBRect.left-peBRect.left)+\'px\';ele.style.width=eBRect.width+\'px\';ele.style.height=eBRect.height+\'px\';ele.style.display=\'\';tEle.style.visibility=\'hidden\';this._e.shown=true;}else{this._e.ele.style.display=\'none\';this._e.dEle.style.display=\'none\';this._e.shown=false;}},_down:function(e,ci){var r=ci._aEle(e);ci._startItem=false;if(r){ci._startItem={i:r.i,v:r.v,id:r.ele.id};if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'down\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_up:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'up\',r.i,r.v,iObj,r.ele,e);}',
'if(A5.u.drag._sDif<$e.abstractEvents.click.scrollMax){var id=\'\';if(ci._startItem){if(ci._startItem.i==r.i){id=r.ele.id;var dShown=ci._d.shown;if(iObj.disclosure){if(iObj.autoHideDisclosure!=\'auto\')ci._d.internalShow=true;ci.showDisclosure(iObj.disclosure,r.ele);ci._d.internalShow=false;}else if(iObj.type==\'edit\'){if(ci.state.edit.shown){var tEle=$(ci._e.current.id);tEle.innerHTML=ci._e.ele.value;tEle.style.visibility=\'\';}',
'ci._e.current={item:iObj,id:id,p:r.p};if(r.p==\'main\')var eEle=ci._e.ele;else var eEle=ci._e.dEle;eEle.className=iObj.settings.className;$ss(eEle,iObj.settings.style+\'; position: absolute; top: 0px; left: 0px; margin: 0px; display: none; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\');var ev=A5.u.object.get(ci.data,iObj.bind.value);eEle.value=ev;ci._editPos();eEle.focus();eEle.select();ci.state.edit.shown=true;ci.state.edit.item=r.i;ci.state.edit.part=r.p;ci.state.edit.path=iObj.bind.value;}',
'if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'click\',r.i,r.v,iObj,r.ele,e);}',
'if(dShown&&!ci._d.next&&ci._d.current){if(iObj.autoHideDisclosure){var hide=false;if(iObj.autoHideDisclosure==\'always\')hide=true;else if(iObj.autoHideDisclosure!=\'never\'&&ci._d.current.s.autoHide)hide=true;if(hide)ci.hideDisclosure();}}}}',
'if(this._oid==id)this._isdc=true;else{this._isdc=false;this._oid=id;}}}}}',
'delete r;},_dblClick:function(e,ci){if(!this._isdc)return false;var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'dblclick\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_rClick:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'contextclick\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_downHold:function(e,ci){var r=ci._aEle(e);if(r){if($ga(r.ele,\'a5-disabled\')!=\'true\'&&!r.ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'downhold\',r.i,r.v,iObj,r.ele,e);}}}}',
'delete r;},_swipe:function(e,ci){if(ci._startItem){var r=ci._startItem;var ele=$(r.id);if($ga(ele,\'a5-disabled\')!=\'true\'&&!ele.disabled){var iObj=ci.items[r.i];if(iObj){var iTObj=A5.controlBar.items[iObj.type];if(iTObj){if(iTObj.event)iTObj.event.call(ci,\'swipe\',r.i,r.v,iObj,ele,e);}}}}},_aEle:function(e){var cEle=$(this.contId);var coor=$e.getCoors(e);var ele=document.elementFromPoint(coor.clientX,coor.clientY);if(!ele)return false;var result=false;var i=\'\';while(ele!=cEle&&ele!=document.body){if(!result){i=$ga(ele,\'a5-item\');if(i!=null&&i!=\'\'){var v=this._getValue(ele);result={i:i,v:v,ele:ele,p:\'disclosure\'};}}',
'ele=ele.parentNode;}',
'if(ele==cEle&&result)result.p=\'main\';return result;},_getValue:function(ele){var v=$ga(ele,\'a5-value\');if(v==\'\'||v==null)v=ele.id;return v;},_bindEvents:function(ele){var egName=\'CONTROLBAR.\'+this.contId;$e.add(ele,A5.d.evnts.dblClick,this._dblClick,this,false,egName);$e.add(ele,\'contextmenu\',this._rClick,this,false,egName);$e.add(ele,A5.d.evnts.down,this._down,this,false,egName);$e.add(ele,A5.d.evnts.up,this._up,this,false,egName);$e.add(ele,\'abstractdownhold\',this._downHold,this,false,egName);$e.add(ele,\'abstractswipe\',this._swipe,this,false,egName);},_compileTemplate:function(cl,edge){if(typeof cl._t==\'undefined\')cl._t={};if(typeof cl._t[edge]==\'undefined\'){var tLines=[];var l=null;var ti=null;var cn=\'\';var temp=[];var name=\'\';var tHTML=\'\';var tPH=\'\';for(var i=0;i<cl.lines.length;i++){l=cl.lines[i];$u.o.assign(l,A5.controlBar._.lDefs,true);cn=\'A5ControlBarLine\';if(l.type!=\'custom\'){if(l.middle.items.length==0){if(l.before.items.length==0)cn=\'A5ControlBarLine A5ControlBarLineAfter\';else cn=\'A5ControlBarLine A5ControlBarLineBefore\';}}else cn=\'A5ControlBarLineCust\';temp=[\'<div class="\'+cn+\' \'+l.className+\'" style="\'+l.style+\'">\'];if(l.type==\'custom\'){tHTML=l.html;for(var item in this.items){tPH=\'[\'+item+\']\';if(tHTML.indexOf(tPH)!=-1)tHTML=tHTML.split(tPH).join(this.items[item].template);}',
'temp.push(tHTML);}else{if(l.before.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentBefore">&#65279;\');for(var k=0;k<l.before.items.length;k++){name=l.before.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}',
'if(l.middle.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentMiddle">&#65279;\');for(var k=0;k<l.middle.items.length;k++){name=l.middle.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}',
'if(l.after.items.length!=0){temp.push(\'<div class="A5ControlBarLineContentAfter">&#65279;\');for(var k=0;k<l.after.items.length;k++){name=l.after.items[k];if(name==\'-\'){temp.push(\'<div class="A5ControlBarItem A5CONTROLBARSEPCLASSNAME">&#65279;</div>\');}else if(name[0]==\'<\'){name=name.substring(1,name.length-1).trim();temp.push(\'<div class="A5ControlBarItem" style="A5CONTROLBARITEMSIZE: \'+name+\';"></div>\');}else if(this.items[name])temp.push(this.items[name].template);}',
'temp.push(\'</div>\');}}',
'temp.push(\'</div>\');if(l.bind.show!=\'\'){temp.unshift(\'{*if \'+l.bind.show+\'}\')',
'temp.push(\'{*endif}\');}',
'tLines.push(temp.join(\'\'));}',
'if(edge==\'left\'){tLines.unshift(\'<div class="A5ControlBarVert">\');tLines.push(\'</div>\');}else if(edge==\'bottom\'){tLines.reverse();tLines.unshift(\'<div class="A5ControlBarHorz">\');tLines.push(\'</div>\');}else if(edge==\'right\'){tLines.reverse();tLines.unshift(\'<div class="A5ControlBarVert">\');tLines.push(\'</div>\');}else{tLines.unshift(\'<div class="A5ControlBarHorz">\');tLines.push(\'</div>\');}',
'tLines=tLines.join(\'\');if(edge==\'left\'||edge==\'right\'){tLines=tLines.replace(/A5CONTROLBARITEMSIZE/gi,\'height\');tLines=tLines.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.verticalClassName);}else{tLines=tLines.replace(/A5CONTROLBARITEMSIZE/gi,\'width\');tLines=tLines.replace(/A5CONTROLBARSEPCLASSNAME/gi,this.separator.horizontalClassName);}',
'cl._t[edge]=A5.u.template.parse(tLines);}}});};',
'A5._windowDefaults={title:{tools:{defaults:{\'close\':{action:\'close\',name:\'close\',image:\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAB/klEQVR42qWTPU9qQRCGn92zh0BskGMBFbmlPZHWhopgbWNj/EmWJ7EiASztKK39BZiTGwtCSCAaPIrZz9vIBu69nZtMss3MPO87MyKEwE+eAphOp7+staPNZtNxzknnHN57vPf8/Q8h+DRNn5RSlzc3N78VgLV2dHp6etZut3HOYa2NYYzBGIPWGmMMX19fsiiKs/l8PgK6CmCz2XTa7TYfHx8453h/f0dKidY6RlmWfDej1Woxm806ABJgh22MYTKZcHt7GxMAPj8/ub+/5/HxEe89u5z9AlhrKcuSoihYLBbkeU5ZlpRlyXg8ZrVasVgs0FpHX6KJ3nustUgpub6+Js9zlssld3d3hBBYr9dkWUa/3ydJEpxzOOeIBN77aFSaplxdXXFycsJqtWK9XtNoNBgMBlQqldjsgGAnQWsNgDGG/f0IIcQxOucQQvxLsHP77e2N4XAYOx8fH/P6+srDw0OckjEmEhxI2DcsyzIuLi4YDAaxyHQ6ZbvdHkiIUzDGANBsNmk0GvT7fZRSJElCr9ejXq+TZRlCiCgnehBC8NvtVlpr6Xa7aK3jInnvSZKE8/NzhBAAaK0JIfhIkKbpU1EUVCoVqtUqR0dHJEmClJKdRKUUQgiMMby8vFCr1Z4igVLqcj6fj56fnzvOObl/RP87pu/kSwDx03P+A1+yn0B7bDkwAAAAAElFTkSuQmCC\'}}}}}',
'A5.serverSideDateFormat = \'dd/MM/yyyy\';',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj == \'object\') { ',
'\t{UXPRERENDEREDALIAS}_DlgObj._destroy();',
'\ttry {',
'\t\tdelete {UXPRERENDEREDALIAS}_DlgObj;',
'\t} catch(e) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj = undefined;',
'\t}',
'};',
';if(typeof {UXPRERENDEREDALIAS}_PanelObj != \'undefined\' && {UXPRERENDEREDALIAS}_PanelObj) {',
'\tvar ele = $({UXPRERENDEREDALIAS}_PanelObj.getPanelId());',
'\tif(ele) {',
'\t\tif(ele.parentNode) ele.parentNode.removeChild(ele);',
'\t}',
'\tdelete {UXPRERENDEREDALIAS}_PanelObj;',
'}',
';window[\'{UXPRERENDEREDALIAS}_PanelObj\'] = new A5.PanelNavigator([',
'{',
'\tname: \'PANELCARD_1\',',
'\tsrc: new A5.PanelCard({',
'\ttheme: \'Alpha-Magenta\',',
'\tbody: {',
'\t\tcontent: {',
'\t\t\ttype: \'html\',',
'\t\t\tsrc: \'<div class="A5CWLayout" style="width: 60%" >\\r\\n \\r\\n<div   style="padding:0px; "  >\\r\\n <div id="{UXPRERENDEREDALIAS}.V.R1.LSTMESSAGE.CONTROL"  class="{UXPRERENDEREDALIAS}_LSTMESSAGE" style="overflow: auto; width: 100%; height: 3in; "></div>\\r\\n</div>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5floatClear"></div>\'',
'\t\t},',
'\t\tscroll: {',
'\t\t\taxis: \'both\',',
'\t\t\tstopPropogation: false,',
'\t\t\tpull: {',
'\t\t\t\ty: \'auto\',',
'\t\t\t\tx: \'auto\',',
'\t\t\t\tduration: 1000',
'\t\t\t},',
'\t\t\tindicator: {',
'\t\t\t\tshow: true,',
'\t\t\t\th: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'top\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\tleft: \'0px\',',
'\t\t\t\t\tright: \'0px\'',
'\t\t\t\t},',
'\t\t\t\tv: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'right\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\ttop: \'0px\',',
'\t\t\t\t\tbottom: \'0px\'',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t},',
'\theader: {',
'\t\thtml: \'<div class="A5CWLayout"      style="width: 100%; width: 100%; "  >  <div>  <fieldset id="{UXPRERENDEREDALIAS}.V.R1.FRAME_1" a5-containertype="framesimple" class="" style="-moz-border-radius: 8px;display:inline; width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" >  <legend class="" style=""  >Search</legend> <div class="A5CWLayout" style="width: 50%" >  <label id="{UXPRERENDEREDALIAS}.LBL.R1.SEARCH_FROMUSER" for="{UXPRERENDEREDALIAS}.V.R1.SEARCH_FROMUSER" title="" class="label" style="float: left; width: 1in; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;">From</label> <div style="margin-left: 1in ;"><select     size="1"    class="edit "     name="V.R1.SEARCH_FROMUSER"    title=""   style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"   id="{UXPRERENDEREDALIAS}.V.R1.SEARCH_FROMUSER"      onchange="var tfunc = function() {onChange_SEARCH_fromuser_7ab651e0c4f54bada3edf06fc46dc913.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"            > <option value="Excellence 1">Excellence 1</option>  </select> </div> </div> <div class="A5CWLayout" style="width: 50%" >  <label id="{UXPRERENDEREDALIAS}.LBL.R1.SEARCH_TOUSER" for="{UXPRERENDEREDALIAS}.V.R1.SEARCH_TOUSER" title="" class="label" style="float: left; width: 1in; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;">To</label> <div style="margin-left: 1in ;"><select     size="1"    class="edit "     name="V.R1.SEARCH_TOUSER"    title=""   style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"   id="{UXPRERENDEREDALIAS}.V.R1.SEARCH_TOUSER"      onchange="var tfunc = function() {onChange_SEARCH_touser_266f0a3607fe4c51b959edb76176c5ae.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"            > <option value="Excellence 1">Excellence 1</option>  </select> </div> </div><br  style="clear:both; " /> <div class="A5CWLayout" style="width: 50%" >  <label id="{UXPRERENDEREDALIAS}.LBL.R1.SEARCH_PRIORITY" for="{UXPRERENDEREDALIAS}.V.R1.SEARCH_PRIORITY" title="" class="label" style="float: left; width: 1in; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;">PRIORITY</label> <div style="margin-left: 1in ;"><select     size="1"    class="edit "     name="V.R1.SEARCH_PRIORITY"    title=""   style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"   id="{UXPRERENDEREDALIAS}.V.R1.SEARCH_PRIORITY"      onchange="var tfunc = function() {onChange_SEARCH_PRIORITY_60c8e1ece80e410e906ccf77f33d8150.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"            > <option value=""></option> <option value="Low">Low</option> <option value="Medium">Medium</option> <option value="Hight">Hight</option> <option value="Alert">Alert</option>  </select> </div> </div> <div class="A5CWLayout" style="width: 50%" >  <label id="{UXPRERENDEREDALIAS}.LBL.R1.SEARCH_DONE" for="{UXPRERENDEREDALIAS}.V.R1.SEARCH_DONE" title="" class="label" style="float: left; width: 1in; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;">done</label> <div style="margin-left: 1in ;"><select     size="1"    class="edit "     name="V.R1.SEARCH_DONE"    title=""   style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"   id="{UXPRERENDEREDALIAS}.V.R1.SEARCH_DONE"      onchange="var tfunc = function() {onChange_SEARCH_done_a0dbf7ca03424978af350ff178e6e12a.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"            > <option value="1">Done</option> <option value="0">Not Done</option>  </select> </div> </div><br  style="clear:both; " /> </fieldset> </div> </div> <br  style="clear:both; " /> <div class="A5CWLayout" style="width: 50%" >  <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCH_LSTMESSAGE"    ></button> </div> <div class="A5CWLayout" style="width: 50%" >  <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE"    ></button> </div> <div style="display:none;"></div>\',',
'\t\tshow: true',
'\t},',
'\tfooter: {',
'\t\thtml: \'<div class="A5CWLayout" style="width: 50%" >  <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVNEWRECORD_LSTMESSAGE"    ></button> </div> \',',
'\t\tshow: true',
'\t},',
'\toverlay: {',
'\t},',
'\tonSize: function() {',
';',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj ) {var mObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\'); if(mObj) {',
'\t\t\tif(mObj.resize) {',
'\t\t\t\tmObj.resize();',
'\t\t\t} else { ',
'\t\t\t\tif(typeof mObj.autoRefreshOnResize == \'undefined\' || mObj.autoRefreshOnResize) mObj.refresh()',
'\t\t\t}',
'\t\t}',
'\t}',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard) {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard(\'PANELCARD_1\',this);',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj != null && typeof {UXPRERENDEREDALIAS}_DlgObj._panelCardResize != \'undefined\') { {UXPRERENDEREDALIAS}_DlgObj._panelCardResize(\'PANELCARD_1\'); };;setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_1\')',
'},0);',
'},',
'\tonView: function() {;',
';setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_1\')',
'},0);',
'},',
'\tonActivate: function() {},',
'\tonCreate: function() {',
'}',
'})',
'},',
'{',
'\tname: \'PANELCARD_2\',',
'\tsrc: new A5.PanelCard({',
'\ttheme: \'Alpha-Magenta\',',
'\tbody: {',
'\t\tcontent: {',
'\t\t\ttype: \'html\',',
'\t\t\tsrc: \'<div  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_1"   \\r\\n   A5-containerType="none"\\r\\n   class="A5CWLayout "  style="width: 100%; "  >\\r\\n<div class="A5CWLayout" style="width: 33.33%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.DATE" for="{UXPRERENDEREDALIAS}.V.R1.DATE" title="" class="" style="display:block;">date</label>\\r\\n\\r\\n <input type="text" id="{UXPRERENDEREDALIAS}.V.R1.DATE" title=""     class="edit " style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"  onchange="var tfunc = function() {onChange_date_7d3bda04d4da4fb897e3d7e75ce4da4d.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   name="V.R1.DATE"    value=""   readonly="readonly"   />\\r\\n\\r\\n</div>\\r\\n<div class="A5CWLayout" style="width: 33.33%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.FROM" for="{UXPRERENDEREDALIAS}.V.R1.FROM" title="" class="" style="display:block;">From</label>\\r\\n\\r\\n <input type="text" id="{UXPRERENDEREDALIAS}.V.R1.FROM" title=""     class="edit " style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"  onchange="var tfunc = function() {onChange_From_b2ea807b6d4e4c479a6b864cca3aaa1d.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   name="V.R1.FROM"    value=""   readonly="readonly"   />\\r\\n\\r\\n</div>\\r\\n<div class="A5CWLayout" style="width: 33.33%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.TO" for="{UXPRERENDEREDALIAS}.V.R1.TO" title="" class="" style="display:block;">To</label>\\r\\n\\r\\n <select  \\r\\n  size="1" \\r\\n  class="edit "  \\r\\n  name="V.R1.TO" \\r\\n  title=""\\r\\n  style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"\\r\\n  id="{UXPRERENDEREDALIAS}.V.R1.TO"  \\r\\n   onchange="var tfunc = function() {onChange_To_02d00f27d4854f5098ba9edbd107fa76.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"  \\r\\n  \\r\\n  \\r\\n   >\\r\\n<option value=""></option> <option value="Excellence 1">Excellence 1</option> \\r\\n</select>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_2"   \\r\\n   A5-containerType="none"\\r\\n   class="A5CWLayout "  style="width: 66.67%; "  >\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.MESSAGE" for="{UXPRERENDEREDALIAS}.V.R1.MESSAGE" title="" class="" style="display:block;">message</label>\\r\\n\\r\\n <textarea id="{UXPRERENDEREDALIAS}.V.R1.MESSAGE" class="edit " title="" style="width: 100%; height: 120px; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" rows="2" cols="20"  onchange="var tfunc = function() {onChange_message_67fc519d5b35478aaa58ab1b0c5c2191.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   name="V.R1.MESSAGE"  ></textarea>\\r\\n\\r\\n</div>\\r\\n<div style="display:none;font: 0pt arial;clear:both;"></div>\\r\\n  </div>\\r\\n \\r\\n<div  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_3"   \\r\\n   A5-containerType="none"\\r\\n   class="A5CWLayout "  style="width: 33.33%; "  >\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.PRIORITY" for="{UXPRERENDEREDALIAS}.V.R1.PRIORITY" title="" class="" style="display:block;">PRIORITY</label>\\r\\n\\r\\n <select  \\r\\n  size="1" \\r\\n  class="edit "  \\r\\n  name="V.R1.PRIORITY" \\r\\n  title=""\\r\\n  style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"\\r\\n  id="{UXPRERENDEREDALIAS}.V.R1.PRIORITY"  \\r\\n   onchange="var tfunc = function() {onChange_PRIORITY_afbf9b04d8d9409fa95b6d2c3799453c.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"  \\r\\n  \\r\\n  \\r\\n   >\\r\\n<option value=""></option> <option value="Low">Low</option> <option value="Medium">Medium</option> <option value="Hight">Hight</option> <option value="Alert">Alert</option> \\r\\n</select>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.DUEDATE" for="{UXPRERENDEREDALIAS}.V.R1.DUEDATE" title="" class="label" style="display:block;">duedate</label>\\r\\n\\r\\n <table id="{UXPRERENDEREDALIAS}.V.R1.DUEDATE.CONTAINER" cellspacing="0" cellpadding="0" class="editBG" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display: inline-table; white-space:normal; ">\\r\\n<tr>\\r\\n<td style="width:100%">\\r\\n <input   id="{UXPRERENDEREDALIAS}.V.R1.DUEDATE" name="V.R1.DUEDATE"  value=""  autocomplete="off"   size="200" class="editBGEdit" style="width: 100%; ; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\\r\\n \\r\\n</td>\\r\\n  <td class="" >&nbsp;</td>\\r\\n  <td id="{UXPRERENDEREDALIAS}.V.R1.DUEDATE.BUTTON" class="editBGButton" style="width: 0%;"><svg     class="icon"><use x="0" y="0" width="100%" height="100%" xlink:href="#alpha-icon-chevronDown"  pointer-events="none" /></svg></td>\\r\\n </tr>\\r\\n</table>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.DONE" for="{UXPRERENDEREDALIAS}.V.R1.DONE" title="" class="" style="display:block;">done</label>\\r\\n\\r\\n <span title="" ><span  id="{UXPRERENDEREDALIAS}.V.R1.DONE.CONTAINER" ><input type="checkbox" id="{UXPRERENDEREDALIAS}.V.R1.DONE" name="V.R1.DONE"  value="True"  onBlur="{UXPRERENDEREDALIAS}_DlgObj.buttonClick(\\\'BUTTON_DVSAVE_LSTMESSAGE\\\');" onchange="var tfunc = function() {onChange_done_3d2b539b19684d3da32298cc2e202c34.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"    /><label for="{UXPRERENDEREDALIAS}.V.R1.DONE"></label></span></span> \\r\\n  \\r\\n</div><br  style="clear:both; " />\\r\\n<div style="display:none;font: 0pt arial;clear:both;"></div>\\r\\n  </div>\\r\\n <br  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_3.BREAK"  style="clear:both; " />\\r\\n<div  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_4"   \\r\\n   A5-containerType="none"\\r\\n   class="A5CWLayout "  style="width: 100%; "  >\\r\\n<div class="A5CWLayout" style="width: 33.33%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.ADDTOROUTE" for="{UXPRERENDEREDALIAS}.V.R1.ADDTOROUTE" title="" class="label" style="display:block;">addtoroute</label>\\r\\n\\r\\n <span title="" ><span  id="{UXPRERENDEREDALIAS}.V.R1.ADDTOROUTE.CONTAINER" ><input type="checkbox" id="{UXPRERENDEREDALIAS}.V.R1.ADDTOROUTE" name="V.R1.ADDTOROUTE"  value="True"  onchange="var tfunc = function() {onChange_addtoroute_893c3d71e53749ba8028610aeeaf996a.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"    /><label for="{UXPRERENDEREDALIAS}.V.R1.ADDTOROUTE"></label></span></span> \\r\\n  \\r\\n</div>\\r\\n<div class="A5CWLayout" style="width: 50%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.POIID" for="{UXPRERENDEREDALIAS}.V.R1.POIID" title="" class="label" style="display:block;">poiid</label>\\r\\n\\r\\n <table id="{UXPRERENDEREDALIAS}.V.R1.POIID.CONTAINER" cellspacing="0" cellpadding="0" class="editBG" style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;; display: inline-table; white-space:normal; ">\\r\\n<tr>\\r\\n<td style="width:100%">\\r\\n <input   id="{UXPRERENDEREDALIAS}.V.R1.POIID" name="V.R1.POIID"  value=""  onChange="var tfunc = function() {onChange_poiid_c4b554e74f264b78b49885c236989a4b.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   readonly="readonly"  autocomplete="off"   size="200" class="editBGEdit" style="width: 100%; ; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" />\\r\\n \\r\\n</td>\\r\\n  <td class="" >&nbsp;</td>\\r\\n  <td id="{UXPRERENDEREDALIAS}.V.R1.POIID.CUSTOMBUTTON.0"  class="editBGButton" style="width: 0%;"><i  title="" style="vertical-align: middle; ;font-size: 10px; -xlibrary: materialIcons;" class="mi mi-Youtube-Searched-For" ></i></td>\\r\\n </tr>\\r\\n</table>\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.TEXTBOX1" for="{UXPRERENDEREDALIAS}.V.R1.TEXTBOX1" title="" class="label" style="display:block;">Textbox1</label>\\r\\n\\r\\n <input type="text" id="{UXPRERENDEREDALIAS}.V.R1.TEXTBOX1" title=""     class="edit " style="width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;"  onchange="var tfunc = function() {onChange_textbox1_203c6f95236d4b72867f5b253a4551bc.call(this,{UXPRERENDEREDALIAS}_DlgObj);;}; var tscope = this; setTimeout(function() { if(tscope) { tfunc.call(tscope);} delete tscope;},1 );"   name="V.R1.TEXTBOX1"    value=""   readonly="readonly"   />\\r\\n\\r\\n</div><br  style="clear:both; " />\\r\\n<div style="display:none;font: 0pt arial;clear:both;"></div>\\r\\n  </div>\\r\\n <br  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_4.BREAK"  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: "  id="{UXPRERENDEREDALIAS}.V.R1.LSTMESSAGE_GLOBALERRORS" style="box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;" _type="placeholder">\\r\\n</div><br  style="clear:both; " />\\r\\n<div class="A5CWLayout" style="width: 50%" >\\r\\n <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVSAVE_LSTMESSAGE"    ></button>\\r\\n</div>\\r\\n<div style="display:none;font: 0pt arial;clear:both;"></div>\\r\\n  </div>\\r\\n <br  id="{UXPRERENDEREDALIAS}.V.R1.CONTAINER_1.BREAK"  style="clear:both; " />\\r\\n<div class="A5floatClear"></div>\'',
'\t\t},',
'\t\tscroll: {',
'\t\t\taxis: \'both\',',
'\t\t\tstopPropogation: false,',
'\t\t\tpull: {',
'\t\t\t\ty: \'auto\',',
'\t\t\t\tx: \'auto\',',
'\t\t\t\tduration: 1000',
'\t\t\t},',
'\t\t\tindicator: {',
'\t\t\t\tshow: true,',
'\t\t\t\th: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'top\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\tleft: \'0px\',',
'\t\t\t\t\tright: \'0px\'',
'\t\t\t\t},',
'\t\t\t\tv: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'right\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\ttop: \'0px\',',
'\t\t\t\t\tbottom: \'0px\'',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t},',
'\theader: {',
'\t\thtml: \'<div class="A5CWLayout" style="width: " >  <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVRESET_LSTMESSAGE"    ></button> </div> <div style="display:none;"></div>\',',
'\t\tshow: true',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tonSize: function() {if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard) {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard(\'PANELCARD_2\',this);',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj != null && typeof {UXPRERENDEREDALIAS}_DlgObj._panelCardResize != \'undefined\') { {UXPRERENDEREDALIAS}_DlgObj._panelCardResize(\'PANELCARD_2\'); };;setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_2\')',
'},0);',
'},',
'\tonView: function() {;',
';setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_2\')',
'},0);',
'},',
'\tonActivate: function() {},',
'\tonCreate: function() {',
'}',
'})',
'},',
'{',
'\tname: \'PANELCARD_3\',',
'\tsrc: new A5.PanelCard({',
'\ttheme: \'Alpha-Magenta\',',
'\tbody: {',
'\t\tcontent: {',
'\t\t\ttype: \'html\',',
'\t\t\tsrc: \'<div class="A5CWLayout" style="width: 100%" >\\r\\n <label id="{UXPRERENDEREDALIAS}.LBL.R1.LIST1" for="{UXPRERENDEREDALIAS}.V.R1.LIST1" title="" class="label" style="display:block;">LIST1</label>\\r\\n\\r\\n \\r\\n<div   style="padding:0px; "  >\\r\\n <div id="{UXPRERENDEREDALIAS}.V.R1.LIST1.CONTROL"  class="{UXPRERENDEREDALIAS}_LIST1" style="overflow: auto; width: 100%; height: 3in; "></div>\\r\\n</div>\\r\\n\\r\\n</div>\\r\\n<div class="A5floatClear"></div>\'',
'\t\t},',
'\t\tscroll: {',
'\t\t\taxis: \'both\',',
'\t\t\tstopPropogation: false,',
'\t\t\tpull: {',
'\t\t\t\ty: \'auto\',',
'\t\t\t\tx: \'auto\',',
'\t\t\t\tduration: 1000',
'\t\t\t},',
'\t\t\tindicator: {',
'\t\t\t\tshow: true,',
'\t\t\t\th: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'top\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\tleft: \'0px\',',
'\t\t\t\t\tright: \'0px\'',
'\t\t\t\t},',
'\t\t\t\tv: {',
'\t\t\t\t\tshow: true,',
'\t\t\t\t\tlocation: \'right\',',
'\t\t\t\t\toffset: \'0px\',',
'\t\t\t\t\ttop: \'0px\',',
'\t\t\t\t\tbottom: \'0px\'',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t},',
'\theader: {',
'\t\thtml: \'<div class="A5CWLayout" style="width: " >  <button type="button" id="{UXPRERENDEREDALIAS}.V.R1.BUTTON_6"    ></button> </div> <div style="display:none;"></div>\',',
'\t\tshow: true',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tonSize: function() {',
';',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj ) {var mObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LIST1\'); if(mObj) {',
'\t\t\tif(mObj.resize) {',
'\t\t\t\tmObj.resize();',
'\t\t\t} else { ',
'\t\t\t\tif(typeof mObj.autoRefreshOnResize == \'undefined\' || mObj.autoRefreshOnResize) mObj.refresh()',
'\t\t\t}',
'\t\t}',
'\t}',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard) {UXPRERENDEREDALIAS}_DlgObj._pdfViewerResizeToFitPanelCard(\'PANELCARD_3\',this);',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\' && {UXPRERENDEREDALIAS}_DlgObj != null && typeof {UXPRERENDEREDALIAS}_DlgObj._panelCardResize != \'undefined\') { {UXPRERENDEREDALIAS}_DlgObj._panelCardResize(\'PANELCARD_3\'); };;setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_3\')',
'},0);',
'},',
'\tonView: function() {;',
';setTimeout(function() { ',
'\tif({UXPRERENDEREDALIAS}_DlgObj && {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel) {UXPRERENDEREDALIAS}_DlgObj._turnResizeOnForListsOnPanel(\'PANELCARD_3\')',
'},0);',
'},',
'\tonActivate: function() {},',
'\tonCreate: function() {',
'}',
'})',
'}',
'],{',
'\t__parentPanelName: \'[top]\',',
'\ttype: \'carousel\',',
'\tflow: \'ltr\',',
'\tloopNavigate: false,',
'\tonPanelActivate: function() {},',
'\tonPanelActivateComplete: function() {;',
'{UXPRERENDEREDALIAS}_DlgObj.refreshClientSideComputations(true);},',
'\tonPanelView: function() {',
';',
'},',
'\tonSize: function() {;if(typeof {UXPRERENDEREDALIAS}_DlgObj != \'undefined\') {',
' if(typeof {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule != \'undefined\') {',
'  {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule();',
' }',
'}},',
'\tonCreate: function() {',
'},',
'\ttheme: \'Alpha-Magenta\',',
'\theader: {',
'\t\tshow: false',
'\t},',
'\tfooter: {',
'\t},',
'\toverlay: {',
'\t},',
'\tcontrols: {',
'\t\tprev: {',
'\t\t\thas: false',
'\t\t},',
'\t\tnext: {',
'\t\t\thas: false',
'\t\t},',
'\t\tback: {',
'\t\t\thas: false',
'\t\t},',
'\t\tforward: {',
'\t\t\thas: false',
'\t\t}',
'\t},',
'\tbody: {',
'\t},',
'\tanimation: {',
'\t\tduration: 400',
'\t}',
'})',
'var ele = window[\'{UXPRERENDEREDALIAS}_PanelObj\'].create(\'{UXPRERENDEREDALIAS}.R1\');',
'\t\tvar panelRootId = \'{UXPRERENDEROUTPUTDIV}\';',
'\t\tvar flagSizeToParent = true;',
'\t\tvar wf_alias = \'{UXPRERENDEREDALIAS}\';',
'\t\tif(panelRootId != \'\') { ',
'\t\t\tif (!$(panelRootId)) panelRootId = \'\';',
'\t\t}',
'\t\tif(panelRootId != \'\') { ',
'\t\t\t$(panelRootId).appendChild(ele);',
'\t\t\tif(flagSizeToParent) { ',
'\t\t\t\tif(window[wf_alias + \'_PanelObj\']) window[wf_alias + \'_PanelObj\'].bindSize(\'parent\');',
'\t\t\t\tvar ele = $(panelRootId + \'.CONTENT\'); if(ele) ele.style.display = \'none\'; //srec',
'\t\t\t}',
'\t\t} else { ',
'\t\t\tdocument.body.insertBefore(ele,document.body.firstChild);',
'\t\t\tif(window[wf_alias + \'_PanelObj\']) window[wf_alias + \'_PanelObj\'].bindSize(\'window\');',
'\t\t}',
'{UXPRERENDEREDALIAS}_PanelObj._panelPath = {',
'\tPANELCARD_1: \'PANELCARD_1\',',
'\tPANELCARD_2: \'PANELCARD_2\',',
'\tPANELCARD_3: \'PANELCARD_3\'',
'}',
'{UXPRERENDEREDALIAS}_PanelObj._displayNames = {',
'PANELCARD_1 : \'PANELCARD_1\',PANELCARD_2 : \'PANELCARD_2\',PANELCARD_3 : \'PANELCARD_3\',PANELNAVIGATOR_1 : \'PANELNAVIGATOR_1\'',
'};',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj == \'object\') {UXPRERENDEREDALIAS}_DlgObj._destroy();',
'window[\'{UXPRERENDEREDALIAS}_DlgObj\'] = new A5.DialogComponentHelper(\'{UXPRERENDEREDALIAS}\',{',
'\tajaxURL: \'{UXPRERENDERAJAXURL}\',',
'\t_embeddedMode: false,',
'\t_livePreviewInBuilder: false,',
'\tcomponentGUID: \'f062a9cd-9bcd-433f-a51d-57f378a7cc82\',',
'\tcolumnInfo: {\'SEARCH_FROMUSER\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'SEARCH_TOUSER\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'SEARCH_PRIORITY\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'SEARCH_DONE\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'N\'  },\'LSTMESSAGE\': {info: {controlType: \'List\'}, hiddenVal: false, type: \'control\', isCalc: false, hlp: \'\', isArray: false, dataType: \'\'  },\'DATE\': {info: {controlType: \'TextBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'T\'  },\'FROM\': {info: {controlType: \'TextBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'TO\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'MESSAGE\': {info: {controlType: \'TextArea\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'PRIORITY\': {info: {controlType: \'DropDownBox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'DUEDATE\': {info: {controlType: \'Textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'D\'  },\'DONE\': {info: {controlType: \'Checkbox\',isJSControl: false,dataType: \'n\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'L\'  },\'ADDTOROUTE\': {info: {controlType: \'Checkbox\',isJSControl: false,dataType: \'n\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'L\'  },\'POIID\': {info: {controlType: \'Textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'N\'  },\'TEXTBOX1\': {info: {controlType: \'textbox\'}, hiddenVal: false, type: \'input,label\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  },\'LIST1\': {info: {controlType: \'List\'}, hiddenVal: false, type: \'control\', isCalc: false, hlp: \'\', isArray: false, dataType: \'C\'  }},',
'\toriginalValues: [{',
'\t"SEARCH_FROMUSER": "",',
'\t"SEARCH_TOUSER": "35%",',
'\t"SEARCH_PRIORITY": "",',
'\t"SEARCH_DONE": "",',
'\t"LSTMESSAGE": "",',
'\t"DATE": "",',
'\t"FROM": "",',
'\t"TO": "",',
'\t"MESSAGE": "",',
'\t"PRIORITY": "",',
'\t"DUEDATE": "",',
'\t"DONE": false,',
'\t"ADDTOROUTE": false,',
'\t"POIID": "",',
'\t"TEXTBOX1": "",',
'\t"LIST1": ""',
'}],',
'\tdefaultValues: {',
'\t"SEARCH_FROMUSER": "",',
'\t"SEARCH_TOUSER": "35%",',
'\t"SEARCH_PRIORITY": "",',
'\t"SEARCH_DONE": "",',
'\t"LSTMESSAGE": "",',
'\t"DATE": "",',
'\t"FROM": "",',
'\t"TO": "",',
'\t"MESSAGE": "",',
'\t"PRIORITY": "",',
'\t"DUEDATE": "",',
'\t"DONE": false,',
'\t"ADDTOROUTE": false,',
'\t"POIID": "",',
'\t"TEXTBOX1": "",',
'\t"LIST1": ""',
'},',
'\tdatePickerMonthNames: [\'January\',\'February\',\'March\',\'April\',\'May\',\'June\',\'July\',\'August\',\'September\',\'October\',\'November\',\'December\'],',
'\tdatePickerDayNames: [\'Sun\',\'Mon\',\'Tue\',\'Wed\',\'Thu\',\'Fri\',\'Sat\'],',
'\tdatePickerTodayButton: \'Today\',',
'\tdatePickerCloseButton: \'\',',
'\tdatePickerFirstDayOfWeek: 1,',
'\tresetFormMessage: \'Are you sure you want to reset the form?\',',
'\tresetFormTitle: \'Warning\',',
'\tresetFormIcon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\tdirtyFormMessage: \'You must first save your changes or cancel changes by clicking the Reset button.\',',
'\tdirtyFormTitle: \'Notice\',',
'\tdirtyFormIcon: \'svgIcon=#alpha-icon-infoCircle:icon\',',
'\tdeleteRecordDialogTitle: \'Delete Record\',',
'\tdeleteRecordDialogMessage: \'Are you sure you want to delete this record?\',\t',
'\tssDateFormat: \'dd/MM/yyyy\',',
'\tstyleName: \'Alpha-Magenta\',',
'\t_fieldHelpers_DIALOG2: [],',
'\tparentComponentAlias: \'\'+go._thisGridAlias+\'\',',
'\tsubmitIfHasClientSideErrors: true, ',
'\trowErrors: {',
'\t\t\t\tshowMessageBox: false,',
'\t\t\t\tmessageBoxTitle: \'Error\',',
'\t\t\t\tstyle: \'color: red; width: 6in; height: 2in;\'',
'\t\t},',
'\tfieldErrors: {',
'\t\ttype: \'block\', ',
'\t\tclassName: \'errorText\',',
'\t\tinputClassName: \'editError\',',
'\t\tedit: { ',
'\t\t\tcontainer: { className: \'editError\'}',
'\t\t},',
'\t\ticon: \'svgIcon=#alpha-icon-exclamationCircle:icon\',',
'\t\tglobal: {',
'\t\t\tcontId: \'{UXPRERENDEREDALIAS}.GLOBALERRORS\',',
'\t\t\thoverClassName: \'errorTextHighlight\',',
'\t\t\thoverInputClassName: \'errorInputHighlight\'',
'\t\t}',
'\t},',
'\t\tonRenderComplete: function(e) {',
'setTimeout(function(){',
'\tMPID = {UXPRERENDEREDALIAS}_DlgObj.argumentValue(\'TPOIID\');',
'\t{UXPRERENDEREDALIAS}_DlgObj.setValue(\'poiid\',MPID);',
'\t},700);',
'\t\t},',
'\t\tonOrientationChange: function(e) {',
'var pObj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();',
'if(pObj && pObj.resize && typeof pObj.resize == \'function\') pObj.resize();',
'\t\t},',
'\t\tonFirestoreAuthStateChanged: function(e) {',
'{UXPRERENDEREDALIAS}_DlgObj.onFirestoreLogin(e);',
'\t\t},',
'\t\t_onWindowResize: function(e) {',
'var arr = {UXPRERENDEREDALIAS}_DlgObj._listControls;',
'if(arr) {',
'\tvar obj;',
'\tfor(var i = 0; i < arr.length; i++) { ',
'\t\tobj = {UXPRERENDEREDALIAS}_DlgObj.getControl(arr[i]);',
'\t\tif(obj && obj.resize && typeof obj.resize == \'function\') obj.resize()',
'\t}',
'}',
'\t\t},',
'_onInitializeBegin: function(e) { /*systemOnInitializeBegin*/ ;',
'   },',
'\t});',
'{UXPRERENDEREDALIAS}_DlgObj._onOrientationChange =  function(e) { ;',
'{UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule();',
';  };',
'A5.__componentObj = {UXPRERENDEREDALIAS}_DlgObj;',
'A5.map._fn=\'https://maps.googleapis.com/maps/api/js?key=&libraries=geometry,places&callback=A5.map.init\';',
'{UXPRERENDEREDALIAS}_DlgObj.loadCSSFile(\'{phonegapurlprerender}css/CSSIcons/materialIcons/css/materialIcons.css?crc_4294909166\');',
'{UXPRERENDEREDALIAS}_DlgObj._tabObjects = [];',
'A5.loadJavascript(\'\\n\\n;\\nfunction onChange_SEARCH_fromuser_7ab651e0c4f54bada3edf06fc46dc913(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'SEARCH_FROMUSER\\\');};\\nfunction onChange_SEARCH_touser_266f0a3607fe4c51b959edb76176c5ae(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'SEARCH_TOUSER\\\');};\\nfunction onChange_SEARCH_PRIORITY_60c8e1ece80e410e906ccf77f33d8150(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'SEARCH_PRIORITY\\\');};\\nfunction onChange_SEARCH_done_a0dbf7ca03424978af350ff178e6e12a(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'SEARCH_DONE\\\');};\\n\\nfunction onChange_LSTMESSAGE_29f0e7e0959d4e768832493805409c19(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'LSTMESSAGE\\\');};\\nfunction onChange_date_7d3bda04d4da4fb897e3d7e75ce4da4d(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'DATE\\\');};\\nfunction onChange_From_b2ea807b6d4e4c479a6b864cca3aaa1d(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'FROM\\\');};\\nfunction onChange_To_02d00f27d4854f5098ba9edbd107fa76(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'TO\\\');};\\nfunction onChange_message_67fc519d5b35478aaa58ab1b0c5c2191(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'MESSAGE\\\');};\\nfunction onChange_PRIORITY_afbf9b04d8d9409fa95b6d2c3799453c(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'PRIORITY\\\');};\\nfunction onChange_duedate_44e40800504c44c996d50b4ddc8b7dd8(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'DUEDATE\\\');};\\nfunction onChange_done_3d2b539b19684d3da32298cc2e202c34(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'DONE\\\');};\\nfunction onChange_addtoroute_893c3d71e53749ba8028610aeeaf996a(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'ADDTOROUTE\\\');};\\nfunction onChange_poiid_c4b554e74f264b78b49885c236989a4b(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'POIID\\\'); var rowNum = 1; _dlgObj.ajaxCallback(\\\'\\\',rowNum,\\\'__system__2a7276a0c80b4b3da46c8d59d848ad0b\\\');};\\nfunction onChange_textbox1_203c6f95236d4b72867f5b253a4551bc(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'TEXTBOX1\\\');};\\nfunction onChange_LIST1_a74d49930a68459c9610eb8e679642fe(_dlgObj){if(_dlgObj.executeWatchEventForControl) _dlgObj.executeWatchEventForControl(\\\'LIST1\\\');};\\n\\n\\n;\\n\');',
'if(typeof {UXPRERENDEREDALIAS}_DlgObj !== \'undefined\' && typeof {UXPRERENDEREDALIAS}_DlgObj.fieldHelpers!== \'undefined\') if(!{UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'DUEDATE\']) {  {UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'DUEDATE\'] = new A5.EditDateTime({',
'\ttheme: \'Alpha-Magenta\',',
'\tdateTime: {',
'\t\tformat: \'<DefaultDateOnlyFormat>\',',
'\t\tdatePicker: {',
'\t\t\tdays: {UXPRERENDEREDALIAS}_DlgObj.datePickerDayNames,',
'\t\t\tmonths: {UXPRERENDEREDALIAS}_DlgObj.datePickerMonthNames,',
'\t\t\tstartDay: {UXPRERENDEREDALIAS}_DlgObj.datePickerFirstDayOfWeek-1,',
'\t\t\tcalendar: {',
'\t\t\t\tlockColumnWidth: false,',
'\t\t\t\tdaysOfWeek: {',
'\t\t\t\t\tshow: true',
'\t\t\t\t},',
'\t\t\t\tweeksOfYear: {',
'\t\t\t\t\tshow: false',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tnavigator: {',
'\t\t\t\theader: {',
'\t\t\t\t\ttodayButton: {',
'\t\t\t\t\t\tshow: true,',
'\t\t\t\t\t\thtml: {UXPRERENDEREDALIAS}_DlgObj.datePickerTodayButton,',
'\t\t\t\t\t\ttip: \'\'',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\tdisabledDates: {',
'\t\t\t\tlow: \'\',',
'\t\t\t\thigh: \'\',',
'\t\t\t\tdays: []',
'\t\t\t},',
'\t\t\twidth: \'100%\',',
'\t\t\theight: \'\'',
'\t\t},',
'\t\tswitchYear: 30,',
'\t\tcombinedContainer: {',
'\t\t\tstyle: \'display:block\'',
'\t\t}',
'\t},',
'\twindow: {',
'\t\tautoGenerateButtons: false,',
'\t\tbuttons: {',
'\t\t\titems: [',
'\t\t\t{',
'\t\t\t\thtml: \'OK\',',
'\t\t\t\taction: \'commit\'',
'\t\t\t},',
'\t\t\t{',
'\t\t\t\thtml: \'Cancel\',',
'\t\t\t\taction: \'close\'',
'\t\t\t}]',
'\t\t}',
'\t},',
'\tonSelect: function() {$e.execute(this,\'change\');} ,',
'\tmultiple: {',
'\t\tallow: false',
'\t},',
'\tselectionRequired: true',
'});}',
'{UXPRERENDEREDALIAS}_DlgObj.fieldHelpers[\'POIID\'] = new A5.EditButtonGroup({theme: \'Alpha-Magenta\'});',
'{UXPRERENDEREDALIAS}_DlgObj.lookups = {',
'};',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = (dialog.listDetailView.LSTMESSAGE.isDirty == false);',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'); if(obj) {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_BUTTON_DVNEWRECORD_LSTMESSAGE\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = (dialog.listDetailView.LSTMESSAGE.isDirty == false);',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.BUTTON_DVNEWRECORD_LSTMESSAGE\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.BUTTON_DVNEWRECORD_LSTMESSAGE\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_DVNEWRECORD_LSTMESSAGE\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_DVNEWRECORD_LSTMESSAGE\'); if(obj && typeof readOnly != \'undefined\') {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVNEWRECORD_LSTMESSAGE\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVNEWRECORD_LSTMESSAGE\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'BUTTON_DVNEWRECORD_LSTMESSAGE\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_TO\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = ((dialog.listDetailView.LSTMESSAGE.isDirty == true) && (dialog.listDetailView.LSTMESSAGE.mode != \'search\'));',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.TO\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.TO\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'To\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'To\'); if(obj) {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'To\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'To\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'To\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_MESSAGE\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = ((dialog.listDetailView.LSTMESSAGE.isDirty == true) && (dialog.listDetailView.LSTMESSAGE.mode != \'search\'));',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.MESSAGE\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.MESSAGE\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'message\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'message\'); if(obj) {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'message\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'message\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'message\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_PRIORITY\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = ((dialog.listDetailView.LSTMESSAGE.isDirty == true) && (dialog.listDetailView.LSTMESSAGE.mode != \'search\'));',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.PRIORITY\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.PRIORITY\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'PRIORITY\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'PRIORITY\'); if(obj && typeof readOnly != \'undefined\') {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'PRIORITY\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'PRIORITY\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'PRIORITY\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.dialogWatches[\'ENABLE_BUTTON_DVSAVE_LSTMESSAGE\'] = {',
'\t\twatch: [],',
'\t\tvariables: [],',
'\t\tonChange: function(data) {',
'\tvar dialog = {};',
'\tvar summary = {};',
'\t{UXPRERENDEREDALIAS}_DlgObj._getDialogVariables(dialog,summary,data);',
'\t;',
'\t;',
'\tvar enable = ((dialog.listDetailView.LSTMESSAGE.isDirty == true) && (dialog.listDetailView.LSTMESSAGE.mode != \'search\'));',
'\tvar eles = $cetp($n(\'V.R\' + data.rowNumber + \'.BUTTON_DVSAVE_LSTMESSAGE\'),$(\'{UXPRERENDEREDALIAS}.R\'+data.rowNumber));',
'\tif(typeof eles.length == \'undefined\' || eles.length == 0) eles = [$(\'{UXPRERENDEREDALIAS}.\'+\'V.R\' + data.rowNumber + \'.BUTTON_DVSAVE_LSTMESSAGE\')];',
'\tvar pObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_DVSAVE_LSTMESSAGE\'); if(pObj) { if(typeof pObj.setDisabled != \'undefined\') {  pObj.setDisabled(!enable,eles); return true;  } }',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'BUTTON_DVSAVE_LSTMESSAGE\'); if(obj) {obj.readOnly = readOnly}',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVSAVE_LSTMESSAGE\'] != \'undefined\') {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVSAVE_LSTMESSAGE\'].setDisabled(!enable,eles);',
'\t} else {',
'\t\tfor(var i=0; i<eles.length;i++) eles[i].disabled = !enable;',
'\t}',
'\t;;',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWatchEvent\',{type: \'enable\', control: \'BUTTON_DVSAVE_LSTMESSAGE\', flag: enable});}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({',
'\t"__dtfmt": "dd/MM/yyyy",',
'\t"__tfmt": "<cultureTimeFormat>",',
'\t"__dialogGuid": "f062a9cd-9bcd-433f-a51d-57f378a7cc82",',
'\t"argumentsBoundToCotrols": "",',
'\t"__sgr": ""',
'});//ssi3;',
'{UXPRERENDEREDALIAS}_DlgObj._cascadingControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._cascadingControlsChildren = [];',
'A5.msgBox.theme = \'Alpha-Magenta\';',
'A5.msgBox.buttonWidth = \'1in\';',
'{UXPRERENDEREDALIAS}_DlgObj._defaultWindowTitleDirection = \'ltr\';',
'{UXPRERENDEREDALIAS}_DlgObj._controlContainers = {}',
'{UXPRERENDEREDALIAS}_DlgObj._panelCardControls = {',
'SEARCH_FROMUSER:\'PANELCARD_1\',',
'SEARCH_TOUSER:\'PANELCARD_1\',',
'SEARCH_PRIORITY:\'PANELCARD_1\',',
'SEARCH_DONE:\'PANELCARD_1\',',
'LSTMESSAGE:\'PANELCARD_1\',',
'DATE:\'PANELCARD_2\',',
'FROM:\'PANELCARD_2\',',
'TO:\'PANELCARD_2\',',
'MESSAGE:\'PANELCARD_2\',',
'PRIORITY:\'PANELCARD_2\',',
'DUEDATE:\'PANELCARD_2\',',
'DONE:\'PANELCARD_2\',',
'ADDTOROUTE:\'PANELCARD_2\',',
'POIID:\'PANELCARD_2\',',
'TEXTBOX1:\'PANELCARD_2\',',
'LIST1:\'PANELCARD_3\'',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._controlsOnPanel = {',
'\t\'PANELCARD_1\' : {controls: [\'SEARCH_FROMUSER\',\'SEARCH_TOUSER\',\'SEARCH_PRIORITY\',\'SEARCH_DONE\',\'LSTMESSAGE\']},',
'\t\'PANELCARD_2\' : {controls: [\'DATE\',\'FROM\',\'TO\',\'MESSAGE\',\'PRIORITY\',\'DUEDATE\',\'DONE\',\'ADDTOROUTE\',\'POIID\',\'TEXTBOX1\']},',
'\t\'PANELCARD_3\' : {controls: [\'LIST1\']}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._buttons = {};',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCH_LSTMESSAGE\'] = new A5.Button({',
'\tlayout: \'text\',',
'\tstyle: \'width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \',',
'\ttip: \'Search for matching records.\',',
'\thtml: \'Search\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'] = new A5.Button({',
'\tlayout: \'text\',',
'\tstyle: \'width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \',',
'\ttip: \'Remove the List filter.\',',
'\thtml: \'Clear Filter\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVNEWRECORD_LSTMESSAGE\'] = new A5.Button({',
'\tlayout: \'icon text\',',
'\tstyle: \'width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \',',
'\ttip: \'Enter a new record\',',
'\thtml: \'New\',',
'\ticon: \'svgIcon=#alpha-icon-docAdd:icon iconButton\',',
'\tdisabledIcon: \'svgIcon=#alpha-icon-docAdd:icon iconButton\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVRESET_LSTMESSAGE\'] = new A5.Button({',
'\tlayout: \'icon text\',',
'\tstyle: \'box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\',',
'\ttip: \'Undo edits to the List Detail View\',',
'\thtml: \'Back\',',
'\ticon: \'svgIcon=#alpha-icon-undo:icon iconButton\',',
'\tdisabledIcon: \'svgIcon=#alpha-icon-undo:icon iconDisabled iconButton\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta:left\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVSAVE_LSTMESSAGE\'] = new A5.Button({',
'\tlayout: \'icon text\',',
'\tstyle: \'width: 100%; box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box; \',',
'\ttip: \'Save edits\',',
'\thtml: \'Send\',',
'\ticon: \'svgIcon=#alpha-icon-save:icon iconButton\',',
'\tdisabledIcon: \'svgIcon=#alpha-icon-save:icon iconDisabled iconButton\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_6\'] = new A5.Button({',
'\tlayout: \'text\',',
'\tstyle: \'box-sizing: border-box; -moz-box-sizing: border-box; -ms-box-sizing: border-box; -webkit-box-sizing: border-box;\',',
'\thtml: \'Back\',',
'\tonClick: function() { ',
'},',
'\ttheme: \'Alpha-Magenta:left\'',
'});',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCH_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCH_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVNEWRECORD_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVNEWRECORD_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVRESET_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVRESET_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVSAVE_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVSAVE_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_6\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_6\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCH_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCH_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVNEWRECORD_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVNEWRECORD_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVRESET_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVRESET_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_DVSAVE_LSTMESSAGE\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVSAVE_LSTMESSAGE\');',
'{UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_6\'].bind(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_6\');',
'{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LSTMESSAGE\'] = {',
'\t__pkisguid: false,',
'\t_switchInfo: {',
'},',
'\t_setupAlphabetSearch: function() { },',
'\tgetMapObject: function() { \treturn this.layouts[this.layout].map;',
'}',
',',
'\t__applyIncrementRefreshUpdates: function(listId) { \tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\tvar lObj = _dlgObj.getControl(listId);',
'\tvar countU = 0;',
'\tvar countA = 0;',
'\tvar newData = lObj.__incrementalRefreshData;',
'\tvar getRowState = function (listObj) {',
'\t\tvar d = listObj._data;',
'\t\tvar dObj = {};',
'\t\tfor(var i = 0; i < d.length; i++) {',
'\t\t\tdObj[d[i].__primaryKey] = {};',
'\t\t\tif(typeof d[i]._isDirty == \'undefined\') flag = false',
'\t\t\telse flag = d[i]._isDirty;',
'\t\t\tdObj[d[i].__primaryKey].dirty = flag;',
'\t\t\t//dObj[d[i].__primaryKey].__rowNumber= i;',
'\t\t\t//*renderIndex is not unique after a client side filter has been done',
'\t\t\t//dObj[d[i].__primaryKey].__rowNumber= d[i][\'*renderIndex\'];',
'\t\t\tdObj[d[i].__primaryKey].__rowNumber= d[i][\'*value\'];',
'\t\t}',
'\t\treturn dObj;',
'\t}',
'\tvar dObj = getRowState(lObj);',
'\tvar _obj = {};',
'\tvar __row;',
'\tvar flagDirty;',
'\tfunction pkExists(d,pk) { ',
'\t\tfor(var i = 0; i < d.length; i++) { ',
'\t\tif(d[i].__primaryKey == pk) return true;',
'\t}',
'\t\treturn false;',
'\t}',
'\tfor(var i = 0; i < newData.length; i++) {',
'\t\t_obj = dObj[newData[i].__primaryKey];',
'\t\tif(typeof _obj != \'undefined\') {',
'\t\t\t__row = _obj[\'__rowNumber\'];',
'\t\t\tif(typeof __row != \'undefined\') {',
'\t\t\t\tflagDirty = _obj[\'dirty\'];',
'\t\t\t\tif(!flagDirty) {',
'\t\t\t\t\t//clear out all child arrays since the new data has the child arrays in it.',
'\t\t\t\t\tvar currentData = lObj.getData(__row);',
'\t\t\t\t\tfor(var n in currentData) { ',
'\t\t\t\t\t\tif(n.indexOf(\'__LIST__\') ==  0) { ',
'\t\t\t\t\t\t\tcurrentData[n] = [];',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tlObj.updateRow(__row,newData[i]);',
'\t\t\t\t\tcountU++;',
'\t\t\t\t} else { ',
'\t\t\t\t\t//row is dirty',
'\t\t\t\t\t//lObj.appendRows([ newData[i]]);',
'\t\t\t\t\t//countA++;',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//__row is undefined',
'\t\t\t\t//alert(\'__row is undefined\');',
'\t\t\t\t//lObj.appendRows([ newData[i]]);',
'\t\t\t\t//countA++;',
'\t\t\t}',
'\t\t} else {',
'\t\t\t//check to see if the row is already in the list',
'\t\t\tif(!pkExists(lObj._data,newData[i].__primaryKey)) {',
'\t\t\t\tlObj.appendRows([ newData[i]]);',
'\t\t\t\tcountA++;',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//delete newData; //user might find this helpful. so keep it',
'\tvar name = this.listVariableName;',
'\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t//put in timeout to give list time to refresh before the event fires',
'\tif(lObj._hasDetailView) { ',
'\t\tsetTimeout(function() { ',
'\t\t\t_dlgObj._list_executeEvent(name,\'detailView.afterRefreshListIncremental\',{ rowsUpdated: countU, rowsInserted: countA, rowsDeleted: 0, listId: name});',
'\t\t},0);',
'\t} else { ',
'\t\tsetTimeout(function() { ',
'\t\t\t_dlgObj._list_executeEvent(name,\'afterRefreshListIncremental\',{ rowsUpdated: countU, rowsInserted: countA, rowsDeleted: 0, listId: name});',
'\t\t},100);',
'\t}',
'}',
',',
'\t_flagAutoFetchMore: false,',
'\tfirestoreLogin: function(uid,pw) { alert(\'List is not configured to use Firestore as the data source\') } ,',
'\tfirestoreLogout: function() { alert(\'List is not configured to use Firestore as the data source\') } ,',
'\t_persistListLayout: false,',
'\t_loadPersistedLayout: false,',
'\tsaveLayoutSettings: function() {',
'\t\tvar s = localStorage.listSettings;',
'\t\tif(typeof s == \'undefined\' || s == null) s = {};',
'\t\tif(typeof s == \'string\') {',
'\t\t\ttry{s = JSON.parse(s);}catch(err) {return false;}',
'\t\t}',
'\t\tvar sl = s[this._listGUID];',
'\t\tif(typeof sl == \'undefined\') sl = {};',
'\t\tsl.listVariableName = this.listVariableName;',
'\t\tsl.layouts = this.layouts;',
'\t\tsl.layout = this.layout;',
'\t\ts[this._listGUID] = sl ;',
'\t\tvar str = JSON.stringify(s,\'\',\'\\t\')',
'\t\tlocalStorage.listSettings = str;',
'\t}',
'\t,',
'\tonLayoutUpdate: function(type,args,layoutName) {if(this.saveLayoutSettings) this.saveLayoutSettings();},',
'\trestoreLayoutSettings: function(dlgObj,mode) { ',
'\t\tvar str = localStorage.listSettings;',
'\t\tif(typeof str == \'undefined\' || str == null) {return false;}',
'\t\ttry{var s = JSON.parse(str);}catch(err) {return false;};',
'\t\tvar sl = s[this._listGUID];',
'\t\tif(typeof sl == \'undefined\') {return false;}',
'\t\tif(mode == \'delete\') {',
'\t\t\tdelete s[this._listGUID];',
'\t\t\tvar str = JSON.stringify(s,\'\',\'\\t\')',
'\t\t\tlocalStorage.listSettings = str;',
'\t\t\treturn;',
'\t\t}',
'\t\tif(mode == \'get\') {',
'\t\t\treturn JSON.stringify(sl);',
'\t\t}',
'\t\tthis.layouts = sl.layouts;',
'\t\tthis.layout = sl.layout;',
'\t\tvar listSelector = \'listSelector_\' + sl.listVariableName ;',
'\t\tvar that = this;',
'\t\tsetTimeout(function() {',
'\t\t\tdlgObj.setValue(listSelector,that.layout);',
'\t\t\tdelete that;',
'\t\t},0);',
'\t\tthis.refresh();',
'\t\tthis._flagRestoringLayoutSettings = true;',
'\t}',
',',
'\t_childListsAjax: [],',
'\t_hasDependentLists: false,',
'\t_dataSourceType: \'SQL\',',
'\t_listFields: [',
'{',
'\tname: \'id\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'id\\\');\'',
'},',
'{',
'\tname: \'fromuser\',',
'\tdefaultValue: \'return {UXPRERENDEREDALIAS}_DlgObj.argumentValue(\\\'myUserName\\\');\'',
'},',
'{',
'\tname: \'touser\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'touser\\\');\'',
'},',
'{',
'\tname: \'message\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'message\\\');\'',
'},',
'{',
'\tname: \'poiid\',',
'\tdefaultValue: \'MPID = {UXPRERENDEREDALIAS}_DlgObj.argumentValue(\\\'TPOIID\\\');\\r\\nreturn MPID ;\'',
'},',
'{',
'\tname: \'duedate\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'duedate\\\');\'',
'},',
'{',
'\tname: \'addtoroute\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'addtoroute\\\');\'',
'},',
'{',
'\tname: \'done\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'done\\\');\'',
'},',
'{',
'\tname: \'PRIORITY\',',
'\tdefaultValue: \'return \\\'Low\\\' ;\'',
'},',
'{',
'\tname: \'date\',',
'\tdefaultValue: \'var currentdate = new Date();\\r\\n    var day = currentdate.getDate();\\r\\n    var month = currentdate.getMonth() + 1;\\r\\n    var year = currentdate.getFullYear();\\r\\n    var hours = currentdate.getHours();\\r\\n    var minutes = currentdate.getMinutes();\\r\\n    if (day < 10) day = \\\'0\\\' + day;\\r\\n    if (month < 10) month = \\\'0\\\' + month;\\r\\n    if (hours < 10) hours = \\\'0\\\' + hours;\\r\\n    if (minutes < 10) minutes = \\\'0\\\' + minutes;\\r\\n    var formattedDateTime = day + \\\'/\\\' + month + \\\'/\\\' + year + \\\' \\\' + hours + \\\':\\\' + minutes;\\r\\n    return formattedDateTime;\'',
'}],',
'\t_delayRenderTillRefresh: false,',
'\t_searchPartHas: true,',
'\t_searchPart: {',
'\t\tfieldMap: [',
'{',
'\tfield: \'fromuser\',',
'\tcontrol: \'SEARCH_fromuser\'',
'},',
'{',
'\tfield: \'touser\',',
'\tcontrol: \'SEARCH_touser\'',
'},',
'{',
'\tfield: \'done\',',
'\tcontrol: \'SEARCH_done\'',
'},',
'{',
'\tfield: \'PRIORITY\',',
'\tcontrol: \'SEARCH_PRIORITY\'',
'}]',
'\t},',
'\t_searchPartStyle: \'individualcontrols\',',
'\t_searchFieldOptions: {',
'"ID" : {option: 2,qbf: true,type: \'n\',searchField: \'id\'},',
'"FROMUSER" : {option: 2,qbf: true,type: \'c\',searchField: \'fromuser\'},',
'"TOUSER" : {option: 2,qbf: true,type: \'c\',searchField: \'touser\'},',
'"[MESSAGE]" : {option: 2,qbf: true,type: \'c\',searchField: \'message\'},',
'"POIID" : {option: 2,qbf: true,type: \'n\',searchField: \'poiid\'},',
'"DUEDATE" : {option: 2,qbf: true,type: \'c\',searchField: \'duedate\'},',
'"ADDTOROUTE" : {option: 2,qbf: true,type: \'n\',searchField: \'addtoroute\'},',
'"DONE" : {option: 2,qbf: true,type: \'n\',searchField: \'done\'},',
'"PRIORITY" : {option: 2,qbf: true,type: \'c\',searchField: \'PRIORITY\'},',
'"[DATE]" : {option: 2,qbf: true,type: \'c\',searchField: \'date\'}',
'},',
'\t_showSearchDebugInfo: false,',
'\t_mediaFields: [],',
'\t_mediaTypes: {',
'},',
'\t_mediaFieldReadOnly: [],',
'\t_ignoreMediaFieldsInWWWSubFolder: false,',
'\t_mediaFieldFolderInWWW: \'\',',
'\t_phoneGap: {',
'\t\tmediaFiles: {',
'\t\t\tfireMediaFileCleanup: false,',
'\t\t\tprotectedRead: false,',
'\t\t\ttemplate: \'\',',
'\t\t\ttarget: \'server\',',
'\t\t\ttargetFilenameFunction: \'return \\\'<DeviceId>_\\\' +e.object.listFieldName + \\\'_\\\' + A5.ts() + \\\'_\\\' +e.name\',',
'\t\t\tshowProgress: false,',
'\t\t\tdownload: {',
'\t\t\t\tautodownloadFilesOnPullSynch: false,',
'\t\t\t\tdeleteOrphansAfterSync: false,',
'\t\t\t\ttargetFolder: \'_AAFiles\',',
'\t\t\t\tshowProgress: false,',
'\t\t\t\ttargetFileSystem: \'persistent\'',
'\t\t\t},',
'\t\t\tonErrorFunction: function(e) { }',
'\t\t}',
'\t},',
'\t_incrementalRefreshAfterLoad: function() { },',
'\t_dvmode: \'enter\',',
'\t_hasDetailView: true,',
'\t_optimizeSync: false,',
'\tdeselectAll: function() { ',
'\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t_dlgObj.setValue(this.listVariableName,\'\',true);',
'\tthis._deselectAll();',
'\tif(this.nullOutDetailViewRecord) {',
'\t\tthis.nullOutDetailViewRecord();',
'\t\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\t\tvar lname = this.childLists[i];',
'\t\t\tvar lobjC = {UXPRERENDEREDALIAS}_DlgObj.getControl(lname);',
'\t\t\tlobjC.nullOutDetailViewRecord();',
'\t\t}',
'\t\tif(this._noRecordInListIsSelectedSettingForDetailView ==  \'disabledetailview\') {',
'\t\t\tthis.disableDetailView()',
'\t\t\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\t\t\tvar lname = this.childLists[i];',
'\t\t\t\tvar lobjC = {UXPRERENDEREDALIAS}_DlgObj.getControl(lname);',
'\t\t\t\tlobjC.disableDetailView();',
'\t\t\t}',
'\t\t}',
'\t}',
'}',
',',
'\tshowHideColumn: function(columnNumber,flagShow,layoutName,flagSetShowState) { \tif(typeof flagSetShowState == \'undefined\') flagSetShowState  = false; //set when this function called from listColumnSelector()',
'\tif(typeof layoutName == \'undefined\') layoutName = this.layout;',
'\tif(this.layouts[layoutName].columns[columnNumber].show != flagShow) {',
'\t\tthis.layouts[layoutName].columns[columnNumber].show = flagShow;',
'\t\tif(flagSetShowState) this.layouts[layoutName].columns[columnNumber]._showState = flagShow;',
'\t\tthis.refresh();',
'\t}',
'}',
',',
'\tshowAllColumns: function() { ',
'\tvar l = this.layouts',
'\tvar c = \'\';',
'\tvar flagRefresh = false;',
'\tfor(var n in l) {',
'\t\tc = l[n].columns;',
'\t\tif(typeof c != \'undefined\') {',
'\t\t\tfor(var i = 0; i < c.length; i++) {',
'\t\t\t\tif(!c[i].initialStateHidden) {',
'\t\t\t\t\tvar flag = true',
'\t\t\t\t\tif(typeof c[i]._showState != \'undefined\') {',
'\t\t\t\t\t\tif(!c[i]._showState) flag = false;',
'\t\t\t\t\t}',
'\t\t\t\t\tif(flag && !c[i].show) {',
'\t\t\t\t\t\tc[i].show = true;',
'\t\t\t\t\t\tflagRefresh = true;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(flagRefresh) {',
'\t\tthis.refresh();',
'\t}',
'}',
',',
'\t_hideColumns: function() { ',
'}',
',',
'\t_noRecordInListIsSelectedSettingForDetailView: \'none\',',
'\t_captureLocation: false,',
'\t_detailViewHas: true,',
'\t_submitLocationInfo: false,',
'\t_detailView: {',
'\t\tfieldMap: [',
'{',
'\tfield: \'fromuser\',',
'\tcontrol: \'From\'',
'},',
'{',
'\tfield: \'touser\',',
'\tcontrol: \'To\'',
'},',
'{',
'\tfield: \'message\',',
'\tcontrol: \'message\'',
'},',
'{',
'\tfield: \'poiid\',',
'\tcontrol: \'poiid\'',
'},',
'{',
'\tfield: \'duedate\',',
'\tcontrol: \'duedate\'',
'},',
'{',
'\tfield: \'addtoroute\',',
'\tcontrol: \'addtoroute\'',
'},',
'{',
'\tfield: \'done\',',
'\tcontrol: \'done\'',
'},',
'{',
'\tfield: \'PRIORITY\',',
'\tcontrol: \'PRIORITY\'',
'},',
'{',
'\tfield: \'date\',',
'\tcontrol: \'date\'',
'}],',
'\t\tmethod: \'fieldMap\',',
'\t\tjsonformstoWatch: \'\'',
'\t},',
'\t_detailViewGlobalErrorStyle: \'font-family: Arial; font-size: 10pt; color: red; border: solid 1px red; width: 100%;\',',
'\t_autoCommitDetailView: true,',
'\t_synchBatchSize: 0,',
'\t_resetMediaFileUploadErrorsFlag: function(data) {',
'var r = A5.u.object.each(data,function(name,value,path,result){',
'\tif(name == \'_flagMediaFileUploadError\') {',
'\t\tresult.push({value: false, path: path})',
'\t}',
'});',
'for(var i = 0; i < r.length; i++) {',
'\tA5.u.object.set(data,r[i].path,r[i].value);',
'}',
'},',
'\ttheme: \'Alpha-Magenta\',',
'\tscroll: {',
'\t\taxis: \'both\',',
'\t\tindicator: {',
'\t\t\tshow: true,',
'\t\t\th: {',
'\t\t\t\tshow: true,',
'\t\t\t\tlocation: \'top\',',
'\t\t\t\toffset: \'0px\',',
'\t\t\t\tleft: \'0px\',',
'\t\t\t\tright: \'0px\'',
'\t\t\t},',
'\t\t\tv: {',
'\t\t\t\tshow: true,',
'\t\t\t\tlocation: \'right\',',
'\t\t\t\toffset: \'0px\',',
'\t\t\t\ttop: \'0px\',',
'\t\t\t\tbottom: \'0px\'',
'\t\t\t}',
'\t\t},',
'\t\tmomentum: {',
'\t\t\tallow: true,',
'\t\t\tfriction: 4,',
'\t\t\tduration: 1000',
'\t\t},',
'\t\tpull: {',
'\t\t\ty: \'auto\',',
'\t\t\tx: \'auto\'',
'\t\t}',
'\t},',
'\tlayout: \'Default\',',
'\tcalculateValue: function(data) {  {var _val = \'\' +(function(data) {if(typeof data.__primaryKey != \'undefined\') {return data.__primaryKey;} else { ',
'try{var _pkArr = [];',
'_pkArr.push(\'\' + data[\'id\']);',
'\t\t\tvar pk = _pkArr.join(\'|||\');',
'\t\t\treturn pk;',
'\t\t} catch(err) { return undefined }',
'}})(data); if((_val == \'\' ||  _val == \'undefined\'  )&& typeof data[\'*rowGUID\'] != \'undefined\') _val = \'_temporaryValue_\' + data[\'*rowGUID\']; return _val;}},',
'\tdirtyControlClassName: \'\',',
'\tlistVariableName: \'LSTMESSAGE\',',
'\tlistVariableNameTrueCase: \'LSTMESSAGE\',',
'\t_hostComponentId: \'{UXPRERENDEREDALIAS}\',',
'\t_includeCRC: true,',
'\tparentList: \'\',',
'\tallParentLists: [],',
'\t_inplaceEditing: {',
'\t\tallow: false',
'\t},',
'\t__hasEmbeddedDetailView: false,',
'\tonBeforeListClear: function() {},',
'\t__flagPersist: false,',
'\t__flagIncrementalRefreshAfterLoad: false,',
'\tonBeforePopulate: function(data) {this.__onPopulateHasFired = false;',
'},',
'\tonPopulate: function(data) {',
'\tvar ls = {UXPRERENDEREDALIAS}_DlgObj._localStorageSettings;',
'\tif(typeof ls == \'object\') {',
'\t\tvar lsr = ls.restore;',
'\t\tif(typeof lsr != \'undefined\') {',
'\t\t\tif(!lsr.data) {',
'\t\t\t\t//since ux does not restore from storage (which would have fired _fetchMediaFiles(), we fire it here',
'\t\t\t\tvar lObj = this;',
'\t\t\t\t//sr 2-28-19 turned off because was casing the _fetchMediaFiles to get executed twice.',
'\t\t\t\t//should be no need to do this because the UX issues a _fetchMediaFiles call when the UX is rendered and when a List is refreshed.',
'\t\t\t\t//{UXPRERENDEREDALIAS}_DlgObj._delayTillPhoneGapReady(lObj._fetchMediaFiles,lObj);',
'\t\t\t}',
'\t\t}',
'\t}',
'if(!this._isInit) {if (typeof window[\'cordova\'] == \'undefined\') {',
'\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: \'fullRefresh\' });',
'}',
';this._executeEvent(\'onListReady\',{});};},',
'\tonBeforeUpdateRow: function(index,data){;},',
'\tonUpdateRow: function(index,data){;},',
'\tonBeforeAddRows: function(data,info){;},',
'\tonAddRows: function(data,info){;},',
'\tonBeforeRemoveRows: function(rows){;},',
'\tonRemoveRows: function(rows){;},',
'\tonResize: function(){var l = this.layout;',
'if(this.layouts[l].type == \'column\') {',
'\tvar flagRefresh = false; //prevent multiple refreshes from being done',
'\tif(this.layouts[l]._hasRCW) {',
'\t\tvar w = $(this.contId).offsetWidth;',
'\t\tif(typeof this._w == \'undefined\') {',
'\t\t\tflagRefresh = true;',
'\t\t\tthis._w = w;',
'\t\t} else {',
'\t\t\tif(this._w != w) flagRefresh = true;',
'\t\t\tthis._w = w;',
'\t\t}',
'\t\tvar _c = this.layouts[l].columns;',
'\t\tfor(var i = 0; i < _c.length; i++) {',
'\t\t\tif(_c[i].rcw) {',
'\t\t\t\tif(_c[i].rcw != \'\' && Number(_c[i].rcw) > 0) {',
'\t\t\t\t\tif(typeof _c[i]._show == \'undefined\') _c[i]._show = _c[i].show;',
'\t\t\t\t\tif(_c[i]._show == _c[i].show) {',
'\t\t\t\t\t\tif(Number(_c[i].rcw) >= w) {',
'\t\t\t\t\t\t\t_c[i].show = false;',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t_c[i].show = true;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\t_c[i]._show = _c[i].show;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tvar that = this;',
'\t\tsetTimeout(function() {',
'\t\t\tif(flagRefresh) that.refresh();',
'\t\t\tconsole.log(\'refresh\');',
'\t\t},0);',
'\t}',
'}',
';},',
'\tsynchronizeImmediately: true,',
'\tpushServerEditsToClient: true,',
'\tcustomization: {',
'\t\tdv: {',
'\t\t\tclientSideErrorWarning: \'Cannot save because there are validation errors.\',',
'\t\t\tdirtyDetailViewRecord: {',
'\t\t\t\ttitle: \'Warning\',',
'\t\t\t\ticon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\t\t\t\tmessage: \'You must first save or undo the changes you have made to the List\\\'s Detail View.\'',
'\t\t\t},',
'\t\t\tconfirmFormResetWarning: {',
'\t\t\t\ttitle: \'Warning\',',
'\t\t\t\ticon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\t\t\t\tmessage: \'Are you sure you want to undo changes made to the List\\\'s Detail View?\'',
'\t\t\t},',
'\t\t\tconfirmRowResetWarning: {',
'\t\t\t\ttitle: \'Warning\',',
'\t\t\t\ticon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\t\t\t\tmessage: \'Are you sure you want to undo changes made to this record?\'',
'\t\t\t},',
'\t\t\tconfirmDeleteWarning: {',
'\t\t\t\ttitle: \'Warning\',',
'\t\t\t\ticon: \'svgIcon=#alpha-icon-questionCircle:icon\',',
'\t\t\t\tmessage: \'Are you sure you want to delete this record?\'',
'\t\t\t},',
'\t\t\twriteConflict: {',
'\t\t\t\tuseMineMessage: \'Use mine (\\\'{myvalue}\\\')\',',
'\t\t\t\tuseTheirsMessage: \'Use theirs (\\\'{theirvalue}\\\')\',',
'\t\t\t\tuseMineAll: \'Use mine for all fields\',',
'\t\t\t\tuseTheirsAll: \'Use theirs for all fields\'',
'\t\t\t},',
'\t\t\tdatabaseError: {',
'\t\t\t\tupdate: \'Record was not updated.|More...|Less\',',
'\t\t\t\tinsert: \'Record was not inserted.|More...|Less\',',
'\t\t\t\tdelete: \'Record was not deleted.|More...|Less\'',
'\t\t\t},',
'\t\t\tuseCustomClasses: false,',
'\t\t\tcustomClasses: \'\',',
'\t\t\tsetClassonEditedRows: true,',
'\t\t\tcss: {',
'\t\t\t\tdirtyRecord: \'\',',
'\t\t\t\tnewRecord: \'\',',
'\t\t\t\tserverSideError: \'\',',
'\t\t\t\tdeletedRecord: \'\',',
'\t\t\t\tdirtyRecordRow: \'\',',
'\t\t\t\tnewRecordRow: \'\',',
'\t\t\t\tserverSideErrorRow: \'\',',
'\t\t\t\tdeletedRecordRow: \'\',',
'\t\t\t\thasUnSyncedMediaFiles: \'\'',
'\t\t\t}',
'\t\t}',
'\t},',
'\tonItemDraw: function(ele,data,index) {',
' var _dirtyRowClassName = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRow\';',
' var _dirtyRowClassNameInherited = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowInherited\';',
' var _dirtyRowStyle = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowStyle\';',
' var _hasUnsyncedMediaFilesClassName = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_hasUnsyncedMediaFiles\';',
' var _errorRowClassName = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_hasError\';',
' var _errorRowClassNameInherited = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_hasErrorInherited _{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowInherited\';',
' var _errorRowClassNameInherited_1 = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_hasErrorInherited\';',
' var _errorRowClassNameInherited_2 = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_dirtyRowInherited\';',
' var _errorRowStyle = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_hasErrorStyle\';',
' var _newRowClassName = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_newRow\';',
' var _newRowStyle = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_newRowStyle\';',
' var _deletedRowClassName = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRow\';',
' var _deletedRowStyle = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRowStyle\';',
' var _deletedRowClassNameInherited = \'_{UXPRERENDEREDALIAS}_LSTMESSAGE_deletedRowInherited\';',
' var __d = this._rData[index];',
' $rcn(ele,_dirtyRowClassName);',
' $rcn(ele,_dirtyRowClassNameInherited);',
' $rcn(ele,_dirtyRowStyle);',
' $rcn(ele,_errorRowClassName);',
' $rcn(ele,_errorRowClassNameInherited);',
' $rcn(ele,_errorRowClassNameInherited_1);',
' $rcn(ele,_errorRowClassNameInherited_2);',
' $rcn(ele,_errorRowStyle);',
' $rcn(ele,_newRowClassName);',
' $rcn(ele,_newRowStyle);',
' $rcn(ele,_deletedRowClassName);',
' $rcn(ele,_deletedRowStyle);',
' $rcn(ele,_hasUnsyncedMediaFilesClassName);',
' if(data._isDirty && typeof data._isDeleted != \'undefined\' && data._isDeleted) {',
'  $acn(ele,_deletedRowClassName);',
'  $acn(ele,_deletedRowStyle);',
'  __d.__displayStyle = \'deletedRow\';',
' } else if ( (data._isDirty && typeof data._oldData != \'undefined\' && !data._isNewRow) ) {',
'  $acn(ele,_dirtyRowClassName);',
'  $acn(ele,_dirtyRowStyle);',
'  __d.__displayStyle = \'dirtyRow\';',
' }',
' if(data._isDirty && typeof data._oldData == \'undefined\' && ! (data._isNewRow || data._isDeleted) ) {',
'  $acn(ele,_dirtyRowClassNameInherited);',
'  $acn(ele,_dirtyRowStyle);',
'  __d.__displayStyle = \'dirtyRowInherited\';',
' }',
' if(data._isDeleted) {',
'  $acn(ele,_deletedRowClassName);',
'  $acn(ele,_deletedRowStyle);',
'  __d.__displayStyle = \'deletedRow\';',
' }',
' if(data._isNewRow) {',
'  $acn(ele,_newRowClassName);',
'  $acn(ele,_newRowStyle);',
'  __d.__displayStyle = \'newRow\';',
' }',
' var flagHasGlobalErrors = false;',
' if(typeof data._globalErrors != \'undefined\') {',
'  if( data._globalErrors != \'\')  flagHasGlobalErrors = true;',
' }',
' var flagHasWriteConflictErrors = false;',
' if(typeof data._hasWriteConflictErrors) flagHasWriteConflictErrors = data._hasWriteConflictErrors',
' if(data._hasServerSideError || flagHasGlobalErrors || flagHasWriteConflictErrors) {',
'  $acn(ele,_errorRowClassName);',
'  $acn(ele,_errorRowStyle);',
'  __d.__displayStyle = \'errorRow\';',
' } else {',
'  if(data._flagServerSideErrorInChild || data._flagWriteConflictErrorInChild || data._flagGlobalErrorInChild ){',
'    if(!data._isNewRow) {',
'     $acn(ele,_errorRowClassNameInherited);',
'     __d.__displayStyle = \'errorRowInherited\';',
'   } else {',
'    __d.__displayStyle = \'newRow errorRowInherited\';',
'    $acn(ele, _errorRowClassNameInherited_1);',
'   }',
'  }',
' }',
'  if (data._hasUnsyncedMediaFiles && data._isDirty  ) {',
'  $acn(ele,_hasUnsyncedMediaFilesClassName);',
' }},',
'\tchildLists: [],',
'\tchildListEndpoints: [\'LSTMESSAGE\'],',
'\t_populateAllChildLists: function() { },',
'\tonSelect: function() { this.populateUXControls();',
'this._selectedRow = this.selection[0];',
'{UXPRERENDEREDALIAS}_DlgObj._listRowSelect(\'LSTMESSAGE\',this);',
' this._selectedRow = this.selection[0];if(typeof this._selectedRow != \'undefined\') { var that = this; setTimeout(function() { if(typeof {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL != \'undefined\') { ',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL[\'LSTMESSAGE\'] != \'undefined\') {',
'\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL[\'LSTMESSAGE\'];',
'\t\tvar lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'\t\tvar r = lObj.selection[0];',
'\t\tvar _d = lObj._data[r];',
'\t\tvar linkValue = _d[obj.listPrimaryKey];',
'\t\tvar id = obj.lwlName;',
'\t\tvar linkField = obj.listPrimaryKey',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.refreshLinkedSpreadsheet(id,linkValue,linkField)',
'\t}',
'}',
'},50);};',
';},',
'\tonBeforeSelect: function() {',
' var c = this.childLists;',
' var lObj = \'\';',
' if(typeof c != \'undefined\') {',
'  for(var i = 0; i < c.length; i++) {',
'   lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(c[i]);',
'   if(lObj) {',
'    var flag = lObj.onBeforeSelect();',
'    if(typeof flag != \'undefined\') {',
'     if(!flag) return false;',
'    }',
'   }',
'  }',
' }',
' if(this._dvmode == \'search\') return true;',
' if(!this._autoCommitDetailView) {',
'  return this._showDirtyDetailViewWarning();',
' } else {',
'  if(this.detailViewIsDirty && this.detailViewIsDirty(true)) {',
'   var result =  this.updateListFromUXControls();',
'   return result;',
'  }',
' }},',
'\tonClick: function() {',
'{UXPRERENDEREDALIAS}_DlgObj._listSystemOnClick(\'LSTMESSAGE\',this.selection[0]);',
'},',
'\tonFirestoreAuthStatechanged: function(e) {if(e.isLoggedIn) { ',
'\tvar lObj = this.dialogObject.getControl(this.listName)',
'\tlObj.onFirestoreLogin(e)',
'}',
'},',
'\tgroup: {',
'\t\tcontinued: {',
'\t\t\twrap: false',
'\t\t}',
'\t},',
'\tlayouts: {',
'\t\tDefault: {',
'\t\t\tgroup: {',
'\t\t\t\tauto: false',
'\t\t\t},',
'\t\t\ttype: \'template\',',
'\t\t\titem: {',
'\t\t\t\theight: \'\',',
'\t\t\t\tclassName: \'\',',
'\t\t\t\thoverClassName: \'\',',
'\t\t\t\tselectedClassName: \'\',',
'\t\t\t\tstyle: \'\',',
'\t\t\t\ttitleClassName: \'\',',
'\t\t\t\tseparatorClassName: \'\'',
'\t\t\t},',
'\t\t\ttemplate: [',
'\t\t\t\'<div style="display: table; width: 100%;">\',',
'\t\t\t\'\\t<div style="display: table-cell; vertical-align: middle;">\',',
'\t\t\t\'\\t<div class="listItemPartContext" style="float: right;"><span id="{UXPRERENDEREDALIAS}.LSTMESSAGE.DONE.I.{*dataRow}">{done}</span></div>\',',
'\t\t\t\'\\t<div class="listItemPartMain"><span id="{UXPRERENDEREDALIAS}.LSTMESSAGE.FROMUSER.I.{*dataRow}">{fromuser}</span></div>\',',
'\t\t\t\'\\t<div class="listItemPartSub"><span id="{UXPRERENDEREDALIAS}.LSTMESSAGE.TOUSER.I.{*dataRow}">{touser}</span></div>\',',
'\t\t\t\'\\t<div class="listItemPartContent">\',',
'\t\t\t\'\\t\\t<span id="{UXPRERENDEREDALIAS}.LSTMESSAGE.DATE.I.{*dataRow}">{date}</span>\',',
'\t\t\t\'\\t</div>\',',
'\t\t\t\'\\t<div class="listItemPartContent">\',',
'\t\t\t\'\\t\\t<span id="{UXPRERENDEREDALIAS}.LSTMESSAGE.MESSAGE.I.{*dataRow}">{message}</span>\',',
'\t\t\t\'\\t</div>\',',
'\t\t\t\'\',',
'\t\t\t\'\\t</div>\',',
'\t\t\t\'</div>\']',
'\t\t}',
'\t},',
'\t__checkedImage: \'svgIcon=#alpha-icon-checkCircle:icon,24\',',
'\t__uncheckedImage: \'svgIcon=#alpha-icon-circle:icon,24\',',
'\tonListDraw: function(data,startIndex) {',
'if(A5.flags.isMobile)  {',
'\t$e.add(this.contId+\'.CONTENT\',\'abstractdown\',function(e) {',
'\t\tvar ele = e.target;',
'\t\tvar tag = \'\';',
'\t\tif(ele && typeof ele.tagName == \'string\') tag = ele.tagName.toLowerCase();',
'\t\tif(tag != \'input\' && tag != \'textarea\') $e.preventDefault(e);',
'\t});',
'}',
'this._hasrun = true;',
' this._allrowschecked = true;',
'var d = this._rData;',
'for(var i = 0; i < d.length; i++) {',
'\tif(!d[i].__selected) {',
'\t\tthis._allrowschecked = false;',
'\t\tbreak;',
'\t}',
'}',
'if (d.length == 0) this._allrowschecked = false;',
'var h ;',
'if(this._allrowschecked) {',
'\th = A5.u.icon.html(this.__checkedImage);',
'} else {',
'\th = A5.u.icon.html(this.__uncheckedImage);',
'}',
'var _id = \'{UXPRERENDEREDALIAS}.\' + this.listVariableName + \'.CHECKBOXALL\';',
'var ele = $(_id)',
'ele.innerHTML = h',
'},',
'\tcaptureFocus: true,',
'\tcontent: {',
'\t\theader: {',
'\t\t\tshow: false',
'\t\t},',
'\t\tfooter: {',
'\t\t\tshow: false',
'\t\t}',
'\t},',
'\tsystemEvents: {',
'\t\tonBeforeDestroy: function(e) {},',
'\t\tonTap: function(e) {},',
'\t\tafterAjaxCallback: function(e) {},',
'\t\tafterClientSideFilter: function(e) {},',
'\t\tbeforeServerSideSort: function(e) {},',
'\t\tafterServerSideSort: function(e) {},',
'\t\tonSwipe: function(e) {},',
'\t\tonScroll: function(e) {},',
'\t\tonPullRelease: function(e) {},',
'\t\tonPull: function(e) {},',
'\t\tonPullEnd: function(e) {},',
'\t\tafterSearchComplete: function(e) {},',
'\t\tbeforeSearch: function(e) {},',
'\t\tonSearchResultTooLarge: function(e) {},',
'\t\tonSearchResultTooLargeForLocalStorage: function(e) {},',
'\t\tonBeforePersistToLocalStorage: function(e) {},',
'\t\tonPersistToLocalStorage: function(e) {},',
'\t\tonRestoreFromLocalStorage: function(e) {},',
'\t\tonListReady: function(e) {},',
'\t\tafterRenderComplete: function(e) {},',
'\t\tbeforeFetchMore: function(e) {},',
'\t\tafterFetchMore: function(e) {},',
'\t\tbeforePageNavigate: function(e) {},',
'\t\tafterPageNavigate: function(e) {},',
'\t\tbeforeRefreshRow: function(e) {},',
'\t\tafterRefreshRow: function(e) {},',
'\t\tafterRefreshData: function(e) {},',
'\t\tafterServerSideSummaryCompute: function(summary) {},',
'\t\tafterRefreshListIncremental: function(e) {},',
'\t\tonNamedQuerySelect: function(e) {},',
'\t\tonFirestoreLoaded: function(e) {},',
'\t\tonFirestoreAuthStateChanged: function(e) {},',
'\t\tonFirestoreLogin: function(e) {},',
'\t\tonFirestoreLogout: function(e) {},',
'\t\tdetailView: {',
'\t\t\tcanUpdateList: function(e) {},',
'\t\t\thasClientSideValidationErrors: function(e) {},',
'\t\t\tafterUpdateList: function(e) {},',
'\t\t\tcanSynchronizeList: function(e) {},',
'\t\t\tafterSynchronizeListBatch: function(e) {},',
'\t\t\tcanCancelBatch: function(e) {},',
'\t\t\tafterCancelBatch: function(e) {},',
'\t\t\tafterSynchronizeList: function(e) {},',
'\t\t\tafterSynchronizeListCompleted: function(e) {},',
'\t\t\tbeforeSynchronizeListBatchStart: function(e) {},',
'\t\t\tafterSynchronizeListBatchEnd: function(e) {},',
'\t\t\tafterRefreshListIncremental: function(e) {},',
'\t\t\tcanResetRow: function(e) {},',
'\t\t\tcanDeleteRow: function(e) {},',
'\t\t\tcanUndoEdits: function(e) {},',
'\t\t\tafterResetRow: function(e) {},',
'\t\t\tafterDeleteRow: function(e) {},',
'\t\t\tafterUndoEdits: function(e) {},',
'\t\t\tcanNewRecord: function(e) {},',
'\t\t\tafterNewRecord: function(e) {},',
'\t\t\tbeforeDetailViewPopulate: function(e) {},',
'\t\t\tafterDetailViewPopulate: function(e) {},',
'\t\t\tafterDetailViewSave: function(e) {},',
'\t\t\tafterListRowSelectCancelled: function(e) {},',
'\t\t\tmodeChanged: function(e) {},',
'\t\t\tonStateChanged: function(e) {},',
'\t\t\tbeforeMediaFilesUploaded: function(e) {},',
'\t\t\tafterMediaFilesUploaded: function(e) {},',
'\t\t\tonMediaFilesUploadErrors: function(e) {},',
'\t\t\tonNoMediaFilesToFetch: function(e) {},',
'\t\t\tbeforeMediaFilesDownloaded: function(e) {},',
'\t\t\tafterMediaFilesDownloaded: function(e) {},',
'\t\t\tbeforeDeleteOrphanMediaFiles: function(e) {},',
'\t\t\tafterDeleteOrphanMediaFiles: function(e) {},',
'\t\t\tlistReadyToPersist: function(e) {},',
'\t\t\tbeforeCRUDExecute: function(e) {},',
'\t\t\t_afterRefreshListIncremental: function() { ',
'if (typeof window[\'cordova\'] == \'undefined\') {',
'\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: \'incrementalRefresh\' });',
'}',
'}',
'\t\t},',
'\t\t_afterRenderComplete: function(e) {',
'},',
'\t\t_afterAjaxCallback: function() {this._refreshStateMessages();}',
'\t},',
'\tonBeforeDestroy: function() {if(this._transient) { ',
'\tthis._transient.destroy()',
'\tdelete this._transient;',
'}',
'},',
'\t_clientsideSummary: [],',
'\tcomputeClientSideSummaryValues: function(e) {},',
'\t_executeEvent: function(event,obj) { ',
'\treturn {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(\'LSTMESSAGE\',event,obj);',
'}',
',',
'\t_selectAll: function() {',
'\tvar v = this._values;',
'\tvar v2 = [].concat(v);',
'\tthis.setValue(v2,false);',
'}',
',',
'\tsearchList: function() { ',
'\tif(this._searchPartStyle == \'querybyform\') {',
'\t\tif(this._dvmode != \'search\') return false;',
'\t}',
'\tif(typeof this.detailViewIsDirty == \'function\') {',
'\t\tif(this.detailViewIsDirty()) {',
'\t\t\t\tif(this._autoCommitDetailView) {',
'\t\t\t\t\t//this.updateListFromUXControls(); ?why was this on? it saves the qbf def as a new record',
'\t\t\t\t}',
'\t\t}',
'\t}',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar mode = \'serverSide\';',
'\tif(typeof obj.searchMode != \'undefined\') mode = obj.searchMode;',
'\tmode = mode.toLowerCase();',
'\tif(mode.indexOf(\'auto\') == 0) {',
'\t\tvar flagCS = false;',
'\t\tif(typeof this.detailViewIsDirty == \'function\') {',
'\t\t\tif(this.listIsDirty() || this.detailViewIsDirty()) flagCS = true;',
'\t\t} else {',
'\t\t\tif(this.listIsDirty()) flagCS = true;',
'\t\t}',
'\t\tif(flagCS) mode = \'clientside\';',
'\t\telse {',
'\t\t\tif(this._dataSourceType.toLowerCase() == \'sql\' || this._dataSourceType.toLowerCase() == \'dbf\' || this._dataSourceType.toLowerCase() == \'firestore\' || this._dataSourceType.toLowerCase() == \'mongodb\' ) {',
'\t\t\t\tmode = \'serverside\';',
'\t\t\t} else {',
'\t\t\t\tmode = \'clientside\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(this._dataSourceType.toLowerCase() == \'static\') mode = \'clientside\';',
'\tvar parentList = this.parentList;',
'\tif(typeof parentList != \'undefined\') {',
'\t\tif(parentList != \'\') mode = \'clientside\';',
'\t}',
'\tvar flagDirty = false;',
'\tif(this.listIsDirty) flagDirty = this.listIsDirty();',
'\tvar flagResult = {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'beforeSearch\',{searchMode: \'search\', searchWhere: mode, listIsDirty: flagDirty});',
'\tif(!flagResult) return false;',
'\tif(mode == \'serverside\') {',
'\t\tthis._searchListServerSide(obj);',
'\t} else if(mode == \'clientside\') {',
'\t\tthis._searchPartSubmit_clientSideFilter();',
'\t\tvar rowCount = this._rData.length;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'afterSearchComplete\',{searchMode: \'search\', searchWhere: mode, recordsInQuery: rowCount});',
'\t}',
'}',
',',
'\t_searchListServerSide: function() { ',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar _d={};',
'\tvar flagDirty = false;',
'\tif(this.listIsDirty) flagDirty = this.listIsDirty();',
'\tif(flagDirty) {',
'\t\talert(\'Can\\\'t execute server-side search because List has edits that have not yet been synchronized.\');',
'\t\treturn false;',
'\t}',
'\t_d.listId = this.listVariableName',
'\tvar _data = A5.ajax.buildURLParam(\'__searchInfo\',JSON.stringify(_d));',
'\t_data = _data + \'&\' + A5.ajax.buildURLParam(\'__searchOptions\',JSON.stringify(obj));',
'\tthis.filter = false;',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:ListSearchPart\',\'\',_data);',
'}',
',',
'\tsetListSize: function(height,width) {',
'\tvar l = $(this.contId);',
'\tif(typeof height != \'undefined\') l.style.height = \'\'+ height;',
'\tif(typeof width != \'undefined\') l.style.width = \'\' + width;',
'\tthis.resize();',
'}',
',',
'\tclearSearchList: function() { ',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar mode = \'serverSide\';',
'\tif(typeof obj.searchMode != \'undefined\') mode = obj.searchMode;',
'\tmode = mode.toLowerCase();',
'\tif(mode.indexOf(\'auto\') == 0) {',
'\t\tif(this.listIsDirty()) mode = \'clientside\';',
'\t\telse mode = \'serverside\';',
'\t}',
'\tif(this._dataSourceType.toLowerCase() == \'static\') mode = \'clientside\';',
'\tvar parentList = this.parentList;',
'\tif(typeof parentList != \'undefined\') {',
'\t\tif(parentList != \'\') mode = \'clientside\';',
'\t}',
'\tvar flagResult = {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'beforeSearch\',{searchMode: \'clear\', searchWhere: mode});',
'\tif(!flagResult) return false;',
'\tif(mode == \'serverside\') {',
'\t\tthis._clearSearchListServerSide();',
'\t} else if(mode == \'clientside\') {',
'\t\tthis._searchPartSubmit_clientSideFilterClear();',
'\t\tvar rowCount = this._rData.length;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'afterSearchComplete\',{searchMode: \'clear\', searchWhere: mode, recordsInQuery: rowCount});',
'\t}',
'}',
',',
'\t_clearSearchListServerSide: function() { ',
'\tvar _d={};',
'\t_d.listId = this.listVariableName',
'\tvar _data = A5.ajax.buildURLParam(\'__searchInfo\',JSON.stringify(_d));',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:ListSearchPartClear\',\'\',_data);',
'}',
',',
'\t_str: function(txt) {',
'\ttxt = txt.replace("\'","\\\\\'");',
'\ttxt = \'\\\'\' + txt + \'\\\'\';',
'\treturn txt;',
'}',
',',
'\t_QBF: function(txt) { ',
'\tvar o = {};',
'\to.v2 = \'\';',
'\to.v1 = txt;',
'\to.flag = false;',
'\tif(txt.indexOf(\'>=\') >= 0) {',
'\t\to.op = \'>=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'<=\') >= 0 ) {',
'\t\to.op = \'<=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'>\') >= 0 ) {',
'\t\to.op = \'>\';',
'\t\to.v1 = txt.substr(1);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'<\') >= 0)  {',
'\t\to.op = \'<\';',
'\t\to.v1 = txt.substr(1);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'..\') == 0)  {',
'\t\to.op = \'<=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if ( txt.indexOf(\'..\', txt.length - \'..\'.length) !== -1 ) {',
'\t\t//ends with ..',
'\t\to.op = \'>=\';',
'\t\ttxt = txt.split(\'..\')',
'\t\to.v1 = txt[0];',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'..\') > 0 ) {',
'\t\to.op = \'between\'',
'\t\ttxt = txt.split(\'..\');',
'\t\to.v1 = txt[0];',
'\t\to.v2 = txt[1];',
'\t\to.flag = true;',
'\t}',
'\treturn o;',
'}',
',',
'\t_match: function(data,field,val,obj) { ',
'\tif(obj.qbf && obj.type == \'c\') val = $u.s.rTrim(val,\',\');',
'\tvar flagKeyword = false;',
'\tif(typeof obj.flagKeyword != \'undefined\') flagKeyword = obj.flagKeyword;',
'\tif(flagKeyword) {',
'\t\tvar _field = field',
'\t\t//if(_field.indexOf(\'.\') > -1) _field = _field.split(\'.\')[1]',
'\t\t_field = _field.toUpperCase()',
'\t\tvar obj_i = this._searchFieldOptions[_field];',
'\t\tthis._setSearchOps(obj,obj_i);',
'\t\tfield = obj_i.searchField',
'\t\tconsole.log(field)',
'\t}',
'\tvar _d = \'\';',
'\tvar _v = val;',
'\tvar flagC = false;',
'\tif(obj.type == \'c\') {',
'\t\tflagC = true;',
'\t\tif(!obj.caseSensitive) _v = _v.toLowerCase();',
'\t} else {',
'\t\t//non mumeric searches are only mode 1 or -1',
'\t\tif(obj.mode > 1) obj.mode = 1;',
'\t\tif(obj.mode < -1) obj.mode = -1;',
'\t}',
'\tvar flag = false;',
'\tobj.usesQBFOperator = false;',
'\tif(obj.qbf) {',
'\t\t_v = _v.split(\',\');',
'\t} else {',
'\t\t_v = [_v];',
'\t}',
'\tvar o = {}',
'\tvar r = \'\';',
'\tvar _vals = [];',
'\tfor(var i = 0; i < _v.length; i++) {',
'\t\tif(obj.qbf) {',
'\t\t\to = this._QBF(_v[i]);',
'\t\t} else {',
'\t\t\to.flag = false;',
'\t\t\to.v1 = _v[i];',
'\t\t\to.v2 = \'\';',
'\t\t}',
'\t\tif(typeof data[field] != \'undefined\') {',
'\t\t\tif(data[field] != null) {',
'\t\t\t\t_d = \'\' + data[field];',
'\t\t\t\tif(obj.type == \'n\') {',
'\t\t\t\t\to.v1 = Number(o.v1);',
'\t\t\t\t\to.v2 = Number(o.v2);',
'\t\t\t\t\t_d = Number(_d);',
'\t\t\t\t} else if (obj.type == \'l\') {',
'\t\t\t\t\to.v1 = $u.s.toBool(o.v1);',
'\t\t\t\t\to.v2 = $u.s.toBool(o.v2);',
'\t\t\t\t\t_d = $u.s.toBool(_d);',
'\t\t\t\t} else if (obj.type == \'d\') {',
'\t\t\t\t\to.v1 = A5.stringToDate(o.v1,obj.dateFormat);',
'\t\t\t\t\to.v2 = A5.stringToDate(o.v2,obj.dateFormat);',
'\t\t\t\t\tif(typeof _d == \'string\') _d = A5.stringToDate(_d,obj.dateFormat);',
'\t\t\t\t\tif(o.v1 != \'\' && o.v1 != null ) o.v1 = o.v1.getTime();',
'\t\t\t\t\tif(o.v2 != \'\' && o.v2 != null ) o.v2 = o.v2.getTime();',
'\t\t\t\t\tif(_d != \'\' && _d != null ) _d = _d.getTime();',
'\t\t\t\t}',
'\t\t\t\tif(flagC) {if(!obj.caseSensitive && typeof _d == \'string\') _d = _d.toLowerCase();}',
'\t\t\t\tif(o.flag) {',
'\t\t\t\t\t//has qbf operators',
'\t\t\t\t\tif(o.op == \'between\') {',
'\t\t\t\t\t\tif(flagC) {',
'\t\t\t\t\t\t\tif(_d.substr(0,o.v1.length) >= o.v1 && _d.substr(0,o.v2.length) <= o.v2 ) flag = true;',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(_d >= o.v1 && _d <= o.v2 && (typeof _d == typeof o.v1)  ) flag = true;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(flagC) _d = _d.substr(0,o.v1.length)',
'\t\t\t\t\t\tif(o.op == \'>=\') if( _d >= o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'<=\') if( _d <= o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'>\') if(_d > o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'<\') if(_d < o.v1) flag = true;',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tif(obj.mode == 1 || obj.mode == -1 ) {',
'\t\t\t\t\t\tif(obj.mode == 1) if(_d == o.v1) flag = true;; //match',
'\t\t\t\t\t\tif(obj.mode == -1) if(!(_d == o.v1)) flag = true;; //match',
'\t\t\t\t\t} else if (obj.mode == 2 || obj.mode == -2) {',
'\t\t\t\t\t\tif(obj.mode == 2) if(_d.indexOf(o.v1) > -1) flag = true; //contains',
'\t\t\t\t\t\tif(obj.mode == -2) if(!(_d.indexOf(o.v1) > -1)) flag = true;',
'\t\t\t\t\t} else if (obj.mode == 3 || obj.mode == -3) {',
'\t\t\t\t\t\tif(obj.mode == 3) if(_d.indexOf(o.v1) == 0) flag = true; //starts with',
'\t\t\t\t\t\tif(obj.mode == -3) if(!(_d.indexOf(o.v1) == 0)) flag = true; //starts with',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(o.v1 != \'\') {',
'\t\t\t\t\tif(_vals.indexOf(o.v1) == -1) {',
'\t\t\t\t\t\t_vals.push(o.v1);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(o.v2 != \'\') {',
'\t\t\t\t\tif(_vals.indexOf(o.v2) == -1) {',
'\t\t\t\t\t\t_vals.push(o.v2);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(flag) {',
'\t\tif(typeof this._state.highlight == \'undefined\') this._state.highlight = {};',
'\t\tthis._state.highlight[field.toUpperCase()] = _vals;',
'\t} else {',
'\t\t//this._state.highlight[field.toUpperCase()] = [];',
'\t}',
'\treturn flag;',
'}',
',',
'\t_setSearchOps: function(obj,obj_i) { ',
'\tobj.mode = obj_i.option;',
'\tobj.qbf = obj_i.qbf;',
'\tobj.type = obj_i.type;',
'\t//obj.treatAs = obj_i.treatAs;',
'}',
',',
'\t_searchPartOperator: \'&&\',',
'\t_searchPartSubmit_clientSideFilter: function() { ',
'\tif(!this._searchPartHas) return true;',
'\t//_searchPartStyle: \'individualcontrols\'',
'\tthis._state.highlight = {};',
'\tif(this._searchPartStyle == \'singlekeywordcontrol\') {',
'\t\tvar searchFor = {UXPRERENDEREDALIAS}_DlgObj.getValue(this._keywordSearchControl);',
'\t\tvar arr = this._keywordSearchFields;',
'\t\tvar expn = [];',
'\t\tvar expn_i = \'\';',
'\t\tvar obj = {};',
'\t\t//obj.caseSensitive = false;',
'\t\t//obj.qbf = true;',
'\t\t//obj.mode = 1;',
'\t\tobj.flagKeyword = true;',
'\t\tvar objStr = JSON.stringify(obj)',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\texpn_i = \'this._match(data,\' +this._str(arr[i]) + \',\' + this._str(searchFor) + \',\'+objStr+\')\';',
'\t\t\texpn.push(expn_i);',
'\t\t}',
'\t\texpn = expn.join(\'||\');',
'\t\t//alert(expn);',
'\t} else if ( this._searchPartStyle == \'individualcontrols\' || this._searchPartStyle == \'querybyform\'  ) {',
'\t\tvar map = this._searchPart.fieldMap;',
'\t\tvar val = \'\';',
'\t\tvar expn = [];',
'\t\tvar expn_i = \'\';',
'\t\tvar obj = {};',
'\t\tobj.caseSensitive = false;',
'\t\t//obj.qbf = true;',
'\t\t//obj.mode = 2;',
'\t\t//var objStr = JSON.stringify(obj)',
'\t\tvar ac = [];',
'\t\tvar aco = {};',
'\t\tvar _highlight = {};',
'\t\tif(this._searchPartStyle == \'individualcontrols\') {',
'\t\t\tfor(var i = 0; i < map.length; i++) {',
'\t\t\t\tval = {UXPRERENDEREDALIAS}_DlgObj.getValue(map[i].control);',
'\t\t\t\tif(val != \'\') {',
'\t\t\t\t\tobj_i = this._searchFieldOptions[map[i].field.toUpperCase()];',
'\t\t\t\t\tthis._setSearchOps(obj,obj_i);',
'\t\t\t\t\texpn_i = \'this._match(data,\' +this._str(map[i].field) + \',\' + this._str(val) + \',\'+JSON.stringify(obj)+\')\';',
'\t\t\t\t\texpn.push(expn_i);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t} else if (this._searchPartStyle == \'querybyform\' ) {',
'\t\t\tvar controlName = \'\';',
'\t\t\tfor(var i = 0; i < this._listFields.length; i++) {',
'\t\t\t\tcontrolName = this._getUXDetailViewControlName(this._listFields[i].name);',
'\t\t\t\tif(controlName != \'\') {',
'\t\t\t\t\tval = {UXPRERENDEREDALIAS}_DlgObj.getValue(controlName);',
'\t\t\t\t\tif(val != \'\') {',
'\t\t\t\t\t\t//obj_i = this._searchFieldOptions[map[i].field.toUpperCase()];',
'\t\t\t\t\t\tobj_i = this._searchFieldOptions[this._listFields[i].name.toUpperCase()];',
'\t\t\t\t\t\tthis._setSearchOps(obj,obj_i);',
'\t\t\t\t\t\texpn_i = \'this._match(data,\' +this._str(this._listFields[i].name) + \',\' + this._str(val) + \',\'+JSON.stringify(obj)+\')\';',
'\t\t\t\t\t\texpn.push(expn_i);',
'\t\t\t\t\t\taco.control = controlName;',
'\t\t\t\t\t\taco.value = val;',
'\t\t\t\t\t\tac.push(aco);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tthis.__queryByFormValues = ac;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._setDVClean(this);',
'\t\t}',
'\t\tvar operator = \'&&\';',
'\t\tif(typeof this._searchPartOperator != \'undefined\') operator = this._searchPartOperator;',
'\t\texpn = expn.join(\' \'+operator+\' \');',
'\t}',
'\tif (this._showSearchDebugInfo) {',
'\t\tvar ele = $(\'{UXPRERENDEREDALIAS}.V.R1.\' + this._searchDebugPH);',
'\t\tif(ele) ele.innerHTML = expn;',
'\t}',
'\t//user did not fill in any search fields',
'\tif(expn == \'\') return true;',
'\tvar fnTxt = \'if(\' + expn + \') {return true;} else { return false;}\'',
'\tvar searchFunction = new Function(\'data\',fnTxt);',
'\tthis.setFilter(searchFunction);',
'\tif(this._rData.length > 0) this.setValue(0);',
'}',
',',
'\t_searchPartSubmit_clientSideFilterClear: function() { ',
'if(!this._searchPartHas) return true;',
'\tthis._state.highlight = {};',
'\tthis.setFilter(false);',
'\tvar map = this._searchPart.fieldMap;',
'\tvar val = \'\';',
'\tvar od = {UXPRERENDEREDALIAS}_DlgObj.originalValues[0];',
'\tfor(var i = 0; i < map.length; i++) {',
'\t\tvar val = od[map[i].control.toUpperCase()];',
'\t\t//selwyn 8/6/20 -- used to be false, but then the floating label is not resotred to its initial position when the form is cleared',
'\t\tif(typeof val != \'undefined\') {UXPRERENDEREDALIAS}_DlgObj.setValue(map[i].control,val,false);',
'\t}',
'\tthis.setFilter(false);',
'\tdelete this.__queryByFormValues;',
'\t{UXPRERENDEREDALIAS}_DlgObj._setDVClean(this);',
'\tif(this._data.length > 0) this.setValue(0);',
'\tif (this._showSearchDebugInfo) {',
'\t\tvar ele = $(\'{UXPRERENDEREDALIAS}.V.R1.\' + this._searchDebugPH);',
'\t\tif(ele) ele.innerHTML = \'\';',
'\t}',
'}',
',',
'\t_debugListData: function() { \t\tvar debugObj = this._data[this.selection[0]];',
'\t\tif(typeof debugObj == \'undefined\') {alert(\'no active row\'); return false;}',
'\t\t\tvar debugTxt = JSON.stringify(debugObj,\'\',\'\\t\');',
'\t\tdebugTxt = debugTxt.split(\'\\t\').join(\'    \');',
'\t\tvar ele = $(\'{UXPRERENDEREDALIAS}.V.R1.\');',
'\t\tif(ele) {',
'\t\t\tele.innerHTML = \'<div style="color: blue;width: 100%; height: 100%;white-space: pre;border: solid 1px blue; padding: 2px;"></div>\';',
'\t\t\tele.firstChild.innerText = debugTxt;',
'\t\t\tif(ele.firstChild.innerHTML == \'\')  { ele.firstChild.innerHTML = debugTxt }',
'\t\t}',
'},',
'\t_refreshDebugInfo: function() {},',
'\t_showSQL_CRUD: function(txt) { },',
'\t_globalErrorPlaceHolder: \'LSTMESSAGE_GLOBALERRORS\',',
'\tflagShowAlerts: true,',
'\tlookupValue: function(key,name,keyValue) {',
'\tvar _d = this._data;',
'\tvar indx = A5FindPropInArray(_d,key,keyValue);',
'\tvar rv = \'\';',
'\tif(indx >=0) {',
'\t\tif(name == \'__rowData__\') return _d[indx];',
'\t\trv =  _d[indx][name];',
'\t} else {',
'\t\t//null out all properties in row',
'\t\tvar _d2 = {};',
'\t\tif(typeof _d[0] == \'undefined\') { return {}} ;',
'\t\tfor(var n in _d[0]) {',
'\t\t\t_d2[n] = \'&nbsp;\';',
'\t\t}',
'\t\trv = _d2;',
'\t}',
'\treturn rv;',
'}',
',',
'\tallowNullSelection: true,',
'\tallowTextSelection: false,',
'\tallowAnyValue: false,',
'\tallowNullDeselection: false,',
'\tloopNavigate: false,',
'\tloopNavigateNullSelection: false,',
'\trefreshChildLists: function() {{UXPRERENDEREDALIAS}_DlgObj._listRefreshCascadingLists(\'LSTMESSAGE\'); },',
'\trowExpander: function(rowNumber) { ',
'\tvar mode = typeof arguments[2] != \'undefined\' ? arguments[2] : \'toggle\';',
'\tif(typeof rowNumber === \'undefined\' || rowNumber === \'\' ) {',
'\t\trowNumber = this.selection[0];',
'\t\tif(typeof rowNumber == \'undefined\') return false;',
'\t}',
'\tvar animObj = typeof arguments[1] != \'undefined\' ? arguments[1] : {};',
'\tvar ele = $(this._hostComponentId + \'.\' + this.listVariableName + \'.ROWEXPANDER.\' + rowNumber);',
'\tif(ele) {',
'\t\tif(mode == \'toggle\') A5.u.element.toggle(ele,animObj);',
'\t\tif(mode == \'show\') A5.u.element.show(ele,animObj);',
'\t\tif(mode == \'hide\') A5.u.element.hide(ele,animObj);',
'\t}',
'}',
',',
'\tafterClientSideSummaryCompute: function(csSummary) { },',
'\tselectCurrentLayout: function(name) {',
'if(this._flagRestoringLayoutSettings) {',
'\tthis._flagRestoringLayoutSettings = false;',
'\treturn;',
'}',
'var pl = this.layouts[name];',
'if(typeof pl == \'undefined\') return false;',
'this.setLayout(name);',
'if(pl.type == \'column\') {',
'\tthis.columnLayout.header.show = this.layouts[name].showColumnTitles;',
'\tthis.refresh();',
'}',
'var flagPersist = this._persistListLayout;',
'if(flagPersist && this.saveLayoutSettings ) this.saveLayoutSettings()',
'},',
'\tonFilter: function() { \tvar e = {};',
'\te.rowCount = this._values.length;',
'\tvar ele = $(\'{UXPRERENDEREDALIAS}.__listId__.RECORDCOUNT\');',
'\tif(ele) {ele.innerHTML = e.rowCount;};',
'\tif(this.persistToStorage) { this.persistToStorage({});}',
'\t(function(e) {   })(e);',
'}',
',',
'\tserverSideSort: function(column,initialDirection) {',
'var e = {};',
'this.setOrder(false);',
'e.column = column;',
'var result = this.systemEvents.beforeServerSideSort(e);',
'if(result == false) return false;',
'var obj = {};',
'obj.cmd = \'sort\';',
'obj.column = column;',
'obj.layoutName = this.layout;',
'obj.listState = this._state;',
'obj.initialDirection = initialDirection;',
'var data = \'_listId=LSTMESSAGE&\' + A5.ajax.buildURLParam(\'_cmdObj\',$u.o.toJSON(obj));',
'{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:listServerSideSort\',\'\',data);',
'},',
'\tfilterListClientSide: function(searchFor) {',
'searchFor =  searchFor.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, "\\\\$&");',
'//var result = this.systemEvents.beforeClientSideFilter();',
'//if(result == false) return false;',
'if(searchFor != \'\') {',
'\t//fixes bug in Chrome when searching on dates strings that use forward slashes',
'\tsearchFor = searchFor.replace(/\\//g,\'\\\\/\');',
'\tthis.setFilter({\'id\': RegExp(\'\' + searchFor,\'i\'), \'fromuser\': RegExp(\'\' + searchFor,\'i\'), \'touser\': RegExp(\'\' + searchFor,\'i\'), \'message\': RegExp(\'\' + searchFor,\'i\'), \'poiid\': RegExp(\'\' + searchFor,\'i\'), \'duedate\': RegExp(\'\' + searchFor,\'i\'), \'addtoroute\': RegExp(\'\' + searchFor,\'i\'), \'done\': RegExp(\'\' + searchFor,\'i\'), \'PRIORITY\': RegExp(\'\' + searchFor,\'i\'), \'date\': RegExp(\'\' + searchFor,\'i\')});',
'} else this.setFilter(false);',
'var rowCount = this._values.length;',
'//var e = {};',
'//e.rowCount = rowCount;',
'//this.systemEvents.afterClientSideFilter(e);',
'var ele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.RECORDCOUNT\');',
'if(ele) ele.innerHTML = rowCount;',
'if(this._showHideFetchMoreSpinner) this._showHideFetchMoreSpinner();',
'}',
',',
'\tscrollToClosestValue: function(val) { ',
'\tif(typeof val != \'string\') val = val.join(\'\');',
'\tvar flagCI = typeof arguments[1] != \'undefined\' ? arguments[1] : false;',
'\tvar pos = typeof arguments[2] != \'undefined\' ? arguments[2] : \'top\';',
'\tvar anim = typeof arguments[3] != \'undefined\' ? arguments[3] : {}',
'\tvar _d = this._rData;',
'\tvar len = val.length;',
'\tvar _d2;',
'\tvar i2 = -1;',
'\tif(flagCI) val = val.toLowerCase();',
'\tfor(var i = 0 ; i < _d.length; i++) {',
'\t\ti2 = i;',
'\t\t_d2 = String(_d[i][\'*value\']);',
'\t\t_d2 = _d2.substr(0,len);',
'\t\t_d2 = $u.s.pad(_d2,len,\' \',\'l\');',
'\t\tif(flagCI) _d2 = _d2.toLowerCase();',
'\t\tif(val <= _d2){',
'\t\t\t break;',
'\t\t}',
'\t}',
'\tif(i2 > -1) {',
'\t\tthis.scrollToItem(i2,{mode: pos, animation: anim});',
'\t}',
'}',
',',
'\t_setPageSize: function(pageSize) {',
'\tthis._state.pageSize = pageSize;',
'\tvar options = {',
'\t\tkeepFocusOnCurrentSelection: true,',
'\t\tpreserveCurrentFilterOrder: true,',
'\t};',
'\t{UXPRERENDEREDALIAS}_DlgObj._refreshListData(this.listVariableName,options);',
'}',
',',
'\t_refreshStateMessages: function() {',
'\tif({UXPRERENDEREDALIAS}_DlgObj._listStateChange) {UXPRERENDEREDALIAS}_DlgObj._listStateChange(this.listVariableName);',
'\tvar ele = \'\';',
'\tele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.PAGENUMBER\');',
'\tif(ele) ele.innerHTML = this._state.page;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.PAGECOUNT\');',
'\tif(ele) ele.innerHTML = this._state.pageCount;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.PAGECOUNT.PAGESELECTOR\');',
'\tif(ele) ele.innerHTML = this._state.pageCount;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.LISTSTATE\');',
'\tif(ele) {',
'\t\tvar listState = $u.o.toJSON(this._state);',
'\t\tele.innerHTML = listState;',
'\t}',
'\tif(this._hasNavigationBar) {',
'\t\tvar nObj = this._listNavigator;',
'\t\tif(!nObj) {',
'\t\t\tthis._listNavigator = {UXPRERENDEREDALIAS}_DlgObj._navigationBar(this._navBarId);',
'\t\t}',
'\t\tif(nObj) {',
'\t\t\tvar obj = nObj.data;',
'\t\t\tobj.settings = this._navigationBar;',
'\t\t\tobj.pageNumber = this._state.page;',
'\t\t\tobj.totalPages = this._state.pageCount;',
'\t\t\tobj.totalRecords = this._state.recordCount;',
'\t\t\tobj.listName = this.listVariableName;',
'\t\t\tnObj.populate(obj);',
'\t\t\tthis.refresh();',
'\t\t\tthis.resize(); //needed if the list has a fixed size and the style is gr*',
'\t\t}',
'\t}',
'\t//navigation buttons',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_NEXT.LSTMESSAGE\'];',
'\tif(ele) {',
'\t\tif(this._state.page == this._state.pageCount || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_LAST.LSTMESSAGE\'];',
'\tif(ele) {',
'\t\tif(this._state.page == this._state.pageCount || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_FIRST.LSTMESSAGE\'];',
'\tif(ele) {',
'\t\tif(this._state.page == 1 || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_PREV.LSTMESSAGE\'];',
'\tif(ele) {',
'\t\tif(this._state.page == 1 || this._state.pageCount == 0 ) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = $(\'{UXPRERENDEREDALIAS}.V.R1.A5SYSTEM_LIST_PAGESELECTOR_LSTMESSAGE\');',
'\tif(ele) {',
'\t\tvar data = this._recordNavigatorLinks;',
'\t\tif(data) {',
'\t\t\tA5.form.populateSelect(ele,\'\' + this._state.page,data,true);',
'\t\t\t//alert(\'page: \' + this._state.page);',
'\t\t\t//ele.value = this._state.page;',
'\t\t}',
'\t}',
'}',
',',
'\theader: {',
'\t\thtml: \'\'',
'\t},',
'\t__flagHasFixedColumnFooters: false,',
'\t_getRoute: function() { ',
'\tvar mode = typeof arguments[0] != \'undefined\' ? arguments[0] : \'rowNumber\'; //',
'\tvar obj  = typeof arguments[1] != \'undefined\' ? arguments[1] : [];',
'\tif(typeof this.selection == \'undefined\') return false;',
'\tif(typeof this.selection[0] == \'undefined\') return false;',
'\tif(typeof this.getData(this.selection[0]) == \'undefined\') return false;',
'\tif(mode == \'*key\') {',
'\t\t//leave as *key',
'\t} else {',
'\t\tif(mode != \'rowNumber\') {',
'\t\t\tvar _d = this.getData(this.selection[0]);',
'\t\t\tif(typeof _d.__primaryKey == \'undefined\') {',
'\t\t\t\tmode = \'rowNumber\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\tvar endPoint = typeof arguments[2] != \'undefined\' ? arguments[2]: \'\';',
'\tif(endPoint != \'\') {',
'\t\t//if you have sibling children _getRoute() is returning wrong route -- it is including the siblings in the route.',
'\t\t//route should only include parents',
'\t\t//by passing in the listName to the function we get the route from the top parent to the \'endPoint\' list (ignoring siblings)',
'\t\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t\tvar ra2 = [];',
'\t\tvar lObj = _dlgObj.getControl(endPoint);',
'\t\tvar parentList = lObj.parentList;',
'\t\twhile(typeof parentList != \'undefined\' && parentList != \'\') {',
'\t\t\tvar l2 = _dlgObj.getControl(parentList);',
'\t\t\tvar row = \'\';',
'\t\t\tif(mode == \'rowNumber\') {',
'\t\t\t\trow = l2.selection[0]',
'\t\t\t} else {row = l2.getData(l2.selection[0])[\'*key\'] }',
'\t\t\tra2.push({list: parentList.toUpperCase(), row: row});',
'\t\t\tparentList = l2.parentList;',
'\t\t}',
'\t\treturn ra2.reverse();',
'\t}',
'\tif(mode == \'rowNumber\' || mode == \'*key\') {',
'\t\tobj.push({list: this.listVariableName.toUpperCase(), row: this.getData(this.selection[0])[\'*key\'], mode: mode});',
'\t} else {',
'\t\tvar _d = this.getData(this.selection[0]);',
'\t\tvar _pk = _d.__primaryKey;',
'\t\tif(typeof _d.__primaryKey == \'undefined\') {',
'\t\t\t_pk = _d[\'*rowGUID\'];',
'\t\t}',
'\t\tobj.push({list: this.listVariableName.toUpperCase(), row: _pk, mode: mode});',
'\t}',
'\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\tvar lname = this.childLists[i];',
'\t\tvar lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(lname);',
'\t\tif(lObj) lObj._getRoute(mode,obj);',
'\t}',
'\treturn obj;',
'}',
',',
'\t_getRouteOLD: function() { ',
'\tvar obj  = typeof arguments[1] != \'undefined\' ? arguments[1] : [];',
'\tvar mode = typeof arguments[0] != \'undefined\' ? arguments[0] : \'rowNumber\'; //',
'\tif(typeof this.selection == \'undefined\') return false;',
'\tif(typeof this.selection[0] == \'undefined\') return false;',
'\tif(typeof this.getData(this.selection[0]) == \'undefined\') return false;',
'\tif(mode == \'rowNumber\') obj.push({list: this.listVariableName, row: this.getData(this.selection[0])[\'*key\']});',
'\telse obj.push({list: this.listVariableName, row: this.getData(this.selection[0]).__primaryKey});',
'\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\tvar lname = this.childLists[i];',
'\t\tvar lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(lname);',
'\t\tif(lObj) lObj._getRoute(mode,obj);',
'\t}',
'\treturn obj;',
'}',
',',
'\t_setRoute: function(route) { ',
'if(this.multiple ) return;',
'\tif(typeof route == \'undefined\') {',
'\t\troute = this.__currentRoute;',
'\t\tif(typeof route == \'undefined\') return false;',
'\t}',
'\tvar mode = typeof arguments[1] != \'undefined\' ? arguments[1] : \'rowNumber\'; //',
'\tif(mode == \'primaryKey\') {',
'\t\tif(typeof this._data != \'undefined\') {',
'\t\t\tvar _d = this._data;',
'\t\t\tif(typeof _d[0] != \'undefined\') {',
'\t\t\t\tif(typeof _d[0].__primaryKey == \'undefined\') {',
'\t\t\t\t\tmode = \'rowNumber\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tvar lObj = \'\';',
'\tvar row = \'\';',
'\tvar _pk = \'\';',
'\tfor(var i = 0; i < route.length; i++) {',
'\t\tlObj = window[this._hostComponentId + \'_DlgObj\'].getControl(route[i].list);',
'\t\trow = route[i].row;',
'\t\tif(typeof route[i].mode != \'undefined\') {',
'\t\t\tmode = route[i].mode',
'\t\t}',
'\t\tif(mode == \'primaryKey\') _pk = row;',
'\t\t/*',
'\t\tif(mode != \'rowNumber\') {',
'\t\t\tvar _d = lObj._rData;',
'\t\t\tvar _i2 = -1;',
'\t\t\tfor(var j = 0; j < _d.length; j++) {',
'\t\t\t\tif(_d[j].__primaryKey == row) {',
'\t\t\t\t\t_i2 = j;',
'\t\t\t\t\tbreak;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\trow = _i2',
'\t\t}',
'\t\t*/',
'\t\tvar flag = typeof this._restoringList != \'undefined\' ? !this._restoringList : true;',
'\t\tif(mode == \'rowNumber\') {',
'\t\t\tif(typeof row != \'undefined\') {',
'\t\t\t\tvar rowFixed = \'\';',
'\t\t\t\tif(typeof lObj._dataMap == \'undefined\') return false;',
'\t\t\t\tif(mode != \'rowNumber\')  {',
'\t\t\t\t\trowFixed = row;',
'\t\t\t\t\t} else {',
'\t\t\t\trowFixed = lObj._dataMap.indexOf(route[i].row);',
'\t\t\t\t}',
'\t\t\t\tlObj.setValue(rowFixed,flag);',
'\t\t\t\tif(this._clearServerSideErrors) this._clearServerSideErrors();',
'\t\t\t\tif(this._showServerSideErrors) this._showServerSideErrors();',
'\t\t\t\tif(this._showWriteConflictErrors) this._showWriteConflictErrors();',
'\t\t\t}',
'\t\t} else {',
'\t\t\tlObj.setValue(\'\'+_pk,flag);',
'\t\t\tif(this._clearServerSideErrors) this._clearServerSideErrors();',
'\t\t\tif(this._showServerSideErrors) this._showServerSideErrors();',
'\t\t\tif(this._showWriteConflictErrors) this._showWriteConflictErrors();',
'\t\t}',
'\t}',
'}',
',',
'\t_useServerSideSyncLog: false,',
'\titems: {',
'},',
'\t_searchHighlighting: false,',
'\tview: {',
'\t\tnavigation: {',
'\t\t\tnext: {',
'\t\t\t\tclassName: \'listNavButtonNext\'',
'\t\t\t},',
'\t\t\tprev: {',
'\t\t\t\tclassName: \'listNavButtonPrev\'',
'\t\t\t}',
'\t\t}',
'\t},',
'\t_incrementalRefreshTimestampField: \'\',',
'\t_hasNavigationBar: false,',
'\t_listGUID: \'f785f30e-52dd-4a8b-8b9c-52aaea34d90e\'',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LIST1\'] = {',
'\t__pkisguid: false,',
'\t_switchInfo: {',
'},',
'\t_setupAlphabetSearch: function() { },',
'\tgetMapObject: function() { \treturn this.layouts[this.layout].map;',
'}',
',',
'\t__applyIncrementRefreshUpdates: function(listId) { \tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\tvar lObj = _dlgObj.getControl(listId);',
'\tvar countU = 0;',
'\tvar countA = 0;',
'\tvar newData = lObj.__incrementalRefreshData;',
'\tvar getRowState = function (listObj) {',
'\t\tvar d = listObj._data;',
'\t\tvar dObj = {};',
'\t\tfor(var i = 0; i < d.length; i++) {',
'\t\t\tdObj[d[i].__primaryKey] = {};',
'\t\t\tif(typeof d[i]._isDirty == \'undefined\') flag = false',
'\t\t\telse flag = d[i]._isDirty;',
'\t\t\tdObj[d[i].__primaryKey].dirty = flag;',
'\t\t\t//dObj[d[i].__primaryKey].__rowNumber= i;',
'\t\t\t//*renderIndex is not unique after a client side filter has been done',
'\t\t\t//dObj[d[i].__primaryKey].__rowNumber= d[i][\'*renderIndex\'];',
'\t\t\tdObj[d[i].__primaryKey].__rowNumber= d[i][\'*value\'];',
'\t\t}',
'\t\treturn dObj;',
'\t}',
'\tvar dObj = getRowState(lObj);',
'\tvar _obj = {};',
'\tvar __row;',
'\tvar flagDirty;',
'\tfunction pkExists(d,pk) { ',
'\t\tfor(var i = 0; i < d.length; i++) { ',
'\t\tif(d[i].__primaryKey == pk) return true;',
'\t}',
'\t\treturn false;',
'\t}',
'\tfor(var i = 0; i < newData.length; i++) {',
'\t\t_obj = dObj[newData[i].__primaryKey];',
'\t\tif(typeof _obj != \'undefined\') {',
'\t\t\t__row = _obj[\'__rowNumber\'];',
'\t\t\tif(typeof __row != \'undefined\') {',
'\t\t\t\tflagDirty = _obj[\'dirty\'];',
'\t\t\t\tif(!flagDirty) {',
'\t\t\t\t\t//clear out all child arrays since the new data has the child arrays in it.',
'\t\t\t\t\tvar currentData = lObj.getData(__row);',
'\t\t\t\t\tfor(var n in currentData) { ',
'\t\t\t\t\t\tif(n.indexOf(\'__LIST__\') ==  0) { ',
'\t\t\t\t\t\t\tcurrentData[n] = [];',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tlObj.updateRow(__row,newData[i]);',
'\t\t\t\t\tcountU++;',
'\t\t\t\t} else { ',
'\t\t\t\t\t//row is dirty',
'\t\t\t\t\t//lObj.appendRows([ newData[i]]);',
'\t\t\t\t\t//countA++;',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//__row is undefined',
'\t\t\t\t//alert(\'__row is undefined\');',
'\t\t\t\t//lObj.appendRows([ newData[i]]);',
'\t\t\t\t//countA++;',
'\t\t\t}',
'\t\t} else {',
'\t\t\t//check to see if the row is already in the list',
'\t\t\tif(!pkExists(lObj._data,newData[i].__primaryKey)) {',
'\t\t\t\tlObj.appendRows([ newData[i]]);',
'\t\t\t\tcountA++;',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//delete newData; //user might find this helpful. so keep it',
'\tvar name = this.listVariableName;',
'\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t//put in timeout to give list time to refresh before the event fires',
'\tif(lObj._hasDetailView) { ',
'\t\tsetTimeout(function() { ',
'\t\t\t_dlgObj._list_executeEvent(name,\'detailView.afterRefreshListIncremental\',{ rowsUpdated: countU, rowsInserted: countA, rowsDeleted: 0, listId: name});',
'\t\t},0);',
'\t} else { ',
'\t\tsetTimeout(function() { ',
'\t\t\t_dlgObj._list_executeEvent(name,\'afterRefreshListIncremental\',{ rowsUpdated: countU, rowsInserted: countA, rowsDeleted: 0, listId: name});',
'\t\t},100);',
'\t}',
'}',
',',
'\t_flagAutoFetchMore: false,',
'\tfirestoreLogin: function(uid,pw) { alert(\'List is not configured to use Firestore as the data source\') } ,',
'\tfirestoreLogout: function() { alert(\'List is not configured to use Firestore as the data source\') } ,',
'\t_persistListLayout: false,',
'\t_loadPersistedLayout: false,',
'\tsaveLayoutSettings: function() {',
'\t\tvar s = localStorage.listSettings;',
'\t\tif(typeof s == \'undefined\' || s == null) s = {};',
'\t\tif(typeof s == \'string\') {',
'\t\t\ttry{s = JSON.parse(s);}catch(err) {return false;}',
'\t\t}',
'\t\tvar sl = s[this._listGUID];',
'\t\tif(typeof sl == \'undefined\') sl = {};',
'\t\tsl.listVariableName = this.listVariableName;',
'\t\tsl.layouts = this.layouts;',
'\t\tsl.layout = this.layout;',
'\t\ts[this._listGUID] = sl ;',
'\t\tvar str = JSON.stringify(s,\'\',\'\\t\')',
'\t\tlocalStorage.listSettings = str;',
'\t}',
'\t,',
'\tonLayoutUpdate: function(type,args,layoutName) {if(this.saveLayoutSettings) this.saveLayoutSettings();},',
'\trestoreLayoutSettings: function(dlgObj,mode) { ',
'\t\tvar str = localStorage.listSettings;',
'\t\tif(typeof str == \'undefined\' || str == null) {return false;}',
'\t\ttry{var s = JSON.parse(str);}catch(err) {return false;};',
'\t\tvar sl = s[this._listGUID];',
'\t\tif(typeof sl == \'undefined\') {return false;}',
'\t\tif(mode == \'delete\') {',
'\t\t\tdelete s[this._listGUID];',
'\t\t\tvar str = JSON.stringify(s,\'\',\'\\t\')',
'\t\t\tlocalStorage.listSettings = str;',
'\t\t\treturn;',
'\t\t}',
'\t\tif(mode == \'get\') {',
'\t\t\treturn JSON.stringify(sl);',
'\t\t}',
'\t\tthis.layouts = sl.layouts;',
'\t\tthis.layout = sl.layout;',
'\t\tvar listSelector = \'listSelector_\' + sl.listVariableName ;',
'\t\tvar that = this;',
'\t\tsetTimeout(function() {',
'\t\t\tdlgObj.setValue(listSelector,that.layout);',
'\t\t\tdelete that;',
'\t\t},0);',
'\t\tthis.refresh();',
'\t\tthis._flagRestoringLayoutSettings = true;',
'\t}',
',',
'\t_childListsAjax: [],',
'\t_hasDependentLists: false,',
'\t_dataSourceType: \'SQL\',',
'\t_listFields: [',
'{',
'\tname: \'ID\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'ID\\\');\'',
'},',
'{',
'\tname: \'area\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'area\\\');\'',
'},',
'{',
'\tname: \'loginpassword\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'loginpassword\\\');\'',
'},',
'{',
'\tname: \'POISTATUS\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POISTATUS\\\');\'',
'},',
'{',
'\tname: \'POICREDITLIMIT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POICREDITLIMIT\\\');\'',
'},',
'{',
'\tname: \'AMOUNTLIMIT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'AMOUNTLIMIT\\\');\'',
'},',
'{',
'\tname: \'DAYLIMIT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'DAYLIMIT\\\');\'',
'},',
'{',
'\tname: \'PAYMENTMODEID\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'PAYMENTMODEID\\\');\'',
'},',
'{',
'\tname: \'account_type\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'account_type\\\');\'',
'},',
'{',
'\tname: \'POINAME\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POINAME\\\');\'',
'},',
'{',
'\tname: \'POICATEGORY\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POICATEGORY\\\');\'',
'},',
'{',
'\tname: \'POITYPE\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POITYPE\\\');\'',
'},',
'{',
'\tname: \'POISPECIALITY\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POISPECIALITY\\\');\'',
'},',
'{',
'\tname: \'countryid\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'countryid\\\');\'',
'},',
'{',
'\tname: \'DISTRICT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'DISTRICT\\\');\'',
'},',
'{',
'\tname: \'POIDISTRICT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POIDISTRICT\\\');\'',
'},',
'{',
'\tname: \'areaid\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'areaid\\\');\'',
'},',
'{',
'\tname: \'POIREGION\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POIREGION\\\');\'',
'},',
'{',
'\tname: \'POTENTIALITY\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'POTENTIALITY\\\');\'',
'},',
'{',
'\tname: \'LAT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'LAT\\\');\'',
'},',
'{',
'\tname: \'LONT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'LONT\\\');\'',
'},',
'{',
'\tname: \'BESTTIME\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'BESTTIME\\\');\'',
'},',
'{',
'\tname: \'CLASS\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'CLASS\\\');\'',
'},',
'{',
'\tname: \'COMMENT\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'COMMENT\\\');\'',
'},',
'{',
'\tname: \'CONTACTPERSON\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'CONTACTPERSON\\\');\'',
'},',
'{',
'\tname: \'PHONENO\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'PHONENO\\\');\'',
'},',
'{',
'\tname: \'MOBILE\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'MOBILE\\\');\'',
'},',
'{',
'\tname: \'EMAIL\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'EMAIL\\\');\'',
'},',
'{',
'\tname: \'ADDRESS\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'ADDRESS\\\');\'',
'},',
'{',
'\tname: \'STREET\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'STREET\\\');\'',
'},',
'{',
'\tname: \'typename\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'typename\\\');\'',
'},',
'{',
'\tname: \'specialname\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'specialname\\\');\'',
'},',
'{',
'\tname: \'potenname\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'potenname\\\');\'',
'},',
'{',
'\tname: \'classname\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'classname\\\');\'',
'},',
'{',
'\tname: \'regionname\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'regionname\\\');\'',
'},',
'{',
'\tname: \'MEDREP\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'MEDREP\\\');\'',
'},',
'{',
'\tname: \'medrep_id\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'medrep_id\\\');\'',
'},',
'{',
'\tname: \'poiorcust\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'poiorcust\\\');\'',
'},',
'{',
'\tname: \'pricelist\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'pricelist\\\');\'',
'},',
'{',
'\tname: \'poicode\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'poicode\\\');\'',
'},',
'{',
'\tname: \'Categoryname\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'Categoryname\\\');\'',
'},',
'{',
'\tname: \'paimentmodename\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'paimentmodename\\\');\'',
'},',
'{',
'\tname: \'CONFIRMED\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'CONFIRMED\\\');\'',
'},',
'{',
'\tname: \'frequency\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'frequency\\\');\'',
'},',
'{',
'\tname: \'deal\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'deal\\\');\'',
'},',
'{',
'\tname: \'startd\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'startd\\\');\'',
'},',
'{',
'\tname: \'endd\',',
'\tdefaultValue: \'return this._controlDefaultValueForListField(\\\'endd\\\');\'',
'}],',
'\t_delayRenderTillRefresh: false,',
'\t_searchPartHas: false,',
'\t_mediaFields: [],',
'\t_mediaTypes: {',
'},',
'\t_mediaFieldReadOnly: [],',
'\t_ignoreMediaFieldsInWWWSubFolder: false,',
'\t_mediaFieldFolderInWWW: \'\',',
'\t_phoneGap: {',
'\t\tmediaFiles: {',
'\t\t\tfireMediaFileCleanup: false,',
'\t\t\tprotectedRead: false,',
'\t\t\ttemplate: \'\',',
'\t\t\ttarget: \'server\',',
'\t\t\ttargetFilenameFunction: \'return \\\'<DeviceId>_\\\' +e.object.listFieldName + \\\'_\\\' + A5.ts() + \\\'_\\\' +e.name\',',
'\t\t\tshowProgress: false,',
'\t\t\tdownload: {',
'\t\t\t\tautodownloadFilesOnPullSynch: false,',
'\t\t\t\tdeleteOrphansAfterSync: false,',
'\t\t\t\ttargetFolder: \'_AAFiles\',',
'\t\t\t\tshowProgress: false,',
'\t\t\t\ttargetFileSystem: \'persistent\'',
'\t\t\t},',
'\t\t\tonErrorFunction: function(e) { }',
'\t\t}',
'\t},',
'\t_incrementalRefreshAfterLoad: function() { },',
'\t_dvmode: \'enter\',',
'\t_hasDetailView: false,',
'\t_optimizeSync: false,',
'\tdeselectAll: function() { ',
'\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t_dlgObj.setValue(this.listVariableName,\'\',true);',
'\tthis._deselectAll();',
'\tif(this.nullOutDetailViewRecord) {',
'\t\tthis.nullOutDetailViewRecord();',
'\t\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\t\tvar lname = this.childLists[i];',
'\t\t\tvar lobjC = {UXPRERENDEREDALIAS}_DlgObj.getControl(lname);',
'\t\t\tlobjC.nullOutDetailViewRecord();',
'\t\t}',
'\t\tif(this._noRecordInListIsSelectedSettingForDetailView ==  \'disabledetailview\') {',
'\t\t\tthis.disableDetailView()',
'\t\t\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\t\t\tvar lname = this.childLists[i];',
'\t\t\t\tvar lobjC = {UXPRERENDEREDALIAS}_DlgObj.getControl(lname);',
'\t\t\t\tlobjC.disableDetailView();',
'\t\t\t}',
'\t\t}',
'\t}',
'}',
',',
'\tshowHideColumn: function(columnNumber,flagShow,layoutName,flagSetShowState) { \tif(typeof flagSetShowState == \'undefined\') flagSetShowState  = false; //set when this function called from listColumnSelector()',
'\tif(typeof layoutName == \'undefined\') layoutName = this.layout;',
'\tif(this.layouts[layoutName].columns[columnNumber].show != flagShow) {',
'\t\tthis.layouts[layoutName].columns[columnNumber].show = flagShow;',
'\t\tif(flagSetShowState) this.layouts[layoutName].columns[columnNumber]._showState = flagShow;',
'\t\tthis.refresh();',
'\t}',
'}',
',',
'\tshowAllColumns: function() { ',
'\tvar l = this.layouts',
'\tvar c = \'\';',
'\tvar flagRefresh = false;',
'\tfor(var n in l) {',
'\t\tc = l[n].columns;',
'\t\tif(typeof c != \'undefined\') {',
'\t\t\tfor(var i = 0; i < c.length; i++) {',
'\t\t\t\tif(!c[i].initialStateHidden) {',
'\t\t\t\t\tvar flag = true',
'\t\t\t\t\tif(typeof c[i]._showState != \'undefined\') {',
'\t\t\t\t\t\tif(!c[i]._showState) flag = false;',
'\t\t\t\t\t}',
'\t\t\t\t\tif(flag && !c[i].show) {',
'\t\t\t\t\t\tc[i].show = true;',
'\t\t\t\t\t\tflagRefresh = true;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(flagRefresh) {',
'\t\tthis.refresh();',
'\t}',
'}',
',',
'\t_hideColumns: function() { ',
'}',
',',
'\ttheme: \'Alpha-Magenta\',',
'\tscroll: {',
'\t\taxis: \'both\',',
'\t\tindicator: {',
'\t\t\tshow: true,',
'\t\t\th: {',
'\t\t\t\tshow: true,',
'\t\t\t\tlocation: \'top\',',
'\t\t\t\toffset: \'0px\',',
'\t\t\t\tleft: \'0px\',',
'\t\t\t\tright: \'0px\'',
'\t\t\t},',
'\t\t\tv: {',
'\t\t\t\tshow: true,',
'\t\t\t\tlocation: \'right\',',
'\t\t\t\toffset: \'0px\',',
'\t\t\t\ttop: \'0px\',',
'\t\t\t\tbottom: \'0px\'',
'\t\t\t}',
'\t\t},',
'\t\tmomentum: {',
'\t\t\tallow: true,',
'\t\t\tfriction: 4,',
'\t\t\tduration: 1000',
'\t\t},',
'\t\tpull: {',
'\t\t\ty: \'auto\',',
'\t\t\tx: \'auto\'',
'\t\t}',
'\t},',
'\tlayout: \'Default\',',
'\tcalculateValue: \'\',',
'\tdirtyControlClassName: \'\',',
'\tlistVariableName: \'LIST1\',',
'\tlistVariableNameTrueCase: \'LIST1\',',
'\t_hostComponentId: \'{UXPRERENDEREDALIAS}\',',
'\t_includeCRC: true,',
'\tparentList: \'\',',
'\tallParentLists: [],',
'\t_inplaceEditing: {',
'\t\tallow: false',
'\t},',
'\t__hasEmbeddedDetailView: false,',
'\tonBeforeListClear: function() {},',
'\t__flagPersist: false,',
'\t__flagIncrementalRefreshAfterLoad: false,',
'\tonBeforePopulate: function(data) {this.__onPopulateHasFired = false;',
'},',
'\tonPopulate: function(data) {if(!this._isInit) {if (typeof window[\'cordova\'] == \'undefined\') {',
'\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: \'fullRefresh\' });',
'}',
';this._executeEvent(\'onListReady\',{});};},',
'\tonBeforeUpdateRow: function(index,data){;},',
'\tonUpdateRow: function(index,data){;},',
'\tonBeforeAddRows: function(data,info){;},',
'\tonAddRows: function(data,info){;},',
'\tonBeforeRemoveRows: function(rows){;},',
'\tonRemoveRows: function(rows){;},',
'\tonResize: function(){var l = this.layout;',
'if(this.layouts[l].type == \'column\') {',
'\tvar flagRefresh = false; //prevent multiple refreshes from being done',
'\tif(this.layouts[l]._hasRCW) {',
'\t\tvar w = $(this.contId).offsetWidth;',
'\t\tif(typeof this._w == \'undefined\') {',
'\t\t\tflagRefresh = true;',
'\t\t\tthis._w = w;',
'\t\t} else {',
'\t\t\tif(this._w != w) flagRefresh = true;',
'\t\t\tthis._w = w;',
'\t\t}',
'\t\tvar _c = this.layouts[l].columns;',
'\t\tfor(var i = 0; i < _c.length; i++) {',
'\t\t\tif(_c[i].rcw) {',
'\t\t\t\tif(_c[i].rcw != \'\' && Number(_c[i].rcw) > 0) {',
'\t\t\t\t\tif(typeof _c[i]._show == \'undefined\') _c[i]._show = _c[i].show;',
'\t\t\t\t\tif(_c[i]._show == _c[i].show) {',
'\t\t\t\t\t\tif(Number(_c[i].rcw) >= w) {',
'\t\t\t\t\t\t\t_c[i].show = false;',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t_c[i].show = true;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\t_c[i]._show = _c[i].show;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tvar that = this;',
'\t\tsetTimeout(function() {',
'\t\t\tif(flagRefresh) that.refresh();',
'\t\t\tconsole.log(\'refresh\');',
'\t\t},0);',
'\t}',
'}',
';},',
'\tchildLists: [],',
'\tchildListEndpoints: [\'LIST1\'],',
'\t_populateAllChildLists: function() { },',
'\tonSelect: function() {{UXPRERENDEREDALIAS}_DlgObj._listRowSelect(\'LIST1\',this);',
' this._selectedRow = this.selection[0];if(typeof this._selectedRow != \'undefined\') { var that = this; setTimeout(function() { if(typeof {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL != \'undefined\') { ',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL[\'LIST1\'] != \'undefined\') {',
'\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__listsWithChildLWL[\'LIST1\'];',
'\t\tvar lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LIST1\');',
'\t\tvar r = lObj.selection[0];',
'\t\tvar _d = lObj._data[r];',
'\t\tvar linkValue = _d[obj.listPrimaryKey];',
'\t\tvar id = obj.lwlName;',
'\t\tvar linkField = obj.listPrimaryKey',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.refreshLinkedSpreadsheet(id,linkValue,linkField)',
'\t}',
'}',
'},50);};;',
'this._selectedRow = this.selection[0];',
';},',
'\tonFirestoreAuthStatechanged: function(e) {if(e.isLoggedIn) { ',
'\tvar lObj = this.dialogObject.getControl(this.listName)',
'\tlObj.onFirestoreLogin(e)',
'}',
'},',
'\tgroup: {',
'\t\tcontinued: {',
'\t\t\twrap: false',
'\t\t}',
'\t},',
'\tlayouts: {',
'\t\tDefault: {',
'\t\t\tgroup: {',
'\t\t\t\tauto: false',
'\t\t\t},',
'\t\t\ttype: \'column\',',
'\t\t\tshowColumnTitles: true,',
'\t\t\titem: {',
'\t\t\t\tclassName: \'\',',
'\t\t\t\thoverClassName: \'\',',
'\t\t\t\tselectedClassName: \'\',',
'\t\t\t\tstyle: \'\',',
'\t\t\t\ttitleClassName: \'\',',
'\t\t\t\tseparatorClassName: \'\'',
'\t\t\t},',
'\t\t\tfixedFooterDefinition: \'[]\',',
'\t\t\tfixedFooterJS: \'\',',
'\t\t\tfixedFooterCSJS: \'\',',
'\t\t\tcolumns: [',
'\t\t\t{',
'\t\t\t\theader: {',
'\t\t\t\t\thtml: \'Poicode\'',
'\t\t\t\t},',
'\t\t\t\tseparator: {',
'\t\t\t\t\tlocation: \'none\',',
'\t\t\t\t\tstyle: \'background-color: gray;\',',
'\t\t\t\t\twidth: \'1px\'',
'\t\t\t\t},',
'\t\t\t\t_name: \'poicode\',',
'\t\t\t\t_type: \'\',',
'\t\t\t\tresize: false,',
'\t\t\t\trcw: 0,',
'\t\t\t\tdata: {',
'\t\t\t\t\ttemplate: \'<span id="{UXPRERENDEREDALIAS}.LIST1.POICODE.I.{*dataRow}">{poicode}</span>\'',
'\t\t\t\t},',
'\t\t\t\torder: \'poicode\',',
'\t\t\t\twidth: \'flex(1)\'',
'\t\t\t},',
'\t\t\t{',
'\t\t\t\theader: {',
'\t\t\t\t\thtml: \'POINAME\'',
'\t\t\t\t},',
'\t\t\t\tseparator: {',
'\t\t\t\t\tlocation: \'none\',',
'\t\t\t\t\tstyle: \'background-color: gray;\',',
'\t\t\t\t\twidth: \'1px\'',
'\t\t\t\t},',
'\t\t\t\t_name: \'POINAME\',',
'\t\t\t\t_type: \'\',',
'\t\t\t\tresize: false,',
'\t\t\t\trcw: 0,',
'\t\t\t\tdata: {',
'\t\t\t\t\ttemplate: \'<span id="{UXPRERENDEREDALIAS}.LIST1.POINAME.I.{*dataRow}">{POINAME}</span>\'',
'\t\t\t\t},',
'\t\t\t\torder: \'POINAME\',',
'\t\t\t\twidth: \'flex(3)\'',
'\t\t\t},',
'\t\t\t{',
'\t\t\t\theader: {',
'\t\t\t\t\thtml: \'Sel\'',
'\t\t\t\t},',
'\t\t\t\t_name: \'sel\',',
'\t\t\t\t_type: \'\',',
'\t\t\t\tresize: false,',
'\t\t\t\trcw: 0,',
'\t\t\t\tdata: {',
'\t\t\t\t\ttemplate: \'<span id="{UXPRERENDEREDALIAS}.LIST1.SEL.I.{*dataRow}"><button  a5-item="_systemButtononClick_sel"  id="{UXPRERENDEREDALIAS}.LIST1.SEL.BTN.{*dataRow}"  class="button" style="cursor:pointer;" title="">Select</button></span>&nbsp;\'',
'\t\t\t\t},',
'\t\t\t\torder: false,',
'\t\t\t\twidth: \'flex(1)\'',
'\t\t\t}],',
'\t\t\t_hasRCW: false,',
'\t\t\t_horizontalScrolling: false,',
'\t\t\t_hasColumnSeparators: false',
'\t\t}',
'\t},',
'\tcolumnSeparators: function(state) { \t\t\t\tvar lyt = this.layouts[this.layout];',
'\t\t\t\tif(lyt.type != \'column\') return;',
'\t\t\t\tvar c = lyt.columns',
'\t\t\t\tfor(var i = 0; i < c.length; i++) {',
'\t\t\t\t\tif(state == \'off\') c[i].separator.location = \'none\';',
'\t\t\t\t\tif(state == \'on\') {',
'\t\t\t\t\t\tc[i].separator.location = \'right\';',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tthis.refresh();',
'\t\t\t}',
'\t\t\t,',
'\t__checkedImage: \'svgIcon=#alpha-icon-checkCircle:icon,24\',',
'\t__uncheckedImage: \'svgIcon=#alpha-icon-circle:icon,24\',',
'\tonListDraw: function(data,startIndex) {',
'this._allrowschecked = true;',
'var d = this._rData;',
'for(var i = 0; i < d.length; i++) {',
'\tif(!d[i].__selected) {',
'\t\tthis._allrowschecked = false;',
'\t\tbreak;',
'\t}',
'}',
'if (d.length == 0) this._allrowschecked = false;',
'var h ;',
'if(this._allrowschecked) {',
'\th = A5.u.icon.html(this.__checkedImage);',
'} else {',
'\th = A5.u.icon.html(this.__uncheckedImage);',
'}',
'var _id = \'{UXPRERENDEREDALIAS}.\' + this.listVariableName + \'.CHECKBOXALL\';',
'var ele = $(_id)',
'ele.innerHTML = h',
'},',
'\tcaptureFocus: true,',
'\tcontent: {',
'\t\theader: {',
'\t\t\tshow: false',
'\t\t},',
'\t\tfooter: {',
'\t\t\tshow: false',
'\t\t}',
'\t},',
'\tsystemEvents: {',
'\t\tonBeforeDestroy: function(e) {},',
'\t\tonTap: function(e) {},',
'\t\tafterAjaxCallback: function(e) {},',
'\t\tafterClientSideFilter: function(e) {},',
'\t\tbeforeServerSideSort: function(e) {},',
'\t\tafterServerSideSort: function(e) {},',
'\t\tonSwipe: function(e) {},',
'\t\tonScroll: function(e) {},',
'\t\tonPullRelease: function(e) {},',
'\t\tonPull: function(e) {},',
'\t\tonPullEnd: function(e) {},',
'\t\tafterSearchComplete: function(e) {},',
'\t\tbeforeSearch: function(e) {},',
'\t\tonSearchResultTooLarge: function(e) {},',
'\t\tonSearchResultTooLargeForLocalStorage: function(e) {},',
'\t\tonBeforePersistToLocalStorage: function(e) {},',
'\t\tonPersistToLocalStorage: function(e) {},',
'\t\tonRestoreFromLocalStorage: function(e) {},',
'\t\tonListReady: function(e) {},',
'\t\tafterRenderComplete: function(e) {},',
'\t\tbeforeFetchMore: function(e) {},',
'\t\tafterFetchMore: function(e) {},',
'\t\tbeforePageNavigate: function(e) {},',
'\t\tafterPageNavigate: function(e) {},',
'\t\tbeforeRefreshRow: function(e) {},',
'\t\tafterRefreshRow: function(e) {},',
'\t\tafterRefreshData: function(e) {},',
'\t\tafterServerSideSummaryCompute: function(summary) {},',
'\t\tafterRefreshListIncremental: function(e) {},',
'\t\tonNamedQuerySelect: function(e) {},',
'\t\tonFirestoreAuthStateChanged: function(e) {},',
'\t\tonFirestoreLogin: function(e) {},',
'\t\tonFirestoreLogout: function(e) {},',
'\t\tdetailView: {',
'\t\t\t_afterRefreshListIncremental: function() { ',
'if (typeof window[\'cordova\'] == \'undefined\') {',
'\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: \'incrementalRefresh\' });',
'}',
'}',
'\t\t},',
'\t\t_afterRenderComplete: function(e) {',
'},',
'\t\t_afterAjaxCallback: function() {this._refreshStateMessages();}',
'\t},',
'\tonBeforeDestroy: function() {if(this._transient) { ',
'\tthis._transient.destroy()',
'\tdelete this._transient;',
'}',
'},',
'\t_clientsideSummary: [],',
'\tcomputeClientSideSummaryValues: function(e) {},',
'\t_executeEvent: function(event,obj) { ',
'\treturn {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(\'LIST1\',event,obj);',
'}',
',',
'\t_selectAll: function() {',
'\tvar v = this._values;',
'\tvar v2 = [].concat(v);',
'\tthis.setValue(v2,false);',
'}',
',',
'\tsearchList: function() { ',
'\tif(this._searchPartStyle == \'querybyform\') {',
'\t\tif(this._dvmode != \'search\') return false;',
'\t}',
'\tif(typeof this.detailViewIsDirty == \'function\') {',
'\t\tif(this.detailViewIsDirty()) {',
'\t\t\t\tif(this._autoCommitDetailView) {',
'\t\t\t\t\t//this.updateListFromUXControls(); ?why was this on? it saves the qbf def as a new record',
'\t\t\t\t}',
'\t\t}',
'\t}',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar mode = \'serverSide\';',
'\tif(typeof obj.searchMode != \'undefined\') mode = obj.searchMode;',
'\tmode = mode.toLowerCase();',
'\tif(mode.indexOf(\'auto\') == 0) {',
'\t\tvar flagCS = false;',
'\t\tif(typeof this.detailViewIsDirty == \'function\') {',
'\t\t\tif(this.listIsDirty() || this.detailViewIsDirty()) flagCS = true;',
'\t\t} else {',
'\t\t\tif(this.listIsDirty()) flagCS = true;',
'\t\t}',
'\t\tif(flagCS) mode = \'clientside\';',
'\t\telse {',
'\t\t\tif(this._dataSourceType.toLowerCase() == \'sql\' || this._dataSourceType.toLowerCase() == \'dbf\' || this._dataSourceType.toLowerCase() == \'firestore\' || this._dataSourceType.toLowerCase() == \'mongodb\' ) {',
'\t\t\t\tmode = \'serverside\';',
'\t\t\t} else {',
'\t\t\t\tmode = \'clientside\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(this._dataSourceType.toLowerCase() == \'static\') mode = \'clientside\';',
'\tvar parentList = this.parentList;',
'\tif(typeof parentList != \'undefined\') {',
'\t\tif(parentList != \'\') mode = \'clientside\';',
'\t}',
'\tvar flagDirty = false;',
'\tif(this.listIsDirty) flagDirty = this.listIsDirty();',
'\tvar flagResult = {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'beforeSearch\',{searchMode: \'search\', searchWhere: mode, listIsDirty: flagDirty});',
'\tif(!flagResult) return false;',
'\tif(mode == \'serverside\') {',
'\t\tthis._searchListServerSide(obj);',
'\t} else if(mode == \'clientside\') {',
'\t\tthis._searchPartSubmit_clientSideFilter();',
'\t\tvar rowCount = this._rData.length;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'afterSearchComplete\',{searchMode: \'search\', searchWhere: mode, recordsInQuery: rowCount});',
'\t}',
'}',
',',
'\t_searchListServerSide: function() { ',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar _d={};',
'\tvar flagDirty = false;',
'\tif(this.listIsDirty) flagDirty = this.listIsDirty();',
'\tif(flagDirty) {',
'\t\talert(\'Can\\\'t execute server-side search because List has edits that have not yet been synchronized.\');',
'\t\treturn false;',
'\t}',
'\t_d.listId = this.listVariableName',
'\tvar _data = A5.ajax.buildURLParam(\'__searchInfo\',JSON.stringify(_d));',
'\t_data = _data + \'&\' + A5.ajax.buildURLParam(\'__searchOptions\',JSON.stringify(obj));',
'\tthis.filter = false;',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:ListSearchPart\',\'\',_data);',
'}',
',',
'\tsetListSize: function(height,width) {',
'\tvar l = $(this.contId);',
'\tif(typeof height != \'undefined\') l.style.height = \'\'+ height;',
'\tif(typeof width != \'undefined\') l.style.width = \'\' + width;',
'\tthis.resize();',
'}',
',',
'\tclearSearchList: function() { ',
'\tvar obj = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'\tvar mode = \'serverSide\';',
'\tif(typeof obj.searchMode != \'undefined\') mode = obj.searchMode;',
'\tmode = mode.toLowerCase();',
'\tif(mode.indexOf(\'auto\') == 0) {',
'\t\tif(this.listIsDirty()) mode = \'clientside\';',
'\t\telse mode = \'serverside\';',
'\t}',
'\tif(this._dataSourceType.toLowerCase() == \'static\') mode = \'clientside\';',
'\tvar parentList = this.parentList;',
'\tif(typeof parentList != \'undefined\') {',
'\t\tif(parentList != \'\') mode = \'clientside\';',
'\t}',
'\tvar flagResult = {UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'beforeSearch\',{searchMode: \'clear\', searchWhere: mode});',
'\tif(!flagResult) return false;',
'\tif(mode == \'serverside\') {',
'\t\tthis._clearSearchListServerSide();',
'\t} else if(mode == \'clientside\') {',
'\t\tthis._searchPartSubmit_clientSideFilterClear();',
'\t\tvar rowCount = this._rData.length;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(this.listVariableName,\'afterSearchComplete\',{searchMode: \'clear\', searchWhere: mode, recordsInQuery: rowCount});',
'\t}',
'}',
',',
'\t_clearSearchListServerSide: function() { ',
'\tvar _d={};',
'\t_d.listId = this.listVariableName',
'\tvar _data = A5.ajax.buildURLParam(\'__searchInfo\',JSON.stringify(_d));',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:ListSearchPartClear\',\'\',_data);',
'}',
',',
'\t_str: function(txt) {',
'\ttxt = txt.replace("\'","\\\\\'");',
'\ttxt = \'\\\'\' + txt + \'\\\'\';',
'\treturn txt;',
'}',
',',
'\t_QBF: function(txt) { ',
'\tvar o = {};',
'\to.v2 = \'\';',
'\to.v1 = txt;',
'\to.flag = false;',
'\tif(txt.indexOf(\'>=\') >= 0) {',
'\t\to.op = \'>=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'<=\') >= 0 ) {',
'\t\to.op = \'<=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'>\') >= 0 ) {',
'\t\to.op = \'>\';',
'\t\to.v1 = txt.substr(1);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'<\') >= 0)  {',
'\t\to.op = \'<\';',
'\t\to.v1 = txt.substr(1);',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'..\') == 0)  {',
'\t\to.op = \'<=\';',
'\t\to.v1 = txt.substr(2);',
'\t\to.flag = true;',
'\t} else if ( txt.indexOf(\'..\', txt.length - \'..\'.length) !== -1 ) {',
'\t\t//ends with ..',
'\t\to.op = \'>=\';',
'\t\ttxt = txt.split(\'..\')',
'\t\to.v1 = txt[0];',
'\t\to.flag = true;',
'\t} else if (txt.indexOf(\'..\') > 0 ) {',
'\t\to.op = \'between\'',
'\t\ttxt = txt.split(\'..\');',
'\t\to.v1 = txt[0];',
'\t\to.v2 = txt[1];',
'\t\to.flag = true;',
'\t}',
'\treturn o;',
'}',
',',
'\t_match: function(data,field,val,obj) { ',
'\tif(obj.qbf && obj.type == \'c\') val = $u.s.rTrim(val,\',\');',
'\tvar flagKeyword = false;',
'\tif(typeof obj.flagKeyword != \'undefined\') flagKeyword = obj.flagKeyword;',
'\tif(flagKeyword) {',
'\t\tvar _field = field',
'\t\t//if(_field.indexOf(\'.\') > -1) _field = _field.split(\'.\')[1]',
'\t\t_field = _field.toUpperCase()',
'\t\tvar obj_i = this._searchFieldOptions[_field];',
'\t\tthis._setSearchOps(obj,obj_i);',
'\t\tfield = obj_i.searchField',
'\t\tconsole.log(field)',
'\t}',
'\tvar _d = \'\';',
'\tvar _v = val;',
'\tvar flagC = false;',
'\tif(obj.type == \'c\') {',
'\t\tflagC = true;',
'\t\tif(!obj.caseSensitive) _v = _v.toLowerCase();',
'\t} else {',
'\t\t//non mumeric searches are only mode 1 or -1',
'\t\tif(obj.mode > 1) obj.mode = 1;',
'\t\tif(obj.mode < -1) obj.mode = -1;',
'\t}',
'\tvar flag = false;',
'\tobj.usesQBFOperator = false;',
'\tif(obj.qbf) {',
'\t\t_v = _v.split(\',\');',
'\t} else {',
'\t\t_v = [_v];',
'\t}',
'\tvar o = {}',
'\tvar r = \'\';',
'\tvar _vals = [];',
'\tfor(var i = 0; i < _v.length; i++) {',
'\t\tif(obj.qbf) {',
'\t\t\to = this._QBF(_v[i]);',
'\t\t} else {',
'\t\t\to.flag = false;',
'\t\t\to.v1 = _v[i];',
'\t\t\to.v2 = \'\';',
'\t\t}',
'\t\tif(typeof data[field] != \'undefined\') {',
'\t\t\tif(data[field] != null) {',
'\t\t\t\t_d = \'\' + data[field];',
'\t\t\t\tif(obj.type == \'n\') {',
'\t\t\t\t\to.v1 = Number(o.v1);',
'\t\t\t\t\to.v2 = Number(o.v2);',
'\t\t\t\t\t_d = Number(_d);',
'\t\t\t\t} else if (obj.type == \'l\') {',
'\t\t\t\t\to.v1 = $u.s.toBool(o.v1);',
'\t\t\t\t\to.v2 = $u.s.toBool(o.v2);',
'\t\t\t\t\t_d = $u.s.toBool(_d);',
'\t\t\t\t} else if (obj.type == \'d\') {',
'\t\t\t\t\to.v1 = A5.stringToDate(o.v1,obj.dateFormat);',
'\t\t\t\t\to.v2 = A5.stringToDate(o.v2,obj.dateFormat);',
'\t\t\t\t\tif(typeof _d == \'string\') _d = A5.stringToDate(_d,obj.dateFormat);',
'\t\t\t\t\tif(o.v1 != \'\' && o.v1 != null ) o.v1 = o.v1.getTime();',
'\t\t\t\t\tif(o.v2 != \'\' && o.v2 != null ) o.v2 = o.v2.getTime();',
'\t\t\t\t\tif(_d != \'\' && _d != null ) _d = _d.getTime();',
'\t\t\t\t}',
'\t\t\t\tif(flagC) {if(!obj.caseSensitive && typeof _d == \'string\') _d = _d.toLowerCase();}',
'\t\t\t\tif(o.flag) {',
'\t\t\t\t\t//has qbf operators',
'\t\t\t\t\tif(o.op == \'between\') {',
'\t\t\t\t\t\tif(flagC) {',
'\t\t\t\t\t\t\tif(_d.substr(0,o.v1.length) >= o.v1 && _d.substr(0,o.v2.length) <= o.v2 ) flag = true;',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(_d >= o.v1 && _d <= o.v2 && (typeof _d == typeof o.v1)  ) flag = true;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(flagC) _d = _d.substr(0,o.v1.length)',
'\t\t\t\t\t\tif(o.op == \'>=\') if( _d >= o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'<=\') if( _d <= o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'>\') if(_d > o.v1) flag = true;',
'\t\t\t\t\t\tif(o.op == \'<\') if(_d < o.v1) flag = true;',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tif(obj.mode == 1 || obj.mode == -1 ) {',
'\t\t\t\t\t\tif(obj.mode == 1) if(_d == o.v1) flag = true;; //match',
'\t\t\t\t\t\tif(obj.mode == -1) if(!(_d == o.v1)) flag = true;; //match',
'\t\t\t\t\t} else if (obj.mode == 2 || obj.mode == -2) {',
'\t\t\t\t\t\tif(obj.mode == 2) if(_d.indexOf(o.v1) > -1) flag = true; //contains',
'\t\t\t\t\t\tif(obj.mode == -2) if(!(_d.indexOf(o.v1) > -1)) flag = true;',
'\t\t\t\t\t} else if (obj.mode == 3 || obj.mode == -3) {',
'\t\t\t\t\t\tif(obj.mode == 3) if(_d.indexOf(o.v1) == 0) flag = true; //starts with',
'\t\t\t\t\t\tif(obj.mode == -3) if(!(_d.indexOf(o.v1) == 0)) flag = true; //starts with',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(o.v1 != \'\') {',
'\t\t\t\t\tif(_vals.indexOf(o.v1) == -1) {',
'\t\t\t\t\t\t_vals.push(o.v1);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(o.v2 != \'\') {',
'\t\t\t\t\tif(_vals.indexOf(o.v2) == -1) {',
'\t\t\t\t\t\t_vals.push(o.v2);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(flag) {',
'\t\tif(typeof this._state.highlight == \'undefined\') this._state.highlight = {};',
'\t\tthis._state.highlight[field.toUpperCase()] = _vals;',
'\t} else {',
'\t\t//this._state.highlight[field.toUpperCase()] = [];',
'\t}',
'\treturn flag;',
'}',
',',
'\t_setSearchOps: function(obj,obj_i) { ',
'\tobj.mode = obj_i.option;',
'\tobj.qbf = obj_i.qbf;',
'\tobj.type = obj_i.type;',
'\t//obj.treatAs = obj_i.treatAs;',
'}',
',',
'\t_searchPartOperator: \'&&\',',
'\t_searchPartSubmit_clientSideFilter: function() { ',
'\tif(!this._searchPartHas) return true;',
'\t//_searchPartStyle: \'individualcontrols\'',
'\tthis._state.highlight = {};',
'\tif(this._searchPartStyle == \'singlekeywordcontrol\') {',
'\t\tvar searchFor = {UXPRERENDEREDALIAS}_DlgObj.getValue(this._keywordSearchControl);',
'\t\tvar arr = this._keywordSearchFields;',
'\t\tvar expn = [];',
'\t\tvar expn_i = \'\';',
'\t\tvar obj = {};',
'\t\t//obj.caseSensitive = false;',
'\t\t//obj.qbf = true;',
'\t\t//obj.mode = 1;',
'\t\tobj.flagKeyword = true;',
'\t\tvar objStr = JSON.stringify(obj)',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\texpn_i = \'this._match(data,\' +this._str(arr[i]) + \',\' + this._str(searchFor) + \',\'+objStr+\')\';',
'\t\t\texpn.push(expn_i);',
'\t\t}',
'\t\texpn = expn.join(\'||\');',
'\t\t//alert(expn);',
'\t} else if ( this._searchPartStyle == \'individualcontrols\' || this._searchPartStyle == \'querybyform\'  ) {',
'\t\tvar map = this._searchPart.fieldMap;',
'\t\tvar val = \'\';',
'\t\tvar expn = [];',
'\t\tvar expn_i = \'\';',
'\t\tvar obj = {};',
'\t\tobj.caseSensitive = false;',
'\t\t//obj.qbf = true;',
'\t\t//obj.mode = 2;',
'\t\t//var objStr = JSON.stringify(obj)',
'\t\tvar ac = [];',
'\t\tvar aco = {};',
'\t\tvar _highlight = {};',
'\t\tif(this._searchPartStyle == \'individualcontrols\') {',
'\t\t\tfor(var i = 0; i < map.length; i++) {',
'\t\t\t\tval = {UXPRERENDEREDALIAS}_DlgObj.getValue(map[i].control);',
'\t\t\t\tif(val != \'\') {',
'\t\t\t\t\tobj_i = this._searchFieldOptions[map[i].field.toUpperCase()];',
'\t\t\t\t\tthis._setSearchOps(obj,obj_i);',
'\t\t\t\t\texpn_i = \'this._match(data,\' +this._str(map[i].field) + \',\' + this._str(val) + \',\'+JSON.stringify(obj)+\')\';',
'\t\t\t\t\texpn.push(expn_i);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t} else if (this._searchPartStyle == \'querybyform\' ) {',
'\t\t\tvar controlName = \'\';',
'\t\t\tfor(var i = 0; i < this._listFields.length; i++) {',
'\t\t\t\tcontrolName = this._getUXDetailViewControlName(this._listFields[i].name);',
'\t\t\t\tif(controlName != \'\') {',
'\t\t\t\t\tval = {UXPRERENDEREDALIAS}_DlgObj.getValue(controlName);',
'\t\t\t\t\tif(val != \'\') {',
'\t\t\t\t\t\t//obj_i = this._searchFieldOptions[map[i].field.toUpperCase()];',
'\t\t\t\t\t\tobj_i = this._searchFieldOptions[this._listFields[i].name.toUpperCase()];',
'\t\t\t\t\t\tthis._setSearchOps(obj,obj_i);',
'\t\t\t\t\t\texpn_i = \'this._match(data,\' +this._str(this._listFields[i].name) + \',\' + this._str(val) + \',\'+JSON.stringify(obj)+\')\';',
'\t\t\t\t\t\texpn.push(expn_i);',
'\t\t\t\t\t\taco.control = controlName;',
'\t\t\t\t\t\taco.value = val;',
'\t\t\t\t\t\tac.push(aco);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tthis.__queryByFormValues = ac;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._setDVClean(this);',
'\t\t}',
'\t\tvar operator = \'&&\';',
'\t\tif(typeof this._searchPartOperator != \'undefined\') operator = this._searchPartOperator;',
'\t\texpn = expn.join(\' \'+operator+\' \');',
'\t}',
'\tif (this._showSearchDebugInfo) {',
'\t\tvar ele = $(\'{UXPRERENDEREDALIAS}.V.R1.\' + this._searchDebugPH);',
'\t\tif(ele) ele.innerHTML = expn;',
'\t}',
'\t//user did not fill in any search fields',
'\tif(expn == \'\') return true;',
'\tvar fnTxt = \'if(\' + expn + \') {return true;} else { return false;}\'',
'\tvar searchFunction = new Function(\'data\',fnTxt);',
'\tthis.setFilter(searchFunction);',
'\tif(this._rData.length > 0) this.setValue(0);',
'}',
',',
'\t_searchPartSubmit_clientSideFilterClear: function() { ',
'if(!this._searchPartHas) return true;',
'\tthis._state.highlight = {};',
'\tthis.setFilter(false);',
'\tvar map = this._searchPart.fieldMap;',
'\tvar val = \'\';',
'\tvar od = {UXPRERENDEREDALIAS}_DlgObj.originalValues[0];',
'\tfor(var i = 0; i < map.length; i++) {',
'\t\tvar val = od[map[i].control.toUpperCase()];',
'\t\t//selwyn 8/6/20 -- used to be false, but then the floating label is not resotred to its initial position when the form is cleared',
'\t\tif(typeof val != \'undefined\') {UXPRERENDEREDALIAS}_DlgObj.setValue(map[i].control,val,false);',
'\t}',
'\tthis.setFilter(false);',
'\tdelete this.__queryByFormValues;',
'\t{UXPRERENDEREDALIAS}_DlgObj._setDVClean(this);',
'\tif(this._data.length > 0) this.setValue(0);',
'\tif (this._showSearchDebugInfo) {',
'\t\tvar ele = $(\'{UXPRERENDEREDALIAS}.V.R1.\' + this._searchDebugPH);',
'\t\tif(ele) ele.innerHTML = \'\';',
'\t}',
'}',
',',
'\tdetailViewIsDirty: function() { return false; },',
'\tpopulateUXControls: function() { return true; },',
'\tlistIsDirty: function() { return false; },',
'\tlookupValue: function(key,name,keyValue) {',
'\tvar _d = this._data;',
'\tvar indx = A5FindPropInArray(_d,key,keyValue);',
'\tvar rv = \'\';',
'\tif(indx >=0) {',
'\t\tif(name == \'__rowData__\') return _d[indx];',
'\t\trv =  _d[indx][name];',
'\t} else {',
'\t\t//null out all properties in row',
'\t\tvar _d2 = {};',
'\t\tif(typeof _d[0] == \'undefined\') { return {}} ;',
'\t\tfor(var n in _d[0]) {',
'\t\t\t_d2[n] = \'&nbsp;\';',
'\t\t}',
'\t\trv = _d2;',
'\t}',
'\treturn rv;',
'}',
',',
'\tallowNullSelection: true,',
'\tallowTextSelection: false,',
'\tallowAnyValue: false,',
'\tallowNullDeselection: false,',
'\tloopNavigate: false,',
'\tloopNavigateNullSelection: false,',
'\trefreshChildLists: function() {{UXPRERENDEREDALIAS}_DlgObj._listRefreshCascadingLists(\'LIST1\'); },',
'\trowExpander: function(rowNumber) { ',
'\tvar mode = typeof arguments[2] != \'undefined\' ? arguments[2] : \'toggle\';',
'\tif(typeof rowNumber === \'undefined\' || rowNumber === \'\' ) {',
'\t\trowNumber = this.selection[0];',
'\t\tif(typeof rowNumber == \'undefined\') return false;',
'\t}',
'\tvar animObj = typeof arguments[1] != \'undefined\' ? arguments[1] : {};',
'\tvar ele = $(this._hostComponentId + \'.\' + this.listVariableName + \'.ROWEXPANDER.\' + rowNumber);',
'\tif(ele) {',
'\t\tif(mode == \'toggle\') A5.u.element.toggle(ele,animObj);',
'\t\tif(mode == \'show\') A5.u.element.show(ele,animObj);',
'\t\tif(mode == \'hide\') A5.u.element.hide(ele,animObj);',
'\t}',
'}',
',',
'\tafterClientSideSummaryCompute: function(csSummary) { },',
'\tselectCurrentLayout: function(name) {',
'if(this._flagRestoringLayoutSettings) {',
'\tthis._flagRestoringLayoutSettings = false;',
'\treturn;',
'}',
'var pl = this.layouts[name];',
'if(typeof pl == \'undefined\') return false;',
'this.setLayout(name);',
'if(pl.type == \'column\') {',
'\tthis.columnLayout.header.show = this.layouts[name].showColumnTitles;',
'\tthis.refresh();',
'}',
'var flagPersist = this._persistListLayout;',
'if(flagPersist && this.saveLayoutSettings ) this.saveLayoutSettings()',
'},',
'\tonFilter: function() { \tvar e = {};',
'\te.rowCount = this._values.length;',
'\tvar ele = $(\'{UXPRERENDEREDALIAS}.__listId__.RECORDCOUNT\');',
'\tif(ele) {ele.innerHTML = e.rowCount;};',
'\tif(this.persistToStorage) { this.persistToStorage({});}',
'\t(function(e) {   })(e);',
'}',
',',
'\tserverSideSort: function(column,initialDirection) {',
'var e = {};',
'this.setOrder(false);',
'e.column = column;',
'var result = this.systemEvents.beforeServerSideSort(e);',
'if(result == false) return false;',
'var obj = {};',
'obj.cmd = \'sort\';',
'obj.column = column;',
'obj.layoutName = this.layout;',
'obj.listState = this._state;',
'obj.initialDirection = initialDirection;',
'var data = \'_listId=LIST1&\' + A5.ajax.buildURLParam(\'_cmdObj\',$u.o.toJSON(obj));',
'{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'system:listServerSideSort\',\'\',data);',
'},',
'\tfilterListClientSide: function(searchFor) {',
'searchFor =  searchFor.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, "\\\\$&");',
'//var result = this.systemEvents.beforeClientSideFilter();',
'//if(result == false) return false;',
'if(searchFor != \'\') {',
'\t//fixes bug in Chrome when searching on dates strings that use forward slashes',
'\tsearchFor = searchFor.replace(/\\//g,\'\\\\/\');',
'\tthis.setFilter({\'ID\': RegExp(\'\' + searchFor,\'i\'), \'area\': RegExp(\'\' + searchFor,\'i\'), \'loginpassword\': RegExp(\'\' + searchFor,\'i\'), \'POISTATUS\': RegExp(\'\' + searchFor,\'i\'), \'POICREDITLIMIT\': RegExp(\'\' + searchFor,\'i\'), \'AMOUNTLIMIT\': RegExp(\'\' + searchFor,\'i\'), \'DAYLIMIT\': RegExp(\'\' + searchFor,\'i\'), \'PAYMENTMODEID\': RegExp(\'\' + searchFor,\'i\'), \'account_type\': RegExp(\'\' + searchFor,\'i\'), \'POINAME\': RegExp(\'\' + searchFor,\'i\'), \'POICATEGORY\': RegExp(\'\' + searchFor,\'i\'), \'POITYPE\': RegExp(\'\' + searchFor,\'i\'), \'POISPECIALITY\': RegExp(\'\' + searchFor,\'i\'), \'countryid\': RegExp(\'\' + searchFor,\'i\'), \'DISTRICT\': RegExp(\'\' + searchFor,\'i\'), \'POIDISTRICT\': RegExp(\'\' + searchFor,\'i\'), \'areaid\': RegExp(\'\' + searchFor,\'i\'), \'POIREGION\': RegExp(\'\' + searchFor,\'i\'), \'POTENTIALITY\': RegExp(\'\' + searchFor,\'i\'), \'LAT\': RegExp(\'\' + searchFor,\'i\'), \'LONT\': RegExp(\'\' + searchFor,\'i\'), \'BESTTIME\': RegExp(\'\' + searchFor,\'i\'), \'CLASS\': RegExp(\'\' + searchFor,\'i\'), \'COMMENT\': RegExp(\'\' + searchFor,\'i\'), \'CONTACTPERSON\': RegExp(\'\' + searchFor,\'i\'), \'PHONENO\': RegExp(\'\' + searchFor,\'i\'), \'MOBILE\': RegExp(\'\' + searchFor,\'i\'), \'EMAIL\': RegExp(\'\' + searchFor,\'i\'), \'ADDRESS\': RegExp(\'\' + searchFor,\'i\'), \'STREET\': RegExp(\'\' + searchFor,\'i\'), \'typename\': RegExp(\'\' + searchFor,\'i\'), \'specialname\': RegExp(\'\' + searchFor,\'i\'), \'potenname\': RegExp(\'\' + searchFor,\'i\'), \'classname\': RegExp(\'\' + searchFor,\'i\'), \'regionname\': RegExp(\'\' + searchFor,\'i\'), \'MEDREP\': RegExp(\'\' + searchFor,\'i\'), \'medrep_id\': RegExp(\'\' + searchFor,\'i\'), \'poiorcust\': RegExp(\'\' + searchFor,\'i\'), \'pricelist\': RegExp(\'\' + searchFor,\'i\'), \'poicode\': RegExp(\'\' + searchFor,\'i\'), \'Categoryname\': RegExp(\'\' + searchFor,\'i\'), \'paimentmodename\': RegExp(\'\' + searchFor,\'i\'), \'CONFIRMED\': RegExp(\'\' + searchFor,\'i\'), \'frequency\': RegExp(\'\' + searchFor,\'i\'), \'deal\': RegExp(\'\' + searchFor,\'i\'), \'startd\': RegExp(\'\' + searchFor,\'i\'), \'endd\': RegExp(\'\' + searchFor,\'i\')});',
'} else this.setFilter(false);',
'var rowCount = this._values.length;',
'//var e = {};',
'//e.rowCount = rowCount;',
'//this.systemEvents.afterClientSideFilter(e);',
'var ele = $(\'{UXPRERENDEREDALIAS}.LIST1.RECORDCOUNT\');',
'if(ele) ele.innerHTML = rowCount;',
'if(this._showHideFetchMoreSpinner) this._showHideFetchMoreSpinner();',
'}',
',',
'\tscrollToClosestValue: function(val) { ',
'\tif(typeof val != \'string\') val = val.join(\'\');',
'\tvar flagCI = typeof arguments[1] != \'undefined\' ? arguments[1] : false;',
'\tvar pos = typeof arguments[2] != \'undefined\' ? arguments[2] : \'top\';',
'\tvar anim = typeof arguments[3] != \'undefined\' ? arguments[3] : {}',
'\tvar _d = this._rData;',
'\tvar len = val.length;',
'\tvar _d2;',
'\tvar i2 = -1;',
'\tif(flagCI) val = val.toLowerCase();',
'\tfor(var i = 0 ; i < _d.length; i++) {',
'\t\ti2 = i;',
'\t\t_d2 = String(_d[i][\'*value\']);',
'\t\t_d2 = _d2.substr(0,len);',
'\t\t_d2 = $u.s.pad(_d2,len,\' \',\'l\');',
'\t\tif(flagCI) _d2 = _d2.toLowerCase();',
'\t\tif(val <= _d2){',
'\t\t\t break;',
'\t\t}',
'\t}',
'\tif(i2 > -1) {',
'\t\tthis.scrollToItem(i2,{mode: pos, animation: anim});',
'\t}',
'}',
',',
'\t_setPageSize: function(pageSize) {',
'\tthis._state.pageSize = pageSize;',
'\tvar options = {',
'\t\tkeepFocusOnCurrentSelection: true,',
'\t\tpreserveCurrentFilterOrder: true,',
'\t};',
'\t{UXPRERENDEREDALIAS}_DlgObj._refreshListData(this.listVariableName,options);',
'}',
',',
'\t_refreshStateMessages: function() {',
'\tif({UXPRERENDEREDALIAS}_DlgObj._listStateChange) {UXPRERENDEREDALIAS}_DlgObj._listStateChange(this.listVariableName);',
'\tvar ele = \'\';',
'\tele = $(\'{UXPRERENDEREDALIAS}.LIST1.PAGENUMBER\');',
'\tif(ele) ele.innerHTML = this._state.page;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LIST1.PAGECOUNT\');',
'\tif(ele) ele.innerHTML = this._state.pageCount;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LIST1.PAGECOUNT.PAGESELECTOR\');',
'\tif(ele) ele.innerHTML = this._state.pageCount;',
'\tele = $(\'{UXPRERENDEREDALIAS}.LIST1.LISTSTATE\');',
'\tif(ele) {',
'\t\tvar listState = $u.o.toJSON(this._state);',
'\t\tele.innerHTML = listState;',
'\t}',
'\tif(this._hasNavigationBar) {',
'\t\tvar nObj = this._listNavigator;',
'\t\tif(!nObj) {',
'\t\t\tthis._listNavigator = {UXPRERENDEREDALIAS}_DlgObj._navigationBar(this._navBarId);',
'\t\t}',
'\t\tif(nObj) {',
'\t\t\tvar obj = nObj.data;',
'\t\t\tobj.settings = this._navigationBar;',
'\t\t\tobj.pageNumber = this._state.page;',
'\t\t\tobj.totalPages = this._state.pageCount;',
'\t\t\tobj.totalRecords = this._state.recordCount;',
'\t\t\tobj.listName = this.listVariableName;',
'\t\t\tnObj.populate(obj);',
'\t\t\tthis.refresh();',
'\t\t\tthis.resize(); //needed if the list has a fixed size and the style is gr*',
'\t\t}',
'\t}',
'\t//navigation buttons',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_NEXT.LIST1\'];',
'\tif(ele) {',
'\t\tif(this._state.page == this._state.pageCount || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_LAST.LIST1\'];',
'\tif(ele) {',
'\t\tif(this._state.page == this._state.pageCount || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_FIRST.LIST1\'];',
'\tif(ele) {',
'\t\tif(this._state.page == 1 || this._state.pageCount == 0) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = {UXPRERENDEREDALIAS}_DlgObj._buttons[\'BUTTON_LISTNAV_PREV.LIST1\'];',
'\tif(ele) {',
'\t\tif(this._state.page == 1 || this._state.pageCount == 0 ) ele.setDisabled(true);',
'\t\telse ele.setDisabled(false);',
'\t}',
'\tele = $(\'{UXPRERENDEREDALIAS}.V.R1.A5SYSTEM_LIST_PAGESELECTOR_LIST1\');',
'\tif(ele) {',
'\t\tvar data = this._recordNavigatorLinks;',
'\t\tif(data) {',
'\t\t\tA5.form.populateSelect(ele,\'\' + this._state.page,data,true);',
'\t\t\t//alert(\'page: \' + this._state.page);',
'\t\t\t//ele.value = this._state.page;',
'\t\t}',
'\t}',
'}',
',',
'\theader: {',
'\t\thtml: \'\'',
'\t},',
'\t__flagHasFixedColumnFooters: false,',
'\t_getRoute: function() { ',
'\tvar mode = typeof arguments[0] != \'undefined\' ? arguments[0] : \'rowNumber\'; //',
'\tvar obj  = typeof arguments[1] != \'undefined\' ? arguments[1] : [];',
'\tif(typeof this.selection == \'undefined\') return false;',
'\tif(typeof this.selection[0] == \'undefined\') return false;',
'\tif(typeof this.getData(this.selection[0]) == \'undefined\') return false;',
'\tif(mode == \'*key\') {',
'\t\t//leave as *key',
'\t} else {',
'\t\tif(mode != \'rowNumber\') {',
'\t\t\tvar _d = this.getData(this.selection[0]);',
'\t\t\tif(typeof _d.__primaryKey == \'undefined\') {',
'\t\t\t\tmode = \'rowNumber\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\tvar endPoint = typeof arguments[2] != \'undefined\' ? arguments[2]: \'\';',
'\tif(endPoint != \'\') {',
'\t\t//if you have sibling children _getRoute() is returning wrong route -- it is including the siblings in the route.',
'\t\t//route should only include parents',
'\t\t//by passing in the listName to the function we get the route from the top parent to the \'endPoint\' list (ignoring siblings)',
'\t\tvar _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'\t\tvar ra2 = [];',
'\t\tvar lObj = _dlgObj.getControl(endPoint);',
'\t\tvar parentList = lObj.parentList;',
'\t\twhile(typeof parentList != \'undefined\' && parentList != \'\') {',
'\t\t\tvar l2 = _dlgObj.getControl(parentList);',
'\t\t\tvar row = \'\';',
'\t\t\tif(mode == \'rowNumber\') {',
'\t\t\t\trow = l2.selection[0]',
'\t\t\t} else {row = l2.getData(l2.selection[0])[\'*key\'] }',
'\t\t\tra2.push({list: parentList.toUpperCase(), row: row});',
'\t\t\tparentList = l2.parentList;',
'\t\t}',
'\t\treturn ra2.reverse();',
'\t}',
'\tif(mode == \'rowNumber\' || mode == \'*key\') {',
'\t\tobj.push({list: this.listVariableName.toUpperCase(), row: this.getData(this.selection[0])[\'*key\'], mode: mode});',
'\t} else {',
'\t\tvar _d = this.getData(this.selection[0]);',
'\t\tvar _pk = _d.__primaryKey;',
'\t\tif(typeof _d.__primaryKey == \'undefined\') {',
'\t\t\t_pk = _d[\'*rowGUID\'];',
'\t\t}',
'\t\tobj.push({list: this.listVariableName.toUpperCase(), row: _pk, mode: mode});',
'\t}',
'\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\tvar lname = this.childLists[i];',
'\t\tvar lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(lname);',
'\t\tif(lObj) lObj._getRoute(mode,obj);',
'\t}',
'\treturn obj;',
'}',
',',
'\t_getRouteOLD: function() { ',
'\tvar obj  = typeof arguments[1] != \'undefined\' ? arguments[1] : [];',
'\tvar mode = typeof arguments[0] != \'undefined\' ? arguments[0] : \'rowNumber\'; //',
'\tif(typeof this.selection == \'undefined\') return false;',
'\tif(typeof this.selection[0] == \'undefined\') return false;',
'\tif(typeof this.getData(this.selection[0]) == \'undefined\') return false;',
'\tif(mode == \'rowNumber\') obj.push({list: this.listVariableName, row: this.getData(this.selection[0])[\'*key\']});',
'\telse obj.push({list: this.listVariableName, row: this.getData(this.selection[0]).__primaryKey});',
'\tfor(var i = 0; i < this.childLists.length; i++) {',
'\t\tvar lname = this.childLists[i];',
'\t\tvar lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(lname);',
'\t\tif(lObj) lObj._getRoute(mode,obj);',
'\t}',
'\treturn obj;',
'}',
',',
'\t_setRoute: function(route) { ',
'if(this.multiple ) return;',
'\tif(typeof route == \'undefined\') {',
'\t\troute = this.__currentRoute;',
'\t\tif(typeof route == \'undefined\') return false;',
'\t}',
'\tvar mode = typeof arguments[1] != \'undefined\' ? arguments[1] : \'rowNumber\'; //',
'\tif(mode == \'primaryKey\') {',
'\t\tif(typeof this._data != \'undefined\') {',
'\t\t\tvar _d = this._data;',
'\t\t\tif(typeof _d[0] != \'undefined\') {',
'\t\t\t\tif(typeof _d[0].__primaryKey == \'undefined\') {',
'\t\t\t\t\tmode = \'rowNumber\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\tvar lObj = \'\';',
'\tvar row = \'\';',
'\tvar _pk = \'\';',
'\tfor(var i = 0; i < route.length; i++) {',
'\t\tlObj = window[this._hostComponentId + \'_DlgObj\'].getControl(route[i].list);',
'\t\trow = route[i].row;',
'\t\tif(typeof route[i].mode != \'undefined\') {',
'\t\t\tmode = route[i].mode',
'\t\t}',
'\t\tif(mode == \'primaryKey\') _pk = row;',
'\t\t/*',
'\t\tif(mode != \'rowNumber\') {',
'\t\t\tvar _d = lObj._rData;',
'\t\t\tvar _i2 = -1;',
'\t\t\tfor(var j = 0; j < _d.length; j++) {',
'\t\t\t\tif(_d[j].__primaryKey == row) {',
'\t\t\t\t\t_i2 = j;',
'\t\t\t\t\tbreak;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\trow = _i2',
'\t\t}',
'\t\t*/',
'\t\tvar flag = typeof this._restoringList != \'undefined\' ? !this._restoringList : true;',
'\t\tif(mode == \'rowNumber\') {',
'\t\t\tif(typeof row != \'undefined\') {',
'\t\t\t\tvar rowFixed = \'\';',
'\t\t\t\tif(typeof lObj._dataMap == \'undefined\') return false;',
'\t\t\t\tif(mode != \'rowNumber\')  {',
'\t\t\t\t\trowFixed = row;',
'\t\t\t\t\t} else {',
'\t\t\t\trowFixed = lObj._dataMap.indexOf(route[i].row);',
'\t\t\t\t}',
'\t\t\t\tlObj.setValue(rowFixed,flag);',
'\t\t\t\tif(this._clearServerSideErrors) this._clearServerSideErrors();',
'\t\t\t\tif(this._showServerSideErrors) this._showServerSideErrors();',
'\t\t\t\tif(this._showWriteConflictErrors) this._showWriteConflictErrors();',
'\t\t\t}',
'\t\t} else {',
'\t\t\tlObj.setValue(\'\'+_pk,flag);',
'\t\t\tif(this._clearServerSideErrors) this._clearServerSideErrors();',
'\t\t\tif(this._showServerSideErrors) this._showServerSideErrors();',
'\t\t\tif(this._showWriteConflictErrors) this._showWriteConflictErrors();',
'\t\t}',
'\t}',
'}',
',',
'\t_useServerSideSyncLog: false,',
'\titems: {',
'\'_systemButtononClick_sel\' : {',
'\t"selectable": true,',
'\t"onClick": function(index,v,args) { \t\t\t\t\tvar data = this._data[this._dataMap[index]];',
'\t\t\t\t\t(function(rowNumber,value,ia,data,lObj,listObj) { mpoiid = {UXPRERENDEREDALIAS}_DlgObj.getValue(\'list::LIST1::ID\');',
'{UXPRERENDEREDALIAS}_DlgObj.setValue(\'poiid\',mpoiid);',
'{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_2\'); }(index,v,args,data,this,this))',
'\t\t\t\t}',
'}',
'},',
'\t_searchHighlighting: false,',
'\tview: {',
'\t\tnavigation: {',
'\t\t\tnext: {',
'\t\t\t\tclassName: \'listNavButtonNext\'',
'\t\t\t},',
'\t\t\tprev: {',
'\t\t\t\tclassName: \'listNavButtonPrev\'',
'\t\t\t}',
'\t\t}',
'\t},',
'\t_incrementalRefreshTimestampField: \'\',',
'\t_hasNavigationBar: false,',
'\t_listGUID: \'86963972-318c-4757-97f9-c4822ed8cca1\'',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._listViewData[\'LSTMESSAGE\'] = []; ',
'{UXPRERENDEREDALIAS}_DlgObj._listViewData[\'LIST1\'] = [];',
';',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \t"__dtfmt": "", \t"__tfmt": "", \t"__dialogGuid": "", \t"argumentsBoundToCotrols": "", \t"__sgr": "" });;{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \t"__dtfmt": "dd/MM/yyyy", \t"__tfmt": "<cultureTimeFormat>", \t"__dialogGuid": "f062a9cd-9bcd-433f-a51d-57f378a7cc82", \t"argumentsBoundToCotrols": "", \t"__sgr": "" });//ssi13;',
'{UXPRERENDEREDALIAS}_DlgObj._controls[\'LSTMESSAGE\'] =  { type: \'list\',  data: {UXPRERENDEREDALIAS}_DlgObj._listViewData[\'LSTMESSAGE\'],  onInitialize: function() {;if (!this.allowNullSelection){ var that = this; setTimeout(function() {that._onSelect(); delete that; },10);};',
'\t\tvar pe = $(this.contId).parentElement;',
'\t\tif(typeof this.listVariableName != \'undefined\') { ',
'\t\t\tvar _cn = \'{UXPRERENDEREDALIAS}_\' + this.listVariableName.toUpperCase() + \'_2\';',
'\t\t\t$acn(pe,_cn);',
'\t\t}',
'var flagCordova = true;',
'if (typeof window[\'cordova\'] == \'undefined\') {',
'\tvar flagCordova = false;',
'}',
'if(flagCordova) { ',
'\tif(this.__flagPersist) { ',
'\t\tif(this.__persistWhere.toLowerCase() == \'indexdb\') { ',
'\t\t\talert(\'Error. App is running as a Cordova app. You cannot set the persist location to \\\'IndexedDB\\\' for Cordova applications. You must set the persist location to \\\'FileSystem\\\'\');',
'\t\t}',
'\t}',
'}',
';var that = this;',
'try{',
'\tif(this._hasDetailView) { ',
'\t\tif(this._JSONForm) { ',
'\t\t\tsetTimeout(function() { ',
'\t\t\tthat.resize();',
'\t\t\t},10);',
'\t\t}',
'\t}',
'}catch(e){};',
';this._host = {UXPRERENDEREDALIAS}_DlgObj.dialogId;',
'if(typeof this.__flagHasFixedColumnFooters != \'undefined\') { ',
'\tif(this.__flagHasFixedColumnFooters) { ',
'\t\tthis.refresh();',
'\t}',
'}',
'; if(this.initializeVirtualizedColumns) this.initializeVirtualizedColumns(); if(this._setupAlphabetSearch) this._setupAlphabetSearch.call(this)},  settings: {UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LSTMESSAGE\'] }',
'{UXPRERENDEREDALIAS}_DlgObj._controls[\'LIST1\'] =  { type: \'list\',  data: {UXPRERENDEREDALIAS}_DlgObj._listViewData[\'LIST1\'],  onInitialize: function() {',
'\t\tvar pe = $(this.contId).parentElement;',
'\t\tif(typeof this.listVariableName != \'undefined\') { ',
'\t\t\tvar _cn = \'{UXPRERENDEREDALIAS}_\' + this.listVariableName.toUpperCase() + \'_2\';',
'\t\t\t$acn(pe,_cn);',
'\t\t}',
'var flagCordova = true;',
'if (typeof window[\'cordova\'] == \'undefined\') {',
'\tvar flagCordova = false;',
'}',
'if(flagCordova) { ',
'\tif(this.__flagPersist) { ',
'\t\tif(this.__persistWhere.toLowerCase() == \'indexdb\') { ',
'\t\t\talert(\'Error. App is running as a Cordova app. You cannot set the persist location to \\\'IndexedDB\\\' for Cordova applications. You must set the persist location to \\\'FileSystem\\\'\');',
'\t\t}',
'\t}',
'}',
';var that = this;',
'try{',
'\tif(this._hasDetailView) { ',
'\t\tif(this._JSONForm) { ',
'\t\t\tsetTimeout(function() { ',
'\t\t\tthat.resize();',
'\t\t\t},10);',
'\t\t}',
'\t}',
'}catch(e){};',
';this._host = {UXPRERENDEREDALIAS}_DlgObj.dialogId;',
'if(typeof this.__flagHasFixedColumnFooters != \'undefined\') { ',
'\tif(this.__flagHasFixedColumnFooters) { ',
'\t\tthis.refresh();',
'\t}',
'}',
'; if(this.initializeVirtualizedColumns) this.initializeVirtualizedColumns(); if(this._setupAlphabetSearch) this._setupAlphabetSearch.call(this)},  settings: {UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LIST1\'] }',
'{UXPRERENDEREDALIAS}_DlgObj.setVariables({});',
'{UXPRERENDEREDALIAS}_DlgObj._dataBoundControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._primaryTableAlias = \'\';',
'{UXPRERENDEREDALIAS}_DlgObj._listControlsInfo = {};',
'{UXPRERENDEREDALIAS}_DlgObj._functions.__fillContainer_LSTMESSAGE = function() {',
'\tvar path = {UXPRERENDEREDALIAS}_PanelObj._panelPath[\'PANELCARD_1\'];',
'\tif(typeof path != \'undefined\') {',
'\t\tvar panel = {UXPRERENDEREDALIAS}_PanelObj.getPanel(path);',
'\t\tvar id = panel.src.getPanelId(\'body\');',
'\t} else {',
'\t\tvar id = {UXPRERENDEREDALIAS}_PanelObj.getPanelId(\'body\');',
'\t}',
'\t//removing scrolling from the PanelBody since we will be obliterating the Panel with a control that fills the body',
'\tif($(id + \'.SCROLLWRAPPER\')) {',
'\t\tA5.u.drag.remove(id,\'scroll\');',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LSTMESSAGE\'].containerId = id;',
'\t{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LSTMESSAGE\'].className = \'<Default>\';',
'\t//blow away any existing content in the panel',
'\t$(id).innerHTML = \'\';',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._functions.__fillContainer_LSTMESSAGE();',
'{UXPRERENDEREDALIAS}_DlgObj._functions.__fillContainer_LIST1 = function() {',
'\tvar path = {UXPRERENDEREDALIAS}_PanelObj._panelPath[\'PANELCARD_3\'];',
'\tif(typeof path != \'undefined\') {',
'\t\tvar panel = {UXPRERENDEREDALIAS}_PanelObj.getPanel(path);',
'\t\tvar id = panel.src.getPanelId(\'body\');',
'\t} else {',
'\t\tvar id = {UXPRERENDEREDALIAS}_PanelObj.getPanelId(\'body\');',
'\t}',
'\t//removing scrolling from the PanelBody since we will be obliterating the Panel with a control that fills the body',
'\tif($(id + \'.SCROLLWRAPPER\')) {',
'\t\tA5.u.drag.remove(id,\'scroll\');',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LIST1\'].containerId = id;',
'\t{UXPRERENDEREDALIAS}_DlgObj._listViewSettings[\'LIST1\'].className = \'<Default>\';',
'\t//blow away any existing content in the panel',
'\t$(id).innerHTML = \'\';',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._functions.__fillContainer_LIST1();',
'{UXPRERENDEREDALIAS}_DlgObj._hasPanels = true;',
'{UXPRERENDEREDALIAS}_DlgObj._hasOnSynchronizeEvent = false;',
'{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation = function() {',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj == \'undefined\') return \'\';',
'\tvar orientation = {UXPRERENDEREDALIAS}_DlgObj.getOrientation();',
'\tif( orientation == \'landscape\') {',
'\t\t\t//landscape',
'\t\t\tif({UXPRERENDEREDALIAS}_DlgObj._orientation != \'landscape\') {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._orientation = \'landscape\';',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onOrientationChange\',{orientation: \'landscape\'});',
'\t\t\t}',
'\t} else {',
'\t\t//portrait',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj._orientation != \'portrait\') {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._orientation = \'portrait\';',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onOrientationChange\',{orientation: \'portrait\'});',
'\t\t\t}',
'\t}',
'}',
'\tA5.flags.cordovaLoaded = true;',
'\ttry {',
'\t\tdocument.addEventListener(\'deviceready\', function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = true;',
'\t\t\t//alert(\'fire on cordova ready 2\')',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onCordovaReady\',{});',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onPhoneGapReady\',{});',
'\t\t\tnavigator.geolocation.getAccuratePosition = function(geolocationSuccess, geolocationError, options) {',
' var _lastCheckedPosition = null;',
' var _locationEventCount = 0;',
' options = options || {};',
' options.context = this;',
'    function _checkLocation(pos) {',
'        _lastCheckedPosition = pos;',
'        _locationEventCount++;',
'        if ((pos.coords.accuracy <= options.desiredAccuracy) && (_locationEventCount > options.ignoreResultCount)) {',
'            clearTimeout(_timerID);',
'            navigator.geolocation.clearWatch(_watchID);',
'            _foundPosition(pos);',
'        }',
'    }',
'    function _stopLocationCheck() {',
'      var error = {};',
'      error.code = 0;',
'      error.message = \'Timeout: No results\';',
'        navigator.geolocation.clearWatch(_watchID);',
'        _lastCheckedPosition ? _foundPosition(_lastCheckedPosition) : geolocationError.call(options.context,error);',
'    }',
'    function _onError(error) {',
'        clearTimeout(_timerID);',
'        navigator.geolocation.clearWatch(_watchID);',
'        geolocationError.call(options.context,error);',
'    }',
'    function _foundPosition(pos) {',
'        geolocationSuccess.call(options.context,pos);',
'    }',
'    if (!options.maxWait) {',
'     options.maxWait = 10000;',
'    }',
'    if (!options.desiredAccuracy) {',
'       options.desiredAccuracy = 20;',
'    }',
'    if (!options.timeout) {',
'        options.timeout = options.maxWait;',
'  }',
'  if (!options.ignoreResultCount) {',
'    options.ignoreResultCount = 1;',
'  }',
'    options.maximumAge = 0;',
'    options.enableHighAccuracy = true;',
'    var _watchID = navigator.geolocation.watchPosition(_checkLocation, _onError, options);',
'    var _timerID = setTimeout(_stopLocationCheck, options.maxWait);',
'}',
'\t\t} , false);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._onPhoneGapReady = function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executePhoneGapDelayed();',
'\t\t\tif({UXPRERENDEREDALIAS}_DlgObj) {',
'\t\t\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();',
'\t\t\t\tif(obj) obj.resize();',
'\t\t\t\tif({UXPRERENDEREDALIAS}_DlgObj.instantUpdateOnRenderComplete) {UXPRERENDEREDALIAS}_DlgObj.instantUpdateOnRenderComplete()',
'\t\t\t};',
'\t\t}',
'\t}',
'\tcatch(err) {}',
'{UXPRERENDEREDALIAS}_DlgObj._waitGif = \'css/A5System/Images/wait.gif\';',
'var EXIF=(function(){var debug=false;var ExifTags={0x9000:"ExifVersion",0xA000:"FlashpixVersion",0xA001:"ColorSpace",0xA002:"PixelXDimension",0xA003:"PixelYDimension",0x9101:"ComponentsConfiguration",0x9102:"CompressedBitsPerPixel",0x927C:"MakerNote",0x9286:"UserComment",0xA004:"RelatedSoundFile",0x9003:"DateTimeOriginal",0x9004:"DateTimeDigitized",0x9290:"SubsecTime",0x9291:"SubsecTimeOriginal",0x9292:"SubsecTimeDigitized",0x829A:"ExposureTime",0x829D:"FNumber",0x8822:"ExposureProgram",0x8824:"SpectralSensitivity",0x8827:"ISOSpeedRatings",0x8828:"OECF",0x9201:"ShutterSpeedValue",0x9202:"ApertureValue",0x9203:"BrightnessValue",0x9204:"ExposureBias",0x9205:"MaxApertureValue",0x9206:"SubjectDistance",0x9207:"MeteringMode",0x9208:"LightSource",0x9209:"Flash",0x9214:"SubjectArea",0x920A:"FocalLength",0xA20B:"FlashEnergy",0xA20C:"SpatialFrequencyResponse",0xA20E:"FocalPlaneXResolution",0xA20F:"FocalPlaneYResolution",0xA210:"FocalPlaneResolutionUnit",0xA214:"SubjectLocation",0xA215:"ExposureIndex",0xA217:"SensingMethod",0xA300:"FileSource",0xA301:"SceneType",0xA302:"CFAPattern",0xA401:"CustomRendered",0xA402:"ExposureMode",0xA403:"WhiteBalance",0xA404:"DigitalZoomRation",0xA405:"FocalLengthIn35mmFilm",0xA406:"SceneCaptureType",0xA407:"GainControl",0xA408:"Contrast",0xA409:"Saturation",0xA40A:"Sharpness",0xA40B:"DeviceSettingDescription",0xA40C:"SubjectDistanceRange",0xA005:"InteroperabilityIFDPointer",0xA420:"ImageUniqueID"};var TiffTags={0x0100:"ImageWidth",0x0101:"ImageHeight",0x8769:"ExifIFDPointer",0x8825:"GPSInfoIFDPointer",0xA005:"InteroperabilityIFDPointer",0x0102:"BitsPerSample",0x0103:"Compression",0x0106:"PhotometricInterpretation",0x0112:"Orientation",0x0115:"SamplesPerPixel",0x011C:"PlanarConfiguration",0x0212:"YCbCrSubSampling",0x0213:"YCbCrPositioning",0x011A:"XResolution",0x011B:"YResolution",0x0128:"ResolutionUnit",0x0111:"StripOffsets",0x0116:"RowsPerStrip",0x0117:"StripByteCounts",0x0201:"JPEGInterchangeFormat",0x0202:"JPEGInterchangeFormatLength",0x012D:"TransferFunction",0x013E:"WhitePoint",0x013F:"PrimaryChromaticities",0x0211:"YCbCrCoefficients",0x0214:"ReferenceBlackWhite",0x0132:"DateTime",0x010E:"ImageDescription",0x010F:"Make",0x0110:"Model",0x0131:"Software",0x013B:"Artist",0x8298:"Copyright"};var GPSTags={0x0000:"GPSVersionID",0x0001:"GPSLatitudeRef",0x0002:"GPSLatitude",0x0003:"GPSLongitudeRef",0x0004:"GPSLongitude",0x0005:"GPSAltitudeRef",0x0006:"GPSAltitude",0x0007:"GPSTimeStamp",0x0008:"GPSSatellites",0x0009:"GPSStatus",0x000A:"GPSMeasureMode",0x000B:"GPSDOP",0x000C:"GPSSpeedRef",0x000D:"GPSSpeed",0x000E:"GPSTrackRef",0x000F:"GPSTrack",0x0010:"GPSImgDirectionRef",0x0011:"GPSImgDirection",0x0012:"GPSMapDatum",0x0013:"GPSDestLatitudeRef",0x0014:"GPSDestLatitude",0x0015:"GPSDestLongitudeRef",0x0016:"GPSDestLongitude",0x0017:"GPSDestBearingRef",0x0018:"GPSDestBearing",0x0019:"GPSDestDistanceRef",0x001A:"GPSDestDistance",0x001B:"GPSProcessingMethod",0x001C:"GPSAreaInformation",0x001D:"GPSDateStamp",0x001E:"GPSDifferential"};var StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0x0000:"Flash did not fire",0x0001:"Flash fired",0x0005:"Strobe return light not detected",0x0007:"Strobe return light detected",0x0009:"Flash fired, compulsory flash mode",0x000D:"Flash fired, compulsory flash mode, return light not detected",0x000F:"Flash fired, compulsory flash mode, return light detected",0x0010:"Flash did not fire, compulsory flash mode",0x0018:"Flash did not fire, auto mode",0x0019:"Flash fired, auto mode",0x001D:"Flash fired, auto mode, return light not detected",0x001F:"Flash fired, auto mode, return light detected",0x0020:"No flash function",0x0041:"Flash fired, red-eye reduction mode",0x0045:"Flash fired, red-eye reduction mode, return light not detected",0x0047:"Flash fired, red-eye reduction mode, return light detected",0x0049:"Flash fired, compulsory flash mode, red-eye reduction mode",0x004D:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",0x004F:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",0x0059:"Flash fired, auto mode, red-eye reduction mode",0x005D:"Flash fired, auto mode, return light not detected, red-eye reduction mode",0x005F:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}};function imageHasData(img){return!!(img.exifdata)}function findEXIFinJPEG(file){if(file.getByteAt(0)!=0xFF||file.getByteAt(1)!=0xD8){return false}var offset=2,length=file.getLength(),marker;while(offset<length){if(file.getByteAt(offset)!=0xFF){if(debug)console.log("Not a valid marker at offset "+offset+", found: "+file.getByteAt(offset));return false}marker=file.getByteAt(offset+1);if(marker==22400){if(debug)console.log("Found 0xFFE1 marker");return readEXIFData(file,offset+4,file.getShortAt(offset+2,true)-2)}else if(marker==225){if(debug)console.log("Found 0xFFE1 marker");return readEXIFData(file,offset+4,file.getShortAt(offset+2,true)-2)}else{offset+=2+file.getShortAt(offset+2,true)}}}function readTags(file,tiffStart,dirStart,strings,bigEnd){var entries=file.getShortAt(dirStart,bigEnd),tags={},entryOffset,tag,i;for(i=0;i<entries;i++){entryOffset=dirStart+i*12+2;tag=strings[file.getShortAt(entryOffset,bigEnd)];if(!tag&&debug)console.log("Unknown tag: "+file.getShortAt(entryOffset,bigEnd));tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd)}return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var type=file.getShortAt(entryOffset+2,bigEnd),numValues=file.getLongAt(entryOffset+4,bigEnd),valueOffset=file.getLongAt(entryOffset+8,bigEnd)+tiffStart,offset,vals,val,n,numerator,denominator;switch(type){case 1:case 7:if(numValues==1){return file.getByteAt(entryOffset+8,bigEnd)}else{offset=numValues>4?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getByteAt(offset+n)}return vals}case 2:offset=numValues>4?valueOffset:(entryOffset+8);return file.getStringAt(offset,numValues-1);case 3:if(numValues==1){return file.getShortAt(entryOffset+8,bigEnd)}else{offset=numValues>2?valueOffset:(entryOffset+8);vals=[];for(n=0;n<numValues;n++){vals[n]=file.getShortAt(offset+2*n,bigEnd)}return vals}case 4:if(numValues==1){return file.getLongAt(entryOffset+8,bigEnd)}else{vals=[];for(var n=0;n<numValues;n++){vals[n]=file.getLongAt(valueOffset+4*n,bigEnd)}return vals}case 5:if(numValues==1){numerator=file.getLongAt(valueOffset,bigEnd);denominator=file.getLongAt(valueOffset+4,bigEnd);val=new Number(numerator/denominator);val.numerator=numerator;val.denominator=denominator;return val}else{vals=[];for(n=0;n<numValues;n++){numerator=file.getLongAt(valueOffset+8*n,bigEnd);denominator=file.getLongAt(valueOffset+4+8*n,bigEnd);vals[n]=new Number(numerator/denominator);vals[n].numerator=numerator;vals[n].denominator=denominator}return vals}case 9:if(numValues==1){return file.getSLongAt(entryOffset+8,bigEnd)}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getSLongAt(valueOffset+4*n,bigEnd)}return vals}case 10:if(numValues==1){return file.getSLongAt(valueOffset,bigEnd)/file.getSLongAt(valueOffset+4,bigEnd)}else{vals=[];for(n=0;n<numValues;n++){vals[n]=file.getSLongAt(valueOffset+8*n,bigEnd)/file.getSLongAt(valueOffset+4+8*n,bigEnd)}return vals}}}function readEXIFData(file,start){if(file.getStringAt(start,4)!="Exif"){if(debug)console.log("Not valid EXIF data! "+file.getStringAt(start,4));return false}var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(file.getShortAt(tiffOffset)==0x4949){bigEnd=false}else if(file.getShortAt(tiffOffset)==0x4D4D){bigEnd=true}else{if(debug)console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)");return false}if(file.getShortAt(tiffOffset+2,bigEnd)!=0x002A){if(debug)console.log("Not valid TIFF data! (no 0x002A)");return false}if(file.getLongAt(tiffOffset+4,bigEnd)!=0x00000008){if(debug)console.log("Not valid TIFF data! (First offset not 8)",file.getShortAt(tiffOffset+4,bigEnd));return false}tags=readTags(file,tiffOffset,tiffOffset+8,TiffTags,bigEnd);if(tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]];break}tags[tag]=exifData[tag]}}if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3];break}tags[tag]=gpsData[tag]}}return tags}function getData(img,callback){if(!img.complete)return false;if(!imageHasData(img)){getImageData(img,callback)}else{if(callback){callback.call(img)}}return true}function getTag(img,tag){if(!imageHasData(img))return;return img.exifdata[tag]}function getAllTags(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data){if(data.hasOwnProperty(a)){tags[a]=data[a]}}return tags}function pretty(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data){if(data.hasOwnProperty(a)){if(typeof data[a]=="object"){if(data[a]instanceof Number){strPretty+=a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\\r\\n"}else{strPretty+=a+" : ["+data[a].length+" values]\\r\\n"}}else{strPretty+=a+" : "+data[a]+"\\r\\n"}}}return strPretty}function readFromBinaryFile(file){return findEXIFinJPEG(file)}function BinaryFile(strData,iDataOffset,iDataLength){var data=strData;var dataOffset=iDataOffset||0;var dataLength=0;this.getRawData=function(){return data};if(typeof strData=="string"){dataLength=iDataLength||data.length;this.getByteAt=function(iOffset){return data.charCodeAt(iOffset+dataOffset)&0xFF};this.getBytesAt=function(iOffset,iLength){var aBytes=[];for(var i=0;i<iLength;i++){aBytes[i]=data.charCodeAt((iOffset+i)+dataOffset)&0xFF}return aBytes}}else if(typeof strData=="unknown"){dataLength=iDataLength||IEBinary_getLength(data);this.getByteAt=function(iOffset){return IEBinary_getByteAt(data,iOffset+dataOffset)};this.getBytesAt=function(iOffset,iLength){return new VBArray(IEBinary_getBytesAt(data,iOffset+dataOffset,iLength)).toArray()}}this.getLength=function(){return dataLength};this.getSByteAt=function(iOffset){var iByte=this.getByteAt(iOffset);if(iByte>127)return iByte-256;else return iByte};this.getShortAt=function(iOffset,bBigEndian){var iShort=bBigEndian?(this.getByteAt(iOffset)<<8)+this.getByteAt(iOffset+1):(this.getByteAt(iOffset+1)<<8)+this.getByteAt(iOffset);if(iShort<0)iShort+=65536;return iShort};this.getSShortAt=function(iOffset,bBigEndian){var iUShort=this.getShortAt(iOffset,bBigEndian);if(iUShort>32767)return iUShort-65536;else return iUShort};this.getLongAt=function(iOffset,bBigEndian){var iByte1=this.getByteAt(iOffset),iByte2=this.getByteAt(iOffset+1),iByte3=this.getByteAt(iOffset+2),iByte4=this.getByteAt(iOffset+3);var iLong=bBigEndian?(((((iByte1<<8)+iByte2)<<8)+iByte3)<<8)+iByte4:(((((iByte4<<8)+iByte3)<<8)+iByte2)<<8)+iByte1;if(iLong<0)iLong+=4294967296;return iLong};this.getSLongAt=function(iOffset,bBigEndian){var iULong=this.getLongAt(iOffset,bBigEndian);if(iULong>2147483647)return iULong-4294967296;else return iULong};this.getStringAt=function(iOffset,iLength){var aStr=[];var aBytes=this.getBytesAt(iOffset,iLength);for(var j=0;j<iLength;j++){aStr[j]=String.fromCharCode(aBytes[j])}return aStr.join("")};this.getCharAt=function(iOffset){return String.fromCharCode(this.getByteAt(iOffset))};this.toBase64=function(){return window.btoa(data)};this.fromBase64=function(strBase64){data=window.atob(strBase64)}}return{findEXIFinJPEG:findEXIFinJPEG,pretty:pretty,getTag:getTag,getAllTags:getAllTags,getData:getData,Tags:ExifTags,TiffTags:TiffTags,GPSTags:GPSTags,StringValues:StringValues,BinaryFile:BinaryFile}})();',
'(function(){function detectSubsampling(img){var iw=img.naturalWidth,ih=img.naturalHeight;if(iw*ih>1024*1024){var canvas=document.createElement(\'canvas\');canvas.width=canvas.height=1;var ctx=canvas.getContext(\'2d\');ctx.drawImage(img,-iw+1,0);return ctx.getImageData(0,0,1,1).data[3]===0}else{return false}}function detectVerticalSquash(img,iw,ih){var canvas=document.createElement(\'canvas\');canvas.width=1;canvas.height=ih;var ctx=canvas.getContext(\'2d\');ctx.drawImage(img,0,0);var data=ctx.getImageData(0,0,1,ih).data;var sy=0;var ey=ih;var py=ih;while(py>sy){var alpha=data[(py-1)*4+3];if(alpha===0){ey=py}else{sy=py}py=(ey+sy)>>1}var ratio=(py/ih);return(ratio===0)?1:ratio}function renderImageToDataURL(img,options){var canvas=document.createElement(\'canvas\');renderImageToCanvas(img,canvas,options);return canvas.toDataURL("image/jpeg",options.quality||0.8)}function renderImageToCanvas(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight;var width=options.width,height=options.height;var ctx=canvas.getContext(\'2d\');ctx.save();transformCoordinate(canvas,width,height,options.orientation);var subsampled=detectSubsampling(img);if(subsampled){iw/=2;ih/=2}var d=1024;var tmpCanvas=document.createElement(\'canvas\');tmpCanvas.width=tmpCanvas.height=d;var tmpCtx=tmpCanvas.getContext(\'2d\');var vertSquashRatio=detectVerticalSquash(img,iw,ih);var dw=Math.ceil(d*width/iw);var dh=Math.ceil(d*height/ih/vertSquashRatio);var sy=0;var dy=0;while(sy<ih){var sx=0;var dx=0;while(sx<iw){tmpCtx.clearRect(0,0,d,d);tmpCtx.drawImage(img,-sx,-sy);ctx.drawImage(tmpCanvas,0,0,d,d,dx,dy,dw,dh);sx+=d;dx+=dw}sy+=d;dy+=dh}ctx.restore();tmpCanvas=tmpCtx=null}function transformCoordinate(canvas,width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:canvas.width=height;canvas.height=width;break;default:canvas.width=width;canvas.height=height}var ctx=canvas.getContext(\'2d\');switch(orientation){case 2:ctx.translate(width,0);ctx.scale(-1,1);break;case 3:ctx.translate(width,height);ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height);ctx.scale(1,-1);break;case 5:ctx.rotate(0.5*Math.PI);ctx.scale(1,-1);break;case 6:ctx.rotate(0.5*Math.PI);ctx.translate(0,-height);break;case 7:ctx.rotate(0.5*Math.PI);ctx.translate(width,-height);ctx.scale(-1,1);break;case 8:ctx.rotate(-0.5*Math.PI);ctx.translate(-width,0);break;default:break}}function MegaPixImage(srcImage){if(srcImage instanceof Blob){var img=new Image();var URL=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!URL){throw Error("No createObjectURL function found to create blob url");}img.src=URL.createObjectURL(srcImage);srcImage=img}if(!srcImage.naturalWidth&&!srcImage.naturalHeight){var _this=this;srcImage.onload=function(){var listeners=_this.imageLoadListeners;if(listeners){_this.imageLoadListeners=null;for(var i=0,len=listeners.length;i<len;i++){listeners[i]()}}};this.imageLoadListeners=[]}this.srcImage=srcImage}MegaPixImage.prototype.render=function(target,options){if(this.imageLoadListeners){var _this=this;this.imageLoadListeners.push(function(){_this.render(target,options)});return}options=options||{};var imgWidth=this.srcImage.naturalWidth,imgHeight=this.srcImage.naturalHeight,width=options.width,height=options.height,maxWidth=options.maxWidth,maxHeight=options.maxHeight;if(width&&!height){height=(imgHeight*width/imgWidth)<<0}else if(height&&!width){width=(imgWidth*height/imgHeight)<<0}else{width=imgWidth;height=imgHeight}if(maxWidth&&width>maxWidth){width=maxWidth;height=(imgHeight*width/imgWidth)<<0}if(maxHeight&&height>maxHeight){height=maxHeight;width=(imgWidth*height/imgHeight)<<0}var opt={width:width,height:height};for(var k in options)opt[k]=options[k];var tagName=target.tagName.toLowerCase();if(tagName===\'img\'){target.src=renderImageToDataURL(this.srcImage,opt)}else if(tagName===\'canvas\'){renderImageToCanvas(this.srcImage,target,opt)}if(typeof this.onrender===\'function\'){this.onrender(target)}};if(typeof define===\'function\'&&define.amd){define([],function(){return MegaPixImage})}else{this.MegaPixImage=MegaPixImage}})();',
'/*',
'Copyright (c) 2001, 2019 Alpha Software Corporation',
'All Rights Reserved.',
'This Javascript library is licensed exclusively for use with Alpha Anywhere, Alpha Five,',
'Alpha Five Application Server, Alpha Anywhere Application Server,',
'Alpha Five Run Engine, and Alpha Anywhere Run Engine. It is specifically',
'not licensed for use on a server that does not have installed on it a',
'licensed copy of the Alpha Five Application Server or the Alpha Anywhere Application Server.',
'*/',
'\t{UXPRERENDEREDALIAS}_DlgObj.imageCaptureUsingCamera = function(options) {',
'\t\toptions.specialMode = \'callback\';',
'\t\ttry{',
'\t\t\tif(options.pictureSourceVal == \'0\') options.phonegapMoveFileToPermanentStorage = false;',
'\t\t}catch(e) { };',
'\t\tthis.detailViewImageCapture(options);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCapture = function(options) {',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tvar flagPhoneGapLoaded = false;',
'\t\tvar flagUseCordova = false;',
'\t\tif (typeof window[\'cordova\'] != \'undefined\') {',
'\t\t\tflagPhoneGapLoaded = true;',
'\t\t\tif(options.captureMethod == \'phonegappreferred\' || options.captureMethod == \'phonegap\') {',
'\t\t\t\tflagUseCordova = true;',
'\t\t\t}',
'\t\t}',
'\t\tif(options.captureMethod == \'phonegap\' && flagPhoneGapLoaded == false) {',
'\t\t\talert(\'PhoneGap not available\'); return false;',
'\t\t}',
'\t\tif(!flagUseCordova) {',
'\t\t\tthis.detailViewImageCaptureHTML5(options);',
'\t\t} else {',
'\t\t\tthis.detailViewImageCapturePhoneGap(options);',
'\t\t}',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCaptureHTML5 = function(options) {',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tif(options.onBeforeCaptureJavascript) {',
'\t\t\tvar result = options.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tif(A5.flags.isAndroid == false) {',
'\t\t\tif(A5.flags.isIPhone || A5.flags.isIPad){',
'\t\t\t\tif (typeof A5.flags.iOSVersion != \'undefined\') {',
'\t\t\t\t\tvar majorNum = A5.flags.iOSVersion.split(\'.\')[0];',
'\t\t\t\t\tif(parseInt(majorNum) < 6) {',
'\t\t\t\t\t\talert(\'HTML5 camera access not supported on this version of iOS\');',
'\t\t\t\t\t\treturn false;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tif(A5.u.css.supportsTransition == false) {',
'\t\t\talert(\'Browser does not support HTML5 camera access\');',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof options.resizePolicyHTML5 == \'undefined\') options.resizePolicyHTML5 = \'Always\';',
'\t\toptions.resizePolicyHTML5 = options.resizePolicyHTML5.toLowerCase();',
'\t\tif(options.resizePolicyHTML5 != \'always\') {',
'\t\t\tvar maxSize = 99999999999;',
'\t\t\tif(typeof options.maxImageSizeHTML5 != \'undefined\') maxSize = Number(options.maxImageSizeHTML5);',
'\t\t}',
'\t\t//if(typeof options.resizeImageHTML5 == \'undefined\') options.resizeImageHTML5 = true;',
'\t\tvar ops = {};',
'\t\tops.dialogObj = this;',
'\t\tif(options.specialMode == \'callback\' ) {',
'\t\t\toptions.controlName = \'\';',
'\t\t}',
'\t\tif(typeof options.android14mode == \'undefined\') options.android14mode = \'Camera\'',
'\t \tops.targetImage = options.controlName;',
'\t \tops.targetImage = ops.targetImage.toUpperCase();',
'\t \tops.html5 = {};',
'\t \tops.html5.resizeFlag = options.resizeImageHTML5;',
'\t \tops.html5.compressionFactor = options.imageCompressionHTML5;',
'\t \tops.html5.maxWidth = options.maxImageWidth;',
'\t \tops.html5.maxHeight = options.maxImageHeight;',
'\t \tops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t \tops.imageFieldName = (ops.fieldPrefix + \'.\' + ops.targetImage).toUpperCase();',
'\t \tops.hiddenFileName =  (ops.fieldPrefix + \'.\' + ops.targetImage + \'_HIDDENA5FN\').toUpperCase();',
'\t \tops.android14mode = options.android14mode;',
' \t\tops.handleFileSelect = function(evt) {',
'\t\t\t// creates a FileList object',
'\t\t\tvar files = evt.target.files;',
'\t\t\t// Even if multiple files are presented, only the first file will be uploaded.',
'\t\t\tif (!files.length){',
'\t\t\t\t// alerts should be ok here when fired by a timer',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\t\t//alert(\'<a5:r>No files selected.</a5:r>\');',
'\t\t\t\t},50);',
'\t\t\t\treturn false;',
'\t\t\t} else {',
'\t\t\t\t// we\'re processing only 1 file at this point',
'\t\t\t\tvar f = files[0];',
'\t\t\t\tops.updateImage(f);',
'\t\t\t}',
'\t\t}',
'\t\tif(ops.android14mode.toLowerCase() == \'library\') {',
'\t\t\tvar ele = $(this.dialogId + \'._GETPHOTO\');',
'\t\t\tele.removeAttribute(\'capture\');',
'\t\t}',
'\t\t$e.removeGroup(\'__detailViewImageCapture\')',
'\t\t$e.add($(this.dialogId + \'._GETPHOTO\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__detailViewImageCapture\');',
'\t\tops.updateImage = function(_thisFile) {',
'\t\t\tvar _sourceFileName = _thisFile.name;',
'\t\t\tvar _thisImageName = ops.imageFieldName;',
'\t\t\tvar _thisImage = $(_thisImageName);',
'\t\t\tvar reader = new FileReader();',
'\t\t\treader.onload = function(e) {',
'\t\t\t\tvar flagResize = false;',
'\t\t\t\tif(options.resizePolicyHTML5 == \'always\') {',
'\t\t\t\t\tflagResize = true;',
'\t\t\t\t} else {',
'\t\t\t\t\tif(e.target.result.length > maxSize) {',
'\t\t\t\t\t\tflagResize = true;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(!flagResize) {',
'\t\t\t\t\t//not resizing',
'\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\t_thisImage.src = e.target.result;',
'\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\tif(eleH) eleH.src = _thisImage.src;',
'\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t$sa(eleH,\'a5imageSourceName\',_sourceFileName);',
'\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result});',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\t//resizing',
'\t\t\t\t\tif(options.displaySpinnerWhileResizingImage) {',
'\t\t\t\t\t\t_thisImage.src = options.spinnerURI.replace(/\\|/gi,\'/\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _orientation = ops.parseExifOrientation(e.target.result);',
'\t\t\t\t\tops.renderImgToCanvas(_thisFile,_orientation,_sourceFileName);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\treader.onerror = function(e) {',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\talert(\'<a5:r>Error reading file.</a5:r>\');',
'\t\t\t\t},0);',
'\t\t\t}',
'\t\t\treader.readAsDataURL(_thisFile);',
'\t\t}',
'\t\tops.parseExifOrientation = function(dataUrl) {',
'\t\t\ttry {',
'\t\t\t\t// Some of the more current browsers set the default image_orientation property to from-image',
'\t\t\t\t// It was previously always set to none. This check insures that the image is not rotated twice.',
'\t\t\t\t/* -----------------',
'\t\t\t\t* // 8-13-2020: modified to return null for all iOS browsers',
'\t\t\t\t* if (parseFloat(A5.flags.iOSVersion)>= 13.2) {',
'\t\t\t\t* // if running on an iOS device then check version, do not rotate for versions 13.2 snd greater',
'\t\t\t\t* return null;',
'\t\t\t\t* ------------------',
'\t\t\t\t*/',
'\t\t\t\tif (A5.flags.browserSpecs.name == "Safari") {',
'\t\t\t\t\treturn null;',
'\t\t\t\t} else if ((A5.flags.browserSpecs.name == "Chrome") && (parseFloat(A5.flags.browserSpecs.version) >= 83)) {',
'\t\t\t\t\t//if running on Chrome version 81 or greater, do not rotate',
'\t\t\t\t\treturn null;',
'\t\t\t\t} else if ((A5.flags.browserSpecs.name == "Firefox") && (parseFloat(A5.flags.browserSpecs.version) >= 75)) {',
'\t\t\t\t\t//if running on Firefox version 75 or greater, do not rotate',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t\t// This universal check should work with all modern browsers (Opera, etc.) that set the default value of imageOrientation to "from-image"',
'\t\t\t\tvar _obj = getComputedStyle(document.body);',
'\t\t\t\tif (obj.imageOrientation == "from-image") {',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t\tvar _byteString = atob(dataUrl.split(\',\')[1]);',
'\t\t\t\tvar _binaryFile = new EXIF.BinaryFile(_byteString, 0, _byteString.length);',
'\t\t\t\tvar _exif = EXIF.findEXIFinJPEG(_binaryFile);',
'\t\t\t\t// Store EXIF orientation (if available) in data property.',
'\t\t\t\tif (_exif && _exif[\'Orientation\']) {',
'\t\t\t\t\treturn _exif[\'Orientation\'];',
'\t\t\t\t} else {',
'\t\t\t\t\treturn null;',
'\t\t\t\t}',
'\t\t\t} catch (e) {',
'\t\t\t\t// Error parsing EXIF data.',
'\t\t\t\tconsole.log(\'Error loading EXIF data\', e);',
'\t\t\t\treturn null;',
'\t\t\t}',
'\t\t}',
'\t\tops.renderImgToCanvas = function(_file,_orientation,_sourceFileName) {',
'\t\t\t// using megapix-image.js here which handles(?) sub-sampling issue with large images and Canvas on iOS6 Safari',
'\t\t\tvar mpImg = new MegaPixImage(_file);',
'\t\t\tmpImg.onrender = function(){',
'\t\t\t\t// this timeout required to ensure _thisCanvas render complete',
'\t\t\t\tsetTimeout(function(){',
'\t\t\t\t\tvar dataURL = _thisCanvas.toDataURL(\'image/jpeg\', ops.html5.compressionFactor);',
'\t\t\t\t\t//alert(\'html5 size after resizing image:\' + dataURL.length);',
'\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\t\t//put the scaled image in the element',
'\t\t\t\t\t\tele.src = dataURL;',
'\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\tif(eleH) eleH.src = dataURL;',
'\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t$sa(eleH,\'a5imageSourceName\',_sourceFileName);',
'\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : dataURL, sourceFileName: _sourceFileName});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : dataURL, sourceFileName: _sourceFileName});',
'\t\t\t\t\t}',
'\t\t\t\t},0);',
'\t\t\t}',
'\t\t\tvar _thisCanvas = document.createElement(\'canvas\');',
'\t\t\tvar ctx = _thisCanvas.getContext(\'2d\');',
'\t\t\t// adjust based on extracted _orientation',
'\t\t\tif (_orientation) {',
'\t\t\t\tmpImg.render(_thisCanvas,{maxWidth: ops.html5.maxWidth, maxHeight:ops.html5.maxHeight, orientation:_orientation});',
'\t\t\t} else {',
'\t\t\t\tmpImg.render(_thisCanvas,{maxWidth: ops.html5.maxWidth, maxHeight:ops.html5.maxHeight});',
'\t\t\t}',
'\t\t}',
'\t\t//click the hidden image control',
'\t\tvar ele = $(this.dialogId + \'._GETPHOTO\');',
'\t\tif (ele) {',
'\t\t\tele.value = \'\';',
'\t\t\tele.click();',
'\t\t}',
'\t}',
'\t/////\\\\\\\\\\',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewVideoCapturePhoneGap = function(opsIn) {',
'\t\t//ops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t\t//ops.videoFieldName = (ops.fieldPrefix + \'.\' + ops.controlName).toUpperCase();',
'\t\topsIn.dialogObj = this;',
'\t\tvar options = opsIn.options;',
'\t\tvar onSuccess = function(mediaFiles) { var e = {filename: mediaFiles[0].fullPath};',
'\t\t\tvar e_filename = e.filename;',
'\t\t\tif(e_filename.indexOf(\'file:\') != 0) {',
'\t\t\t\te_filename = e_filename.replace(\'/private\',\'file:\\/\\/\');',
'\t\t\t}',
'\t\t\tif(e_filename.indexOf(\'file:\') != 0 && e_filename.indexOf(\'.wav\') > 0) {',
'\t\t\t\te_filename = \'file:\\/\\/\' + e_filename;',
'\t\t\t\t//alert(e_filename);',
'\t\t\t}',
'\t\t\topsIn.dialogObj.setValue(opsIn.controlName,e_filename);',
'\t\t\t//var ele = $(ops.imageFieldName);',
'\t\t\t//if(ele) ele.src = thisImageURL;',
'\t\t\t//var eleH = $(ops.hiddenFileName);',
'\t\t\t//if(eleH) eleH.src = thisImageURL;',
'\t\t\t//$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\topsIn.dialogObj.refreshClientSideComputations();',
'\t\t};',
'\t\tvar onFailed = function() {',
'\t\t};',
'\t\tvar flagAudio = false;',
'\t\tif(typeof opsIn.audio != \'undefined\') flagAudio = opsIn.audio;',
'\t\tif(!flagAudio) {',
'\t\t\tnavigator.device.capture.captureVideo(onSuccess,onFailed,options);',
'\t\t} else {',
'\t\t\t//alert(\'audio\');',
'\t\t\t//debugger;',
'\t\t\tvar options = { limit: 1, duration: 10 };',
'\t\t\t//navigator.device.capture.captureAudio(captureSuccess, captureError, options);',
'\t\t\t//navigator.device.capture.captureAudio(onSuccess,onFailed,options);',
'\t\t\tvar _media = {',
'\t\t\t\trecorder: null,',
'\t\t\t\trecFile: \'myaudio/myrecording3.amr\'  //if device.platform is \'Android\' then use .amr, otherwise .wav',
'\t\t\t}',
'\t\t\tfunction captureStatus(e) {',
'\t\t\t\tconsole.log(\'status....\' + JSON.stringify(e));',
'\t\t\t}',
'\t\t\tvar onSuccessAudio = function() {',
'\t\t\t\tconsole.log(\'try to play it now\');',
'\t\t\t\tsetTimeout(function() { _media.recorder.play(); },1000);',
'\t\t\t\t//var e_filename = _media.recFile;',
'\t\t\t\t//opsIn.dialogObj.setValue(opsIn.controlName,e_filename);',
'\t\t\t\t//opsIn.dialogObj.refreshClientSideComputations();',
'\t\t\t};',
'\t\t\t_media.recorder = new Media(_media.recFile,onSuccessAudio,onFailed,captureStatus);',
'\t\t\tconsole.log(\'about to record\');',
'\t\t\t_media.recorder.startRecord();',
'\t\t\tconsole.log(\'start\');',
'\t\t\tsetTimeout(function() { console.log(\'stop\'); _media.recorder.stopRecord();  },5000);',
'\t\t\t//_media.recorder.play();',
'\t\t}',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.detailViewImageCapturePhoneGap =  function(options) {',
'\t\tvar flagCustomOnError = false;',
'\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\t\t//if(!flagCustomOnError) window.onerror = function(err) { alert(\'Unhandled Javascript Error - phoneGapImageCapture:  \' + JSON.stringify(err));}',
'\t\tif(options.onBeforeCaptureJavascript) {',
'\t\t\tvar result = options.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tif (typeof window[\'cordova\'] == \'undefined\') {',
'\t\t\talert(\'PhoneGap not loaded\');',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof options.imageSelectionCanceledMessage == \'undefined\') options.imageSelectionCanceledMessage = \'Image Selection Canceled\';',
'\t\tif(typeof options.imageSelectionCanceledButton == \'undefined\') options.imageSelectionCanceledButton = \'Done\';',
'\t\tif(typeof options.cameraCanceledMessage == \'undefined\') options.cameraCanceledMessage = \'Camera Action Canceled\';',
'\t\tif(typeof options.cameraCanceledButton == \'undefined\') options.cameraCanceledButton = \'Done\';',
'\t\tvar maxSize = -1;',
'\t\tif(typeof options.maxImageSizePhoneGap != \'undefined\') maxSize = Number(options.maxImageSizePhoneGap);',
'\t\tif(maxSize == -1) maxSize = 9999999999;',
'\t\tif(typeof options.specialMode == \'undefined\') options.specialMode = \'detailview\';',
'\t\tvar ops = {};',
'\t\tops.dialogObj = this;',
'\t\tif(options.specialMode == \'callback\') {',
'\t\t\toptions.controlName = \'\';',
'\t\t}',
'\t\tops.targetImage = options.controlName.toUpperCase();',
'\t\tops.cordova = {};',
'\t\tops.cordova.pictureSourceVal = options.pictureSourceVal;',
'\t\tops.cordova.imageQuality = options.imageQualityPhonegap;',
'\t\tops.cordova.allowEdit = options.allowPictureEditing',
'\t\tops.cordova.targetWidth = options.maxImageWidth;',
'\t\tops.cordova.targetHeight = options.maxImageHeight;',
'\t\tops.cordova.saveToPhotoAlbum = options.saveToPhotoAlbum',
'\t\tops.cordova.iPadEleId = \'\';',
'\t\tops.fieldPrefix = this.dialogId + \'.V.R1\';',
'\t\tops.imageFieldName = (ops.fieldPrefix + \'.\' + ops.targetImage).toUpperCase();',
'\t\tops.hiddenFileName = (ops.fieldPrefix + \'.\' + ops.targetImage + \'_HIDDENA5FN\').toUpperCase();',
'\t\tops.onCameraSuccess = function(imageURI) {',
'\t\t\tif(typeof options.captureDataMode == \'undefined\') options.captureDataMode = \'base64\';',
'\t\t\ttry {',
'\t\t\t    var iOps = JSON.parse(imageURI);',
'\t\t\t    var filename = iOps.filename;',
'\t\t\t    var metadata = iOps.json_metadata;',
'\t\t\t    var iMD = JSON.parse(metadata);',
'\t\t\t    if(typeof iMD.GPS != \'undefined\') {',
'\t\t\t    \t//running on iOS',
'\t\t\t    \tvar gpsObj = {};',
'\t\t\t    \tgpsObj.latitude = iMD.GPS.Latitude;',
'\t\t\t    \tgpsObj.longitude = iMD.GPS.Longitude;',
'\t\t\t    \tif(iMD.GPS.LongitudeRef == \'W\') gpsObj.longitude = Number(gpsObj.longitude) * -1;',
'\t\t\t    \tif(iMD.GPS.LatitudeRef == \'S\') gpsObj.latitude = Number(gpsObj.latitude) * -1;',
'\t\t\t    \tgpsObj.altitude = iMD.GPS.Altitude;',
'\t\t\t    \tgpsObj.dateTime = iMD.GPS.DateStamp + \' \' + iMD.GPS.TimeStamp;',
'\t\t\t    \tgpsObj.ExifJSON = metadata;',
'\t\t\t    } else {',
'\t\t\t    \t//android',
'\t\t\t    \tvar latRaw = iMD.gpsLatitude;   //":"42/1,28/1,50093/1000",',
'\t\t\t    \tvar latRef = iMD.gpsLatitudeRef;  //":"N",',
'\t\t\t    \tvar lngRaw = iMD.gpsLongitude; //":"71/1,12/1,16183/1000",',
'\t\t\t    \tvar lngRef = iMD.gpsLongitudeRef; //":"W",',
'\t\t\t    \tvar altRaw = iMD.gpsAltitude;',
'\t\t\t    \tvar altRef = iMD.gpsAltitudeRef;',
'\t\t\t    \tops.fixGPS = function(raw,ref) {',
'\t\t\t    \t\t//alert( \' raw: \' + raw + \' ref: \' + ref);',
'\t\t\t    \t\tif(raw == null) return null;',
'\t\t\t\t\t\tvar lat_d, lat_m, lat_s, lat;',
'\t\t\t\t\t\tlat_d = eval(raw.split(\',\')[0]);',
'\t\t\t\t\t\tlat_m = eval(raw.split(\',\')[1]) * ( 1/60);',
'\t\t\t\t\t\tlat_s = eval(raw.split(\',\')[2]) * ( 1/60);',
'\t\t\t\t\t\tlat = Number(lat_d) + Number(lat_m) + Number(lat_s);',
'\t\t\t\t\t\tif(ref != null) {',
'\t\t\t\t\t\t\tif(ref.toUpperCase() == \'S\') lat = Number(lat) * -1;',
'\t\t\t\t\t\t\tif(ref.toUpperCase() == \'W\') lat = Number(lat) * -1;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn lat;',
'\t\t\t    \t}',
'\t\t\t    \tvar lat = ops.fixGPS(latRaw,latRef);',
'\t\t\t    \tvar lng = ops.fixGPS(lngRaw,lngRef);',
'\t\t\t    \tvar alt = ops.fixGPS(altRaw,altRef);',
'\t\t\t    \tvar gpsObj = {};',
'\t\t\t\t\tgpsObj.latitude = lat;',
'\t\t\t\t\tgpsObj.longitude = lng;',
'\t\t\t\t\tgpsObj.altitude = alt;',
'\t\t\t\t\tgpsObj.dateTime = iMD.datetime;',
'\t\t\t\t\tgpsObj.ExifJSON = metadata;',
'\t\t\t    }',
'\t\t\t    options.EXIF = gpsObj;',
'\t\t\t    ops._moveFile(filename);',
'\t\t\t\t//do not call onCaptureJavascript() here ... it gets called by ops._move() ....window.resolveLocalFileSystemURL(imageURI,ops.fsOK,ops.fsError);',
'\t\t\t    //if(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : imageURI});',
'\t\t\t} catch(err) {',
'\t\t\t\t//if you get here then you were not using the AA camera plugin, so EXIF info is not available',
'\t\t\t\tops._moveFile(imageURI);',
'\t\t\t\t//do not call onCaptureJavascript() here ... it gets called by ops._move() ....window.resolveLocalFileSystemURL(imageURI,ops.fsOK,ops.fsError);',
'\t\t\t\t//if(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : imageURI});',
'\t\t\t}',
'\t\t}',
'\t\tops._moveFile = function(filename) {',
'\t\t\tvar flagMove = false;',
'\t\t\tif(typeof options.phonegapMoveFileToPermanentStorage != \'undefined\') flagMove = options.phonegapMoveFileToPermanentStorage;',
'\t\t\tif(flagMove) {',
'\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\talert(\'ERROR The PhoneGap \\\'device\\\' plugin is not installed.\');',
'\t\t\t\t}',
'\t\t\t\tvar _dir = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(options.phonegapFileSystemType);',
'\t\t\t\tvar _onFolderEnsured = function() {',
'\t\t\t\t\tvar pos = filename.indexOf(\'?\'); // look for ?, not part of a filename when moving files',
'\t\t\t\t\tif (pos>=0) filename = filename.substring(0,pos); // remove query parts if present',
'\t\t\t\t\tvar objFn = A5.parseFilename(filename);',
'\t\t\t\t\tvar extension = objFn.name.split(\'.\');',
'\t\t\t\t\textension = extension[extension.length-1];',
'\t\t\t\t\tvar targetName = A5.UUID() + \'.\' + extension;',
'\t\t\t\t\tvar subfolder = \'\';',
'\t\t\t\t\tif(options.phonegapPermanentStorageFolder != \'\') {',
'\t\t\t\t\t\tsubfolder = options.phonegapPermanentStorageFolder + \'/\';',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _moveOK = function() {',
'\t\t\t\t\t\tvar fn = _dir + subfolder + targetName;',
'\t\t\t\t\t\twindow.resolveLocalFileSystemURL(fn,ops.fsOK,ops.fsError);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _moveFail = function(e) {',
'\t\t\t\t\t\talert(\'Move error: \'+e.code);',
'\t\t\t\t\t}',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(filename,_dir, subfolder + targetName,_moveOK,_moveFail)',
'\t\t\t\t}',
'\t\t\t\tvar _onError = function() {',
'\t\t\t\t\talert(\'could not create folder\');',
'\t\t\t\t}',
'\t\t\t\tif(options.phonegapPermanentStorageFolder != \'\') {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_dir, options.phonegapPermanentStorageFolder, _onFolderEnsured, _onError)',
'\t\t\t\t} else {',
'\t\t\t\t\t//storing in the root of the requested filesystem --',
'\t\t\t\t\t_onFolderEnsured();',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//do not need to move the file',
'\t\t\t\twindow.resolveLocalFileSystemURL(filename,ops.fsOK,ops.fsError);',
'\t\t\t}',
'\t\t}',
'\t\tops.onImageSelectFail = function(msg) {',
'\t\t\tif(typeof options.onCaptureCancel == \'function\') {',
'\t\t\t\toptions.onCaptureCancel.call();',
'\t\t\t} else {',
'\t\t\t\tnavigator.notification.alert(msg,null,options.imageSelectionCanceledMessage,options.imageSelectionCanceledButton);',
'\t\t\t}',
'\t\t}',
'\t\tops.onCameraCaptureFail = function(msg) {',
'\t\t\tif(typeof options.onCaptureCancel == \'function\') {',
'\t\t\t\t\toptions.onCaptureCancel.call(this,msg);',
'\t\t\t} else {',
'\t\t\t\tnavigator.notification.alert(msg,null,options.cameraCanceledMessage,options.cameraCanceledButton);',
'\t\t\t}',
'\t\t}',
'\t\tops.fsOK = function(fileEntry) {',
'\t\t\t// HTML5 File system available as fileEntry',
'\t\t\t// Using standard HTML5 file handling here',
'\t\t\t// get fileEntry URL for upload',
'\t\t\tvar thisImageURL = fileEntry.toURL();',
'\t\t\tif(options.captureDataMode == \'filename\') {',
'\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t//better be - only mode we are supporting for \'filename\'',
'\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\tif(ele) ele.src = {UXPRERENDEREDALIAS}_DlgObj.addCustomSchemeForAlphaWkWebView(thisImageURL);',
'\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\tif(eleH) eleH.src = thisImageURL;',
'\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\tvar exifData = \'\';',
'\t\t\t\t\tif(typeof options.EXIF != \'undefined\') exifData = JSON.stringify(options.EXIF);',
'\t\t\t\t\t$sa(eleH,\'a5EXIF\',exifData);',
'\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : thisImageURL, options: options.EXIF});',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tfileEntry.file(function(file){',
'\t\t\t\t\tvar reader = new FileReader();',
'\t\t\t\t\treader.onloadend = function(e) {',
'\t\t\t\t\t\t// this is Base64 encoded',
'\t\t\t\t\t\tif(options.specialMode == \'detailview\') {',
'\t\t\t\t\t\t\tvar ele = $(ops.imageFieldName);',
'\t\t\t\t\t\t\tif(ele) ele.src = e.target.result;',
'\t\t\t\t\t\t\tvar eleH = $(ops.hiddenFileName);',
'\t\t\t\t\t\t\tif(eleH) eleH.src = e.target.result;',
'\t\t\t\t\t\t\t$sa(eleH,\'a5isdirty\',\'true\');',
'\t\t\t\t\t\t\tops.dialogObj.refreshClientSideComputations();',
'\t\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result, fileSystemURL: fileEntry.nativeURL, options: options});',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(options.onCaptureJavascript) options.onCaptureJavascript.call(this, {data : e.target.result, fileSystemURL: fileEntry.nativeURL, options: options});  //pass in options so that the user defined callback js can reference options (which has the exif data in it)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t};',
'\t\t\t\t\treader.onerror = function(e) {',
'\t\t\t\t\t\tnavigator.notification.alert(\'<a5:r>File reader error</a5:r>\');',
'\t\t\t\t\t};',
'\t\t\t\t\treader.readAsDataURL(file);',
'\t\t\t\t},function(error) {',
'\t\t\t\t\tnavigator.notification.alert(\'<a5:r>Image file read error</a5:r>\');',
'\t\t\t\t});',
'\t\t\t}',
'\t\t}',
'\t\tops.fsError = function() {',
'\t\t\tnavigator.notification.alert(\'<a5:r>Local File system unavailable.</a5:r>\');',
'\t\t}',
'\t\t// Calculate positioning for iPad popup menu if applicable',
'\t\tvar cordovaPopoverOptions = null;',
'\t\t\tif (ops.cordova.iPadEleId.length > 0) {',
'\t\t\tvar ele = $(ops.cordova.iPadEleId);',
'\t\t\tif (ele) {',
'\t\t\t\tvar rect = ele.getBoundingClientRect();',
'\t\t\t\tvar x = rect.left;',
'\t\t\t\tvar y = rect.top;',
'\t\t\t\tvar w = rect.right - rect.left;',
'\t\t\t\tvar h = rect.bottom - rect.top;',
'\t\t\t\tcordovaPopoverOptions = new CameraPopoverOptions(x,y,w,h,15);',
'\t\t\t}',
'\t\t}',
'\t\t// These options define all of the objects functionality',
'\t\tvar cordovaOptions = {',
'\t\t\tquality: Number(ops.cordova.imageQuality),',
'\t\t\tallowEdit: ops.cordova.allowEdit,',
'\t\t\tsourceType: Number(ops.cordova.pictureSourceVal),',
'\t\t\tcorrectOrientation: true,',
'\t\t\tdestinationType: 1,',
'\t\t\ttargetWidth: Number(ops.cordova.targetWidth),',
'\t\t\ttargetHeight: Number(ops.cordova.targetHeight),',
'\t\t\tsaveToPhotoAlbum: ops.cordova.saveToPhotoAlbum,',
'\t\t\tpopoverOptions: cordovaPopoverOptions,',
'\t\t\tencodingType: Camera.EncodingType.JPEG',
'\t\t}',
'\t\t/*',
'\t\tvar options = {',
'\t\t\t\tdestinationType: Camera.DestinationType.FILE_URI,',
'\t\t\t\tsourceType: Camera.PictureSourceType.PHOTOLIBRARY,',
'\t\t\t\tmediaType: Camera.MediaType.VIDEO',
'\t\t\t\t//getting error: destination file type unavailable',
'\t\t\t};',
'\t\t*/',
'\t\tif (cordovaOptions.sourceType != 1) {',
'\t\t\tcordovaOptions.saveToPhotoAlbum = false;',
'\t\t\tnavigator.camera.getPicture(ops.onCameraSuccess, ops.onImageSelectFail,cordovaOptions);',
'\t\t} else {',
'\t\t\tnavigator.camera.getPicture(ops.onCameraSuccess, ops.onCameraCaptureFail,cordovaOptions);',
'\t\t}',
'\t}',
'{UXPRERENDEREDALIAS}_DlgObj.stripCustomSchemeForAlphaWkWebView = function(fileURL) {',
'\tif(fileURL.indexOf(\'alpha-local://\') == 0 && fileURL.indexOf(\'_app_file_\') >-1) {',
'\t\tvar name = fileURL.split(\'alpha-local://localhost/_app_file_/\')[1];',
'\t\t//file: protocol requires 3 forward slashes',
'\t\tname = \'file:///\'+ name ;',
'\t\treturn name;',
'\t}',
'\ttry{',
'\t\tif(fileURL.toLowerCase().indexOf(\'alpha-local\') == -1) return fileURL;',
'\t\treturn fileURL.split(\'url=\')[1]',
'\t}catch(e) { return fileURL}',
'}',
'//////////',
'{UXPRERENDEREDALIAS}_DlgObj.addCustomSchemeForAlphaWkWebView = function(fileURL) {',
'\tif (typeof fileURL != \'string\') return fileURL; //only process strings',
'\t// catch null fileURL',
'\tif (!fileURL) {',
'\t\treturn fileURL;',
'\t}',
'\tfunction getExt(path){',
'    \tvar ext = (path.match(/(?:.+..+[^\\/]+$)/ig) != null) ? path.split(\'.\').slice(-1): [\'dir\'];',
'    \treturn ext[0].toLowerCase();',
'\t}',
'\t// set default',
'\tvar modifiedFileURL = fileURL;',
'\tconst alphaJpgScheme   = \'alpha-local://jpg?url=\';',
'\tconst alphaSvgScheme   = \'alpha-local://svg?url=\';',
'\tconst alphaPngScheme   = \'alpha-local://png?url=\';',
'\tconst alphaAudioScheme = \'alpha-local://audio?url=\';',
'\tconst alphaVideoScheme = \'alpha-local://video?url=\';',
'\tconst alphaHtmlScheme  = \'alpha-local://html?url=\';',
'\tconst alphaViewScheme  = \'alpha-local://view?url=\';',
'\tconst alphaViewDirScheme = \'alpha-local://viewdir?url=\';',
'\t// Is Alpha\'s WkWebView plugin installed?',
'\tif (typeof WkWebView == \'object\' && WkWebView != null) {',
'\t\tif (typeof WkWebView.convertFilePath == \'function\') {',
'\t\t\t//using Cordova 6.2',
'\t\t\tvar modifiedFileURL = WkWebView.convertFilePath(fileURL);',
'\t\t} else {',
'\t\t\tif (typeof WkWebView.isAlphaWkWebView == \'function\') {',
'\t\t\t\tif (fileURL.startsWith(\'file://\')) {',
'\t\t\t\t\tvar ext = getExt(fileURL);',
'\t\t\t\t\tswitch(ext) {',
'\t\t\t\t\t\tcase "jpg":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaJpgScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "png":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaPngScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "svg":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaSvgScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "m4a":',
'\t\t\t\t\t\tcase "mp3":',
'\t\t\t\t\t\tcase "wav":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaAudioScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "mp4":',
'\t\t\t\t\t\tcase "m4v":',
'\t\t\t\t\t\tcase "mov":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaVideoScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\tcase "html":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaHtmlScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t// for viewing files in iOS QuickLook viewer',
'\t\t\t\t\t\tcase "pdf":',
'\t\t\t\t\t\tcase "doc":',
'\t\t\t\t\t\tcase "xlsx":',
'\t\t\t\t\t\tcase "rtf":',
'\t\t\t\t\t\tcase "csv":',
'\t\t\t\t\t\tcase "ppt":',
'\t\t\t\t\t\tcase "txt":',
'\t\t\t\t\t\tcase "zip":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaViewScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t// for viewing a directory of files in iOS QuickLook viewer',
'\t\t\t\t\t\tcase "dir":',
'\t\t\t\t\t\t\tmodifiedFileURL = alphaViewDirScheme + fileURL;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t}',
'\treturn modifiedFileURL;',
'}',
'//////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload = function(__guid,number,rowId) {',
'\t\tvar arrS3 = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'arrS3\'];',
'\t\tvar options = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'options\'];',
'\t\tvar _dlgObj = {UXPRERENDEREDALIAS}_DlgObj;',
'\t\tvar _xhr = arrS3[number].xhr;',
'\t\t_xhr.abort();',
'\t\tarrS3[number].aborted = true;',
'\t\tif(typeof rowId != \'undefined\') {',
'\t\t\tvar ele = $(rowId);',
'\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t}',
'\t\t//uploadCompleteFunction',
'\t\tvar ops = {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'ops\'];',
'\t\t//fire the onComplete events',
'\t\tvar flagAllCompleted = false;',
'\t\tvar c = 0;',
'\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\tif(arrS3[i].completed == true || arrS3[i].aborted == true) c = c+1;',
'\t\t}',
'\t\tif(c == arrS3.length) flagAllCompleted = true;',
'\t\tvar f = arrS3[number];',
'\t\tvar e = {',
'\t\t\tname: f.name,',
'\t\t\ttype: f.type,',
'\t\t\tsize: f.size,',
'\t\t\taborted: f.aborted,',
'\t\t\tnumber: number,',
'\t\t\tfileArray: arrS3,',
'\t\t\ttargetName: arrS3[number].targetName',
'\t\t}',
'\t\toptions.onCompleteFile(e);',
'\t\tif(flagAllCompleted) {',
'\t\t\toptions.onCompleteAllFiles(e);',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar eleP = $(_dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder);',
'\t\t\t\tif(eleP) eleP.style.display = \'none\';',
'\t\t\t}',
'\t\t\tdelete {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid];',
'\t\t}',
'\t\t//end onComplete events',
'\t}',
'\t/////////////////////////////////////////////////////////////////////////',
'{UXPRERENDEREDALIAS}_DlgObj.fileUploadAmazonS3 = function(options) {',
'if( typeof options.maxActiveUploads == \'undefined\') options.maxActiveUploads = 10;',
'\t\tif(typeof options.target != \'undefined\') {',
'\t\t\tif(options.target.toLowerCase() == \'server\') {',
'\t\t\t\tif({UXPRERENDEREDALIAS}_DlgObj._embeddedMode) {',
'\t\t\t\t\talert(\'This action cannot be perfomed in Working Preview.\');',
'\t\t\t\t\treturn;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tvar eleB = \'\';',
'\t\tvar _dlgObj = this;',
'\t\tvar _part = options.part;',
'\t\tdelete ops;',
'\t\tvar ops = {};',
'\t\tif(typeof options.onBeforeFileSelect == \'function\') {',
'\t\t\tvar result = options.onBeforeFileSelect();',
'\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\tif(!result) return false;',
'\t\t\t}',
'\t\t}',
'\t\tops.formatNum = function(num) {',
'\t\t\tvar suffix = \'Kb\';',
'\t\t \tif(num >= 1000000) {',
'\t\t \t\tnum = num/1000000;',
'\t\t \t\tsuffix = \'Mb\';',
'\t\t\t} else if(num >= 1000) {',
'\t\t\t \tnum = num / 1000;',
'\t\t\t \tsuffix = \'Kb\';',
'\t\t\t} else {',
'\t\t\t   suffix = \'bytes\'',
'\t\t\t  }',
'\t\t\tnum = Math.round(num * 100) / 100;',
'\t\t\tnum = Number(num);',
'\t\t\treturn (num).toLocaleString() + suffix;',
'\t\t}',
'\t\tops.setProgress = function(percent,message,objS3) {',
'\t\t\t//fire system onProgress events',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar i = objS3.number;',
'\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\tvar ep = $(id_i);',
'\t\t\t\tif(ep) {',
'\t\t\t\t\tif(options.progressStyle == \'text\') ep.innerHTML = percent + \'%\';',
'\t\t\t\t\telse ep.style.width = percent + \'%\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar e = {',
'\t\t\t\tpercent: percent,',
'\t\t\t\tmessage: message,',
'\t\t\t\tname: objS3.name,',
'\t\t\t\ttargetName: objS3.targetName,',
'\t\t\t\tnumber: objS3.number,',
'\t\t\t\tsize: objS3.size,',
'\t\t\t\ttype: objS3.type',
'\t\t\t}',
'\t\t\tif(typeof objS3.userProgressFunction == \'function\') objS3.userProgressFunction(e);;',
'\t\t}',
'\t\tops.createCORSRequest = function(method, url) {',
'\t\t\tvar left = url.split(\'?\')[0];',
'\t\t\tvar right = url.split(\'?\')[1];',
'\t\t\tright = right.split(\'/\').join(\'%2F\');',
'\t\t\tright = right.replace(\'host;x-amz-acl\',\'host%3Bx-amz-acl\')',
'\t\t\turl = left + \'?\' + right;',
'  \t\t\tvar xhr = new XMLHttpRequest();',
'  \t\t\t//alert(method)',
'  \t\t\t//alert(url);',
'\t\t\t // "withCredentials" only exists on XHR2 objects',
'  \t\t\tif ("withCredentials" in xhr) {',
'  \t\t\t\ttry {',
'    \t\t\t\txhr.open(method, url, true);',
'    \t\t\t} catch(err) {',
'    \t\t\t\talert(\'XHR error - could not open XHR object. This action is not supported in Working Preview if you are using Internet Explorer. Try using Chrome Working Preview.\');',
'    \t\t\t\treturn false;',
'    \t\t\t}',
'\t\t\t} else if (typeof XDomainRequest != "undefined") {',
'\t\t\t    // XDomainRequest only exists in IE',
'    \t\t\txhr = new XDomainRequest();',
'\t\t\t    xhr.open(method, url);',
'  \t\t\t} else {',
'\t\t\t  \t// CORS not supported by this browser',
'    \t\t\txhr = null;',
'\t\t\t  }',
'\t\t  return xhr;',
'\t\t}',
'\t\tops.uploadToS3 = function(file, url, objS3) {',
'\t\t\tvar targetServer = objS3.targetServer;',
'\t\t\tif(typeof targetServer == \'undefined\') targetServer = \'S3\';',
'\t\t\tif(targetServer.toUpperCase() == \'S3\') {',
'\t\t\t\tvar xhr = ops.createCORSRequest(\'PUT\', url);',
'\t\t\t} else {',
'\t\t\t\t//alpha server',
'\t\t\t\tvar additionalInfo = \'\';',
'\t\t\t\tif(typeof options.additionalInfo == \'function\') {',
'\t\t\t\t\tadditionalInfo = options.additionalInfo.call();',
'\t\t\t\t}',
'\t\t\t\tvar s3Indirect = \'\';',
'\t\t\t\tif(typeof options.xbasicFunctionNameS3Indirect !=\'undefined\') s3Indirect = options.xbasicFunctionNameS3Indirect;',
'\t\t\t\tadditionalInfo = A5.ajax.buildURLParam(\'__additionalInfo\',additionalInfo);',
'\t\t\t\tvar AAURI = encodeURI({UXPRERENDEREDALIAS}_DlgObj.ajaxURL + \'&\' + additionalInfo + \'&__Ajax=true&__FormAction=GenericAjaxCallback&_XbasicFunction=system:multifileupload&_xbasic=\' + options.xbasicFunction + \'&_s3indirect=\' + s3Indirect );',
'\t\t\t\tvar xhr = new XMLHttpRequest();',
'\t\t\t\txhr.open(\'POST\',AAURI,true);',
'\t\t\t}',
'\t\t\tif (!xhr) {',
'\t\t\t\t//ops.setProgress(0, \'CORS not supported\',objS3);',
'\t\t\t\tif(typeof objS3.onError == \'function\') objS3.onError({errorText: \'CORS not supported\', errorCode: -1, fileObject: objS3});',
'\t\t\t  \telse alert(\'CORS not supported\');',
'\t\t\t} else {',
'\t\t\t//capture the xhr object so you can call cancel',
'\t\t\tobjS3.arrS3[objS3.number].xhr = xhr;',
'\t\t\txhr.onreadystatechange = function() {',
'\t\t\t\t//this.readyState == 4 & this.status == 200 -- success',
'\t\t\t\t//this.readyState == 4 && this.status = 408 - timeout',
'\t\t\t\t//anything else is an error',
'\t\t\t}',
'\t\t\txhr.onload = function() {',
'\t\t\t  if(xhr.status == 200) {',
'\t\t\t\tops.setProgress(100, \'Upload completed.\',objS3);',
'\t\t\t\t//file number is available in objS3.number',
'\t\t\t\tobjS3.uploadCompleteFunction.call(objS3);',
'\t\t\t\tvar txt = this.responseText;',
'\t\t\t\tif(txt.indexOf(\'Eval:\') == 0) {',
'\t\t\t\t\ttxt = txt.substring(5);',
'\t\t\t\t\teval(txt);',
'\t\t\t\t}',
'\t\t\t  } else {',
'\t\t\t\t//ops.setProgress(0, \'Upload error: \' + xhr.status);',
'\t\t\t\tvar responseText = \'\';',
'\t\t\t\tif(typeof xhr.responseText != \'undefined\') responseText = xhr.responseText;',
'\t\t\t\tif(typeof objS3.onError == \'function\') objS3.onError({errorText: \'Upload error\', errorCode: xhr.status, fileObject: objS3, errorText: responseText});',
'\t\t\t  \telse alert(\'XHR error. Reported error:\' + responseText);',
'\t\t\t  }',
'\t\t\t};',
'\t\t\txhr.onerror = function() {',
'\t\t\t  //ops.setProgress(0, \'XHR error.\');',
'\t\t\t  if(typeof objS3.onError == \'function\') objS3.onError({errorText: \'XHR Error\', errorCode: xhr.status, fileObject: objS3});',
'\t\t\t  else alert(\'XHR error\');',
'\t\t\t};',
'\t\t\txhr.upload.onprogress = function(e) {',
'\t\t\t  if (e.lengthComputable) {',
'\t\t\t\tvar percentLoaded = Math.round((e.loaded / e.total) * 100);',
'\t\t\t\tops.setProgress(percentLoaded, percentLoaded == 100 ? \'Finalizing.\' : \'Uploading.\',objS3);',
'\t\t\t  }',
'\t\t\t};',
'\t\t\tif(!options.target) options.target = \'S3\';',
'\t\t\tif(options.target.toUpperCase() == \'S3\') {',
'\t\t\t\tif(typeof options.tags == \'undefined\') options.tags = \'\';',
'\t\t\t\txhr.setRequestHeader(\'Content-Type\', file.type);',
'\t\t\t\tif(typeof _dlgObj._authenticatedRead == \'boolean\') {',
'\t\t\t\t\tobjS3.authenticatedRead = _dlgObj._authenticatedRead  //set in a5DialogHelper_signAmazonS3FileUploadURL()',
'\t\t\t\t}',
'\t\t\t\tif(!objS3.authenticatedRead) {',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-acl\', \'public-read\');',
'\t\t\t\t} else {',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-acl\', \'authenticated-read\');',
'\t\t\t\t}',
'\t\t\t\tif(options.tags != \'\') {',
'\t\t\t\t\toptions.tags = decodeURIComponent(options.tags);',
'\t\t\t\t\toptions.tags = atob(options.tags);',
'\t\t\t\t\txhr.setRequestHeader(\'x-amz-tagging\', options.tags);',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//don\'t bother with headers. they will get set automatically becuase we will be .send()ing a FormData() object',
'\t\t\t}',
'\t\t\tif(targetServer.toUpperCase() == \'S3\') {',
'\t\t\t\tif (typeof window[\'cordova\'] != \'undefined\') {',
'\t\t\t\t}',
'\t\t\t\t//alert(typeof options);',
'\t\t\t\t//alert(1);',
'\t\t\t\t//',
'\t\t\t\t//var options = new FileUploadOptions();',
'\t\t\t\txhr.send(file);',
'\t\t\t} else {',
'\t\t\t\t//uploading to alpha server - by using a FormData() object, the content-type headers get set correctly',
'\t\t\t\tvar formData = new FormData();',
'\t\t\t\tformData.append(\'file\',file);',
'\t\t\t\txhr.send(formData);',
'\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tops.handleFileSelect = function(evt) {',
'\t\t\tdelete arrS3;',
'\t\t\tvar arrS3 = [];',
'\t\t\tops.__guid = Number(new Date());',
'\t\t\tvar __guid = ops.__guid;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads = {};',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid] = {};',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'arrS3\'] = arrS3;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'ops\'] = ops;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid][\'options\'] = options;',
'\t\t\tvar files = evt.target.files;',
'\t\t\tvar f = \'\';',
'\t\t\tvar data = \'\';',
'\t\t\tvar targetName = \'\';',
'\t\t\tvar newTargetName = \'\';',
'\t\t\tarrS3.length = 0;',
'\t\t\tfor(var i = 0; i < files.length; i++) {',
'\t\t\t\tf = files[i];',
'\t\t\t\tif(typeof f.name == \'undefined\') {',
'\t\t\t\t\tvar localFileName = \'blobfile.jpg\';',
'\t\t\t\t\tif(typeof options.localFileName != \'undefined\') localFileName = options.localFileName;',
'\t\t\t\t\tf.name = localFileName;',
'\t\t\t\t}',
'\t\t\t\tdelete obji;',
'\t\t\t\tvar obji = {',
'\t\t\t\t\tnumber: i,',
'\t\t\t\t\tname: f.name,',
'\t\t\t\t\tsize: f.size,',
'\t\t\t\t\ttype: f.type,',
'\t\t\t\t\tfile: f,',
'\t\t\t\t\tcompleted: false,',
'\t\t\t\t\taborted: false,',
'\t\t\t\t\tlastModified: f.lastModified',
'\t\t\t\t}',
'\t\t\t\tarrS3.push(obji)',
'\t\t\t}',
'\t\t\tvar __guid = ops.__guid;',
'\t\t\t//validate file selection -------------------------------------',
'\t\t\tvar totalSize = 0;',
'\t\t\tif(typeof options.maxFileSize == \'undefined\') options.maxFileSize = -1;',
'\t\t\tvar maxSize = options.maxFileSize;',
'\t\t\tif(maxSize == -1) maxSize = 999999999999999;',
'\t\t\tif(typeof options.maxFileSizeTotal == \'undefined\') options.maxFileSizeTotal = -1;',
'\t\t\tvar maxSizeTotal = options.maxFileSizeTotal;',
'\t\t\tif(maxSizeTotal == -1) maxSizeTotal = 999999999999999;',
'\t\t\tif(typeof options.allowedFileTypes == \'undefined\') options.allowedFileTypes = \'\';',
'\t\t\tvar fileMsg = options.customization.maxFileSize;',
'\t\t\tvar fileTotalMsg = options.customization.totalFileSize;',
'\t\t\tvar typeMsg = options.customization.fileType;',
'\t\t\tvar flagHasValidationFunction = false;',
'\t\t\tif(typeof options.onValidationError == \'function\') flagHasValidationFunction = true;',
'\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\ttotalSize = totalSize + arrS3[i].size;',
'\t\t\t\t//check size',
'\t\t\t\tif(arrS3[i].size > maxSize) {',
'\t\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\t\toptions.onValidationError({violationType: \'size\', name: arrS3[i].name, size: arrS3[i].size, type: arrS3[i].type});',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tif(typeof fileMsg != \'undefined\' && fileMsg != \'\') {',
'\t\t\t\t\t\t\tvar msg = fileMsg;',
'\t\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[filename]\',e.name);',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[filesize]\',\'\' + e.size);',
'\t\t\t\t\t\t\tmsg = msg.replace(\'[maxfilesize]\',\'\' + maxSize);',
'\t\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\talert(\'File exceeds maximum allowed size of \' + maxSize);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\treturn false;',
'\t\t\t\t}',
'\t\t\t\t//check type',
'\t\t\t\tif(options.allowedFileTypes != \'\') {',
'\t\t\t\t\tvar arrT = options.allowedFileTypes.split(\',\');',
'\t\t\t\t\tfor(var i2 = 0; i2 < arrT.length; i2++ ) {',
'\t\t\t\t\t\tarrT[i2] =   $u.s.aTrim(arrT[i2].toLowerCase());',
'\t\t\t\t\t\tarrT[i2] = arrT[i2].replace(\'.\',\'\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ext = arrS3[i].name.split(\'.\');',
'\t\t\t\t\text = ext[ext.length -1];',
'\t\t\t\t\text = ext.toLowerCase();',
'\t\t\t\t\tvar ia = $u.a.find(arrT,ext);',
'\t\t\t\t\tif(ia == -1) {',
'\t\t\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\t\t\toptions.onValidationError({violationType: \'type\', name: arrS3[i].name, size: arrS3[i].size, type: arrS3[i].type});',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tif(typeof typeMsg != \'undefined\' && typeMsg != \'\') {',
'\t\t\t\t\t\t\t\tvar msg = typeMsg;',
'\t\t\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\t\t\tmsg = msg.replace(\'[filename]\',e.name);',
'\t\t\t\t\t\t\t\tmsg = msg.replace(\'[filetype]\',ext);',
'\t\t\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\talert(\'Invalid file type \' + ext);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn false;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//check total size',
'\t\t\tif(totalSize > maxSizeTotal) {',
'\t\t\t\t//Selected files ([filecount] files, total size [totalfilesize]) exceed the maximum allowed total file size of [maxtotalfilesize].',
'\t\t\t\tif(flagHasValidationFunction) {',
'\t\t\t\t\toptions.onValidationError({violationType: \'totalSize\', totalSize: totalSize, maxSizeTotal: maxSizeTotal});',
'\t\t\t\t} else {',
'\t\t\t\t\tif(typeof fileTotalMsg != \'undefined\' && fileTotalMsg != \'\') {',
'\t\t\t\t\t\tvar msg = fileTotalMsg;',
'\t\t\t\t\t\tvar e = arrS3[i];',
'\t\t\t\t\t\tmsg = msg.replace(\'[filecount]\',arrS3.length);',
'\t\t\t\t\t\tmsg = msg.replace(\'[totalfilesize]\',\'\' + totalSize);',
'\t\t\t\t\t\tmsg = msg.replace(\'[maxtotalfilesize]\',\'\' + maxSizeTotal);',
'\t\t\t\t\t\talert(msg);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\talert(\'Files exceeds maximum allowed size of \' + maxSizeTotal);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treturn false;',
'\t\t\t}',
'\t\t\t//end validate file selection',
'\t\t\tif(typeof options.onAfterFilesSelect == \'function\') {',
'\t\t\t\tvar result = options.onAfterFilesSelect(arrS3);',
'\t\t\t\tif(typeof result != \'undefined\') {',
'\t\t\t\t\tif(!result) return false;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tops.__handleFileSelectLow(files,__guid,arrS3)',
'\t\t}',
'\t\tops._generatePlaceholderId = function() {',
'\t\t\tvar txt = options.progressDisplayPlaceholder;',
'\t\t\tvar flagDV = false;',
'\t\t\tif(typeof options.__dv != \'undefined\') flagDV = options.__dv;',
'\t\t\tvar num = txt.split(\'.\')[1];',
'\t\t\tif(!flagDV) {',
'\t\t\t\tvar eleId = _dlgObj.gridId + \'.V.R\'+options.rowNumber+\'._UNBOUND_STATICTEXT_\' + num;',
'\t\t\t} else {',
'\t\t\t\tvar eleId = _dlgObj.gridId + \'.D.V.R\'+options.rowNumber+\'._UNBOUND_STATICTEXT_\' + num;',
'\t\t\t}',
'\t\t\treturn eleId;',
'\t\t}',
'\t\tops.__handleFileSelectLow = function(files,__guid,arrS3) {',
'\t\t\tif(options.displayProgress) {',
'\t\t\t\tvar nn = options.progressDisplayPlaceholder.indexOf(\'[\');',
'\t\t\t\tif(options.progressDisplayPlaceholder.indexOf(\'ELEMENT:\') == 0) {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = options.progressDisplayPlaceholder.split(\':\')[1];',
'\t\t\t\t} else {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder',
'\t\t\t\t}',
'\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\tif(options.part == \'grid\') {',
'\t\t\t\t\toptions.resolvedProgressPlaceholder = this._generatePlaceholderId()',
'\t\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\t}',
'\t\t\t\tif(eleP) {',
'\t\t\t\t\teleP.style.display = \'\';',
'\t\t\t\t\tvar arrH = [];',
'\t\t\t\t\tvar id_i = \'\';',
'\t\t\t\t\tvar id_row_i = \'\';',
'\t\t\t\t\tvar html = \'\';',
'\t\t\t\t\tvar html_i = \'\';',
'\t\t\t\t\tvar spanTxt = \'\';',
'\t\t\t\t\tvar flagAllowCancel = options.allowCancel;',
'\t\t\t\t\tif(typeof flagAllowCancel == \'undefined\') flagAllowCancel = false;',
'\t\t\t\t\tif(typeof options.progressStyle == \'undefined\') options.progressStyle = \'bar\';',
'\t\t\t\t\tif(options.progressStyle == \'text\') {',
'\t\t\t\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_row_i = id_i + \'.ROW\';',
'\t\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\t\thtml_i += \'<tr id="\'+id_row_i+\'">\';',
'\t\t\t\t\t\t\tif(flagAllowCancel) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td><div style="cursor:pointer;padding: 5px;" title="Cancel upload" onclick="{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload(\\\'\'+__guid+\'\\\',\'+i+\',\\\'\'+id_row_i+\'\\\');">X</div></td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i +=\'<td><div>\' + arrS3[i].name + \' (\' + ops.formatNum(arrS3[i].size) + \') <span id=\'+id_i+\'></span> </div></td>\';',
'\t\t\t\t\t\t\thtml_i +=\'</tr>\'',
'\t\t\t\t\t\t\tarrH.push(html_i)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\thtml = arrH.join(\'\');',
'\t\t\t\t\t\thtml = \'<table>\' + html + \'</table>\'',
'\t\t\t\t\t} else if (options.progressStyle == \'bar\') {',
'\t\t\t\t\t\tvar flagShowFilename = options.showFileNameInProgressBar;',
'\t\t\t\t\t\tif(typeof flagShowFilename == \'undefined\') flagShowFilename = true;',
'\t\t\t\t\t\tvar flagMobile = false;',
'\t\t\t\t\t\tif(typeof options._flagMobile != \'undefined\') flagMobile = options._flagMobile;',
'\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\tif(typeof options.progressBarColor == \'undefined\') options.progressBarColor = \'#9fa1e8\';',
'\t\t\t\t\t\tif(typeof options.progressBarWidth == \'undefined\') options.progressBarWidth = \'1.5in\';',
'\t\t\t\t\t\tvar color = options.progressBarColor',
'\t\t\t\t\t\tvar width = options.progressBarWidth;',
'\t\t\t\t\t\tfor(var i = 0; i < arrS3.length; i++) {',
'\t\t\t\t\t\t\t//id_i = _dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_i = options.resolvedProgressPlaceholder + \'.\' + (i+1);',
'\t\t\t\t\t\t\tid_row_i = id_i + \'.ROW\';',
'\t\t\t\t\t\t\thtml_i = \'\';',
'\t\t\t\t\t\t\thtml_i += \'<tr id="\'+id_row_i+\'">\';',
'\t\t\t\t\t\t\tif(flagShowFilename) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td>\' + arrS3[i].name + \' (\' + ops.formatNum(arrS3[i].size) + \')</td>\';',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\thtml_i += \'<td>(\' + ops.formatNum(arrS3[i].size) + \')</td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i += \'<td><div style="border: solid 1px \'+color+\'; width: \'+width+\';">\';',
'\t\t\t\t\t\t\thtml_i += \'<div id="\'+id_i+\'"style="width: 0%; height: .05in;  background-color:\'+color+\';"></div></div></td>\';',
'\t\t\t\t\t\t\tif(flagAllowCancel) {',
'\t\t\t\t\t\t\t\thtml_i += \'<td><div style="cursor:pointer;padding: 5px;" title="Cancel upload" onclick="{UXPRERENDEREDALIAS}_DlgObj._abortS3Upload(\\\'\'+__guid+\'\\\',\'+i+\',\\\'\'+id_row_i+\'\\\');">X</div></td>\';',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\thtml_i += \'</tr>\';',
'\t\t\t\t\t\t\tarrH.push(html_i);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\thtml = arrH.join(\'\');',
'\t\t\t\t\t\t//for some reason in ie, this function is getting called a second time and if we don\'t exit here when .length == 0, it will overwrite the progress bar with a null string',
'\t\t\t\t\t\tif(arrH.length == 0) return true;',
'\t\t\t\t\t\thtml = \'<table>\' + html + \'</table>\'',
'\t\t\t\t\t\tif(flagMobile) {',
'\t\t\t\t\t\t\t//mobile upload limited to 1 file and don\'t wrap in table',
'\t\t\t\t\t\t\t//id_i = options.resolvedProgressPlaceholder + \'.\' + (1);',
'\t\t\t\t\t\t\thtml = \'\';',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\teleP.innerHTML = html;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tfunction onCompleteFile(e) {',
'\t\t\t\tthrottleRequests({finishedRequest: e});',
'\t\t\t\tif (onCompleteFile.origOnCompleteFile !== undefined && onCompleteFile.origOnCompleteFile !== null) {',
'\t\t\t\t\tonCompleteFile.origOnCompleteFile(e);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif (options.onCompleteFile !== onCompleteFile) {',
'\t\t\t\tonCompleteFile.origOnCompleteFile = options.onCompleteFile;',
'\t\t\t\toptions.onCompleteFile = onCompleteFile;',
'\t\t\t}',
'\t\t\tfunction sendRequest(i) {',
'\t\t\t\tvar f = files[i];',
'\t\t\t\tvar dataA = [];',
'\t\t\t\tdataA.push(\'_mimeType=\' + f.type);',
'\t\t\t\ttargetName = f.name;',
'\t\t\t\tif(typeof options.targetName == \'function\') {',
'\t\t\t\t\tnewTargetName = options.targetName( f  );',
'\t\t\t\t\tif(typeof newTargetName != \'undefined\') {',
'\t\t\t\t\t\tif(newTargetName != \'\') targetName = newTargetName;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tarrS3[i].targetName = targetName;',
'\t\t\t\tvar targetServer = options.target;',
'\t\t\t\tif(!options.target) targetServer = \'S3\';',
'\t\t\t\tarrS3[i].targetServer = targetServer;',
'\t\t\t\tdataA.push(\'_name=\' + urlencode(targetName));  //name of object in S3',
'\t\t\t\tdataA.push(\'_number=\' + i);',
'\t\t\t\tif(options.specifyCredentials == \'Explicit\') {',
'\t\t\t\t\tdataA.push(\'_xbasicFunctionNameForPropertyValues=\' + options.xbasicFunctionName);',
'\t\t\t\t\tdataA.push(\'_method=explicit\');',
'\t\t\t\t} else {',
'\t\t\t\t\tdataA.push(\'_namedStorageConnectionString=\' + options.connectionString);',
'\t\t\t\t\tdataA.push(\'_method=connectionString\');',
'\t\t\t\t}',
'\t\t\t\tdataA.push(\'_authenticatedRead=\' + options.authenticatedRead);',
'\t\t\t\tdataA.push(\'_part=\' + options.part);',
'\t\t\t\tdataA.push(\'_s3timeout=\'+ options.s3timeout);',
'\t\t\t\tif(typeof options.tags != \'undefined\') {',
'\t\t\t\t\tvar tags = options.tags;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar tags = \'\';',
'\t\t\t\t}',
'\t\t\t\tdataA.push(\'_tags=\'+ encodeURIComponent(tags));',
'\t\t\t\tdata = dataA.join(\'&\');',
'\t\t\t\t//alert(data);',
'\t\t\t\tif(typeof options.userProgressFunction == \'undefined\') options.userProgressFunction = function(e) {};',
'\t\t\t\tif(typeof options.onCompleteAllFiles == \'undefined\') options.onCompleteAllFiles = function(e) {};',
'\t\t\t\tvar obj = {',
'\t\t\t\t\t//ajax callback to sign url onComplete',
'\t\t\t\t\tonComplete: function() {',
'\t\t\t\t\t\tvar signedURL = decodeURIComponent(_dlgObj._fileCodedURL);',
'\t\t\t\t\t\t//attempt to fix a problem uploading to s3 when object name has ( )',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\'(\',\'%28\')',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\')\',\'%29\')',
'\t\t\t\t\t\t//signedURL = signedURL.replace(\' \',\'%20\')',
'\t\t\t\t\t\tvar num = _dlgObj._fileCodedURLNum;',
'\t\t\t\t\t\tvar fi = arrS3[num].file;',
'\t\t\t\t\t\tvar targetServer = arrS3[num].targetServer;',
'\t\t\t\t\t\tdelete objS3;',
'\t\t\t\t\t\tvar objS3 = {',
'\t\t\t\t\t\t\tuploadCompleteFunction: function() {',
'\t\t\t\t\t\t\t\tthis.arrS3[this.number].completed = true;',
'\t\t\t\t\t\t\t\tvar flagAllCompleted = false;',
'\t\t\t\t\t\t\t\tvar c = 0;',
'\t\t\t\t\t\t\t\tfor(var i = 0; i < this.arrS3.length; i++) {',
'\t\t\t\t\t\t\t\t\tif(this.arrS3[i].completed == true || this.arrS3[i].aborted == true) c = c+1;',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\tif(c == this.arrS3.length) flagAllCompleted = true;',
'\t\t\t\t\t\t\t\tvar e = {',
'\t\t\t\t\t\t\t\t\tname: this.name,',
'\t\t\t\t\t\t\t\t\ttype: this.type,',
'\t\t\t\t\t\t\t\t\tsize: this.size,',
'\t\t\t\t\t\t\t\t\tnumber: this.number,',
'\t\t\t\t\t\t\t\t\tfileArray: this.arrS3,',
'\t\t\t\t\t\t\t\t\ttargetName: arrS3[this.number].targetName',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\toptions.onCompleteFile(e);',
'\t\t\t\t\t\t\t\tif(flagAllCompleted) {',
'\t\t\t\t\t\t\t\t\toptions.onCompleteAllFiles(e);',
'\t\t\t\t\t\t\t\t\tif(options.displayProgress) {',
'\t\t\t\t\t\t\t\t\t\t//var eleP = $(_dlgObj.dialogId + \'.V.R1.\' + options.progressDisplayPlaceholder);',
'\t\t\t\t\t\t\t\t\t\tvar eleP = $(options.resolvedProgressPlaceholder);',
'\t\t\t\t\t\t\t\t\t\tif(eleP) eleP.style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tdelete {UXPRERENDEREDALIAS}_DlgObj.__CORSUploads[__guid];',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tuserProgressFunction: options.userProgressFunction,',
'\t\t\t\t\t\t\tonError: options.onError,',
'\t\t\t\t\t\t\tname: fi.name,',
'\t\t\t\t\t\t\tsize: fi.size,',
'\t\t\t\t\t\t\ttype: fi.type,',
'\t\t\t\t\t\t\tnumber: num,',
'\t\t\t\t\t\t\tarrS3: arrS3,',
'\t\t\t\t\t\t\ttargetName: arrS3[num].targetName,',
'\t\t\t\t\t\t\t__guid: __guid,',
'\t\t\t\t\t\t\tauthenticatedRead: options.authenticatedRead',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tobjS3.targetServer = targetServer;',
'\t\t\t\t\t\tops.uploadToS3(fi,signedURL,objS3);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tops.obj = obj;',
'\t\t\t\tvar reader = new FileReader();',
'\t\t\t\treader.onload = function(e) {',
'\t\t\t\t\tvar eleId = \'\';',
'\t\t\t\t\tvar ele = \'\';',
'\t\t\t\t\tif(typeof options.imageControl != \'undefined\' && options.part == \'ux\') {',
'\t\t\t\t\t\teleId = options.__alias + \'.V.R1.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\tele = $(eleId);',
'\t\t\t\t\t\tif(ele) ele.src = e.target.result;',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar flagDV = false;',
'\t\t\t\t\t\tif(typeof options.__dv != \'undefined\') flagDV = options.__dv',
'\t\t\t\t\t\tif(flagDV) {',
'\t\t\t\t\t\t\teleId = options.__alias + \'.D.V.R\'+options.rowNumber+\'.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\teleId = options.__alias + \'.V.R\'+options.rowNumber+\'.\' + options.imageControl.toUpperCase();',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tele = $(eleId);',
'\t\t\t\t\t\tif(ele) {',
'\t\t\t\t\t\t\tvar oldSrc = ele.src;',
'\t\t\t\t\t\t\t_dlgObj.__oldImage = oldSrc;',
'\t\t\t\t\t\t\tele.src = e.target.result;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treader.onerror = function(e) {',
'\t\t\t\t\talert(\'error in reader 123\');',
'\t\t\t\t}',
'\t\t\t\tif(typeof options.imageControl != \'undefined\') reader.readAsDataURL(f);',
'\t\t\t\tvar flagTargetIsServer = false;',
'\t\t\t\tif(typeof options.target != \'undefined\') {',
'\t\t\t\t\tif(options.target.toLowerCase() == \'server\') flagTargetIsServer = true;',
'\t\t\t\t}',
'\t\t\t\tif(!flagTargetIsServer) {',
'\t\t\t\t\t_dlgObj.ajaxCallback(\'\',\'\',\'a5DialogHelper_signAmazonS3FileUploadURL\',\'\',data,obj);',
'\t\t\t\t} else {',
'\t\t\t\t\t//no need to sign the url for target = \'alpha\'',
'\t\t\t\t\t_dlgObj._fileCodedURLNum = i;',
'\t\t\t\t\tobj.onComplete();',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar throttleRequests = function (requestsMax) {',
'\t\t\t\tvar activeRequests = 0;',
'\t\t\t\tvar maxRequests = requestsMax;',
'\t\t\t\tvar sentRequests = 0;',
'\t\t\t\tvar finishedRequests = 0;',
'\t\t\t\treturn function throttleRequestActual(options) {',
'\t\t\t\t\tif (options !== undefined && options !== null) {',
'\t\t\t\t\t\tif (options.finishedRequest !== undefined && options.finishedRequest !== null) {',
'\t\t\t\t\t\t\tactiveRequests--;',
'\t\t\t\t\t\t\tfinishedRequests++;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\twhile (sentRequests < files.length && activeRequests < maxRequests) {',
'\t\t\t\t\t\tactiveRequests++;',
'\t\t\t\t\t\tsendRequest(sentRequests);',
'\t\t\t\t\t\tsentRequests++',
'\t\t\t\t\t}',
'\t\t\t\t};',
'\t\t\t}(options.maxActiveUploads); // <---- This is the max number of requests to have active at one time.',
'\t\t\t// Kickoff the requests.',
'\t\t\tthrottleRequests({});',
'\t\t}',
'\t\t//$e.add($(this.dialogId + \'._GETFILEMULTI\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t$e.removeGroup(\'__amazonS3fileupload\')',
'\t\t//bind the change event to the file selector',
'\t\tif(options.allowMultipleFiles) {',
'\t\t\tif(typeof this._getFileMultiListenerLoaded == \'undefined\') {',
'\t\t\t\t//this._getFileMultiListenerLoaded = true;',
'\t\t\t\t//$(this.dialogId + \'._GETFILEMULTI\').addEventListener(\'change\',ops.handleFileSelect,false);',
'\t\t\t\t$e.add($(this.dialogId + \'._GETFILEMULTI\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t\t}',
'\t\t\teleB = $(this.dialogId + \'._GETFILEMULTI\');',
'\t\t} else {',
'\t\t\tif(typeof this._getFileListenerLoaded == \'undefined\') {',
'\t\t\t\t//this._getFileListenerLoaded = true;',
'\t\t\t\t//$(this.dialogId + \'._GETFILE\').addEventListener(\'change\',ops.handleFileSelect,false);',
'\t\t\t\t$e.add($(this.dialogId + \'._GETFILE\'),\'change\',ops.handleFileSelect,\'\',\'\',\'__amazonS3fileupload\');',
'\t\t\t}',
'\t\t\teleB = $(this.dialogId + \'._GETFILE\');',
'\t\t}',
'\t\tvar flagFilePassedIn = false;',
'\t\tif(typeof options.flagFilePassedIn != \'undefined\') {',
'\t\t\tflagFilePassedIn = options.flagFilePassedIn',
'\t\t}',
'\t\tif(!flagFilePassedIn) {',
'\t\t\teleB.value = \'\';',
'\t\t\teleB.click();',
'\t\t\teleB.value = \'\';',
'\t\t} else {',
'\t\t\t//options.filePassedIn',
'\t\t\tvar evt = {};',
'\t\t\tevt.target = {};',
'\t\t\tevt.target.files = [];',
'\t\t\tif(options.filePassedIn.constructor == FileList) {',
'\t\t\t\tevt.target.files = options.filePassedIn;',
'\t\t\t} else {',
'\t\t\t\tevt.target.files[0] = options.filePassedIn;',
'\t\t\t}',
'\t\t\tops.handleFileSelect(evt);',
'\t\t}',
'\t}',
'\t////==== upload PhoneGap /////////////////////////////////////////////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileUpload = function(arr,options) {',
'\t\tvar _dlgObj = this;',
'\t\t//arr is an array of files to  upload. arr must have a .filename property in each item',
'\t\tif(typeof LocalFileSystem == \'undefined\') {',
'\t\t\tif(typeof cordova == \'undefined\') {',
'\t\t\t\talert(\'Method not supported when not running in PhoneGap\');',
'\t\t\t} else {',
'\t\t\t\talert(\'Required PhoneGap plugins (\\\'LocalFileSystem 2\\\')not loaded.\');',
'\t\t\t}',
'\t\t\treturn false;',
'\t\t}',
'\t\t//initialize variables',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].name = arr[i].filename;',
'\t\t\tarr[i].number = i;',
'\t\t\tarr[i].completed = false;',
'\t\t\tarr[i].aborted = false;',
'\t\t\tarr[i].succeeded = false;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: generateProgressBarsHTML -------------',
'\t\tvar generateProgressBarsHTML = function (ops,count) {',
'\t\t\tvar eleTarget = ops.progressElement;',
'\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\tvar html = \'\';',
'\t\t\tvar html_i = \'\';',
'\t\t\tvar name_i = \'\';',
'\t\t\tvar progress_i = \'\';',
'\t\t\tvar idName = \'\';',
'\t\t\tvar idProgress = \'\';',
'\t\t\tif(ops.individualProgress) {',
'\t\t\t\tfor(var  i = 0; i < count; i++) {',
'\t\t\t\t\tname_i = \'Name: \' + i;',
'\t\t\t\t\tprogress_i = \'Progress...\' + i;',
'\t\t\t\t\tidProgress = eleTarget + \'.PROGRESS.\' + i;',
'\t\t\t\t\tidName = eleTarget + \'.NAME.\' + i;',
'\t\t\t\t\tprogress_i = \'<div style="border: solid 1px \'+ops.color+\'; width: \'+ops.width+\';">\';',
'\t\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';"></div></div></td>\';',
'\t\t\t\t\thtml_i = \'<td id="\'+idName+\'">name \'+name_i+\'</td><td>\'+progress_i+\'</td>\';',
'\t\t\t\t\thtml_i = \'<tr>\' + html_i + \'</tr>\';',
'\t\t\t\t\thtml = html + html_i;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(ops.showTotalProgress) {',
'\t\t\t\tidProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\tidName = eleTarget + \'.NAME.TOTAL\';',
'\t\t\t\tprogress_i = \'<div style="border: solid 1px \'+ops.color+\'; width: \'+ops.width+\';">\';',
'\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';"></div></div></td>\';',
'\t\t\t\thtml_i = \'<td id="\'+idName+\'"></td><td>\'+progress_i+\'</td>\';',
'\t\t\t\thtml_i = \'<tr>\' + html_i + \'</tr>\';',
'\t\t\t\thtml = html + html_i',
'\t\t\t}',
'\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\thtml = \'<div id="\'+idProgress+\'"><table>\' + html + \'</table><div>\';',
'\t\t\t$(eleTarget).innerHTML = html;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: phoneGapUploadDoWork -------------',
'\t\tvar phoneGapUploadDoWork = function(arr,options) {',
'\t\t\tif(options.target.toLowerCase() == \'s3\') {',
'\t\t\t\t//s3',
'\t\t\t\tvar xbasicFunction = \'a5dialogHelper_systemSignS3Policy\';',
'\t\t\t\tvar o2 = {};',
'\t\t\t\t$u.o.assign(o2,options);',
'\t\t\t\t/////compute localTargetName before making the callback',
'\t\t\t\tvar filenameURI;',
'\t\t\t\tvar actionOptions = options;',
'\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\tfilenameURI = arr[i].filename;',
'\t\t\t\t\tvar fileName = filenameURI.substr(filenameURI.lastIndexOf(\'/\')+1);',
'\t\t\t\t\tvar targetName = fileName;',
'\t\t\t\t\tif(typeof actionOptions.onComputeS3Filename == \'function\') {',
'\t\t\t\t\t\tvar e = {name: targetName, object: arr[i]};',
'\t\t\t\t\t\tvar newTargetName = actionOptions.onComputeS3Filename(e);',
'\t\t\t\t\t\tif(typeof newTargetName == \'undefined\') newTargetName = targetName;',
'\t\t\t\t\t\tif(newTargetName == \'\') newTargetName = targetName;',
'\t\t\t\t\t\ttargetName = newTargetName;',
'\t\t\t\t\t}',
'\t\t\t\t\t//on iphone video name is always \'capturedvideo.mov\' (in a unique subfolder)',
'\t\t\t\t\tif(targetName.toLowerCase() == \'capturedvideo.mov\') {',
'\t\t\t\t\t\ttargetName = A5.UUID() + \'_video.MOV\';',
'\t\t\t\t\t}',
'\t\t\t\t\tarr[i].targetName = targetName;',
'\t\t\t\t}',
'\t\t\t\t///--------end compute s3 target name',
'\t\t\t\to2.arr = arr;',
'\t\t\t\tvar data = A5.ajax.buildURLParam(\'_jsonOptions\',JSON.stringify(o2));',
'\t\t\t\tvar ajaxObj = {',
'\t\t\t\t\terrorFunction: function() {',
'\t\t\t\t\t\tif(typeof options.onAjaxFailed == \'function\') options.onAjaxFailed();',
'\t\t\t\t\t},',
'\t\t\t\t\tonComplete: function() {',
'\t\t\t\t\t\tvar startUploadLocal = function() {',
'\t\t\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\t\t\ttotalSize = totalSize + Number(arr[i].size);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tvar _sysObj = {};',
'\t\t\t\t\t\t\t_sysObj.totalBytesToUpload = totalSize;',
'\t\t\t\t\t\t\tvar flagMobile = false;',
'\t\t\t\t\t\t\tif(typeof options._flagMobile != \'undefined\') flagMobile = options._flagMobile;',
'\t\t\t\t\t\t\toptions._flagMobile = flagMobile;',
'\t\t\t\t\t\t\tif(options.showProgress && !flagMobile) generateProgressBarsHTML(options.progress,arr.length);',
'\t\t\t\t\t\t\t//alert(\'ready to start uploading files: total \' + totalSize);',
'\t\t\t\t\t\t\tstartUploadFilesToS3(_sysObj,options);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tvar _sTop = {};',
'\t\t\t\t\t\tgetFileSizesForAllItemsInArray(startUploadLocal,_sTop);',
'\t\t\t\t\t},',
'\t\t\t\t\tdeviceOfflineFunction: function() {',
'\t\t\t\t\t\tif(typeof options.onDeviceOffline == \'function\') options.onDeviceOffline();',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t//alert(\'ajax callback\');',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',xbasicFunction,\'\',data,ajaxObj);',
'\t\t\t} else {',
'\t\t\t\t//alpha server',
'\t\t\t\tvar startUploadLocal = function() {',
'\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\ttotalSize = totalSize + Number(arr[i].size);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _sysObj = {};',
'\t\t\t\t\t_sysObj.totalBytesToUpload = totalSize;',
'\t\t\t\t\tif(options.showProgress) generateProgressBarsHTML(options.progress,arr.length);',
'\t\t\t\t\tstartUploadFilesToS3(_sysObj,options);',
'\t\t\t\t}',
'\t\t\t\tvar _sTop = {};',
'\t\t\t\tgetFileSizesForAllItemsInArray(startUploadLocal,_sTop);',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: getFileSizesForAllItemsInList',
'\t\tvar getFileSizesForAllItemsInArray = function(allDone_GotAllFileSizes_Callback, _sTop)  {',
'\t\t\tvar _s = {count: 0};',
'\t\t\tvar getFileSizesForAllItemsInArrayLow = function (arr,r,count,callback,_s,_sTop) {',
'\t\t\t\tvar rowNumber = r;',
'\t\t\t\tvar url = arr[r].filename;',
'\t\t\t\tvar resolveLocalFileURL_SUCCESS = function(fileEntry) {',
'\t\t\t\t\tvar file_SUCCESS = function(f) {',
'\t\t\t\t\t\tarr[r].size = f.size;',
'\t\t\t\t\t\t_s.count = _s.count + 1;',
'\t\t\t\t\t\tif(_s.count == count) {',
'\t\t\t\t\t\t\tcallback(_sTop);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tfileEntry.file(file_SUCCESS);',
'\t\t\t\t}',
'\t\t\t\tvar resolveLocalFileURL_fail = function() {',
'\t\t\t\t\tarr[r].size = 0',
'\t\t\t\t\t_s.count = _s.count + 1;',
'\t\t\t\t\tif(_s.count == count) {',
'\t\t\t\t\t\tcallback(_sTop);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t//on  iphone, video capture does not return a file with the file:// prefix',
'\t\t\t\tvar urlToResolve = url;',
'\t\t\t\tif(url.indexOf(\'file:\') != 0) {',
'\t\t\t\t\turlToResolve = urlToResolve.replace(\'/private\',\'file:\\/\\/\');',
'\t\t\t\t}',
'\t\t\t\t//window.resolveLocalFileSystemURL(urlToResolve, resolveLocalFileURL_SUCCESS, function() { } );',
'\t\t\t\twindow.resolveLocalFileSystemURL(urlToResolve, resolveLocalFileURL_SUCCESS, resolveLocalFileURL_fail );',
'\t\t\t}',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tgetFileSizesForAllItemsInArrayLow(arr,i,arr.length,allDone_GotAllFileSizes_Callback,_s,_sTop)',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: startUploadFilesToS3',
'\t\tvar startUploadFilesToS3 = function(_sysObj,options) {',
'\t\t\t//_sysObj.totalBytesToUpload;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tupLoadFilesToS3Work(arr[i].filename,arr,i,_sysObj,options)',
'\t\t\t}',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: s3SignedPolicy',
'\t\tvar s3SignedPolicy = function() {',
'\t\t\tvar obj = {};',
'\t\t\tobj.hasError = {UXPRERENDEREDALIAS}_DlgObj._pgS3.hasError;',
'\t\t\tobj.policyBase64 = {UXPRERENDEREDALIAS}_DlgObj._pgS3.policyBase64;',
'\t\t\tobj.signature = {UXPRERENDEREDALIAS}_DlgObj._pgS3.signature;',
'\t\t\tobj.userKey = {UXPRERENDEREDALIAS}_DlgObj._pgS3.accessKey;',
'\t\t\tobj.acl = {UXPRERENDEREDALIAS}_DlgObj._pgS3.acl;',
'\t\t\tobj.bucket = {UXPRERENDEREDALIAS}_DlgObj._pgS3.bucket;',
'\t\t\treturn obj;',
'\t\t}',
'\t\t///define local function for phoneGapFileUpload: uploadFilesToS3Work',
'\t\tvar upLoadFilesToS3Work = function(filenameURI,arr,fileNumber,_sysObj, actionOptions) {',
'\t\t\t//this code to compute the targetName now gets run before the ajax callback to sign the url is made because the v4 amz signing method',
'\t\t\t//needs to include the s3 object name in the url that gets signed',
'\t\t\tvar fileName = filenameURI.substr(filenameURI.lastIndexOf(\'/\')+1);',
'\t\t\tvar targetName = fileName;',
'\t\t\tif(typeof actionOptions.onComputeS3Filename == \'function\') {',
'\t\t\t\tvar e = {name: targetName, object: arr[fileNumber]};',
'\t\t\t\tvar newTargetName = actionOptions.onComputeS3Filename(e);',
'\t\t\t\tif(typeof newTargetName == \'undefined\') newTargetName = targetName;',
'\t\t\t\tif(newTargetName == \'\') newTargetName = targetName;',
'\t\t\t\ttargetName = newTargetName;',
'\t\t\t}',
'\t\t\t//on iphone video name is always \'capturedvideo.mov\' (in a unique subfolder)',
'\t\t\tif(targetName.toLowerCase() == \'capturedvideo.mov\') {',
'\t\t\t\ttargetName = A5.UUID() + \'_video.MOV\';',
'\t\t\t}',
'\t\t\tif(typeof actionOptions.target != \'undefined\') {',
'\t\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\t\tarr[fileNumber].targetName = targetName',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//',
'\t\t\t//do not do this here when target is S3. it has already been done before the ajax callback.',
'\t\t\t//arr[fileNumber].targetName = targetName; //use name that event returned',
'\t\t\tvar ft = new FileTransfer();',
'\t\t\tvar options = new FileUploadOptions();',
'\t\t\toptions.fileKey = "file";',
'\t\t\toptions.fileName = targetName;',
'\t\t\toptions.mimeType = "image/jpeg";',
'\t\t\toptions.chunkedMode = false;',
'\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\tvar s3URI = encodeURI( $u.s.aTrim({UXPRERENDEREDALIAS}_DlgObj.ajaxURL));',
'\t\t\t\t//s3URI = \'junk\'; //force a file upload error',
'\t\t\t\t//alert(\'remember to turn this off\');',
'\t\t\t\tvar xbasicAfterUpload = actionOptions.xbasicAfterFileUploaded',
'\t\t\t\tvar specialMode = \'\';',
'\t\t\t\tif(typeof actionOptions.specialMode != \'undefined\') specialMode = actionOptions.specialMode;',
'\t\t\t\toptions.params = {',
'\t\t\t\t\t"_XbasicFunction" : "system:phonegapfileupload",',
'\t\t\t\t\t"__Ajax" : "true",',
'\t\t\t\t\t"__FormAction" : "GenericAjaxCallback",',
'\t\t\t\t\t"__FormID" : "",',
'\t\t\t\t\t"__xbasicAfterUpload" : xbasicAfterUpload,',
'\t\t\t\t\t"__arrayIndex" : fileNumber,',
'\t\t\t\t\t"__actionOptions" : JSON.stringify(actionOptions),',
'\t\t\t\t\t"__specialMode" : specialMode,',
'\t\t\t\t\t"__targetName" : targetName,',
'\t\t\t\t\t"__arrayItem" : JSON.stringify(arr[fileNumber]),',
'\t\t\t\t\t"__ajaxURL" : $u.s.aTrim({UXPRERENDEREDALIAS}_DlgObj.ajaxURL)',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\t//s3',
'\t\t\t\tvar obj = s3SignedPolicy();',
'\t\t\t\tvar s3URI = encodeURI(\'https://\' + obj.bucket + \'.s3.amazonaws.com/\'),',
'\t\t\t\t\tpolicyBase64 = obj.policyBase64,',
'\t\t\t\t\tsignature = obj.signature,',
'\t\t\t\t\tawsKey = obj.userKey,',
'\t\t\t\t\tacl = obj.acl;',
'\t\t\t\t//this is computed on the server',
'\t\t\t\ts3URI = {UXPRERENDEREDALIAS}_DlgObj._pgS3.signedURI;',
'\t\t\t\tvar arr2 = JSON.parse({UXPRERENDEREDALIAS}_DlgObj._pgS3.signedURIArrayJSON);',
'\t\t\t\tvar _uri = arr2[fileNumber].uri;',
'\t\t\t\tvar _mime = arr2[fileNumber].mimeType;',
'\t\t\t\ts3URI = _uri;',
'\t\t\t\t//alert(\'s3URI: \' + s3URI);',
'\t\t\t\toptions.params = {',
'\t\t\t\t\t"key": targetName,',
'\t\t\t\t\t"AWSAccessKeyId": awsKey,',
'\t\t\t\t\t"acl": acl,',
'\t\t\t\t\t"policy": policyBase64,',
'\t\t\t\t\t"signature": signature,',
'\t\t\t\t\t"Content-Type": "image/jpeg"',
'\t\t\t\t};',
'\t\t\t}',
'\t\t\tvar setProgress = function(progressId,fileNumber,pctComplete) {',
'\t\t\t\tvar id = \'\';',
'\t\t\t\tvar countCompleted = 0;',
'\t\t\t\tif(fileNumber == \'total\') {',
'\t\t\t\t\tid = progressId + \'.PROGRESS.TOTAL\';',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\tif(arr[i].completed) countCompleted = countCompleted + 1;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar idN = progressId + \'.NAME.TOTAL\';',
'\t\t\t\t\tvar ele = $(idN);',
'\t\t\t\t\t//if(ele) ele.innerHTML = \'Completed: \' + countCompleted +  \' of \' + arr.length;',
'\t\t\t\t} else {',
'\t\t\t\t\tid = progressId + \'.PROGRESS.\' + fileNumber;',
'\t\t\t\t}',
'\t\t\t\tvar ele = $(id);',
'\t\t\t\tif(ele) ele.style.width = pctComplete + \'%\';',
'\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\tele = $(idP);',
'\t\t\t\tif(ele) ele.style.display = \'\';',
'\t\t\t}',
'\t\t\tft.onprogress = function(progressEvent) {',
'\t\t\t\tvar totalBytesToTransfer = _sysObj.totalBytesToUpload',
'\t\t\t\tif(typeof _sysObj.workDone == \'undefined\') {',
'\t\t\t\t\t_sysObj.workDone = [];',
'\t\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\t\t_sysObj.workDone[i] = 0;',
'\t\t\t\t\t}',
'\t\t\t\t };',
'\t\t\t\t_sysObj.workDone[fileNumber] = progressEvent.loaded;',
'\t\t\t\tvar gTotal = 0;',
'\t\t\t\tfor(var i = 0; i < _sysObj.workDone.length; i++) {',
'\t\t\t\t\tif(typeof _sysObj.workDone[i] != \'undefined\') {',
'\t\t\t\t\t\tgTotal = gTotal + _sysObj.workDone[i];',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\tif (progressEvent.lengthComputable) {',
'\t\t\t\t\tvar pctComplete = (progressEvent.loaded / progressEvent.total)*100;',
'\t\t\t\t\tif(pctComplete > 100) pctComplete = 100;',
'\t\t\t\t\tpctComplete = $u.n.round(pctComplete,4);',
'\t\t\t\t\tif(actionOptions.showProgress) setProgress(progressId,fileNumber,pctComplete);',
'\t\t\t\t\tif(typeof actionOptions.onProgressEvent == \'function\') {',
'\t\t\t\t\t\tactionOptions.onProgressEvent(arr, fileNumber, pctComplete, progressEvent.loaded, progressEvent.total);',
'\t\t\t\t\t}',
'\t\t\t\t\tvar pctCompleteTotal = (gTotal / totalBytesToTransfer) * 100;',
'\t\t\t\t\tif(pctCompleteTotal > 100) pctCompleteTotal = 100;',
'\t\t\t\t\tpctCompleteTotal = $u.n.round( pctCompleteTotal,4);',
'\t\t\t\t\tif(actionOptions.showProgress) setProgress(progressId,\'total\',pctCompleteTotal);',
'\t\t\t\t\tif(typeof actionOptions.onProgressEvent == \'function\') {',
'\t\t\t\t\t\tactionOptions.onProgressEvent(arr, \'total\', pctCompleteTotal, gTotal, totalBytesToTransfer);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(actionOptions._flagMobile) {',
'\t\t\t\t\t\tif($(\'MOBILEUPLOADPROGRESS.1\')) $(\'MOBILEUPLOADPROGRESS.1\').style.width = pctCompleteTotal + \'%\';',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\t//progress messages not possible -- should never happen',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tvar _hasCompleted = function() {',
'\t\t\t\tvar flagAllDone = true;',
'\t\t\t\tfor(var i = 0; i < arr.length; i ++) {',
'\t\t\t\t\tif(arr[i].completed == false) {',
'\t\t\t\t\t\tflagAllDone = false;',
'\t\t\t\t\t\tbreak;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\treturn flagAllDone;',
'\t\t\t}',
'\t\t\tvar fileUploadSuccess = function(r) {',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t\tarr[fileNumber].succeeded = true;',
'\t\t\t\tarr[fileNumber].remoteName = arr[fileNumber].targetName;',
'\t\t\t\t//for uploads to AlphaAnywhere, the Xbasic function that is called can send a response',
'\t\t\t\tif(r.response != \'undefined\') {',
'\t\t\t\t\tif(r.response != \'\') eval(r.response);',
'\t\t\t\t};',
'\t\t\t\t//if the targer is the Alpha server and the Xbasic handler sent a response that set the \'targetFileName\' property',
'\t\t\t\tvar target = actionOptions.target.toLowerCase();',
'\t\t\t\tif(target == \'s3\') {',
'\t\t\t\t\tif(typeof actionOptions.s3.template != \'undefined\') {',
'\t\t\t\t\t\tarr[fileNumber].remoteName = actionOptions.s3.template.replace(\'__name__\',arr[fileNumber].targetName);',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tif(typeof arr[fileNumber].targetFileName != \'undefined\') {',
'\t\t\t\t\t\tarr[fileNumber].remoteName = arr[fileNumber].targetFileName;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(typeof actionOptions.onCompleteIndividualFile == \'function\') {',
'\t\t\t\t\tactionOptions.onCompleteIndividualFile(arr,fileNumber);',
'\t\t\t\t}',
'\t\t\t\tvar flagAllDone = _hasCompleted();',
'\t\t\t\tif(flagAllDone) {',
'\t\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\tvar ele = $(idP);',
'\t\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t\t\tif(typeof actionOptions.onComplete == \'function\') {',
'\t\t\t\t\t\tactionOptions.onComplete(arr);',
'\t\t\t\t\t};',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar _hideProgress = function() {',
'\t\t\t\tvar progressId = actionOptions.progress.progressElement;',
'\t\t\t\tvar idP = progressId + \'.PROGRESSDISPLAY\';',
'\t\t\t\tvar ele = $(idP);',
'\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t}',
'\t\t\tvar fileUploadFailed = function(error) {',
'\t\t\t\tarr[fileNumber].failed = true;',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t\tif(typeof actionOptions.onError == \'function\') {',
'\t\t\t\t\tactionOptions.onError(arr,fileNumber,error);',
'\t\t\t\t}',
'\t\t\t\tif(typeof actionOptions.onCompleteIndividualFile == \'function\') {',
'\t\t\t\t\tactionOptions.onCompleteIndividualFile(arr,fileNumber);',
'\t\t\t\t}',
'\t\t\t\tvar flagAllDone = _hasCompleted();',
'\t\t\t\tif(flagAllDone) {',
'\t\t\t\t\t_hideProgress();',
'\t\t\t\t\tif(typeof actionOptions.onComplete == \'function\') {',
'\t\t\t\t\t\tactionOptions.onComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t};',
'\t\t\t}',
'\t\t\tvar flagOK = true;',
'\t\t\tif(typeof actionOptions.onValidate == \'function\') {',
'\t\t\t\tvar result = actionOptions.onValidate(arr,fileNumber);',
'\t\t\t\tif(typeof result != \'undefined\') flagOK = result;',
'\t\t\t}',
'\t\t\t//do the upload',
'\t\t\tif(flagOK) {',
'\t\t\t\tvar flagTrustAllHosts = false;',
'\t\t\t\tif(typeof _dlgObj != \'undefined\') {',
'\t\t\t\t\tif(typeof _dlgObj._phoneGapTrustAllHosts != \'undefined\') {',
'\t\t\t\t\t\tflagTrustAllHosts = _dlgObj._phoneGapTrustAllHosts;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tif(actionOptions.target == \'alphaanywhere\') {',
'\t\t\t\t\toptions.httpMethod = \'POST\';',
'\t\t\t\t} else {',
'\t\t\t\t\toptions.httpMethod = \'PUT\';',
'\t\t\t\t\toptions.headers = {\'Content-Type\': \'image/jpeg\',\'x-amz-acl\': acl };',
'\t\t\t\t\toptions.multipartMode = false;',
'\t\t\t\t}',
'\t\t\t\tft.upload(filenameURI, s3URI, fileUploadSuccess, fileUploadFailed, options,flagTrustAllHosts);',
'\t\t\t} else {',
'\t\t\t\tarr[fileNumber].aborted = true;',
'\t\t\t\tarr[fileNumber].completed = true;',
'\t\t\t}',
'\t\t}',
'\t\tphoneGapUploadDoWork(arr,options);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory = function(dirName, onComplete, onError) {',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\t//got the filesystem',
'\t\t\tvar onDirCreateSuccess = function(dirEntry) {',
'\t\t\t\tif(typeof onComplete == \'function\') {',
'\t\t\t\t\tonComplete();',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tfs.root.getDirectory(dirName, {create: true},onDirCreateSuccess, onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectoryRecurse = function(dirName, onComplete, onError) {',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar prepareWork = function(dir) {',
'\t\t\tvar arr = dir.split(\'/\');',
'\t\t\tvar arr3 = [];',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tvar arr2 = [];',
'\t\t\t\tfor(var k = 0; k < i + 1; k++) {',
'\t\t\t\t\tarr2.push(arr[k]);',
'\t\t\t\t}',
'\t\t\t\tarr3.push(arr2.join(\'/\'));',
'\t\t\t}',
'\t\t\treturn arr3;',
'\t\t}',
'\t\tvar arr = prepareWork(dirName);',
'\t\tvar count = 0;',
'\t\tvar onCompleteLocal = function() {',
'\t\t\tif(count == arr.length) {',
'\t\t\t\tonComplete();',
'\t\t\t} else {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory(arr[count],onCompleteLocal,onError);',
'\t\t\t\t++count;',
'\t\t\t}',
'\t\t}',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateDirectory(arr[count],onCompleteLocal,onError);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory = function(dirName, onComplete, onError) {',
'\t\t//calls onComplete with an array of files in the directory',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\t//got filesystem event handler',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tif(dirName.indexOf(\'/\') == 0) dirName = dirName.substring(1);',
'\t\t\t//got the fileSystem',
'\t\t\t//alert(\'got fs - dirName:  \' + dirName);',
'\t\t\tfs.root.getDirectory(dirName,{},function(e) {',
'\t\t\tvar dirReader = e.createReader();',
'\t\t\tvar listFiles = function(entries) {',
'\t\t\t\tvar fileCount = entries.length;',
'\t\t\t\tvar arr = [];',
'\t\t\t\tvar displayName = \'\';',
'\t\t\t\tfor(var i = 0; i < fileCount ; i++) {',
'\t\t\t\t\tif(entries[i].isFile) displayName = entries[i].fullPath + \' [F]\';',
'\t\t\t\t\telse displayName = entries[i].fullPath + \' [D]\';',
'\t\t\t\t\tarr.push( {fullPath: entries[i].fullPath, isFile: entries[i].isFile, display: displayName } );',
'\t\t\t\t}',
'\t\t\t\tif(typeof onComplete == \'function\') {',
'\t\t\t\t\tonComplete(arr);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tdirReader.readEntries(listFiles,onError);',
'\t\t},onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectoryRecurse = function(folder, onDirComplete, onDirError) {',
'\t\t//onDirComplete gets called with files, an array of all files. each array entry has a \'fileName\' property.',
'\t\tvar files = [];',
'\t\tvar pending = 0;',
'\t\tvar onComplete = function(array) {',
'\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\tif(array[i].isFile) {',
'\t\t\t\t\tfiles.push({fullPath: array[i].fullPath, isFile: true, display: array[i].fullPath + \' [F]\'})',
'\t\t\t\t} else {',
'\t\t\t\t\t++pending;',
'\t\t\t\t\tfiles.push({fullPath: array[i].fullPath, isFile: false, display: array[i].fullPath + \' [D]\'})',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory(array[i].fullPath,onComplete,onError)',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t--pending;',
'\t\t\tif(pending == 0) {',
'\t\t\t\tonDirComplete(files);',
'\t\t\t}',
'\t\t}',
'\t\tvar onError = function(err) {',
'\t\t\tif(typeof onDirError == \'function\') {',
'\t\t\t\tonDirError(err);',
'\t\t\t\tonDirComplete = function() { } //prevent the all complete from firing',
'\t\t\t}',
'\t\t\telse alert(\'Error\');',
'\t\t}',
'\t\t++pending;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetDirectory(folder,onComplete,onError);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectory = function(dirName,onSuccess,onError,flagRecursive) {',
'\t\tif(typeof flagRecursive == \'undefined\') flagRecursive = false;',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar gotDirectory = function(dirEntry) {',
'\t\t\t\tif(flagRecursive) {',
'\t\t\t\t\tdirEntry.removeRecursively(function() {',
'\t\t\t\t\t\tif(typeof onSuccess == \'function\') onSuccess();',
'\t\t\t\t\t},onError);',
'\t\t\t\t} else {',
'\t\t\t\t\tdirEntry.remove(function() {',
'\t\t\t\t\t\tif(typeof onSuccess == \'function\') onSuccess();',
'\t\t\t\t\t},onError);',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//if you cant find the dir then it is effectively removed, so call onSuccess',
'\t\t\tfs.root.getDirectory(dirName, {}, gotDirectory, onSuccess);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurse = function(dirName,onSuccess,onError) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectory(dirName,onSuccess,onError,true);',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFile = function(fileName,onSuccess,onError) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tfs.root.getFile(fileName, {create: false}, function(f) {',
'\t\t\t\tf.remove( function() {',
'\t\t\t\t\tif(typeof onSuccess == \'function\') {',
'\t\t\t\t\t\tonSuccess();',
'\t\t\t\t\t}',
'\t\t\t\t}, onError );',
'\t\t\t}, onError);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExists = function(fileName,onResult,onFailed) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar gotFile = function(f) {',
'\t\t\t\tif(typeof onResult == \'function\') onResult(true);',
'\t\t\t}',
'\t\t\tvar didNotGetFile = function() {',
'\t\t\t\tif(typeof onResult == \'function\') onResult(false);',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create: false}, gotFile,didNotGetFile);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onFailed );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFile = function(fileName,onReadFile,onReadFileERROR,startAt,endAt) {',
'\t\tif(typeof fileName == \'object\') {',
'\t\t\tvar fnObj = fileName;',
'\t\t\tvar _success = onReadFile',
'\t\t\tif(typeof onReadFileERROR == \'undefined\') onReadFileERROR = function(err) { };',
'\t\t\tvar _error = onReadFileERROR;',
'\t\t\tif(fnObj._strip) {',
'\t\t\t\tvar _filePath = this.phoneGapGetLocalDirURL(fnObj._fs) + fnObj._dir + \'/\' + fnObj.fileNameShort;',
'\t\t\t} else {',
'\t\t\t\tvar _filePath = this.phoneGapGetLocalDirURL(fnObj._fs) + fnObj._dir + \'/\' + \'A5SessionFile/\' + fnObj.fileNameShort;',
'\t\t\t}',
'\t\t\tif(typeof startAt == \'undefined\') {',
'\t\t\t\tthis.phoneGapReadFileURL(_filePath, _success,_error);',
'\t\t\t} else {',
'\t\t\t\tthis.phoneGapReadFileURL(_filePath, _success,_error,startAt,endAt);',
'\t\t\t}',
'\t\t\treturn true;',
'\t\t}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar readFile = function(f) {',
'\t\t\t\tf.file( function(e) {',
'\t\t\t\t\treader = new FileReader();',
'\t\t\t\t\treader.onloadend = function(e) {',
'\t\t\t\t\t\tif(typeof onReadFile == \'function\') {',
'\t\t\t\t\t\t\tonReadFile(e.target.result);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tif(typeof startAt == \'undefined\' || typeof endAt == \'undefined\') {',
'\t\t\t\t\t\treader.readAsText(e);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar blob = e.slice(startAt,endAt);',
'\t\t\t\t\t\treader.readAsText(blob);',
'\t\t\t\t\t}',
'\t\t\t\t});',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create: false}, readFile, onReadFileERROR);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onReadFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low = function(fileName,text,onCreatedFile,onCreateFileERROR) {',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar writeFileData = function(f) {',
'\t\t\t\tvar doFileWrite = function(writerObject) {',
'\t\t\t\t\twriterObject.onwrite = function() {',
'\t\t\t\t\t\tif(typeof onCreatedFile == \'function\') onCreatedFile();',
'\t\t\t\t\t}',
'\t\t\t\t\twriterObject.seek(writerObject.length);',
'\t\t\t\t\tvar blob = new Blob([text], {type: \'text/plain\'});',
'\t\t\t\t\twriterObject.write(blob);',
'\t\t\t\t}',
'\t\t\t\tf.createWriter(doFileWrite);',
'\t\t\t}',
'\t\t\tfs.root.getFile(fileName, {create:true}, writeFileData, onCreateFileERROR);',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onCreateFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCreateFile = function(fileName,text,onCreatedFile,onCreateFileERROR,flagAppend) {',
'\t\tif(fileName == \'\') {if(typeof onCreateFileERROR == \'function\') onCreateFileERROR(); return false;}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tif(!flagAppend) {',
'\t\t\t\tvar onDelete = function() {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low(fileName,text,onCreatedFile,onCreateFileERROR);',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFile(fileName,onDelete,onDelete)',
'\t\t\t} else {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapCreateFile_low(fileName,text,onCreatedFile,onCreateFileERROR)',
'\t\t\t}',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onCreateFileERROR );',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload = function(arr,options) {',
'\t\tvar totalSizePassedIn = 0;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(typeof arr[i].size != \'undefined\') totalSizePassedIn = totalSizePassedIn + arr[i].size;',
'\t\t}',
'\t\toptions.totalSizePassedIn = totalSizePassedIn',
'\t\tif(totalSizePassedIn > 0) options.totalFileSize = totalSizePassedIn;',
'\t\tif(typeof options.targetFolder == \'undefined\') {',
'\t\t\tvar _baseURI = this.phoneGapGetLocalDirURL(options.filesystem);; //sr2',
'\t\t\tvar _dirName = options.directory;;',
'\t\t\tif(_dirName == \'\') {',
'\t\t\t\tvar _dirPath = _baseURI;',
'\t\t\t} else {',
'\t\t\t\tvar _dirPath = _baseURI + _dirName + \'/\';',
'\t\t\t}',
'\t\t\toptions.fullyQualifiedPath = _dirPath;',
'\t\t}',
'\t\tvar _countDone = 0;',
'\t\tvar flagCustomOnError = false;',
'\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\t\t//if(!flagCustomOnError) window.onerror = function(err) { alert(\'Unhandled Javascript Error - phoneGapFileDownload:  \' + JSON.stringify(err));}',
'\t\tvar _dlgObj = this;',
'\t\tif(typeof LocalFileSystem == \'undefined\') {',
'\t\t\tif(typeof cordova == \'undefined\') {',
'\t\t\t\talert(\'Method not supported when not running in PhoneGap\');',
'\t\t\t} else {',
'\t\t\t\talert(\'Required PhoneGap plugins (\\\'LocalFileSystem\\\') not loaded.\');',
'\t\t\t}',
'\t\t\treturn false;',
'\t\t}',
'\t\tif(typeof onError == \'undefined\') onError = function(err) { };',
'\t\t//got filesystem event handler',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].handled = false;',
'\t\t\tarr[i].downloaded = false;',
'\t\t\tarr[i].sourceType = \'server\';',
'\t\t\tif(arr[i].filename.toLowerCase().indexOf(\'http://\') == 0) arr[i].sourceType = \'url\';',
'\t\t\tif(arr[i].filename.toLowerCase().indexOf(\'https://\') == 0) arr[i].sourceType = \'url\';',
'\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\tarr[i].sourceFilename = arr[i].filename.split(\'/\').pop().split(\'?\')[0];',
'\t\t\t}',
'\t\t}',
'\t\tvar onFSSuccess = function(fs) {',
'\t\t\tvar baseDirectory = fs.root.toURL();',
'\t\t\toptions._baseDirectory = baseDirectory; //sr 99',
'\t\t\tvar url = {UXPRERENDEREDALIAS}_DlgObj.ajaxURL;',
'\t\t\t;',
'\t\t\turl = url.split(\'?\')[0];',
'\t\t\turl = url.split(\'/\');',
'\t\t\turl.pop();',
'\t\t\turl = url.join(\'/\') + \'/\';',
'\t\t\toptions._serverURL = url;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t//arr[i].localFileName = false;',
'\t\t\t}',
'\t\t\tif(options.showProgress) {',
'\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\tif(typeof eleTarget != \'undefined\'){',
'\t\t\t\t\tif(eleTarget != eleTarget.toUpperCase() ) {',
'\t\t\t\t\t\talert(\'error: PROGRESS WILL NOT BE SHOWN. target div name MUST be uppercase. you have specified :\' + eleTarget);',
'\t\t\t\t\t}',
'\t\t\t\t\teleTarget = eleTarget.toUpperCase();',
'\t\t\t\t}',
'\t\t\t\tvar idProgress = eleTarget;',
'\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\tif(!ele) options.showProgress = false; //set to false or else you will hang iOS',
'\t\t\t}',
'\t\t\tif(options.showProgress) {',
'\t\t\t\tvar ops = options.progress;',
'\t\t\t\tops.totalFileSize = options.totalFileSize;',
'\t\t\t\tvar eleTarget = ops.progressElement;',
'\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\tvar html = \'\';',
'\t\t\t\tvar html_i = \'\';',
'\t\t\t\tvar name_i = \'\';',
'\t\t\t\tvar progress_i = \'\';',
'\t\t\t\tvar idName = \'\';',
'\t\t\t\tvar idProgress = \'\';',
'\t\t\t\tidProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\tidName = eleTarget + \'.NAME.TOTAL\';',
'\t\t\t\tprogress_i = \'<div style="background-color: #f3f0ef; border: solid 1px gray; border-radius: 5px; width: \'+ops.width+\'; ">\';',
'\t\t\t\tprogress_i += \'<div id="\'+idProgress+\'"style="width: 0%; height: .05in;  background-color:\'+ops.color+\';border-radius: 5px; border: solid .5px \'+ops.color+\';"></div></div>\';',
'\t\t\t\thtml_i = \'<div id="\'+idName+\'" ></div>\'+progress_i;',
'\t\t\t\thtml = html + html_i',
'\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\thtml = \'<div id="\'+idProgress+\'"  style="width: 100%" >\' + html + \'</div>\';',
'\t\t\t\tif ($(eleTarget)) $(eleTarget).innerHTML = html;',
'\t\t\t\tvar msg = \'eleTarget: \' + eleTarget + \'\\n\' + html',
'\t\t\t\tvar showProgress = function(pct,arr,fileNumber,loaded,totalBytes, onProgressEvent,completedFiles) {',
'\t\t\t\t\tvar eleTarget = options.progress.progressElement',
'\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESS.TOTAL\';',
'\t\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\t\tif(ele) {',
'\t\t\t\t\t\tif(pct >=100) pct = 100;',
'\t\t\t\t\t\tele.style.width = pct + \'%\';',
'\t\t\t\t\t\tele.style.borderRadius = \'5px\';',
'\t\t\t\t\t}',
'\t\t\t\t\tif(typeof onProgressEvent == \'function\') {',
'\t\t\t\t\t\t//match the prototype of the function: array, arrayIndex, pctComplete, bytesCompleted, bytesTotal, completedFiles',
'\t\t\t\t\t\tonProgressEvent(arr,fileNumber,pct,loaded,totalBytes,completedFiles)',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tvar showProgress = function(pct) { };',
'\t\t\t\t//this is wrong. if the user has turned showprogress off, then the showProgress() function must still be defined, passsing in the user defined onProgress event',
'\t\t\t}',
'\t\t\tvar phoneGapFileDownload_low = function(arr,iIn,options) {',
'\t\t\t\tvar i = Number(iIn);',
'\t\t\t\tif(typeof options.targetFolder != \'undefined\') {',
'\t\t\t\t\tvar targetFolder = options.targetFolder;',
'\t\t\t\t\tif(targetFolder != \'\') targetFolder = targetFolder + \'/\';',
'\t\t\t\t\tif(typeof options._baseDirectory != \'undefined\') {',
'\t\t\t\t\t\tvar fnLocal = options._baseDirectory + targetFolder + A5.parseFilename(arr[i].filename).name;',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar fnLocal = targetFolder + A5.parseFilename(arr[i].filename).name; //sr99',
'\t\t\t\t\t}',
'\t\t\t\t} else {',
'\t\t\t\t\tvar flagStrip = false;',
'\t\t\t\t\tif(typeof options.strip != \'undefined\') flagStrip = options.strip;',
'\t\t\t\t\tvar flagHasA5SessionFilePrefix = false',
'\t\t\t\t\tif(arr[i].filename.indexOf(\'A5SessionFile/\') >=0) flagHasA5SessionFilePrefix = true;',
'\t\t\t\t\tif(flagStrip) {',
'\t\t\t\t\t\tvar _fn = (A5.parseFilename(arr[i].filename).name).replace(\'A5SessionFile/\',\'\');',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar _fn = A5.parseFilename(arr[i].filename).name;',
'\t\t\t\t\t\tif(flagHasA5SessionFilePrefix) _fn = \'A5SessionFile/\' + _fn;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar fnLocal = options.fullyQualifiedPath + _fn;',
'\t\t\t\t}',
'\t\t\t\t//alert(fnLocal); //could strip off /A5SessionFile',
'\t\t\t\t/*',
'\t\t\t\tnot sure why this is being done, but wrong',
'\t\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\t\tif(typeof targetFolder == \'undefined\') {',
'\t\t\t\t\t\ttargetFolder = options.directory + \'/\';',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\ttargetFolder = options.targetFolder + \'/\';',
'\t\t\t\t\t}',
'\t\t\t\t\tfnLocal = options._baseDirectory + targetFolder +arr[i].sourceFilename;',
'\t\t\t\t}',
'\t\t\t\t*/',
'\t\t\t\tif(A5.log) A5.log(\'fnLocal: \' + fnLocal);',
'\t\t\t\t//if the targetFolder is <SQLite>|localdbname.db user is doing a special download to the SQL database folder',
'\t\t\t\tvar flagSQLite = false;',
'\t\t\t\t/*',
'\t\t\t\tif(targetFolder.indexOf(\'<SQLite>\') == 0) {',
'\t\t\t\t\tvar localDBName = targetFolder.split(\'|\')[1];',
'\t\t\t\t\tlocalDBName = localDBName.split(\'/\')[0];',
'\t\t\t\t\tflagSQLite = true;',
'\t\t\t\t\tvar thisPackageName = \'\';',
'\t\t\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\t\t\tvar localDbFileUrl = \t{',
'\t\t\t\t\t\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\tios: \'cdvfile://localhost/persistent/\' + localDBName',
'\t\t\t\t\t\t\t//cdvfile://localhost/persistent/sqlite/\' + localDBName',
'\t\t\t\t\t\t};',
'\t\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t\t\t\t\t}',
'\t\t\t\t\tvar thisDevice = device.platform;',
'\t\t\t\t\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\t\t\t\t\tconsole.log(\'database location: \' + fileUrl);',
'\t\t\t\t\tfnLocal = fileUrl;',
'\t\t\t\t}',
'\t\t\t\t*/',
'\t\t\t\tif(typeof options.targetFolder != \'undefined\') {',
'\t\t\t\t\tif(targetFolder.indexOf(\'<SQLite>\') == 0) {',
'\t\t\t\t\t\tvar localDBName = targetFolder.split(\'|\')[1];',
'\t\t\t\t\t\tlocalDBName = localDBName.split(\'/\')[0];',
'\t\t\t\t\t\tflagSQLite = true;',
'\t\t\t\t\t\tvar thisPackageName = \'\';',
'\t\t\t\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\t\t\t\tvar localDbFileUrl = {',
'\t\t\t\t\t\t\t// Android note: This entry was tested and works on Android 6.01, 5.5.1, 4.4.2',
'\t\t\t\t\t\t\tandroidx: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\tandroid: cordova.file.applicationStorageDirectory.substr(7) + \'databases/\' + localDBName,',
'\t\t\t\t\t\t\t// iOS Note: dataDirectory will point to ..appid/Library/NoCloud',
'\t\t\t\t\t\t\t// This is not exposed to iTunes or iCloud',
'\t\t\t\t\t\t\tios: cordova.file.dataDirectory + localDBName',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\tif(typeof device == \'undefined\') {',
'\t\t\t\t\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tvar thisDevice = device.platform;',
'\t\t\t\t\t\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\t\t\t\t\t\tconsole.log(\'.phoneGapFileDownload reports fileUrl: \' + fileUrl);',
'\t\t\t\t\t\tfnLocal = fileUrl;',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar fileFound = function() {',
'\t\t\t\t\tvar forceDownload = false;',
'\t\t\t\t\tforceDownload = options.forceDownloadIfFileExists;',
'\t\t\t\t\tif(typeof forceDownload == \'undefined\') forceDownload = false;',
'\t\t\t\t\tif(forceDownload) {',
'\t\t\t\t\t\tfileNotFound();',
'\t\t\t\t\t\treturn true;',
'\t\t\t\t\t}',
'\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\tarr[i].found = true;',
'\t\t\t\t\tarr[i].localFilename = fnLocal;',
'\t\t\t\t\tarr[i].success = true;',
'\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t////',
'\t\t\t\t\tvar totalBytes = 0;',
'\t\t\t\t\tvar loaded = 0;',
'\t\t\t\t\tvar pctCompleteTotal = 0;',
'\t\t\t\t\tvar flagStartShowingProgress = true;',
'\t\t\t\t\tvar completedFiles = 0;',
'\t\t\t\t\tvar totalSize = 0;',
'\t\t\t\t\tvar _pctMethod = \'auto\' //base on filesLoadedCount if array size > 10',
'\t\t\t\t\tif(typeof options != \'undefined\') {',
'\t\t\t\t\t\tif(typeof options.pctMethod != \'undefined\') _pctMethod = options.pctMethod',
'\t\t\t\t\t}',
'\t\t\t\t\tif(arr.length == 1) _pctMethod = \'auto\';',
'\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\tif(typeof arr[k].totalBytes != \'undefined\') {',
'\t\t\t\t\t\t\ttotalBytes = totalBytes + arr[k].totalBytes;',
'\t\t\t\t\t\t\tloaded = loaded + arr[k].bytesLoaded;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(arr[k].handled) completedFiles++;',
'\t\t\t\t\t\tpctCompleteTotal = (loaded/totalBytes) * 100;',
'\t\t\t\t\t\tif(totalSize > 0) {',
'\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalSize) * 100;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(_pctMethod == \'auto\') {',
'\t\t\t\t\t\t\tif(arr.length >= 10) _pctMethod = \'fileCount\';',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tif(_pctMethod == \'fileCount\') {',
'\t\t\t\t\t\t\tpctCompleteTotal = (completedFiles/ arr.length) * 100;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(flagStartShowingProgress || true ) showProgress(pctCompleteTotal,arr,i,loaded,totalBytes, options.onProgressEvent,completedFiles);',
'\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase();',
'\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\tvar ele = $(idProgress);',
'\t\t\t\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar fileNotFound = function() {',
'\t\t\t\t\t//file was not in the local filesystem so must download it.',
'\t\t\t\t\tarr[i].found = false;',
'\t\t\t\t\tarr[i].localFilename = fnLocal;',
'\t\t\t\t\tvar url2 = options._serverURL + arr[i].filename;',
'\t\t\t\t\tif(arr[i].sourceType == \'url\') {',
'\t\t\t\t\t\turl2 = arr[i].filename;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ft = new FileTransfer();',
'\t\t\t\t\tft.onprogress = function(progressEvent) {',
'\t\t\t\t\t\tif (progressEvent.lengthComputable) {',
'\t\t\t\t\t\t\tarr[i].totalBytes = progressEvent.total;',
'\t\t\t\t\t\t\tarr[i].bytesLoaded = progressEvent.loaded;',
'\t\t\t\t\t\t\tvar totalSize = -1;',
'\t\t\t\t\t\t\t_pctMethod = \'auto\' //base on filesLoadedCount if array size > 10',
'\t\t\t\t\t\t\tif(typeof options != \'undefined\') {',
'\t\t\t\t\t\t\t\ttotalSize = options.totalFileSize;',
'\t\t\t\t\t\t\t\tif(typeof options.pctMethod != \'undefined\') _pctMethod = options.pctMethod',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(arr.length == 1) _pctMethod = \'auto\';',
'\t\t\t\t\t\t\t//alert(_pctMethod);',
'\t\t\t\t\t\t\tif(typeof totalSize == \'undefined\') totalSize = -1;',
'\t\t\t\t\t\t\tif(totalSize == -1) {',
'\t\t\t\t\t\t\t\tvar pctComplete = (progressEvent.loaded / progressEvent.total)*100;',
'\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\tvar pctComplete = (progressEvent.loaded / totalSize)*100;',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(pctComplete > 100) pctComplete = 100;',
'\t\t\t\t\t\t\tpctComplete = $u.n.round(pctComplete,4);',
'\t\t\t\t\t\t\tarr[i].pctComplete = pctComplete;',
'\t\t\t\t\t\t\tvar totalBytes = 0;',
'\t\t\t\t\t\t\tvar loaded = 0;',
'\t\t\t\t\t\t\tvar pctCompleteTotal = 0;',
'\t\t\t\t\t\t\tvar flagStartShowingProgress = true;',
'\t\t\t\t\t\t\tvar completedFiles = 0;',
'\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\tif(typeof arr[k].totalBytes != \'undefined\') {',
'\t\t\t\t\t\t\t\t\ttotalBytes = totalBytes + arr[k].totalBytes;',
'\t\t\t\t\t\t\t\t\tloaded = loaded + arr[k].bytesLoaded;',
'\t\t\t\t\t\t\t\t\tif(arr[k].handled) completedFiles++;',
'\t\t\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalBytes) * 100;',
'\t\t\t\t\t\t\t\t\tif(typeof options.totalSizePassedIn > 0) {',
'\t\t\t\t\t\t\t\t\t\ttotalSize = options.totalSizePassedIn;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(totalSize > 0) {',
'\t\t\t\t\t\t\t\t\t\tpctCompleteTotal = (loaded/totalSize) * 100;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(_pctMethod == \'auto\') {',
'\t\t\t\t\t\t\t\t\t\tif(arr.length >= 10) _pctMethod = \'fileCount\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tif(_pctMethod == \'fileCount\') {',
'\t\t\t\t\t\t\t\t\t\tpctCompleteTotal = (completedFiles/ arr.length) * 100;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t\tpctCompleteTotal = $u.n.round(pctCompleteTotal,1);',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\tif(flagStartShowingProgress || true ) showProgress(pctCompleteTotal,arr,i,loaded,totalBytes, options.onProgressEvent,completedFiles); //sr55',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t//alert(\'length NOT computable: \' + arr[i].filename);',
'\t\t\t\t\t\t\tconsole.log(\'PhoneGap fileTransfer event. onProgress. length NOT computable: \' + arr[i].filename)',
'\t\t\t\t\t\t\t//alert(\'progressevent: \' + JSON.stringify(progressEvent));',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar flagTrustAllHosts = false;',
'\t\t\t\t\tif(typeof _dlgObj._phoneGapTrustAllHosts != \'undefined\') {',
'\t\t\t\t\t\tflagTrustAllHosts = _dlgObj._phoneGapTrustAllHosts;',
'\t\t\t\t\t}',
'\t\t\t\t\t//had a url like this: https://aapdf.s3.amazonaws.com/651 - 2015007 - HL072 - Summary P&L.PDF',
'\t\t\t\t\t//need to urlencode the url and the fnLocal to get this',
'\t\t\t\t\t//https://aapdf.s3.amazonaws.com/651%20-%202015007%20-%20HL072%20-%20Summary%20P%26L.PDF',
'\t\t\t\t\t//first decode, then encode again to make sure we don\'t double encode',
'\t\t\t\t\t//the fix the encoded \'&\' - %2526 to change to %26',
'\t\t\t\t\tvar testString1 = url2.toLowerCase();',
'\t\t\t\t\tvar testString2 = decodeURI(url2).toLowerCase();',
'\t\t\t\t\tvar search = \'X-Amz-\'.toLowerCase();',
'\t\t\t\t\tvar flagDoEncode = true;',
'\t\t\t\t\tif(testString1.indexOf(search) > -1 || testString2.indexOf(search) > -1) flagDoEncode = false;',
'\t\t\t\t\t//if the url to download from S3 is signed then the urlencode() will break the download',
'\t\t\t\t\tif(flagDoEncode) {',
'\t\t\t\t\t\turl2 = encodeURI(decodeURI(url2));',
'\t\t\t\t\t\turl2 = url2.replace(/%2526/g,\'%26\');',
'\t\t\t\t\t}',
'\t\t\t\t\tfnLocal = encodeURI(decodeURI(fnLocal));',
'\t\t\t\t\tfnLocal = fnLocal.replace(/%2526/g,\'%26\');',
'\t\t\t\t\tif(A5.log) A5.log(\'Inside PhoneGap file transfer url2: \' + url2);',
'\t\t\t\t\tif(A5.log) A5.log(\'Inside PhoneGap file transfer fnLocal: \' + fnLocal);',
'\t\t\t\t\tvar sessionId = \'unknown\';',
'\t\t\t\t\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.__sessionId != \'undefined\') sessionId = {UXPRERENDEREDALIAS}_DlgObj.__sessionId;',
'\t\t\t\t\tvar FToptions = {',
'\t\t\t\t\t\theaders: {\'X-A5WSessionId\':sessionId }',
'\t\t\t\t\t}',
'\t\t\t\t\tft.download(url2, fnLocal,',
'\t\t\t\t\t\t\tfunction(entry) {',
'\t\t\t\t\t\t\t\tarr[i].success = true;',
'\t\t\t\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\t\t\t\tarr[i].downloaded = true;',
'\t\t\t\t\t\t\t\t//fileAllDone();',
'\t\t\t\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t_countDone++;',
'\t\t\t\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\t\t\t\tshowProgress(100,arr,1,-1,-1, options.onProgressEvent,arr.length); //sr55',
'\t\t\t\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\t\t\t\tif(options.showProgress) {',
'\t\t\t\t\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase()',
'\t\t\t\t\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\t\t\t\t\tif($(idProgress)) $(idProgress).style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tfunction(err) {',
'\t\t\t\t\t\t\t\tarr[i].success = false;',
'\t\t\t\t\t\t\t\tarr[i].errorText = JSON.stringify(err);',
'\t\t\t\t\t\t\t\tarr[i].handled = true;',
'\t\t\t\t\t\t\t\tif(A5.log) A5.log(\'Error in .download() function: \' + arr[i].errorText);',
'\t\t\t\t\t\t\t\tvar allHandled = true;',
'\t\t\t\t\t\t\t\tfor(var k = 0; k < arr.length; k++) {',
'\t\t\t\t\t\t\t\t\tif(!arr[k].handled) {',
'\t\t\t\t\t\t\t\t\t\tallHandled = false;',
'\t\t\t\t\t\t\t\t\t\tbreak;',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\tif(allHandled) {',
'\t\t\t\t\t\t\t\t\tif(typeof options.onComplete == \'function\') options.onComplete(arr);',
'\t\t\t\t\t\t\t\t\tif(options.showProgress) {',
'\t\t\t\t\t\t\t\t\t\tvar eleTarget = options.progress.progressElement;',
'\t\t\t\t\t\t\t\t\t\tif(typeof eleTarget != \'undefined\') eleTarget = eleTarget.toUpperCase()',
'\t\t\t\t\t\t\t\t\t\tvar idProgress = eleTarget + \'.PROGRESSDISPLAY\';',
'\t\t\t\t\t\t\t\t\t\tif($(idProgress)) $(idProgress).style.display = \'none\';',
'\t\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t},',
'\t\t\t\t\t\t\tflagTrustAllHosts, FToptions',
'\t\t\t\t\t);',
'\t\t\t\t\t//end fetch file  ---------------------------------------',
'\t\t\t\t\t//true/false -- trustAllHosts parameter',
'\t\t\t\t}',
'\t\t\t\twindow.resolveLocalFileSystemURL(fnLocal, fileFound, fileNotFound);',
'\t\t\t}',
'\t\t\tif(A5.log) A5.log(\'Call phoneGapFileDownload_low\');',
'\t\t\tif(A5.log) A5.log(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tphoneGapFileDownload_low(arr,i,options)',
'\t\t\t}',
'\t\t}',
'\t\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\t\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, onError );',
'\t}',
'\tA5.ts = function() {',
'\t\tvar d = new Date()',
'\t\treturn d.getTime().toString(36);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetFileSystemURIForLegacyPersistentStorage = function(ok,fail) {',
'\tvar _ok = ok;',
'\tvar onFSSuccess = function(fs) {',
'\t\tvar uri = fs.root.filesystem.root.nativeURL;',
'\t\t_ok(uri);',
'\t}',
'\tif(!{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded(true)) return false;',
'\twindow.requestFileSystem(LocalFileSystem.PERSISTENT, 0, onFSSuccess, fail );',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._isPGFileLoaded = function(flagShowAlert) {',
'\tvar flag = true;',
'\tif(typeof window.requestFileSystem == \'undefined\') flag =  false;',
'\tif(typeof window.resolveLocalFileSystemURL == \'undefined\') flag =  false;',
'\tif(typeof LocalFileSystem == \'undefined\') flag =  false;',
'\tif(typeof flagShowAlert != \'undefined\' && flagShowAlert && !flag) {',
'\t\talert(\'PhoneGap File plugin is not loaded\');',
'\t}',
'\treturn flag;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.base64DataToBlob = function(dataURI) {',
'\t//data:image/jpeg;base64,/',
'\t// convert base64/URLEncoded data component to raw binary data held in a string',
'    var byteString;',
'    if (dataURI.split(\',\')[0].indexOf(\'base64\') >= 0)',
'        byteString = atob(dataURI.split(\',\')[1]);',
'    else',
'        byteString = unescape(dataURI.split(\',\')[1]);',
'        if(typeof byteString == \'undefined\') byteString = dataURI;',
'    // separate out the mime component',
'    var mimeString = dataURI.split(\',\')[0].split(\':\')[1].split(\';\')[0];',
'    // write the bytes of the string to a typed array',
'    var ia = new Uint8Array(byteString.length);',
'    for (var i = 0; i < byteString.length; i++) {',
'        ia[i] = byteString.charCodeAt(i);',
'    }',
'    return new Blob([ia], {type:mimeString});',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteDownloadDatabase = function(SQLiteDBURL,localDBName,onComplete,onError,optionsIn) {',
'\tif(SQLiteDBURL.indexOf(\'http://\') == 0 || SQLiteDBURL.indexOf(\'https://\') == 0) {',
'\t\t//don\'t need to add the baseURL',
'\t} else {',
'\t\tvar url = {UXPRERENDEREDALIAS}_DlgObj.ajaxURL;',
'\t\turl = url.split(\'?\')[0];',
'\t\turl = url.split(\'/\');',
'\t\turl.pop();',
'\t\turl = url.join(\'/\') + \'/\';',
'\t\tSQLiteDBURL =  url + SQLiteDBURL;',
'\t}',
'\tif(typeof onError != \'function\') {',
'\t\tonError = function(error) {',
'\t\t\talert(\'Database Download Failed. File transfer error: \'+error);',
'\t\t}',
'\t}',
'\tif(typeof _phoneGapSettings == \'undefined\') {',
'\t\talert(\'PhoneGap not loaded\');',
'\t\treturn false;',
'\t}',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\tflagSQL = true;',
'\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\tif(!flagSQL) {',
'\t\talert(\'SQLitePluginExt not loaded\');',
'\t\treturn false;',
'\t}',
'\t////////////////////',
'\tif(typeof optionsIn == \'undefined\') {',
'\t\tvar ops = {',
'\t\t\tshowProgress : false,',
'\t\t\tforceDownloadIfFileExists : true',
'\t\t\t}',
'\t} else {',
'\t\tvar ops = optionsIn',
'\t}',
'\tvar arr = [];',
'\tarr.push({filename: SQLiteDBURL});',
'\tvar options = {};',
'\toptions.targetFolder = \'<SQLite>|\' + localDBName;',
'\toptions.onComplete = function() {',
'\t\tonComplete.call();',
'\t}',
'\toptions.onError = function() { onError.call() };',
'\toptions.showProgress = ops.showProgress;',
'\toptions.forceDownloadIfFileExists = ops.forceDownloadIfFileExists;',
'\tif(options.showProgress) {',
'\t\toptions.progress = ops.progress;',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'\t///////////////////////////////////',
'\t/*',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\t//alert(thisPackageName)',
'\tvar localDbFileUrl = \t{',
'\t\t\t\t\t\t\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + localDBName,',
'\t\t\t\t\t\t\t\tios: \'cdvfile://localhost/persistent/\' + localDBName',
'\t\t\t\t\t\t\t};',
'\tif(typeof device == \'undefined\') {',
'\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t}',
'\tvar thisDevice = device.platform;',
'\tvar fileUrl = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\tvar fileTransfer = new FileTransfer();',
'\tvar uri = encodeURI(SQLiteDBURL);',
'\tvar options = {};',
'\tfileTransfer.download(uri,fileUrl,onComplete,onError,false,options);',
'\t*/',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQLPromise = function(dbName,sql,argumentsIn) {',
'\tvar f = function(resolve,reject) {',
'\t\tvar obj = {};',
'\t\tvar _ok = function(tx,result,resultArray) {',
'\t\t\tobj.result = result;',
'\t\t\tobj.resultArray = resultArray;',
'\t\t\tobj.tx = tx',
'\t\t\t//resolve(obj);',
'\t\t}',
'\t\tvar _fail = function(e) { };',
'\t\tvar _txOk = function() {',
'\t\t\tresolve(obj)',
'\t\t}',
'\t\tvar _txFail = function(e) {',
'\t\t\treject(e);',
'\t\t}',
'\t\tsetTimeout(function() {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,argumentsIn,_ok,_fail,_txOk,_txFail);',
'\t\t},50);',
'\t}',
'\treturn new Promise(f)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL = function(dbName,sql,argumentsIn,onSuccess,onError, onTransactionSuccess, onTransactionError, flagCloseDB,transObj) {',
'\tif(typeof transObj == \'undefined\') {',
'\t\ttransObj = {};',
'\t}',
'\tvar flagSQLisArray = false;',
'\tif(sql.constructor == Array) flagSQLisArray = true;',
'\tif(typeof flagCloseDB == \'undefined\') flagCloseDB = true;',
'\tvar flagCustomOnError = false;',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents != \'undefined\') flagCustomOnError = {UXPRERENDEREDALIAS}_DlgObj.customWindowErrorEvents;',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\t\tflagSQL = true;',
'\t\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\t\tif(!flagSQL) {',
'\t\t\talert(\'SQLitePluginExt not loaded\');',
'\t\t\treturn false;',
'\t}',
'\tif(typeof onSuccess == \'undefined\') onSuccess = false;',
'\tif(typeof onError == \'undefined\') onError = false;',
'\tif(typeof argumentsIn == \'undefined\' || argumentsIn.constructor != Array) argumentsIn = [];',
'\tif(onSuccess.constructor != Array)  {',
'\t\tif(typeof onSuccess != \'function\') {',
'\t\t\tonSuccess = function(tx,result) {',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(onError.constructor != Array)  {',
'\t\tif(typeof onError != \'function\') {',
'\t\t\t\tonError = function(e) {',
'\t\t\t\t}',
'\t\t}',
'\t}',
'\tif(typeof device == \'undefined\') {',
'\t\t\talert(\'PhoneGap required plugin not loaded: device\');',
'\t}',
'\tvar flagArrayOfObjects = false;',
'\tif(sql.constructor == Array) {',
'\t\tif(sql[0].constructor == Object) {',
'\t\t\tflagArrayOfObjects = true;',
'\t\t}',
'\t}',
'\tif(flagArrayOfObjects == false && flagSQLisArray) {',
'\t\t//convert to array of objects',
' \t\tvar obj2 = [];',
' \t\tfor(var i = 0; i <sql.length; i++) {',
' \t\t\tobj2.push({\'sql\': sql[i], \'arguments\': argumentsIn[i], \'onSuccess\': onSuccess[i], \'onError\':onError[i]});',
'\t\t}',
' \t\targumentsIn = false;',
'\t\t onSuccess = false;',
'\t\t onError = false;',
'\t\t sql = obj2',
'\t\tflagArrayOfObjects = true;',
'\t}',
'\tif(flagArrayOfObjects) {',
'\t\tvar a = sql;',
'\t\tdelete sql;',
'\t\tdelete sqlObject;',
'\t\tsql = [];',
'\t\tsqlObject = [];',
'\t\targumentsIn = [];',
'\t\tonSuccess = [];',
'\t\tonError = [];',
'\t\tfor(var i = 0; i < a.length; i++) {',
'\t\t\tsql[i] = a[i].sql;',
'\t\t\tsqlObject[i] = a[i];',
'\t\t\tif(typeof a[i].arguments != \'undefined\') {',
'\t\t\t\targumentsIn[i] = a[i].arguments;',
'\t\t\t} else {',
'\t\t\t\targumentsIn[i] = [];',
'\t\t\t}',
'\t\t\tif(typeof a[i].onSuccess != \'undefined\') {',
'\t\t\t\tonSuccess[i] = a[i].onSuccess;',
'\t\t\t} else {',
'\t\t\t\tonSuccess[i] = function() { };',
'\t\t\t}',
'\t\t\tif(typeof a[i].onError != \'undefined\') {',
'\t\t\t\tonError[i] = a[i].onError;',
'\t\t\t} else {',
'\t\t\t\tonError[i] = function() { };',
'\t\t\t}',
'\t\t}',
'\t}',
'\t/*',
'\tvar thisDevice = device.platform;',
'\t//var dbFilename = thisDevice == \'Android\' ? dbName:\'files/\' + dbName;',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\tvar localDbFileUrl = \t{',
'\t\tandroid: \'/data/data/\' + thisPackageName + \'/databases/\' + dbName,',
'\t\tios: \'cdvfile://localhost/persistent/\' + dbName',
'\t\t//cdvfile://localhost/persistent/sqlite/\' + localDBName',
'\t};',
'\tvar dbFilename = thisDevice == "Android" ? localDbFileUrl.android : localDbFileUrl.ios;',
'\tconsole.log(\'database location: \' + dbFilename);',
'\tdelete db;',
'\tif(typeof window.sqlitePlugin == \'undefined\') {',
'\t\talert(\'Error: PhoneGap SQLite plugin not loaded.\');',
'\t}',
'\tvar db = window.sqlitePlugin.openDatabase({name:dbFilename,location:2});',
'\t*/',
'\t///////////////// new code starts here/////////////',
'\t//start here........',
'\tvar thisDevice = device.platform;',
'\tvar dbFilename = thisDevice == \'Android\' ? dbName:\'NoCloud/\' + dbName;   //NoCloud -- no exposed to iTunes and not backed up to iCloud',
'\tconsole.log(\'.SQLiteExecuteSQL: database location = \' + dbFilename);',
'\tif(typeof window.sqlitePlugin == \'undefined\') {',
'\t\talert(\'Error: PhoneGap SQLite plugin not loaded.\');',
'\t}',
'\tvar location = \'download\';',
'\tif( dbName.indexOf(\'root:\') == 0) {',
'\t\tlocation = \'root\';',
'\t\tdbName = dbName.split(\'root:\')[1];',
'\t}',
'\t//this is for a db that is downloaded from the server',
'\tif(location == \'download\') {',
'\t\tvar db = window.sqlitePlugin.openDatabase({name:dbFilename,location:1});',
'\t} else {',
'\t\t//if the db is in the webroot (pre-populated), then use this code',
'\t\tvar db = window.sqlitePlugin.openDatabase({name: dbName , location: 2, createFromLocation: 1});',
'\t}',
'\t///// end here.....',
'\t///////////////////new code ends here ////////////////',
'\tdb.transaction(',
'\t\tfunction(tx) {',
'\t\t\tif(flagSQLisArray) {',
'\t\t\t}',
'\t\t\tvar flagArrayOfArrays = false;',
'\t\t\ttry{if(argumentsIn[0].constructor == Array) flagArrayOfArrays = true;} catch(e) {}',
'\t\t\tif(sql.constructor == Array || flagArrayOfArrays) {',
'\t\t\t\tif(sql.constructor == Array) {',
'\t\t\t\t\tvar sql_length = sql.length;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar sql_length = argumentsIn.length;',
'\t\t\t\t}',
'\t\t\t\tvar i = 0;',
'\t\t\t\tfunction _lowSQL(transObj) {',
'\t\t\t\t\tif(sql.constructor == Array) {',
'\t\t\t\t\t\tvar sql_i = sql[i];',
'\t\t\t\t\t\tvar sqlObject_i = sqlObject[i];',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tvar sql_i = sql;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar args_i = argumentsIn[i];',
'\t\t\t\t\tif(typeof args_i != \'undefined\') {',
'\t\t\t\t\t\tfor(var j = 0; j < args_i.length; j++) {',
'\t\t\t\t\t\t\tif(typeof args_i[j] == \'function\') {',
'\t\t\t\t\t\t\t\tvar result = args_i[j].call(this,transObj);',
'\t\t\t\t\t\t\t\targs_i[j] = result;',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar success_i = function(tx2,result) {',
'\t\t\t\t\t\tvar resultArray = {UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray(result);',
'\t\t\t\t\t\tif(onSuccess.constructor == Array) {',
'\t\t\t\t\t\t\tonSuccess[i].call(this,tx2,result,resultArray,transObj);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tonSuccess.call(this,tx2,result,resultArray,transObj);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\ti++;',
'\t\t\t\t\t\tif(i < sql_length) {',
'\t\t\t\t\t\t\ttransObj.i = i;',
'\t\t\t\t\t\t\t_lowSQL(transObj);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tvar error_i = function(e) {',
'\t\t\t\t\t\tif(onError.constructor == Array) {',
'\t\t\t\t\t\t\tonError[i].call(this,e);',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\tonError.call(this,e);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\ttx.sql = sql_i;',
'\t\t\t\t\ttx.arguments = args_i;',
'\t\t\t\t\ttx.sqlObject = sqlObject_i;',
'\t\t\t\t\ttx.executeSql(sql_i,args_i,success_i,error_i);',
'\t\t\t\t}',
'\t\t\t\t_lowSQL(transObj);',
'\t\t\t} else {',
'\t\t\t\t//single sql statement',
'\t\t\t\ttx.executeSql(sql,argumentsIn,function(tx,result) {',
'\t\t\t\t\tvar resultArray = {UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray(result);',
'\t\t\t\t\tonSuccess.call(this,tx,result,resultArray);',
'\t\t\t\t}, function(e) {onError.call(this,e); });',
'\t\t\t}',
'\t\t},',
'\t\tfunction(e) { /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}; if(flagCloseDB) db.close(); },',
'\t\tfunction() { /*transaction success*/ if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);} if(flagCloseDB) db.close();  }',
'\t\t//function(e) {alert(\'close the db1\'); db.close(); /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}  },',
'\t\t//function() { alert(\'close the db2\'); db.close(function() { alert(\'done closing\')} ); /*transaction success*/ if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);}   }',
'\t\t//function(e) { db.close(); /*transaction failure*/ if(typeof onTransactionError == \'function\') { onTransactionError.call(this);}  },',
'\t\t//function() { db.close(function() { if(typeof onTransactionSuccess == \'function\') { onTransactionSuccess.call(this);}; alert(\'done closing\')} ); /*transaction success*/   }',
'\t);',
'}',
'////////////////////////sqlite incremental refresh',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteApplyIncrementalUpdates = function(cbId,_onErrorFunction) {',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshData;',
'\tvar sqlObj = {UXPRERENDEREDALIAS}_DlgObj.__sqliteIncrementalUpdate_computeSQL(obj);',
'\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToUpdate = sqlObj.length;',
'\tif(sqlObj.length > 0) {',
'\t\tvar _dbName = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshDBName;',
'\t\tvar _sql = sqlObj;',
'\t\tvar _args = false;',
'\t\tvar _success = false;',
'\t\tvar _error = false;',
'\t\tvar _onTxSuccess = function() {',
'\t\t\tif(transObj.insert.length == 0) {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata(cbId,true)',
'\t\t\t} else {',
'\t\t\t\t//run the inserts',
'\t\t\t\tvar sql2 = [];',
'\t\t\t\tvar sqlObj = transObj.insert;',
'\t\t\t\tfor(var i = 0; i < sqlObj.length; i++) {',
'\t\t\t\t\tsql2.push({sql: sqlObj[i].sql2, arguments: sqlObj[i].arguments2});',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToInsert = sql2.length',
'\t\t\t\t//get the sql to update the __metaData table, but don\'t run it.',
'\t\t\t\tvar metaDataSQL = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata(cbId,false);',
'\t\t\t\t//add the metadata sql to the sql2 object',
'\t\t\t\tfor(var i = 0; i < metaDataSQL.length; i++) {',
'\t\t\t\t\tsql2.push(metaDataSQL[i])',
'\t\t\t\t}',
'\t\t\t\t//var msg6 = JSON.stringify(sql2,\'\',\'\\t\')',
'\t\t\t\t//$(\'pre1\').innerHTML = \'combined insert and meta data sql: \' + msg6;',
'\t\t\t\t//make a closure that captures the cbId',
'\t\t\t\tvar _generate_txOK = function(cbId) {',
'\t\t\t\t\tvar _txOK = function() {',
'\t\t\t\t\t\tvar cbid = cbId;',
'\t\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbid);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _txOK',
'\t\t\t\t}',
'\t\t\t\tvar _txOK = _generate_txOK(cbId)',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefresh_ExecuteSQLCommands(_dbName,sql2,_txOK)',
'\t\t\t}',
'\t\t};',
'\t\t_error = _onErrorFunction',
'\t\tvar _onTxError = function() {',
'\t\t\t//alert(\'tx error\');',
'\t\t\t//alert(\'Failed to update SQLite database2\')',
'\t\t\t_onErrorFunction.call()',
'\t\t};',
'\t\t/*',
'\t\tvar _onTxError = function() {',
'\t\t\talert(\'Failed to update SQLite database\')',
'\t\t};',
'\t\t*/',
'\t\tvar transObj = {};',
'\t\ttransObj.insert = [];',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(_dbName,_sql,_args,_success,_error,_onTxSuccess,_onTxError,false,transObj);',
'\t} else {',
'\t\t//there was no work to do',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshRowsToUpdate = 0;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbId);',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.__sqliteIncrementalUpdate_computeSQL = function(d) {',
'\tvar obj2 = [];',
'\tfor (var i = 0; i < d.length; i++) {',
'\t\tvar rows = d[i].data.length;',
'\t\tif(rows > 0) {',
'\t\t\tvar rows = d[i].data.length;',
'\t\t\tif(rows > 0) {',
'\t\t\t    for(var j = 0; j < rows; j++) {',
'\t\t\t        var fields = [];',
'\t\t\t        var fieldsInsert = [];',
'\t\t\t        var fieldsInsertNotNull = [];',
'\t\t\t        var argsInsert = [];',
'\t\t\t        var args = [];',
'\t\t\t        var argsInsert = [];',
'\t\t\t        var argsInsertNotNull = [];',
'\t\t\t        var argsNotNull = [];',
'\t\t\t        var _d = d[i].data[j];',
'\t\t\t        for(var n in _d) {',
'\t\t\t            fields.push(n  + \' = ?\');',
'\t\t\t            fieldsInsert.push(n );',
'\t\t\t            argsInsert.push(\'?\');',
'\t\t\t            args.push(_d[n]);',
'\t\t\t            if(_d[n] != null) {',
'\t\t\t            \tfieldsInsertNotNull.push(n);',
'\t\t\t            \targsNotNull.push(_d[n]);',
'\t\t\t            \targsInsertNotNull.push(\'?\');',
'\t\t\t            }',
'\t\t\t        }',
'\t\t\t        var fieldList = fields.join(\',\')',
'\t\t\t        var pk = d[i].primaryKey.split(\',\');',
'\t\t\t        for(var k = 0; k < pk.length; k++) {',
'\t\t\t            args.push(_d[pk[k]]);',
'\t\t\t            pk[k] = pk[k] + \' = ?\';',
'\t\t\t        }',
'\t\t\t        var pkwhere = pk.join(\' and \')',
'\t\t\t        var sql = \'UPDATE \' +  d[i].SQLiteTableName + \' SET \' + fieldList + \' WHERE \' + pkwhere;',
'\t\t\t        var sqlInsert = \'INSERT INTO \'  + d[i].SQLiteTableName + \' (\' + fieldsInsert.join(\',\') + \' ) VALUES (\' + argsInsert.join(\',\') + \')\';',
'\t\t\t        var sqlInsertNotNull = \'INSERT INTO \'  + d[i].SQLiteTableName + \' (\' + fieldsInsertNotNull.join(\',\') + \' ) VALUES (\' + argsInsertNotNull.join(\',\') + \')\';',
'//alert(\'sqlInsertNotNull:\' + sqlInsertNotNull);',
'\t\t\t        obj2.push(',
'\t\t\t            {',
'\t\t\t                sql: sql,',
'\t\t\t                sqlInsert: sqlInsert,',
'\t\t\t                sqlInsertNotNull: sqlInsertNotNull,',
'\t\t\t                arguments: args,',
'\t\t\t                argumentsNotNull: argsNotNull,',
'\t\t\t                onSuccess: function(tx,result,resultArray, transObj) {',
'\t\t\t                    if(result.rowsAffected == 0) {',
'\t\t\t                    \t//alert(\'push on tx\');',
'\t\t\t                    \t//transObj.insert.push({sql2:  tx.sqlObject[\'sqlInsert\'], arguments2: tx.arguments})',
'\t\t\t                    \t//transObj.insert.push({sql2:  tx.sqlObject[\'sqlInsertNotNull\'], arguments2: tx.argsNotNull})',
'\t\t\t                    \ttransObj.insert.push({sql2:  tx.sqlObject[\'sqlInsertNotNull\'], arguments2: tx.sqlObject[\'argumentsNotNull\']})',
'\t\t\t                    \t//alert(\'push done\');',
'\t\t\t                    }',
'\t\t\t                },',
'\t\t\t                onError: function(e) {',
'\t\t\t                \t//don\'t emit this error as the _sqliteApplyIncrementalUpdates() function will emit the user defined error',
'\t\t\t                    //alert(\'error22222: \' );',
'\t\t\t                }',
'\t\t\t            }',
'\t\t\t        )',
'\t\t\t    }',
'\t\t\t}',
'\t\t}',
'\t}',
'\treturn obj2;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshUpdateMetadata = function(cbid, flagExecute) {',
'\tvar md = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshMetaData;',
'\tvar mdstring = JSON.stringify(md);',
'\tvar _dbName = {UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefreshDBName;',
'\tvar _obj = [];',
'\t_obj.push( { sql: \'DELETE FROM __metaData\'}  );',
'\t_obj.push( { sql: \'insert into __metaData (metadata) VALUES (?)\', arguments: [mdstring]}  );',
'\tvar _sql = _obj;',
'\tvar _args = false;',
'\tvar _success = false;',
'\tvar _error = false;',
'\tvar _onTxSuccess = function() {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeAjaxCallbackCompleteCode(cbid);',
'\t};',
'\tvar _onTxError = function() {alert(\'Failed to update __metaDataTable\')};',
'\tif(flagExecute) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(_dbName,_sql,_args,_success,_error,_onTxSuccess,_onTxError);',
'\t} else {',
'\t\treturn _sql;',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._sqliteIncrementalRefresh_ExecuteSQLCommands = function(dbName,sql,_txOK, _txFailed, obj) {',
'\t//alert(\'execute sql commands\');',
'\tif(typeof _txOK == \'function\') { _onTxSuccess = _txOK;} else { \t_onTxSuccess = function() { alert(\'txok\'); }};',
'\tif(typeof _txFailed == \'function\') {  _onTxError = _txFailed;} else { _onTxError = function() {',
'\t\talert(\'txfailed\');',
'\t\t//alert(\'sql to execute: \' + JSON.stringify(sql));',
'\t}};',
'\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,false,false,false,_onTxSuccess,_onTxError);',
'}',
'//////////////////////end sqlite incrmental refresh',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteResultSetToArray = function(result) {',
'\tvar array = [];',
'\tif (result !=null && result.rows != null){',
'\t\tfor (var i = 0; i < result.rows.length; i++) {',
'\t\t\tarray.push(result.rows.item(i));',
'\t\t}',
'\t}',
'\treturn array;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.SQLiteDeleteDatabase = function(dbName,successCB,errorCB,location) {',
'\tvar flagSQL = _phoneGapSettings().plugins[\'cordova-sqlite-ext\'];   //com.brodysoft.sqliteplugin',
'\t\tflagSQL = true;',
'\t\tif(typeof flagSQL == \'undefined\') flagSQL = false;',
'\t\tif(!flagSQL) {',
'\t\t\talert(\'SQLitePluginExt not loaded\');',
'\t\t\treturn false;',
'\t}',
'\t/*',
'\tif(typeof location == \'undefined\') location = 2;',
'\t*/',
'\t///// new code /////',
'\tif(typeof location == \'undefined\') location = 1;',
'\t///// end new code /////',
'\twindow.sqlitePlugin.deleteDatabase({name: dbName, location: location}, successCB, errorCB);',
'}',
'////////////////////////////////////////',
'{UXPRERENDEREDALIAS}_DlgObj.submitListDataAndMediaFiles = function(listName,xbCallbackFunction,ajaxObject,mediaFileUploadObject) {',
'\t//first, upload media files, then upload dirty records in a list and then call xbCallbackFunction on the server side. Uploaded data will be in e._listData in the Xbasic function',
'\t/*',
'\tExample syntax:',
'\tvar ajaxObject = {',
'\t\terrorFunction: function() { alert(\'failed ajax\'); },',
'\t\tonComplete: function() { alert(\'ajax done\');},',
'\t\tdeviceOfflineFunction: function() { alert(\'offline \');  }',
'\t}',
'\tvar objUpload = {',
'\t\ttarget: \'alphaanywhere\',',
'\t\tshowProgress: true,',
'\t\tonComplete: function(array) {},',
'\t\tonMediaUploadErrors: function(array) { alert(\'there were media upload errors\');},',
'\t\txbasicAfterFileUploaded: \'xbAfterUpload\',',
'\t\tprogress: {',
'\t\t\tcolor: \'#9fa1e8\',',
'\t\t\twidth: \'300px\',',
'\t\t\tindividualProgress: false,',
'\t\t\tshowTotalProgress: true,',
'\t\t\tallowCancel: false,',
'\t\t\tprogressElement: \'{UXPRERENDEREDALIAS}.V.R1.PLACEHOLDER_2\'',
'\t\t}',
'\t}',
'\t//to upload to s3',
'\ttarget: \'s3\',',
'\t\ts3: {',
'\t\t\tconnectionString: \'alphamediacapture\',',
'\t\t\tprotectedRead: false,',
'\t\t\ttemplate: \'https://alphamediacapture.s3.amazonaws.com/__name__\'',
'\t},',
'\t///////',
'\t{UXPRERENDEREDALIAS}_DlgObj.submitListDataAndMediaFiles(\'list1\',xbName,ajaxObject,objUpload);',
'\t*/',
'\tvar lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(listName);',
'\tif(!lObj) return false;',
'\tvar objAjax = {};',
'\tif(typeof arguments[2] == \'object\') objAjax = arguments[2];',
'\tvar objUpload = {};',
'\tif(typeof arguments[3] == \'object\') objUpload = arguments[3]; //this is the object that defines the upload target (s3/alphaanywhere), showProgress, etc',
'\tvar _userOnComplete = objUpload.onComplete;',
'\tobjUpload.onComplete = function(array) {',
'\t\t_userOnComplete.call(this,array)',
'\t\tpushRemoteMediaNamesToArray(array,_data);',
'\t}',
'\tvar xbasicFunction = xbCallbackFunction;',
'\t//define local functions',
'\tvar _ajaxUpload = function(data,xbasicFunction,objAjax) {',
'\t\tvar listData = JSON.stringify(data,\'\',\'\\t\');',
'\t\tlistData = A5.ajax.buildURLParam(\'_listData\',listData);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',xbasicFunction,\'\',listData, objAjax);',
'\t}',
'\tvar pushRemoteMediaNamesToArray = function(mediaFiles,_data) {',
'\t\tvar _data2 = [];',
'\t\t$u.o.assign(_data2,_data);',
'\t\t//media files have been uploaded and the mediaFiles[] array has these properties of interest',
'\t\t//listFieldName -- name of the field in the data array that had the media field',
'\t\t//route -- an array that looks like [{table: \'_top_\', row: 1}]',
'\t\t//remoteName -- the name of the alpha server or s3',
'\t\t//succeeded',
'\t\tvar r = \'\';',
'\t\tvar table = \'\';',
'\t\tvar _di = \'\';',
'\t\tvar _diTop = \'\';',
'\t\tfor(var i = 0; i < mediaFiles.length; i++) {',
'\t\t\tmediaFiles[i].routeObj = JSON.parse(mediaFiles[i].route);',
'\t\t\tr = mediaFiles[i].routeObj[0].row',
'\t\t\tfor(var j = 0; j < mediaFiles[i].routeObj.length; j ++) {',
'\t\t\t\ttable = mediaFiles[i].routeObj[j].table;',
'\t\t\t\tr = mediaFiles[i].routeObj[j].row',
'\t\t\t\tif(table == \'_top_\') {',
'\t\t\t\t\t_di = _data2[r];',
'\t\t\t\t\t_diTop = _di;',
'\t\t\t\t} else {',
'\t\t\t\t\t_di = _di[table][r];',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(typeof _di != \'undefined\') {',
'\t\t\t\t//need to add a check to see if the success flag is true',
'\t\t\t\tif(mediaFiles[i].succeeded) {',
'\t\t\t\t\t _di[mediaFiles[i].listFieldName] = mediaFiles[i].remoteName;',
'\t\t\t\t} else {',
'\t\t\t\t\t_diTop.__flagHasMediaFileUploadError = true;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\t//harvest rows that are dirty and also do not have media upload errors - these rows will be pushed to the server',
'\t\tvar _data3 = [];',
'\t\tvar _mErr = [];',
'\t\tvar flagPush = false;',
'\t\tvar flagHasMediaUploadError = false;',
'\t\tfor(var i = 0; i < _data2.length; i++) {',
'\t\t\tflagPush = true;',
'\t\t\tif(typeof _data2[i].__flagHasMediaFileUploadError != \'undefined\' && _data2[i].__flagHasMediaFileUploadError) {',
'\t\t\t\tflagPush = false;',
'\t\t\t\tflagHasMediaUploadError = true;',
'\t\t\t\t_mErr.push(_data2[i]);',
'\t\t\t}',
'\t\t\tif(flagPush) {',
'\t\t\t\tif(typeof _data2[i]._isDirty == \'undefined\') {',
'\t\t\t\t\tflagPush = false;',
'\t\t\t\t} else if(_data2[i]._isDirty == false) {',
'\t\t\t\t\tflagPush = false;',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(flagPush) {',
'\t\t\t\t_data3.push(_data2[i]);',
'\t\t\t}',
'\t\t}',
'\t\tif(flagHasMediaUploadError) {',
'\t\t\tif(typeof objUpload.onMediaUploadErrors == \'function\') {',
'\t\t\t\tobjUpload.onMediaUploadErrors.call(this,_mErr);',
'\t\t\t}',
'\t\t}',
'\t\t_ajaxUpload(_data3,xbasicFunction,objAjax) //do the ajax callback to upload the fixed data array',
'\t}',
'\t//end local functions',
'\tvar _data = lObj.harvestList();',
'\tif(_data.length == 0) {',
'\t\treturn false;',
'\t}',
'\tvar arr = lObj._harvestMediaFields();',
'\tif(arr.length == 0) {',
'\t\t//no media fields -- just make the ajax callback',
'\t\t_ajaxUpload(_data,xbasicFunction,objAjax);',
'\t\treturn true;',
'\t} else {',
'\t\t//upload the media files -- the onComplete event will make the ajax callback',
'\t\t//objUpload._dataToUpload = _data;',
'\t\t_data = lObj._data;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileUpload(arr,objUpload);',
'\t}',
'}',
'// File manipulation',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()',
'//',
'// Returns true if there is a local file system and PhoneGap is running.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable = function() {',
'   if(typeof LocalFileSystem == \'undefined\') {',
'      if(typeof cordova == \'undefined\') {',
'         return false;',
'      }',
'      return false;',
'   }',
'   return true;',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(type)',
'//',
'// type: "temp", "private", "saved", "public"',
'// On iOS, saved and public may be backed up to iCloud',
'//',
'// Returns URL of base for the requested part of the file system.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL = function(type) {',
'   var dir = "";',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) return dir;',
'   if (type.toLowerCase().indexOf(\'explicit:\') == 0) {',
'   \t\tvar dir = type.substring(\'explicit:\'.length)',
'   \t\treturn dir;',
'   }',
'   if (device.platform == \'iOS\') {',
'      switch (type) {',
'         case "temp":',
'            dir = cordova.file.tempDirectory;',
'            break;',
'         case "private":',
'            dir = cordova.file.dataDirectory;',
'            break;',
'         case "saved":',
'            dir = cordova.file.syncedDataDirectory;',
'            break;',
'         case "public":',
'            dir = cordova.file.documentsDirectory;',
'            break;',
'         case "persistent": //original file system actions',
'          \tdir = cordova.file.dataDirectory.replace(\'NoCloud\',\'files\');',
'          \tbreak;',
'      }',
'   }',
'   else {',
'      switch (type) {',
'         case "temp":',
'            dir = cordova.file.externalCacheDirectory || cordova.file.cacheDirectory;',
'            break;',
'         case "private":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "saved":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "public":',
'            dir = cordova.file.externalDataDirectory || cordova.file.dataDirectory;',
'            break;',
'         case "persistent":',
'          \tdir = \'file:///data/user/0/\'+_phoneGapSettings().appId+\'/files/files/\';',
'          \tbreak;',
'      }',
'   }',
'   return dir;',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(filepath, onReadSuccess, onError, startAt, endAt)',
'//',
'// filepath is the local file URL of the desired file.',
'// If startAt and endAt are present, returns just those positions in the file.',
'//',
'// onReadSuccess(result) returns the contents read.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL = function(filepath, onReadSuccess, onError, startAt, endAt) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               var doReadFunction =',
'                  function(file) {',
'                     var reader = new FileReader();',
'                     reader.onloadend =',
'                        function(e) {',
'                           onReadSuccess(this.result);',
'                        };',
'                     if (typeof startAt==\'undefined\' || typeof endAt==\'undefined\') {',
'                        reader.readAsText(file);',
'                     }',
'                     else {',
'                        var blob = file.slice(startAt, endAt);',
'                        reader.readAsText(blob);',
'                     }',
'                  };',
'               fileEntry.file(doReadFunction);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL(filepath, text, onWriteSuccess, onError, append)',
'//',
'// filepath is the local file URL of the desired file. The directory must',
'// exist, but the file need not.',
'// If append is true, appends to current contents.',
'// Truncates (if file existed) to end of what is written.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL = function(filepath, text, onWriteSuccess, onError, append) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               var writerFunction =',
'                  function(fileWriter) {',
'                     fileWriter.onwriteend =',
'                        function(e) {',
'                           onWriteSuccess();',
'                        };',
'                     fileWriter.onerror = onError;',
'                     if (append) {',
'                        fileWriter.seek(fileWriter.length);',
'                     }',
'                     var blob = new Blob([text], {type:\'text/plain\'});',
'                     fileWriter.write(blob);',
'                  };',
'               fileEntry.createWriter(writerFunction, onError);',
'            };',
'         fsEntry.getFile(filename, {create: true}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURLfilepath, onResult, onError)',
'//',
'// filepath is the local file URL of the desired file.',
'// onResult(properties) will be called with false if file does not exist.',
'// If file does exist, properties will be:',
'//',
'//    {',
'//       name:file\'s name,',
'//       lastModifiedDate:lastModifiedDate object,',
'//       size:size in bytes,',
'//       type:MIME type if known(not on iOS now, but yes on Android)',
'//    }',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURL = function(filepath, onResult, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               fileEntry.file(function(fileObj) {',
'                  onResult({name:fileObj.name, lastModifiedDate:fileObj.lastModifiedDate,',
'                     size:fileObj.size, type:fileObj.type});',
'                  },',
'                  onError);',
'            };',
'         var onDidNotGetFile =',
'            function() {',
'               onResult(false);',
'            };',
'         fsEntry.getFile(filename, {create: false}, onGotFile, onDidNotGetFile);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(filepath, onDeleteSuccess, onError)',
'//',
'// filepath is the local file URL of the file to be deleted.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL = function(filepath, onDeleteSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = filepath.lastIndexOf("/");',
'   var dirpath = filepath.substring(0,pos);',
'   var filename = filepath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               fileEntry.remove(onDeleteSuccess, onError);',
'            };',
'         fsEntry.getFile(filename, {create: false}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(srcpath, destdirpath, destname, onCopySuccess, onError)',
'//',
'// srcpath is the local file URL of the file to be copied.',
'// destdirpath is the URL of the directory into which to copy the file.',
'// destname is the name to be given to the copied file. If null, the source filename will be used.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL = function(srcpath, destdirpath, destname, onCopySuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = srcpath.lastIndexOf("/");',
'   var dirpath = srcpath.substring(0,pos);',
'   var filename = srcpath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               window.resolveLocalFileSystemURL(destdirpath,',
'                  function(destDirEntry) {',
'                     fileEntry.copyTo(destDirEntry, destname, onCopySuccess, onError);',
'                  },',
'                  onError);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(srcpath, destdirpath, destname, onMoveSuccess, onError)',
'//',
'// srcpath is the local file URL of the file to be moved.',
'// destdirpath is the URL of the directory into which to move the file, replacing any existing file with the name.',
'// destname is the name to be given to the copied file. If null, the source filename will be used.',
'// If moved into the same directory, the file will be renamed.',
'// A move of a directory on top of an existing empty directory replaces that directory.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL = function(srcpath, destdirpath, destname, onMoveSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var pos = srcpath.lastIndexOf("/");',
'   var dirpath = srcpath.substring(0,pos);',
'   var filename = srcpath.slice(pos+1);',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var onGotFile =',
'            function(fileEntry) {',
'               window.resolveLocalFileSystemURL(destdirpath,',
'                  function(destDirEntry) {',
'                     fileEntry.moveTo(destDirEntry, destname, onMoveSuccess, onError);',
'                  },',
'                  onError);',
'            };',
'         fsEntry.getFile(filename, {}, onGotFile, onError); //does not work on moving directories',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(dirpath, onRemoveSuccess, onError)',
'//',
'// dirpath is the file URL of the directory to be deleted.',
'// Deletes the specified directory and all of its contents, including other directories and',
'// their contents.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL = function(dirpath, onRemoveSuccess, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var onResolvedURL =',
'      function(dirEntry) {',
'         dirEntry.removeRecursively(onRemoveSuccess, onError);',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(rootpath, subdirpath, onCompletion, onError)',
'//',
'// rootpath is the file URL of the existing directory that will contain the directories that are needed.',
'// subdirpath is a path of directories to ensure exist below rootpath. They will be created',
'// if they don\'t exist.',
'//',
'// For example, if rootpath is "file://root/public/", subdirpath may be "toplevel/subdir1".',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL = function(rootpath, subdirpath, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var dirs = subdirpath.split(\'/\') || [];',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var ensureDirFunction =',
'            function(dirEntry) { // function to recurse',
'               if (dirs.length>0) {',
'                  if (dirs[0]==\'.\' || dirs[0]==\'\') {',
'                     dirs = dirs.slice(1); // remove null dir',
'                  }',
'               }',
'               if (dirs.length==0) {',
'                  onCompletion();',
'                  return;',
'               }',
'               dirEntry.getDirectory(dirs[0], {create: true},',
'                  function(subdirEntry) {',
'                     dirs = dirs.slice(1); // do next',
'                     ensureDirFunction(subdirEntry);',
'                  },',
'                  onError);',
'               };',
'         ensureDirFunction(fsEntry); // do first',
'      };',
'   window.resolveLocalFileSystemURL(rootpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(rootpath, onCompletion, onError)',
'//',
'// rootpath is the file URL of the directory whose contents will be listed.',
'// onCompletion(filelist) will contain an array of strings representing each file',
'// and directory down the hierarchy. Directories end in "/".',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL = function(rootpath, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var filelist = [];',
'   var pathprefix = "";',
'   var pending = 0;',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var processDirFunction =',
'            function(subdirpath, listingObj) {',
'               var files = listingObj.files;',
'               var i;',
'               var fpath;',
'               var prefix = subdirpath.slice(pathprefix.length);',
'               for (i=0; i<files.length; i++) {',
'                  fpath = prefix+files[i];',
'                  filelist.push(fpath);',
'               }',
'               var dirs = listingObj.dirs;',
'               if (dirs.length==0) {',
'                  if (pending==0) {',
'                     onCompletion(filelist);',
'                  }',
'                  return;',
'               }',
'               for (i=0; i<dirs.length; i++) {',
'                  fpath = dirs[i].fullPath.slice(pathprefix.length);',
'                  filelist.push(fpath);',
'                  pending++;',
'                  dirs[i].filesystem.root.getDirectory(dirs[i].fullPath, {create: false},',
'                     function(dirEntry) {',
'                        listDirFunction(dirEntry);',
'                     },',
'                     function(e){pending--;onError(e);});',
'               }',
'            };',
'         var listDirFunction =',
'            function(dirEntry) { // function to recurse on subdirs',
'               var dirReader = dirEntry.createReader();',
'               var listingObj = {files:[], dirs:[]};',
'               var readDirEntries = function() {',
'                  dirReader.readEntries( // start an async reading of entries',
'                     function(entries) { // more entries read, or done',
'                        if (!entries || entries.length==0) {',
'                           pending--;',
'                           processDirFunction(dirEntry.fullPath, listingObj);',
'                           return;',
'                        }',
'                        var entry;',
'                        for (var i=0; i<entries.length; i++) {',
'                           entry = entries[i];',
'                           if (entry.isFile) {',
'                              listingObj.files.push(entry.name);',
'                           }',
'                           else {',
'                              listingObj.dirs.push(entry);',
'                           }',
'                        }',
'                        readDirEntries(); // recurse to call dirReader.readEntries again',
'                     },',
'                     onError);',
'                  };',
'               readDirEntries(); // do first reading of entries',
'            };',
'         pending++;',
'         pathprefix = fsEntry.fullPath; // get prefix',
'         listDirFunction(fsEntry); // do first list getting',
'      };',
'   window.resolveLocalFileSystemURL(rootpath, onResolvedURL, onError);',
'}',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL(dirpath, matchRegex, onCompletion, onError)',
'//',
'// dirpath is the file URL of the directory whose contents will be listed (only files).',
'// matchRegex, if non-null, will need to match file names found for them to be listed.',
'// onCompletion(filelist) will contain an array of strings representing each file.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL = function(dirpath, matchRegex, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var filelist = [];',
'         var dirReader = fsEntry.createReader();',
'         var readEntriesFunction =',
'            function() { // function to recurse to call repeatedly after each completion until no result',
'               dirReader.readEntries( // start an async reading of entries',
'                  function(entries) { // more entries read, or done',
'                     if (!entries || entries.length==0) {',
'                        onCompletion(filelist);',
'                        return;',
'                     }',
'                     var name;',
'                     for (var i=0; i<entries.length; i++) {',
'                        name = entries[i].name;',
'                        if (!matchRegex || name.match(matchRegex)) {',
'                           filelist.push(name);',
'                        }',
'                     }',
'                     readEntriesFunction(); // recurse to call dirReader.readEntries again',
'                  },',
'                  onError);',
'               };',
'         readEntriesFunction(); // do first reading',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder = function(mode) {',
'\tif(typeof mode == \'undefined\') mode = 0;',
'\tvar thisPackageName = \'\';',
'\tthisPackageName = _phoneGapSettings().appId ;',
'\tvar localDbFileUrl = {',
'\t\tandroidx: \'/data/data/\' + thisPackageName + \'/databases/\',',
'\t\tandroid1x: \'file:///data/data/\' + thisPackageName + \'/databases/\',',
'\t\tandroid2x: \'file:///data/data/\' + thisPackageName,',
'\t\tandroid: cordova.file.applicationStorageDirectory.substr(7)+ \'databases/\',',
'\t\tandroid1: cordova.file.applicationStorageDirectory + \'databases/\',',
'\t\tandroid2: cordova.file.applicationStorageDirectory.substr(0, cordova.file.applicationStorageDirectory.length -1) ,',
'\t\tios: cordova.file.dataDirectory',
'\t};',
'\ttry{',
'\t\tvar thisDevice = device.platform.toLowerCase();',
'\t\tif(mode == 1 && thisDevice == \'android\') thisDevice = \'android1\';',
'\t\tif(mode == 2 && thisDevice == \'android\') thisDevice = \'android2\';',
'\t\tvar _targetDir = localDbFileUrl[thisDevice];',
'\t\treturn _targetDir;',
'\t}catch(e) {',
'\t\talert(\'PhoneGap \\\'device\\\' Plugin not loaded\');',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLite =  function(explicitFileName,filesystemSource,folderSource,zipFileName,dirStructureTarget,ok,fail) {',
'\tif(typeof explicitFileName == \'undefined\' || explicitFileName == \'\') {',
'\t\tvar baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(filesystemSource)',
'\t\tvar fnSource = baseURI + folderSource + \'/\' + zipFileName;',
'\t} else {',
'\t\tvar fnSource = explicitFileName;',
'\t\tvar fn = fnSource',
'\t\tfn = fn.split(\'/\');',
'\t\tzipFileName = fn[fn.length-1];',
'\t}',
'\tvar baseURITarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\tvar dirTarget = baseURITarget ;',
'\tvar targetFolder = fnSource.split(\'/\')',
'\ttargetFolder.pop();',
'\ttargetFolder = targetFolder.join(\'/\') + \'/\';',
'\tvar copyFNSource = fnSource.split(\'.\');',
'\tcopyFNSource.pop();',
'\tcopyFNSource = copyFNSource.join(\'.\') + \'.db\'',
'\t//alert(\'target folder: \' + targetFolder)',
'\tvar cb = function(e) {',
'\t//alert(\'unzip cb \' + e);',
'\t\tif(e == 0) {',
'\t\t//get files in targetFolder (assumme .zip file only has a single sqlite file and that the sqllite file has as .db extension and name of sqlite.zip file is same as sqlite.db file)',
'\t\t\t//alert(\'copy file to target location\'); debugger;',
'\t\t\t///////////',
'\t\t\tvar rootpath = dirTarget;',
'\t\t\tvar _srcPath = copyFNSource',
'\t\t\tvar _destinationName = zipFileName.split(\'.\')',
'\t\t\t_destinationName.pop()',
'\t\t\t_destinationName = dirStructureTarget + \'___\' + _destinationName.join(\'.\') + \'.db\';',
'\t\t\t//ensure that the databases folder exists/////////',
'\t\t\tvar _baseURI = baseURITarget;',
'\t\t\tif(_baseURI.indexOf(\'/databases/\') > -1) {',
'\t\t\t\t_baseURI = _baseURI.substr(0,_baseURI.indexOf(\'/databases/\')+1)',
'\t\t\t}',
'\t\t\t//alert(_baseURI);',
'\t\t\tvar _dirStructure = \'databases\';;',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure,function() {',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(_srcPath, rootpath, _destinationName, function() { } ,function() { });',
'\t\t\t} ,function() {alert(\'failed to create databases folder\'); } );',
'\t\t\tok.call(this);',
'\t\t}',
'\t\telse fail.call(this);',
'\t}',
'\t//zip.unzip(fnSource, dirTarget, cb );',
'\tzip.unzip(fnSource, targetFolder, cb );',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB = function(explicitFilename,sourceFileSystem,sourceFolder,sourceDBName,targetDBName,targetFolder, onSuccess, onError) {',
'\t\tif(typeof onSuccess == \'undefined\') onSuccess = function() { };',
'\t\tif(typeof onError == \'undefined\') onError = function() { }',
'\t\tvar _copyLow = function() {',
'\t\t\tvar localDBName = targetDBName;',
'\t\t\tif (targetFolder != \'\') {',
'\t\t\t\tlocalDBName = targetFolder + \'___\' + targetDBName;',
'\t\t\t}',
'\t\t\tif(typeof explicitFilename == \'undefined\' || explicitFilename == \'\') {',
'\t\t\t\tvar fnSource = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(sourceFileSystem) + sourceFolder + \'/\' + sourceDBName;',
'\t\t\t} else {',
'\t\t\t\tvar fnSource = explicitFilename;',
'\t\t\t}',
'\t\t\tvar fnTarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) +  localDBName;',
'\t\t\t//alert(\'fnsource: \' + fnSource +\'\\nfntarget: \' + fnTarget);',
'\t\t\t// \'/data/data/\' + thisPackageName + \'/databases/\',',
'\t\t\tvar _onCopySuccess = function() {',
'\t\t\t\t//alert(\'sqlite copy success: \' + 5)',
'\t\t\t\tonSuccess.call(this);',
'\t\t\t\tif(sourceFolder == \'tempFolder/zipfiles\') {',
'\t\t\t\t\t//delete this folder. this is where the sqlitedb zip file was unzipped',
'\t\t\t\t\tvar _onRemoveSuccess = function() { /* alert(\'tempFolder/zipfiles was deleted\'); */};',
'\t\t\t\t\tvar _error = function(e) { /*alert(\'could not delete the tempFolder/zipfiles folder\');*/\t};',
'\t\t\t\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\t\t\t\tvar _dirName = \'tempFolder/zipfiles/\';;',
'\t\t\t\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tvar _onCopyError = function(e) {',
'\t\t\t\talert(\'sqlite copy error:\' + JSON.stringify(e));',
'\t\t\t\tonError.call(this);',
'\t\t\t};',
'\t\t\tvar _onDeleteSuccess = function() {',
'\t\t\t\tvar folderTarget = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) ;',
'\t\t\t\t//alert(fnSource);',
'\t\t\t\t//alert(folderTarget);',
'\t\t\t\t//alert(\'about to copy: \' + localDBName);',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(fnSource,folderTarget, localDBName, _onCopySuccess, _onCopyError);',
'\t\t\t};',
'\t\t\tvar _onDeleteError = _onDeleteSuccess;',
'\t\t\t//alert(\'delete what: \' + fnTarget)',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(fnTarget, _onDeleteSuccess,_onDeleteError);',
'\t\t}',
'\t\tif(targetFolder != \'\') {',
'\t\t\tvar onFolderCreated = function() {   _copyLow();}',
'\t\t\tvar onFolderCreatedFailed = function(e) { alert(\'SQLite folder not created\');  onError.call()}',
'\t\t\tvar _base = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(2); //add file:// and omit trailing \'databases\' folder',
'\t\t\tvar targetx;',
'\t\t\tvar thisPackageName = \'\';',
'\t\t\tthisPackageName = _phoneGapSettings().appId ;',
'\t\t\tif(thisPackageName.toLowerCase() == \'android\') {',
'\t\t\t\ttargetx = \'databases/\' + targetFolder;',
'\t\t\t\ttargetx = \'databases/\'',
'\t\t\t} else {',
'\t\t\t\ttargetx = targetFolder;',
'\t\t\t\ttargetx = \'/\';',
'\t\t\t}',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_base,targetx, onFolderCreated, onFolderCreatedFailed);',
'\t\t} else {',
'\t\t\t_copyLow()',
'\t\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles =  function(explicitFileName,filesystemSource,folderSource,zipFileName,fileSystemTarget, dirStructureTarget,ok,fail,flagListUnzippedFiles) {',
'\tif(typeof ok == \'undefined\') ok = function() { };',
'\tif(typeof fail == \'undefined\') fail = function() { };',
'\tvar _listFileThatWereUnzipped = function() {',
'\t\t var _onSuccess = function(filelist) {',
'\t\t\tok.call(this,filelist);',
'\t\t\t//remove the tempUnzipFolder, but do not trigger the follow on function to unzip to the tempUnzipFolder',
'\t\t\t_removeTempUnzipFolder(\'\',2);',
'\t\t};',
'\t\tvar _error = function(e) { alert(\'error\');};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = \'tempUnzipFolder/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
'\t}',
'\tvar _removeTempUnzipFolder = function(fnSource,mode) {',
'\t\tif(typeof mode == \'undefined\') mode = 1;',
'\t\tvar _onRemoveSuccess = function() { if(mode == 1) _listUnzippedFiles(fnSource);};',
'\t\tvar _error = function(e) { if(mode == 1) _listUnzippedFiles(fnSource);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = \'tempUnzipFolder/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\tvar _listUnzippedFiles = function(fnSource) {',
'\t\tvar baseURITarget =  {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\')',
'\t\tvar cb = function(e) {',
'\t\t\tif(e == 0) {',
'\t\t\t\t_listFileThatWereUnzipped();',
'\t\t\t} else {',
'\t\t\t\t//could not unzip to the tempUnzipFolder -- should be unlikely',
'\t\t\t\tok.call(this,[]);',
'\t\t\t}',
'\t\t}',
'\t\tzip.unzip(fnSource,baseURITarget + \'tempUnzipFolder\',cb)',
'\t}',
'\tif(typeof explicitFileName == \'undefined\' || explicitFileName == \'\') {',
'\t\tvar baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(filesystemSource)',
'\t\tvar fnSource = baseURI + folderSource + \'/\' + zipFileName;',
'\t} else {',
'\t\tvar fnSource = explicitFileName;',
'\t}',
'\tvar baseURITarget = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemTarget)',
'\tvar dirTarget = baseURITarget + dirStructureTarget',
'\tvar cb = function(e) {',
'\t\tif(e == 0) {',
'\t\t\tif(flagListUnzippedFiles) {',
'\t\t\t\t//this function will call the follow on functions to unzip to the tempUnzipFolder',
'\t\t\t\t_removeTempUnzipFolder(fnSource)',
'\t\t\t} else {',
'\t\t\t\tok.call(this);',
'\t\t\t}',
'\t\t}',
'\t\telse {',
'\t\t\t//alert(\'in unzip: \' + e); sr55',
'\t\t\tfail.call(this);',
'\t\t}',
'\t}',
'\tif(typeof zip == \'undefined\') {',
'\t\talert(\'FATAL ERROR - Cordova Zip plugin not loaded\');',
'\t}',
'\tzip.unzip(fnSource, dirTarget, cb );',
'}',
'/*',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLiteDB = function(explicitFileName,filesystemSource,folderSource,zipName,account,onCopyOK,onCopyError) {',
'\t//unzips a .zip file that contains one (only 1) sqlite.db file and copies file to the sqlite folder',
'\tvar _copyLow = function(sqliteDBSource,account,onCopyOK,onCopyError) {',
'\t\tvar sourceFileSystem = \'temp\';',
'\t\tsourceFolder = \'tempFolder/zipfiles\';',
'\t\tsourceDBName = sqliteDBSource;',
'\t\ttargetDBName = sqliteDBSource;',
'\t\ttargetFolder = account;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB(sourceFileSystem,sourceFolder,sourceDBName,targetDBName,targetFolder, onCopyOK, onCopyError)',
'\t}',
'\tvar flagListUnzippedFiles = true;',
'\tvar okUnzip = function(fileArray) {',
'\t\talert(JSON.stringify(fileArray,\'\',\'\\t\'));',
'\t\tif(fileArray.length > 1) {',
'\t\t\talert(\'zip file caon only contain one SQLite database which must not be in a sub-folder.\');',
'\t\t} else {',
'\t\t\tvar sqliteDBSource = fileArray[0];',
'\t\t\talert(\'dirPath: \' + dirPath);',
'\t\t\t_copyLow(sqliteDBSource,account,onCopyOK,onCopyError)',
'\t\t}',
'\t };',
'\tvar failUnzip = function() { alert(\'fail\');}',
'\tvar dirPath = \'tempFolder/zipfiles\'',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles(explicitFileName,filesystemSource,folderSource,zipName,\'temp\', dirPath,okUnzip,failUnzip,flagListUnzippedFiles)',
'}',
'*/',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles = function(manifest,folder,cbAllDone,optionsIn,fileSystemPart,flagMoveSQLiteFiles,manifestName) {',
'\t////////////////////////////////////////////////////////',
'\tfunction storeManifest(string,name) {',
'\t\t//\'transFormOnDeviceManifest\'',
'\t\tif(manifestName == \'\') {',
'\t\t\tlocalStorage.setItem(\'transFormOnDeviceManifest\',string);',
'\t\t\treturn;',
'\t\t} else {',
'\t\t\tvar manifestObj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\t\t\tmanifestObj[name] = string;',
'\t\t\tlocalStorage.manifests = JSON.stringify(manifestObj);',
'\t\t}',
'\t}',
'\tfunction getManifest(name) {',
'\t\t//\'transFormOnDeviceManifest\'',
'\t\tif(manifestName == \'\') return localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\telse {',
'\t\t\tvar manifestObj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\t\t\tvar m = manifestObj[name];',
'\t\t\treturn m;',
'\t\t\t//return JSON.stringify(manifestObj[name]);',
'\t\t}',
'\t}',
'\tfunction getManifestStorageLocation(manifestName) {',
'\t\t//\'transFormFileSystemPart\'',
'\t\tif(manifestName == \'\'|| true) return localStorage.getItem(\'transFormFileSystemPart\')',
'\t}',
'\tfunction setManifestStorageLocation(string,manifestName) {',
'\t\t//\'transFormFileSystemPart\'',
'\t\tif(manifestName == \'\' || true) localStorage.setItem(\'transFormFileSystemPart\',string);',
'\t}',
'\t//var storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\t//var storedWhere = getManifestStorageLocation(manifestName);',
'\t//localStorage.setItem(\'transFormFileSystemPart\',_string);',
'\t//setManifestStorageLocation(_string,manifestName);',
'\t//localStorage.setItem(\'transFormOnDeviceManifest\',json);',
'\t//storeManifest(json,manifestName)',
'\t//localStorage.transFormOnDeviceManifest = m;',
'\t//storeManifest(m,manifestName);',
'\t//var oldManifest = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t//var oldManifest = getManifest(manifestName);',
'\t//var m = localStorage.transFormOnDeviceManifest;',
'\t//var m = getManifest(manifestName);',
'\t/////////////////////////////////////////////////////////',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar manifestName2 = manifestName',
'\tif(manifestName2 == \'\') manifestName2 = \'___default___\';',
'\tif(typeof obj[manifestName2] ==\'undefined\') obj[manifestName2] = {};',
'\tobj[manifestName2].folder = folder =  folder ;',
'\tobj[manifestName2].fileSystemPart = fileSystemPart',
'\tvar json = JSON.stringify(obj)',
'\tlocalStorage.setItem(\'manifestInfo\',json)',
'if(typeof flagMoveSQLiteFiles == \'undefined\') flagMoveSQLiteFiles = true;',
'\t/*',
'\tusage:',
'\tif \'informationOnly\' is set to true, the cb function is called with arr.mode = \'informationOnly\' and arr.array set to the manifest of files that need to be downloaded',
'\tvar opsIn = {',
'\t\tinformationOnly: false,',
'\t\tshowProgress: true,',
'\t\tprogress: {',
'\t\t\txcolor: \'#9fa1e8\',',
'\t\t\tcolor: \'green\',',
'\t\t\twidth: \'600px\',',
'\t\t\tprogressElement: \'{UXPRERENDEREDALIAS}.V.R1.PLACEHOLDER_1\'',
'\t\t}',
'\t}',
'\tvar cb = function(arr) {',
'\t\tif(typeof arr.mode != \'undefined\') {',
'\t\t\t\tif(arr.mode == \'informationOnly\') {',
'\t\t\t\t\talert(\'Number of files to download: \' + arr.array.length);',
'\t\t\t\t\treturn;',
'\t\t\t\t}',
'\t\t}',
'\t\talert(\'post process is now COMPLETE: items - \' + arr.array.length);',
'\t};',
'\t//url can also be an http::// or https:// address or an array of objects',
'\t\tvar url = \'\';',
'\t\turl = [',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/SQLiteNorthwind.zip\',',
'\t\t\t\t\t\ttype: \'sqlite\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 70900',
'\t\t\t\t\t},',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/sqlite3.db\',',
'\t\t\t\t\t\ttype: \'sqlite\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 7000',
'\t\t\t\t\t},',
'\t\t\t\t\t{',
'\t\t\t\t\t\turl: \'https://alphamediacapture.s3.amazonaws.com/transform/allimages.zip\',',
'\t\t\t\t\t\ttype: \'folder\',',
'\t\t\t\t\t\tzipped: true,',
'\t\t\t\t\t\ttargetFolder: \'transFormShortFileList\',',
'\t\t\t\t\t\tversion: 1,',
'\t\t\t\t\t\tsize: 56900',
'\t\t\t\t\t}',
'\t\t]',
'\tvar url = \'https://alphamediacapture.s3.amazonaws.com/transform/transformManifest.json\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles(url,\'account1\',cb,opsIn)',
'\t*/',
'\tvar computeNewManifest = function(oldManifestJSON,manifest, accountId) {',
'\t\ttry{',
'\t\t\tvar om = JSON.parse(oldManifestJSON);',
'\t\t\tom = om[accountId];',
'\t\t\tif(typeof om == \'undefined\' || om == null) {',
'\t\t\t\treturn manifest;',
'\t\t\t}',
'\t\t\tvar arr = manifest;',
'\t\t\tvar totalSize = 0;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tarr[i].mustFetch = true;',
'\t\t\t\tvar url = arr[i].url;',
'\t\t\t\tvar type = arr[i].type;',
'\t\t\t\tfor(var j = 0; j < om.length; j++) {',
'\t\t\t\t\tif(om[j].url == url && om[j].type == type) {',
'\t\t\t\t\t\tvar oldVersion = om[j].version;',
'\t\t\t\t\t\tif(typeof oldVersion == \'undefined\') oldVersion = -1;',
'\t\t\t\t\t\tif(typeof oldVersion == \'number\') {',
'\t\t\t\t\t\t\tvar newVersion = arr[i].version;',
'\t\t\t\t\t\t\tif(typeof newVersion == \'undefined\') newVersion = -1;',
'\t\t\t\t\t\t\tif(typeof newVersion == \'number\') {',
'\t\t\t\t\t\t\t\tif(newVersion <= oldVersion) {',
'\t\t\t\t\t\t\t\t\tarr[i].mustFetch = false;',
'\t\t\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\t\t\t//alert(\'must fetch: \' + i);',
'\t\t\t\t\t\t\t\t\tif(typeof arr[i].size != \'undefined\') totalSize = totalSize + arr[i].size;',
'\t\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tvar count = 0;',
'\t\t\tvar arr2 = [];',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(arr[i].mustFetch) {',
'\t\t\t\t\tcount++;',
'\t\t\t\t\tarr2.push(arr[i])',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//if optionsIn says information only then we can do the callback function here, passing in the arr2 array',
'\t\t\t//alert(\'count must fetch: \' + count +  \' total size: \' + totalSize);',
'\t\t\treturn arr2;',
'\t\t}catch(err) {',
'\t\t\treturn manifest;',
'\t\t}',
'\t}',
'\tvar flagExplicit = false;',
'\tif(typeof fileSystemPart == \'undefined\') fileSystemPart = \'saved\';',
'\tif(fileSystemPart.toLowerCase().indexOf(\'explicit:\') == 0) {',
'\t\tfileSystemPart = fileSystemPart.substr(\'explicit:\'.length);',
'\t\tflagExplicit = true;',
'\t}',
'\t//var storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\tvar storedWhere = getManifestStorageLocation(manifestName);',
'\tvar obj = {}',
'\tif(storedWhere == null) {',
'\t\tobj[folder] = fileSystemPart;',
'\t} else {',
'\t\ttry{',
'\t\t\tobj = JSON.parse(storedWhere)',
'\t\t\tobj[folder] = fileSystemPart;',
'\t\t}catch(e) {',
'\t\t\tobj[folder] = fileSystemPart;',
'\t\t}',
'\t}',
'\tvar _string = JSON.stringify(obj);',
'\t//localStorage.setItem(\'transFormFileSystemPart\',_string);',
'\tsetManifestStorageLocation(_string,manifestName);',
'\tvar accountId = folder;',
'\tvar fetchManifest = function(url) {',
'\tvar onOK = function(data) {',
'\t\ttry{',
'\t\t\tvar arr = JSON.parse(data);',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDownloadManifestFiles(arr,accountId,cbAllDone,optionsIn,fileSystemPart,flagMoveSQLiteFiles,manifestName);',
'\t\t}catch(e) {',
'\t\t\t//alert(\'Error - could not read the TransForm manifest file.\' + JSON.stringify(e));',
'\t\t\tvar cbObj = {error: true, errorText: \'Could not read the manifest file.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t\t}',
'\t\t}',
'\t\tvar onFail = function() {',
'\t\t\t//alert(\'Error - Could not download the TransForm manifest file.\');',
'\t\t\tvar cbObj = {error: true, errorText: \'Could not download the manifest file.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t}',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.httpFetch(url,onOK,onFail,[{name:"cache-control",value:"no-cache"}]);',
'\t}',
'\tif(typeof manifest == \'function\') {',
'\t\tmanifest = manifest.call()',
'\t}',
'\tif(typeof manifest == \'string\') {',
'\t\tfetchManifest(manifest);',
'\t\treturn;',
'\t}',
'\t//var oldManifest = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t//debugger;',
'\tvar oldManifest = getManifest(manifestName);',
'\tvar obj = {};',
'\tvar newManifest = manifest;',
'\tif(oldManifest != null) {',
'\t\tvar newManifest = computeNewManifest(oldManifest,manifest,folder);',
'\t} else {',
'\t\tif(manifest.constructor != Array) {',
'\t\t\tobj = JSON.parse(manifest);',
'\t\t}',
'\t}',
'\tobj[folder] = manifest;',
'\tvar json = JSON.stringify(obj);',
'\tvar flagInformationOnly = false;',
'\tif(typeof optionsIn.informationOnly != \'undefined\') {',
'\t\tif(optionsIn.informationOnly) {',
'\t\t\tflagInformationOnly = true;',
'\t\t}',
'\t}',
'\tif (!flagInformationOnly) {',
'\t\t//localStorage.setItem(\'transFormOnDeviceManifest\',json);',
'\t\tstoreManifest(json,manifestName)',
'\t}',
'\tmanifest = newManifest;',
'\tif(flagInformationOnly) {',
'\t\tvar objCB = {error: false, array: manifest, accountId: accountId, mode: \'informationOnly\'}',
'\t\tcbAllDone.call(this,objCB);',
'\t\treturn;',
'\t}',
'\tif(manifest.length == 0) {',
'\t\tvar objCB = {error: false, array: manifest, accountId: accountId, arrayFilesRelative: [], arrayFiles: [], fileCount: 0}',
'\t\tcbAllDone.call(this,objCB);',
'\t\treturn;',
'\t}',
'\tif(typeof flagMoveSQLiteFiles == \'undefined\') flagMoveSQLiteFiles = true;',
'\t\tif(flagMoveSQLiteFiles) {',
'\t\t\t//android can use sqlite files in a sub-dir so they are moved to the root and given a filename account___sqlitedbname.db',
'\t\t\tif(typeof cbAllDone == \'undefined\') {',
'\t\t\t\tvar origCB = function() { }',
'\t\t\t} else {',
'\t\t\t\torigCB = cbAllDone;',
'\t\t\t}',
'\t\t\tcbAllDone = function(obj) {',
'\t\t\t\tvar makeCBDone = function(array,cbNoError) {',
'\t\t\t\t\tvar cbDone = function() {',
'\t\t\t\t\t\tvar arrayIn = array;',
'\t\t\t\t\t\t/////////////////',
'\t\t\t\t\t\tvar folder = accountId;',
'\t\t\t\t\t\tvar cb = function(array) {',
'\t\t\t\t\t\t\tvar arrFQ = [];',
'\t\t\t\t\t\t\tvar arrR = [];',
'\t\t\t\t\t\t\tvar uriPrefix = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId);',
'\t\t\t\t\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\t\t\t\t\tarrR.push(array[i].name);',
'\t\t\t\t\t\t\t\tarrFQ.push(uriPrefix + array[i].name);',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t    var obj = {error: false, array: arrayIn, arrayFilesRelative: arrR, arrayFiles: arrFQ, fileCount: array.length}',
'\t\t\t\t\t\t\tcbNoError.call(this,obj);',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles(folder,cb);',
'\t\t\t\t\t\t////////////////',
'\t\t\t\t\t}',
'\t\t\t\t\treturn cbDone;',
'\t\t\t\t}',
'\t\t\t\tvar cbDone = makeCBDone(obj.array,origCB);',
'\t\t\t\tvar cbError = function() {};',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.moveSQLiteFilesFromSubfolder(obj.accountId,cbDone,cbError)',
'\t\t\t}',
'\t}',
'\tvar arr = manifest',
'\tvar tempFolderName = \'transFormTemp\';',
'\tfor(var i = 0; i < arr.length; i++) {',
'\t\tarr[i].filename = arr[i].url;',
'\t\tarr[i].zipped = false;',
'\t\tvar flagZip = false;',
'\t\tvar fn = arr[i].filename;',
'\t\tvar ext = fn.split(\'.\');',
'\t\text = ext[ext.length-1];',
'\t\tif(typeof ext != \'undefined\') {',
'\t\t\tif(ext.toLowerCase() == \'zip\') {',
'\t\t\t\tflagZip = true;',
'\t\t\t\tarr[i].zipped = true;',
'\t\t\t\tif(arr[i].type == \'file\') {',
'\t\t\t\t\tarr[i].type = \'folder\';',
'\t\t\t\t\tif(typeof arr[i].targetFolder == \'undefined\') arr[i].targetFolder = \'\';',
'\t\t\t\t}',
'\t\t\t}',
'\t\t}',
'\t\tarr[i].shortName = A5.parseFilename(fn).name;',
'\t\tif(typeof arr[i].targetFolder == \'undefined\') arr[i].targetFolder = \'\';',
'\t}',
'\tvar options = {',
'\t\tdirectory: tempFolderName,',
'\t\tstrip: true,',
'\t\tfilesystem: \'temp\',',
'\t\tforceDownloadIfFileExists: true,',
'\t\tonComplete: function(array) {',
'\t\t\t_processDownloadedFiles(arr,accountId)',
'\t\t},',
'\t\tonError: function(array,arrayIndex) {',
'\t\t\tvar cbObj = {error:true, errorText: \'Error downloading files to device.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t},',
'\t\tonDeviceOffline: function() {',
'\t\t\tvar cbObj = {error:true, errorText: \'No connection.\'};',
'\t\t\tcbAllDone.call(this,cbObj);',
'\t\t}',
'\t}',
'\tif(typeof optionsIn == \'object\') $u.o.assign(options,optionsIn);',
'\tvar _deleteTempFolder = function() {',
'\t\tvar _onRemoveSuccess = function() {  };',
'\t\tvar _error = function(e) {  };',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = tempFolderName + \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\tvar postProcessComplete = function(arr) {',
'\t\tvar flagDone = true;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(arr[i].postProcessDone == false) {',
'\t\t\t\tflagDone = false;',
'\t\t\t\tbreak;',
'\t\t\t}',
'\t\t}',
'\t\tvar ph = \'\';',
'\t\tif(typeof options.progress != \'undefined\') {',
'\t\t\tif(typeof options.progress.progressElement != \'undefined\') {',
'\t\t\t\tph = options.progress.progressElement;',
'\t\t\t}',
'\t\t}',
'\t\tif(ph == \'\') flagShowProgress = false;',
'\t\tvar ele = $(ph + \'.PROGRESS.TOTAL\');',
'\t\tvar ele2 = $(ph + \'.PROGRESSDISPLAY\');',
'\t\tif(ele2) {',
'\t\t\tele2.style.display = \'\';',
'\t\t\tele2.innerHTML = \'Processing files...\';',
'\t\t}',
'\t\t//alert(\'flag done: \' + flagDone);',
'\t\tvar flagShowProgress = false;',
'\t\tif(typeof options.showProgress != \'undefined\') {',
'\t\t\tflagShowProgress = options.showProgress;',
'\t\t}',
'\t\tif(flagShowProgress) {',
'\t\t\t//we don\'t show progress anymore for post processing. just put up a message saying \'Processing files...\'',
'\t\t}',
'\t\tif(flagDone) {',
'\t\t\tif(ele2) ele2.innerHTML = \'\';',
'\t\t\tif(ele2) ele2.style.display = \'none\';',
'\t\t\tif(ele) ele.style.display = \'none\';',
'\t\t\tvar that = this;',
'\t\t\tsetTimeout(function() {',
'\t\t\t\tif(ele2) ele2.style.display = \'none\';',
'\t\t\t\tsetTimeout(function() {',
'\t\t\t\t\tvar objCB = {error: false, array: arr, accountId: accountId};',
'\t\t\t\t\tcbAllDone.call(that,objCB);',
'\t\t\t\t\t_deleteTempFolder();',
'\t\t\t\t},100);',
'\t\t\t},101);',
'\t\t} else {',
'\t\t\tvar countDone = 0;',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(arr[i].postProcessDone) countDone = countDone + 1;',
'\t\t\t}',
'\t\t\tif(ele2) ele2.style.display = \'\';',
'\t\t\tvar pct = (countDone/arr.length) * 100;',
'\t\t\tif(ele) {',
'\t\t\t\t//ele.style.width = pct + \'%\';',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//////////////////// post process function start ////////////////////',
'\tvar _processDownloadedFiles = function(arr, accountId) {',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tarr[i].postProcessDone = false;',
'\t\t\tarr[i].postProcessError = false;',
'\t\t}',
'\t\tvar flagMustUpdateOnDeviceManifest = false;',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(!arr[i].downloaded) {',
'\t\t\t\tif(!flagInformationOnly) flagMustUpdateOnDeviceManifest = true;',
'\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t}',
'\t\t}',
'\t\t//sr00',
'\t\tif(flagMustUpdateOnDeviceManifest) {',
'\t\t\t//var m = localStorage.transFormOnDeviceManifest;',
'\t\t\tvar m = getManifest(manifestName);',
'\t\t\tvar mObj = JSON.parse(m);',
'\t\t\tvar url_i = \'\';',
'\t\t\tvar mObj2 = mObj[folder];',
'\t\t\t//window.onerror = function(err) { alert(\'Unhandled Javascript Error - postprocess:  \' + JSON.stringify(err));}',
'\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\tif(!arr[i].downloaded) {',
'\t\t\t\t\turl_i = arr[i].url;',
'\t\t\t\t\tfor(var j = 0; j < mObj2.length; j++) {',
'\t\t\t\t\t\tif(mObj2[j].url == url_i) {',
'\t\t\t\t\t\t\tmObj2[j].version = -1; //set version to -1 so that if the error is later corrected, file will download',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tm = JSON.stringify(mObj)',
'\t\t\t//localStorage.transFormOnDeviceManifest = m;',
'\t\t\tstoreManifest(m,manifestName);',
'\t\t}',
'\t\tpostProcessComplete(arr) //if all downloads fail, need to trigger the onDone event',
'\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\tif(arr[i].type == \'sqlite\' && arr[i].downloaded) {',
'\t\t\t\tvar flagZip = arr[i].zipped',
'\t\t\t\tif(flagZip) {',
'\t\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite unzipped in target - \'  + i + arr[i].localFilename );',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar fail = function() {',
'\t\t\t\t\t\t\t//alert(\'failed\');',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t};',
'\t\t\t\t\t\treturn fail;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar ok = _getcbok(i,arr);',
'\t\t\t\t\tvar fail = _getcbfail(i,arr);',
'\t\t\t\t\t//alert(\'about to unzip\'); debugger;',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipSQLite(arr[i].localFilename,\'\',\'\',\'\',accountId,ok,fail)',
'\t\t\t\t} else {',
'\t\t\t\t\t//SQLite db is NOT zipped',
'\t\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar onSuccess = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite db copied: \' + i + \' must now delete \' + arr[i].localFilename);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\t//alert(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn onSuccess;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function() {',
'\t\t\t\t\t\t\t//alert(\'sqlite db NOT copied: \' + i);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok;',
'\t\t\t\t\t}',
'\t\t\t\t\tvar onSuccess = _getcbok(i,arr);',
'\t\t\t\t\tvar onError = _getcbfail(i,arr);',
'\t\t\t\t\tvar fn = arr[i].localFilename',
'\t\t\t\t\tfn = fn.split(\'/\');',
'\t\t\t\t\tvar localDBName = fn[fn.length-1];',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.copySQLiteDB(arr[i].localFilename,\'\',\'\',\'\',localDBName,accountId, onSuccess, onError)',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tif(arr[i].type == \'file\' && arr[i].downloaded) {',
'\t\t\t\tvar fnSource = arr[i].localFilename;',
'\t\t\t\tif(arr[i].targetFolder == \'\') {',
'\t\t\t\t\tvar _targetFolder = accountId + \'/\';',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _targetFolder = accountId + \'/\' + arr[i].targetFolder;',
'\t\t\t\t}',
'\t\t\t\tvar makeOnMoveOK = function(arr,i) {',
'\t\t\t\t\tvar _ok = function() {',
'\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\tpostProcessComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _ok;',
'\t\t\t\t}',
'\t\t\t\tvar makeOnMoveError = function(arr,i) {',
'\t\t\t\t\tvar _err = function() {',
'\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\tpostProcessComplete(arr);',
'\t\t\t\t\t}',
'\t\t\t\t\treturn _err;',
'\t\t\t\t}',
'\t\t\t\tvar _onMoveSuccess = makeOnMoveOK(arr,i);',
'\t\t\t\tvar _error = makeOnMoveError(arr,i);',
'\t\t\t\tvar _srcPath = fnSource;',
'\t\t\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart) + _targetFolder;;',
'\t\t\t\tvar _destinationName = arr[i].shortName;',
'\t\t\t\tvar _onFolderCreateSuccess = function() {',
'\t\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(_srcPath, _destinationDirPath, _destinationName, _onMoveSuccess, _error);',
'\t\t\t\t};',
'\t\t\t\tvar _onFolderCreateError = makeOnMoveError(arr,i);',
'\t\t\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
'\t\t\t\tvar _dirStructure = _targetFolder;;',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _onFolderCreateSuccess, _onFolderCreateError);',
'\t\t\t}',
'\t\t\tif(arr[i].type == \'folder\' && arr[i].downloaded) {',
'\t\t\t\tvar _getcbfail = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar ok = function(err) {',
'\t\t\t\t\t\t\t//alert(\'failed\');',
'\t\t\t\t\t\t\talert(\'UNZIP folder failed: \' + i);',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = true;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn ok;',
'\t\t\t\t\t}',
'\t\t\t\tvar _getcbok = function(index,arrIn) {',
'\t\t\t\t\t\tvar i = index;',
'\t\t\t\t\t\tvar arr = arrIn;',
'\t\t\t\t\t\tvar onSuccess = function() {',
'\t\t\t\t\t\t\t//alert(\'folder UNZIP OK: \' + i + \' delete temp file: \' + arr[i].localFilename) ;',
'\t\t\t\t\t\t\tarr[i].postProcessDone = true;',
'\t\t\t\t\t\t\tarr[i].postProcessError = false;',
'\t\t\t\t\t\t\tpostProcessComplete(arr)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t\treturn onSuccess;',
'\t\t\t\t\t}',
'\t\t\t\tvar ok = _getcbok(i,arr)',
'\t\t\t\tvar fail = _getcbfail(i,arr)',
'\t\t\t\tif(arr[i].targetFolder == \'\') {',
'\t\t\t\t\tvar _target = accountId;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _target = accountId + \'/\' + arr[i].targetFolder;',
'\t\t\t\t}',
'\t\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapUnzipFiles(arr[i].localFilename,\'\',\'\',\'\',fileSystemPart, _target,ok,fail,false)',
'\t\t\t}',
'\t\t}',
'\t}',
'\t//////////////////// post process function end ////////////////////',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'}',
'//////////////////////////===========new',
'//each named manifest MUST have its own folder',
'{UXPRERENDEREDALIAS}_DlgObj.__getManifestObj = function(keyName) {',
'\tif(typeof keyName == \'undefined\') keyName = \'manifests\';',
'\t\tvar manifestObj = localStorage.getItem(keyName);',
'\t\tif(manifestObj == null || !manifestObj) manifestObj = \'\';',
'\t\tif(manifestObj == \'\') {',
'\t\t\tmanifestObj = {};',
'\t\t} else {',
'\t\t\tmanifestObj = JSON.parse(manifestObj);',
'\t\t}',
'\t\treturn manifestObj;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest = function(manifestName) {',
'\twindow.onerror = function(err) { alert(\'Error - getFolderForNamedManifest():  \' + JSON.stringify(err));}',
'\t//returns an object with \'folder\' and \'fileSystemPart\'',
'\tif(typeof manifestName == \'undefined\' || manifestName == \'\') manifestName = \'___default___\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar obj2 = obj[manifestName];',
'\treturn obj2;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesInManifest = function(manifestName,cb) {',
'\twindow.onerror = function(err) { alert(\'Error - phoneGapListFilesInManifest():  \' + JSON.stringify(err));}',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName);',
'\tif(obj) {',
'\t\tvar folder = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName).folder;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles(folder,cb);',
'\t} else {',
'\t\tvar arr = [];',
'\t\tcb.call(this,arr);',
'\t}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesInManifest = function(manifestName,onOK,onError) {',
'\twindow.onerror = function(err) { alert(\'Error - phoneGapDeleteFilesInManifest():  \' + JSON.stringify(err));}',
'\tif(typeof manifestName == \'undefined\') manifestName = \'\';',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getFolderForNamedManifest(manifestName);',
'\tif(!obj) return;',
'\tif(obj) var folder = obj.folder;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFRemoveFilesForAccount(folder,onOK,onError,manifestName)',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tdelete obj[manifestName];',
'\tvar json = JSON.stringify(obj);',
'\tlocalStorage.setItem(\'manifestInfo\',json) ;',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\tdelete obj[manifestName];',
'\tvar json = JSON.stringify(obj);',
'\tlocalStorage.setItem(\'manifests\',json)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.listManifests = function(cb) {',
'\twindow.onerror = function(err) { alert(\'Error - listManifests():  \' + JSON.stringify(err));}',
'\tvar m = [];',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tif(obj) {',
'\t\tfor(var n in obj) {',
'\t\t\tif(n.indexOf(\'___default___\') > -1) {',
'\t\t\t\tvar obj2 = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\t\t\tif(obj2 == null || obj2 == \'null\') {',
'\t\t\t\t} else {',
'\t\t\t\t\tm.push(\'Default Manifest\');',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tm.push(n)',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(cb) cb.call(this,m);',
'\treturn m;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.getManifests = function(onOK) {',
'\twindow.onerror = function(err) { alert(\'FATAL: getManifests()  \' + JSON.stringify(err));}',
'\tvar m = {UXPRERENDEREDALIAS}_DlgObj.listManifests();',
'\tvar r = [];',
'\tvar robj = {};',
'\tvar obj =  {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj(\'manifestInfo\');',
'\tvar obj2 = {UXPRERENDEREDALIAS}_DlgObj.__getManifestObj();',
'\tfor(var i = 0; i < m.length; i++) {',
'\t\tvar n = m[i];',
'\t\tif(n == \'Default Manifest\') {',
'\t\t\tvar obj4 = obj[\'___default___\'];',
'\t\t\tif(obj4) {',
'\t\t\t\tif(obj4.folder && obj4.folder != null) {',
'\t\t\t\t\tdelete robj;',
'\t\t\t\t\tvar robj = {};',
'\t\t\t\t\trobj.name = \'Default Manifest\';;',
'\t\t\t\t\trobj.folder = obj4.folder',
'\t\t\t\t\trobj.fileSystemPart = obj4.fileSystemPart;',
'\t\t\t\t\tvar ls = localStorage.getItem(\'transFormOnDeviceManifest\');',
'\t\t\t\t\tvar ls = JSON.parse(ls);',
'\t\t\t\t\tif(ls) {',
'\t\t\t\t\t\tvar manifest = ls[obj4.folder];',
'\t\t\t\t\t\trobj.manifest = manifest;',
'\t\t\t\t\t\tr.push(robj)',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t} else {',
'\t\t\tdelete robj;',
'\t\t\tvar robj = {};',
'\t\t\trobj.name = n;',
'\t\t\tvar obj4 = obj[n]',
'\t\t\tif(obj4 && obj4.folder) {',
'\t\t\t\trobj.folder = obj4.folder;',
'\t\t\t\trobj.fileSystemPart = obj4.fileSystemPart;',
'\t\t\t\trobj.manifest = JSON.parse(obj2[n])[obj4.folder];',
'\t\t\t\tr.push(robj);',
'\t\t\t}',
'\t\t}',
'\t}',
'\tif(typeof onOK == \'function\') onOK.call(this,r);',
'\treturn r;',
'}',
'/*',
'{UXPRERENDEREDALIAS}_DlgObj.getManifest = function(manifestName,onOK) {',
'\tvar val = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetManifestBaseFolder(manifestName,onOK,\'getManifest\')',
'}',
'*/',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetManifestBaseFolder = function(manifestName,onOK,mode) {',
'\tvar name = manifestName;',
'\tif(name == \'\') name = \'Default Manifest\';',
'\tif(manifestName == \'Default Manifest\') manifestName = \'\'',
'\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getManifests();',
'\tif(!obj) {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,{});',
'\t\treturn \'\';',
'\t};',
'\tvar obj2 = {};',
'\tvar found = false;',
'\tfor(var i = 0; i < obj.length; i++) {',
'\t\tif(obj[i].name == name) {',
'\t\t\tobj2 = obj[i];',
'\t\t\tfound = true;',
'\t\t}',
'\t}',
'\tif(mode == \'getManifest\') {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,obj2)',
'\t\treturn obj2;',
'\t}',
'\tif(!found) {',
'\t\tif(typeof onOK == \'function\') onOK.call(this,{});',
'\t\treturn \'\';',
'\t}',
'\tvar folder = obj2.folder;',
'\tvar fspart = obj2.fileSystemPart;',
'\tobj2.baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(obj2.fileSystemPart)',
'\tif(typeof onOK == \'function\') onOK.call(this,obj2)',
'\treturn \'\' + {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(obj2.fileSystemPart)',
'}',
'//////////////',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFReadFile = function(filename,ok,fail) {',
'\tvar fileSystemPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(account,true);',
'\tif(typeof ok == \'undefined\') ok = function() { };',
'\tif(typeof fail == \'undefined\') fail = function(e) { };',
'\tvar _success = function(result) {',
'\t\tok.call(this,result)',
'\t};',
'\tvar _error = function(e) {',
'\t\tfail.call(this,e)',
'\t};',
'\tif(fileSystemPart == null || fileSystemPart == \'\') {',
'\t\tfail.call(this);',
'\t\treturn;',
'\t}',
'\tvar _filePath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart) + filename;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(_filePath, _success,_error)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFExecuteSQL = function(dbName,sql,args,ok,fail) {',
'/*',
'useage:',
'var _success = function() {',
'\tresultArray = arguments[0];',
'\t{UXPRERENDEREDALIAS}_DlgObj.setListColumnsAndPopulate(\'list1\',resultArray)',
'};',
'var _error = function(e) { };',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFExecuteSQL(\'account1/SQLiteNorthwind.db\',\'select * from Customers where Country = ?\',[\'UK\'],ok,fail)',
'*/',
'\tif(typeof ok != \'function\') ok = function() { };',
'\tif(typeof fail != \'function\') fail = function(e) { }',
'\t//dbName is typically like this: account1/dbname.db',
'\tif(args.constructor == Array) {',
'\t\tvar _args = args;',
'\t} else {',
'\t\tvar _args = [];',
'\t}',
'\tvar _success = function(tx,result,resultArray) {',
'\t\tok.call(this,resultArray,result,tx)',
'\t};',
'\tvar _error = function(e) {',
'\t\tfail.call(this,e)',
'\t};',
'\t_onTxSuccess = function() {/*transaction success */  };',
'\t_onTxError = function() {/*transaction error */  };',
'\t{UXPRERENDEREDALIAS}_DlgObj.SQLiteExecuteSQL(dbName,sql,_args,_success,_error,_onTxSuccess,_onTxError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteSQLiteDBFiles = function(account,cb,onerror) {',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\tif(typeof onerror == \'undefined\') onerror = function() { };',
' \tvar ext = \'.db\';',
' \tvar _onCompletion = function() { cb.call(this);};',
'\tvar _error = function(e) { onerror.call(this) };',
'\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\tvar _dirName = \'/\';;',
'\tvar _matchRegex = new RegExp(account.escapeRegExp() + \'___[A-z0-9_]*\' + ext.escapeRegExp());',
'\tvar _keepList = [];',
'\tvar _dirPath = _baseURI + _dirName;',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(_dirPath,_matchRegex,_keepList, _onCompletion, _error);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFRemoveFilesForAccount = function(accountId,cb,onError) {',
'\tif(typeof onError == \'undefined\') onError = function() { };',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\t//get the fspart where manifest was loaded',
'\tvar fsPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId);',
'\tvar __removeSQLite = function(accountId,cb,onError) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteSQLiteDBFiles(accountId,cb,onError);',
'\t}',
'\tvar _errorRemoveFolder = function() { __removeSQLite(accountId,cb,onError); };',
'\tvar _onRemoveFolderSuccess = function() { __removeSQLite(accountId,cb,onError);};',
'\tvar _dirPath = fsPart + accountId + \'/\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveFolderSuccess, _errorRemoveFolder);',
'\tvar manifestName = arguments[3];',
'\tif(typeof manifestName == \'undefined\') localStorage.transFormOnDeviceManifest = null;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFListAccountFiles = function(account,cb) {',
'//alert(\'list\');',
'//debugger;',
'//if fileSystemPart is \'private\' on iOS will get odd results because private and getSQLiteFolder() are same folder',
'\tvar fileSystemPart = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(account,true);',
'\tif(typeof cb == \'undefined\') cb = function() { };',
'\tif(fileSystemPart == null || fileSystemPart == \'\') {',
'\t\tcb.call(this,[]);',
'\t\treturn;',
'\t}',
'\tvar arr = [];',
'\tvar _files = function(account) {',
'\t\tvar _onSuccess = function(filelist) {',
'\t\t\tvar str;',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tstr = filelist[i];',
'\t\t\t\tif(str.substr(str.length-1) != \'/\') {',
'\t\t\t\t\tarr.push({name: account + \'/\' + filelist[i], type: \'file\'});',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\t_sqlite(account)',
'\t\t};',
'\t\tvar _error = function(e) {  _sqlite(account) };',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
'\t\tvar _dirName = account + \'/\';;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
'\t}',
'\tvar _sqlite = function(account) {',
'\t\tvar _onSuccessSQ = function(filelist) {',
'\t\t\tvar _ext = function(fn) {',
'\t\t\t\tfn = fn.split(\'.\')',
'\t\t\t\tif(fn.length == 1) return \'\';',
'\t\t\t\tvar ext = fn[fn.length-1];',
'\t\t\t\tif(typeof ext == \'undefined\') ext = \'\';',
'\t\t\t\treturn ext;',
'\t\t\t}',
'\t\t\tvar flagFixType = false;',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tflagFixType = false;',
'\t\t\t\t/*',
'\t\t\t\ttry{',
'\t\t\t\t\tif(fileSystemPart == \'private\' && device.platform.toLowerCase() == \'ios\') {',
'\t\t\t\t\t\tflagFixType = true;',
'\t\t\t\t\t}',
'\t\t\t\t}catch(e) { }',
'\t\t\t\t*/',
'\t\t\t\tif(flagFixType == false) {',
'\t\t\t\t\tif(filelist[i].indexOf(account) == 0) {',
'\t\t\t\t\t\tif( filelist[i].substr(filelist[i].length-1) != \'/\' && _ext(filelist[i]) == \'db\') {',
'\t\t\t\t\t\t\tarr.push({name: filelist[i], type: \'SQLiteDB\'});',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t};',
'\t\t\tif(flagFixType) {',
'\t\t\t\tfor(var i = 0; i < arr.length; i++) {',
'\t\t\t\t\tvar _n = arr[i].name.split(\'.\');',
'\t\t\t\t\tvar _e = _n[_n.length-1];',
'\t\t\t\t\tif(_e.toLowerCase() == \'db\') {',
'\t\t\t\t\t\tarr[i].type = \'SQLiteDB\';',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tcb.call(this,arr);',
'\t\t};',
'\t\tvar _error = function(e) { cb.call(this,arr);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\t\t//var _dirName = account + \'/\';;',
'\t\t_dirName = \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccessSQ, _error);',
'\t}',
'\t_files(account)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetSQLiteDatabases = function(account,cb,error) {',
'\tif(typeof error == \'undefined\') error = function(e) { };',
'\tvar _sqlite = function(account) {',
'\t\tvar _onSuccessSQ = function(filelist) {',
'\t\t\tif(account != \'\') {',
'\t\t\t\tvar _f = [];',
'\t\t\t\tvar x;',
'\t\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\t\tx = filelist[i].split(\'.\');',
'\t\t\t\t\tx = x[x.length-1];',
'\t\t\t\t\tif(filelist[i].indexOf(account+\'___\') == 0 && x != \'undefined\' && x == \'db\' ) {',
'\t\t\t\t\t\t_f.push(filelist[i]);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t} else {',
'\t\t\t\tvar _f = [];',
'\t\t\t\tvar x;',
'\t\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\t\tx = filelist[i].split(\'.\');',
'\t\t\t\t\tx = x[x.length-1];',
'\t\t\t\t\tif(x != \'undefined\' && x == \'db\' ) {',
'\t\t\t\t\t\t_f.push(filelist[i]);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\tcb.call(this,_f);',
'\t\t};',
'\t\tvar _error = function(e) { error.call(this,e);};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);',
'\t\t_dirName = \'/\';',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccessSQ, _error);',
'\t}',
'\t_sqlite(account)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart = function(accountId,flagShortPartName) {',
'\tif(typeof flagShortPartName == \'undefined\') flagShortPartName = false;',
'\tvar baseFolder = \'\'',
'\tvar storedWhere = localStorage.getItem(\'transFormFileSystemPart\');',
'\tvar obj = {}',
'\tif(storedWhere == null) {',
'\t} else {',
'\t\ttry{',
'\t\t\tobj = JSON.parse(storedWhere);',
'\t\t\tbaseFolder = obj[accountId];',
'\t\t}catch(e) {',
'\t\t}',
'\t}',
'\tif(flagShortPartName) {',
'\t\treturn baseFolder;',
'\t}',
'\tbaseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL( baseFolder);',
'\treturn baseFolder;',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFullPath = function(relativeFilename,accountId) {',
'\tif(relativeFilename.indexOf(accountId) == -1) {',
'\t\tvar baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId) + accountId + \'/\' + relativeFilename;',
'\t} else {',
'\t\tvar baseFolder = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(accountId) +  relativeFilename;',
'\t}',
'\treturn baseFolder;',
'}',
'////=========== \'sr87',
'{UXPRERENDEREDALIAS}_DlgObj.moveSQLiteFilesFromSubfolder = function(accountIn, cbDone, cbError) {',
'\t//called after a manifest has been downloaded to move the SQLite databases to the root of the SQLite folder with \'accountName___\' as the db prefix',
'\t//this is done because while iOS can open a db named folder/sqlite.db, android can\'t. so we make folder___sqlite.db',
'\t//get a list of SQLite dbs in the subfolder, then iterate over list calling _moveLow()',
'\tfunction _moveLow(account,dbName,array, cbDone) {',
'\t\t//var _onMoveSuccess = function() { alert(\'ok\'); + alert(JSON.stringify(array)); };',
'\t\tvar _onMoveSuccess = cbDone;',
'\t\tvar _error = function(e) { alert(\'move failed\');};',
'\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1) + account + \'/\' + dbName;',
'\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.getSQLiteFolder(1);;',
'\t\tvar _destinationName = account + \'___\' + dbName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(_srcPath, _destinationDirPath, _destinationName, _onMoveSuccess, _error);',
'\t}',
'\t//make a closure that captures the accountIn name',
'\tvar _makeOK = function(accountIn,cbDone,cbError) {',
'\t\tvar account = accountIn;',
'\t\tvar _ok = function(filelist) {',
'\t\t\tvar _arr = []',
'\t\t\tfor(var i = 0; i < filelist.length; i++) {',
'\t\t\t\tif(filelist[i].indexOf(account + \'/\') == 0) {',
'\t\t\t\t\tvar n = filelist[i];',
'\t\t\t\t\tn = n.split(\'/\')',
'\t\t\t\t\tvar acc = n[0];',
'\t\t\t\t\tvar dbName = n[1];',
'\t\t\t\t\t_arr.push({account: acc, dbName: dbName, completed: 0});',
'\t\t\t\t}',
'\t\t\t}',
'\t\t\t//alert(\' now do _moveLow for \' + _arr.length + \' files\');',
'\t\t\tif (_arr.length == 0) {',
'\t\t\t\tcbDone.call();',
'\t\t\t}',
'\t\t\tvar count = 0;',
'\t\t\tfor(var i = 0; i < _arr.length; i++) {',
'\t\t\t\tvar _okmc = function(ii) {',
'\t\t\t\t\tvar arr = _arr;',
'\t\t\t\t\tvar _ok = function() {',
'\t\t\t\t\t\t_arr[ii].completed = 1;',
'\t\t\t\t\t\tvar _done = 0;',
'\t\t\t\t\t\tfor(var j = 0; j < arr.length; j++) {',
'\t\t\t\t\t\t\t_done = _done + arr[j].completed;',
'\t\t\t\t\t\t\tif(_done == arr.length) {',
'\t\t\t\t\t\t\t\t//alert(\'done: \' + _done + \' account: \' + accountIn + \' typeof cbDone: \' + typeof cbDone);',
'\t\t\t\t\t\t\t\t//alert(cbDone.toString())',
'\t\t\t\t\t\t\t\tcbDone.call();',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t};',
'\t\t\t\t\treturn _ok;',
'\t\t\t\t}',
'\t\t\t\tvar _okm = _okmc(i);',
'\t\t\t\t_moveLow(_arr[i].account,_arr[i].dbName,_arr,_okm)',
'\t\t\t}',
'\t\t};',
'\t\treturn _ok;',
'\t}',
'\t//var cbx = function() { };',
'\t//alert(1);',
'\t//alert(cbDone.toString());',
'\tvar _ok = _makeOK(accountIn,cbDone);',
'\tvar _err = function(e) { };',
'\tvar _err = _ok; //sr 6-12-2020 on android, if there are no sqlite databases, then the _err function will get called and as a result, the onComplete event was  not firing',
'\t//therefore make the _err() function same as the _ok() function',
'\t//need to specify a blank account because the sqlite unzip creates subfolders at the root level of the sqlite folder and these are the files we want to move',
'\tvar account = \'\';',
'\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetSQLiteDatabases(account,_ok,_err);',
'}',
'////=======',
'//',
'// {UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(dirpath, matchRegex, keepList, onCompletion, onError)',
'//',
'// dirpath is the file URL of the directory whose contents will be examined (only files).',
'// matchRegex, if non-null, will need to match file names found for them to be considered for deletion.',
'// Any file name which is in the array keepList will not be considered even if it matches.',
'// All remaining files found (those matched and not in keepList) will be deleted.',
'//',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL = function(dirpath, matchRegex, keepList, onCompletion, onError) {',
'   if (!{UXPRERENDEREDALIAS}_DlgObj.phoneGapFilesAvailable()) {',
'      onError();',
'      return;',
'   }',
'   var keepnames = {}; // fill object with all the names as attributes',
'   for (var j=0; j<keepList.length; j++) {',
'      keepnames[keepList[j]] = true;',
'   }',
'   var filelist = []; // list of files to delete',
'   var totalDeleted = 0;',
'   var deleteFromFileList = function() { // called repeatedly by itself on successes until all deleted',
'      if (filelist.length==0) { // no more to delete',
'         onCompletion(totalDeleted);',
'         return;',
'      }',
'      var todelete = filelist.pop(); // pop one from list and delete it, leaving list shorter',
'      totalDeleted += 1;',
'      todelete.remove(deleteFromFileList, onError);',
'   };',
'   var onResolvedURL =',
'      function(fsEntry) {',
'         var dirReader = fsEntry.createReader();',
'         var readEntriesFunction =',
'            function() { // function to recurse to call repeatedly after each completion until no result',
'               dirReader.readEntries( // start an async reading of entries',
'                  function(entries) { // more entries read, or done',
'                     if (!entries || entries.length==0) {',
'                        deleteFromFileList(); // got all - now start deleting them',
'                        return;',
'                     }',
'                     var name;',
'                     for (var i=0; i<entries.length; i++) {',
'                        name = entries[i].name;',
'                        if (!matchRegex || name.match(matchRegex)) { // must match regex',
'                           if (!keepnames[name]) { // and not be on keep list',
'                              filelist.push(entries[i]); // add one to delete to list',
'                           }',
'                        }',
'                     }',
'                     readEntriesFunction(); // recurse to call dirReader.readEntries again',
'                  },',
'                  onError);',
'               };',
'         readEntriesFunction(); // do first reading',
'      };',
'   window.resolveLocalFileSystemURL(dirpath, onResolvedURL, onError);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapGetVideoFromLibrary = function(ops) {',
'\tif(typeof ops.onBeforeCaptureJavascript != \'undefined\') {',
'\t\tif(ops.onBeforeCaptureJavascript.constructor == Function) {',
'\t\t\tvar result = ops.onBeforeCaptureJavascript.call();',
'\t\t\tif(typeof result !=\'undefined\' && !result) return false;',
'\t\t}',
'\t}',
'\tvar _options = ops',
'\tvar getVideoWithPromises = function() {',
'\t\treturn new Promise(function (returnResolve, returnReject) {',
'\t\t// here are all the callbacks as promises',
'\t\tnew Promise(function (resolve, reject) {',
'\t\t\t// call camera | photo library | videos only',
'\t\t\tvar options = {',
'\t\t\t\tdestinationType: Camera.DestinationType.FILE_URI,',
'\t\t\t\tsourceType: Camera.PictureSourceType.PHOTOLIBRARY,',
'\t\t\t\tmediaType: Camera.MediaType.VIDEO',
'\t\t\t};',
'\t\t\tnavigator.camera.getPicture(resolve, reject, options);',
'\t\t}).then(function(filePath) {',
'\t\t\tconsole.log(\'First promise returned filepath: \'+filePath);',
'\t\t\t//Android does not return prefix so append',
'\t\t\tvar prefix = \'file://\'',
'\t\t\tfilePath=filePath.includes(prefix)?filePath:prefix+filePath;',
'\t\t\treturn new Promise(function(resolve, reject) {',
'\t\t\t\t\twindow.resolveLocalFileSystemURL(filePath, resolve, reject);',
'\t\t\t});',
'\t\t}).then(function (videoFileEntry) {',
'\t\t\tconsole.log(\'Second promise returned videoFileEntry: \'+videoFileEntry);',
'\t\t\treturnResolve(videoFileEntry)',
'\t\t});',
'\t});',
'}',
'\tvar getVideo = function() {',
'\t\tgetVideoWithPromises().then(function (videoFileName) {',
'\t\t\tconsole.log(\'Final promise completed.\');',
'\t\t\tvar vUrl = videoFileName.toURL();',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._thisVideo = [vUrl];',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.setValue(\'vp\',vUrl);',
'\t\t\tconsole.log(\'Local Video File: \'+vUrl);',
'\t\t\tvar e2 = {};',
'\t\t\te2.fileSystemURL = vUrl;',
'\t\t\t_options.onCaptureJavascript.call(this,e2);',
'\t\t}, function(err) {',
'\t\t\tconsole.log(\'Error: \' + err);',
'\t\t\talert(\'Error: \' + err);',
'\t\t});',
'\t};',
'\tgetVideo();',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapOpenFileWithNativeViewer = function(objIn,_onSuccess,_onError) {',
'\tvar _ts = function(txt) { //add trailing slash',
' \t\tif(txt[txt.length-1] == \'/\') return txt;',
'\t\treturn txt + \'/\';',
'\t}',
'\tif(typeof objIn.targetFolder == \'undefined\') objIn.targetFolder = \'\';',
'\tobjIn.targetFolder = _ts(objIn.targetFolder);',
'\tobjIn.sourceFolder = _ts(objIn.sourceFolder);',
'\tobjIn.flagMustDownload = typeof objIn.flagMustDownload != \'undefined\' ? objIn.flagMustDownload: false;',
'\t//set up obj variables from the passed in object (objIn);',
'\tvar obj = {};',
'\tobj.__tempFolderDirName = \'__AATEMPFILES/\';',
'\tif(objIn.flagMustDownload == false) { //local file',
'\t\tobj.__fileName = objIn.sourceFileName;',
'\t} else {//remote file',
'\t\tvar __url = objIn.sourceFileName;',
'\t\tobj.__url = __url;',
'\t\tvar __forceDownloadIfFileExists = true;',
'\t\tvar __showProgress = objIn.options.showProgress;',
'\t\tvar __downloadOptions = objIn.options;',
'\t\t//alert(\'__url: \' + __url);',
'\t\tobj.__fileName = A5.parseFilename(objIn.sourceFileName).name; \'\'  //get the short filename from the URL',
'\t}',
'\tobj.__sourceFileSystemPart = objIn.sourceFileSystem;',
'\tobj.__sourceFolder = objIn.sourceFolder;',
'\tobj.flagMustDownload = objIn.flagMustDownload',
'\tobj.options = objIn;',
'\t//end set up obj variables',
'\t{UXPRERENDEREDALIAS}_DlgObj._phoneGapOpenNativeLow(obj,_onSuccess,_onError)',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._phoneGapOpenNativeLow = function(obj,_onSuccess,_onError) {',
'\ttry {',
'\t//cordova.plugins.fileOpener2',
'\t\tvar _open = cordova.plugins.disusered.open;',
'\t} catch(e) {',
'\t\talert("\'cordova-open\' plugin not loaded.");',
'\t\treturn false;',
'\t}',
'\tif(obj.__fileName.indexOf(\'http:\') == -1 && obj.__fileName.indexOf(\'https:\') == -1)  {',
'\t\tvar o = A5.parseFilename(obj.__fileName);',
'\t\tobj.__fileNameFull = obj.__fileName;',
'\t\tobj.__fileName = o.name;',
'\t\tif(o.path != \'\') {',
'\t\t\tobj.__sourceFolder = obj.__sourceFolder + o.path + \'/\';',
'\t\t}',
'\t}',
'\tvar __targetFileName = obj.options.targetFileName;',
'\tvar __tempFolderDirName = obj.__tempFolderDirName; //temp dir where files are copied so that they can be opened',
'\tvar __fileName = obj.__fileName;',
'\tvar __srcFileName = __fileName;',
'\tvar __srcFileNameFull = obj.__fileNameFull',
'\tif(typeof __targetFileName != \'undefined\') {',
'\t\t__fileName = __targetFileName;',
'\t} else {',
'\t\t__targetFileName = \'\';',
'\t}',
'\tvar __sourceFileSystemPart = obj.__sourceFileSystemPart; //dir part where local file exists were where remote file will be downloaded',
'\tvar __sourceFolder = obj.__sourceFolder; //dir folder where local file exists or where remote file will be downloaded',
'\tvar __url = obj.__url;  //if file is remote, the remote url for the file',
'\t//obj.flagMustDownload - true/false indicates if file is local or remote',
'\t//clear out the temp folder by deleting it/////////////////////////////////////',
'\tvar _deleteTemp = function(cb) {',
'\t\tvar _onRemoveSuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was removed.\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was not removed. Not critical, so continue.\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirName = __tempFolderDirName;;',
'\t\tvar _dirPath = _baseURI + _dirName;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(_dirPath, _onRemoveSuccess, _error);',
'\t}',
'\t//recreate the temp folder////////////////////////////////////////////////////',
'\tvar _createTemp = function(cb) {',
'\t\tvar _onSuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was created\');',
'\t\t\tcb.next();',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'Temp dir was not created. Critical error, so stop.\');',
'\t\t\t_onError(e);',
'\t\t\tcb.stop();',
'\t\t};',
'\t\tvar _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _dirStructure = __tempFolderDirName;;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _onSuccess, _error);',
'\t}',
'\t//copy the source file to the temp folder ////////////////////////////////////////////',
'\tvar _copyToTemp = function(cb) {',
'\t\tvar _onCopySuccess = function() {',
'\t\t\tif(A5.log) A5.log(\'File was copied\');',
'\t\t\tcb.next()',
'\t\t};',
'\t\tvar _error = function(e) {',
'\t\t\tif(A5.log) A5.log(\'File was not copied. Critical error, so stop.\');',
'\t\t\t_onError(e);',
'\t\t\tcb.stop();',
'\t\t};',
'\t\tif(__sourceFileSystemPart.indexOf(\'manifest:\') == -1 ) {',
'\t\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder +  __srcFileName;',
'\t\t} else {',
'\t\t\tvar manifestFolder = __sourceFileSystemPart.split(\':\')[1];',
'\t\t\tvar _srcPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapTFGetFSPart(manifestFolder)',
'\t\t\t_srcPath = _srcPath + manifestFolder + \'/\' + __srcFileNameFull;',
'\t\t}',
'\t\tvar _destinationDirPath = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\');;',
'\t\tvar _destinationName = __tempFolderDirName + __fileName;',
'\t\tif(A5.log) A5.log(\'Copy file - source: \' + _srcPath)',
'\t\tif(A5.log) A5.log(\'Copy file - target: \' + _destinationDirPath + _destinationName);',
'\t\tif(_srcPath == _destinationDirPath + _destinationName) {',
'\t\t \tcb.next();',
'\t\t } else {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(_srcPath, _destinationDirPath, _destinationName, _onCopySuccess, _error);',
'\t\t}',
'\t}',
'\t//open the file with the native viewer ////////////////////////////////////////',
'\tvar _openFile = function(cb) {',
'\t\tvar _open = cordova.plugins.disusered.open;',
'\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(\'temp\') + __tempFolderDirName + __fileName;',
'\t\tif(A5.log) A5.log(\'File to show: \' +_filename);',
'\t\t_open(_filename,_onSuccess,_onError);',
'\t}',
'\tvar _actions = [];',
'\tif(obj.__sourceFileSystemPart != \'temp\') {',
'\t\t_actions.push(_deleteTemp);',
'\t\t_actions.push(_createTemp);',
'\t}',
'\t_actions.push(_copyToTemp);',
'\t_actions.push(_openFile);',
'\tvar forEach = function(actions,andThen,ifError) {',
'\t    var index = 0;',
'\t    var stop = function(err) {',
'\t    \tif(ifError) {',
'\t    \t\tifError(err);',
'\t    \t}',
'\t    }',
'\t    var  next = function() {',
'\t        if( index < actions.length ) {',
'\t            var action = actions[index];',
'\t            ++index;',
'\t            action({next:next,stop:stop});',
'\t        } else if(andThen) {',
'\t        \tandThen();',
'\t        }',
'\t    };',
'\t    next();',
'\t};',
'\tvar _allDone = function() { }',
'\tvar _fatal = function() { }',
'\tif(obj.flagMustDownload) { //file download',
'\t\tvar fileToGet = __url;',
'\t\tvar arr = [{filename: fileToGet}];',
'\t\tvar opsIn = obj.options;',
'\t\tvar options = {',
'\t\t\tdirectory: \'\',',
'\t\t\ttargetFolder: opsIn.sourceFolder,',
'\t\t\tforceDownloadIfFileExists: opsIn.options.forceDownloadIfFileExists,',
'\t\t\tshowProgress: opsIn.options.showProgress,',
'\t\t\tonComplete: function(array) {',
'\t\t\t\tif(A5.log) A5.log(\'File download complete\');',
'\t\t\t\tvar msg = JSON.stringify(array,\'\',\'\\t\');',
'\t\t\t\tif(A5.log) A5.log(msg);',
'\t\t\t\t/*',
'\t\t\t\tvar _a2 = []',
'\t\t\t\tvar _a = [];',
'\t\t\t\tfor(var i = 0; i < array.length; i++) {',
'\t\t\t\t\t_a.push({filename: array[i].localFilename, found: array[i].found, downloaded: array[i].downloaded});',
'\t\t\t\t\t_a2.push(array[i].localFilename);',
'\t\t\t\t}',
'\t\t\t\tvar l = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'list2\');',
'\t\t\t\tl.populate(_a);',
'\t\t\t\t$(\'div4\').innerHTML = \'actual download filename: \' + _a2.join(\'<br>\');',
'\t\t\t\t*/',
'\t\t\tif(__targetFileName == \'\' && (__sourceFileSystemPart == \'temp\' || __sourceFileSystemPart == \'public\')) {',
'\t\t\t\tif(A5.log) A5.log(\'Open file in place. No need to copy to a temporary folder\');',
'\t\t\t\tvar _open = cordova.plugins.disusered.open;',
'\t\t\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder + __fileName;',
'\t\t\t\t_open(_filename,_onSuccess,_onError);',
'\t\t\t\treturn false;',
'\t\t\t}',
'\t\t\t\tforEach(_actions,_allDone,_fatal)',
'\t\t\t},',
'\t\t\tonError: function(array,arrayIndex) { alert(\'Download error\'); _onError();},',
'\t\t\tonDeviceOffline: obj.options.options.onDeviceOffline,',
'\t\t\tprogress: opsIn.options.progress,',
'\t\t\tstrip: true',
'\t\t}',
'\t\tdelete options.targetFolder;',
'\t\toptions.filesystem =  opsIn.sourceFileSystem;',
'\t\toptions.directory = opsIn.sourceFolder;',
'\t\tif(A5.log) A5.log(\'About to do file download\')',
'\t\tif(A5.log) A5.log(JSON.stringify(arr,\'\',\'\\t\'));',
'\t\tif(A5.log) A5.log(JSON.stringify(options,\'\',\'\\t\'));',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileDownload(arr,options);',
'\t\t//end file download',
'\t} else {',
'\t\t//local file',
'\t\tif(__targetFileName == \'\' && (__sourceFileSystemPart == \'temp\' || __sourceFileSystemPart == \'public\')) {',
'\t\t\tif(A5.log) A5.log(\'Open file in place. No need to copy to temporary folder.\');',
'\t\t\tvar _open = cordova.plugins.disusered.open;',
'\t\t\tvar _filename = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(__sourceFileSystemPart) + __sourceFolder + __fileName;',
'\t\t\t_open(_filename,_onSuccess,_onError);',
'\t\t\treturn false;',
'\t\t}',
'\t\tforEach(_actions,_allDone,_fatal);',
'\t}',
'}',
'//PROMISE VERSIONS',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURLPromise = function(_baseURI,_dirStructure) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() {resolve()};',
'\t\tvar _err = function(e) { \treject(e)\t};',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapEnsureDirPathURL(_baseURI, _dirStructure, _ok, _err);',
'\t}',
'   return new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURLPromise = function(filepath, text, append) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapWriteFileURL(filepath,text,_ok,_err,append)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURLPromise = function(filepath, startAt, endAt) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(data) { resolve(data) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapReadFileURL(filepath,_ok,_err,startAt, endAt)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURLPromise = function(rootpath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(data) { resolve(data) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(rootpath, _ok, _err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURLPromise = function(dirpath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapRemoveDirectoryRecurseURL(dirpath, _ok, _err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURLPromise = function(filepath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(flag) { resolve(flag) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapFileExistsURL(filepath,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURLPromise = function(filepath) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFileURL(filepath,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURLPromise = function(dirpath, matchRegex, keepList) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() {resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapDeleteFilesNotInListURL(dirpath, matchRegex, keepList, _ok, _err);',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURLPromise = function(srcpath, destdirpath, destname) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapCopyFileURL(srcpath,destdirpath,destname,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURLPromise = function(srcpath, destdirpath, destname) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function() { resolve() };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapMoveFileURL(srcpath,destdirpath,destname,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
'{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURLPromise = function(dirpath, matchRegex) {',
'\tvar promiseF = function(resolve,reject) {',
'\t\tvar _ok = function(filelist) { resolve(filelist) };',
'\t\tvar _err = function(e) { reject(e) };',
'\t\t{UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesURL(dirpath,matchRegex,_ok,_err)',
'\t}',
'\treturn new Promise(promiseF);',
'}',
';',
'/*!',
'    localForage -- Offline Storage, Improved',
'    Version 1.10.0',
'    https://localforage.github.io/localForage',
'    (c) 2013-2017 Mozilla, Apache License 2.0',
'*/',
'!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.localforage=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module \'"+g+"\'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(a){"use strict";function c(){k=!0;for(var a,b,c=l.length;c;){for(b=l,l=[],a=-1;++a<c;)b[a]();c=l.length}k=!1}function d(a){1!==l.push(a)||k||e()}var e,f=a.MutationObserver||a.WebKitMutationObserver;if(f){var g=0,h=new f(c),i=a.document.createTextNode("");h.observe(i,{characterData:!0}),e=function(){i.data=g=++g%2}}else if(a.setImmediate||void 0===a.MessageChannel)e="document"in a&&"onreadystatechange"in a.document.createElement("script")?function(){var b=a.document.createElement("script");b.onreadystatechange=function(){c(),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},a.document.documentElement.appendChild(b)}:function(){setTimeout(c,0)};else{var j=new a.MessageChannel;j.port1.onmessage=c,e=function(){j.port2.postMessage(0)}}var k,l=[];b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(a,b,c){"use strict";function d(){}function e(a){if("function"!=typeof a)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,a!==d&&i(this,a)}function f(a,b,c){this.promise=a,"function"==typeof b&&(this.onFulfilled=b,this.callFulfilled=this.otherCallFulfilled),"function"==typeof c&&(this.onRejected=c,this.callRejected=this.otherCallRejected)}function g(a,b,c){o(function(){var d;try{d=b(c)}catch(b){return p.reject(a,b)}d===a?p.reject(a,new TypeError("Cannot resolve promise with itself")):p.resolve(a,d)})}function h(a){var b=a&&a.then;if(a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof b)return function(){b.apply(a,arguments)}}function i(a,b){function c(b){f||(f=!0,p.reject(a,b))}function d(b){f||(f=!0,p.resolve(a,b))}function e(){b(d,c)}var f=!1,g=j(e);"error"===g.status&&c(g.value)}function j(a,b){var c={};try{c.value=a(b),c.status="success"}catch(a){c.status="error",c.value=a}return c}function k(a){return a instanceof this?a:p.resolve(new this(d),a)}function l(a){var b=new this(d);return p.reject(b,a)}function m(a){function b(a,b){function d(a){g[b]=a,++h!==e||f||(f=!0,p.resolve(j,g))}c.resolve(a).then(d,function(a){f||(f=!0,p.reject(j,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=new Array(e),h=0,i=-1,j=new this(d);++i<e;)b(a[i],i);return j}function n(a){function b(a){c.resolve(a).then(function(a){f||(f=!0,p.resolve(h,a))},function(a){f||(f=!0,p.reject(h,a))})}var c=this;if("[object Array]"!==Object.prototype.toString.call(a))return this.reject(new TypeError("must be an array"));var e=a.length,f=!1;if(!e)return this.resolve([]);for(var g=-1,h=new this(d);++g<e;)b(a[g]);return h}var o=a(1),p={},q=["REJECTED"],r=["FULFILLED"],s=["PENDING"];b.exports=e,e.prototype.catch=function(a){return this.then(null,a)},e.prototype.then=function(a,b){if("function"!=typeof a&&this.state===r||"function"!=typeof b&&this.state===q)return this;var c=new this.constructor(d);if(this.state!==s){g(c,this.state===r?a:b,this.outcome)}else this.queue.push(new f(c,a,b));return c},f.prototype.callFulfilled=function(a){p.resolve(this.promise,a)},f.prototype.otherCallFulfilled=function(a){g(this.promise,this.onFulfilled,a)},f.prototype.callRejected=function(a){p.reject(this.promise,a)},f.prototype.otherCallRejected=function(a){g(this.promise,this.onRejected,a)},p.resolve=function(a,b){var c=j(h,b);if("error"===c.status)return p.reject(a,c.value);var d=c.value;if(d)i(a,d);else{a.state=r,a.outcome=b;for(var e=-1,f=a.queue.length;++e<f;)a.queue[e].callFulfilled(b)}return a},p.reject=function(a,b){a.state=q,a.outcome=b;for(var c=-1,d=a.queue.length;++c<d;)a.queue[c].callRejected(b);return a},e.resolve=k,e.reject=l,e.all=m,e.race=n},{1:1}],3:[function(a,b,c){(function(b){"use strict";"function"!=typeof b.Promise&&(b.Promise=a(2))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(a){return}}function f(){try{if(!ua||!ua.open)return!1;var a="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),b="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!a||b)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(a){return!1}}function g(a,b){a=a||[],b=b||{};try{return new Blob(a,b)}catch(f){if("TypeError"!==f.name)throw f;for(var c="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,d=new c,e=0;e<a.length;e+=1)d.append(a[e]);return d.getBlob(b.type)}}function h(a,b){b&&a.then(function(a){b(null,a)},function(a){b(a)})}function i(a,b,c){"function"==typeof b&&a.then(b),"function"==typeof c&&a.catch(c)}function j(a){return"string"!=typeof a&&(console.warn(a+" used as a key, but it is not a string."),a=String(a)),a}function k(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}function l(a){for(var b=a.length,c=new ArrayBuffer(b),d=new Uint8Array(c),e=0;e<b;e++)d[e]=a.charCodeAt(e);return c}function m(a){return new va(function(b){var c=a.transaction(wa,Ba),d=g([""]);c.objectStore(wa).put(d,"key"),c.onabort=function(a){a.preventDefault(),a.stopPropagation(),b(!1)},c.oncomplete=function(){var a=navigator.userAgent.match(/Chrome\\/(\\d+)/),c=navigator.userAgent.match(/Edge\\//);b(c||!a||parseInt(a[1],10)>=43)}}).catch(function(){return!1})}function n(a){return"boolean"==typeof xa?va.resolve(xa):m(a).then(function(a){return xa=a})}function o(a){var b=ya[a.name],c={};c.promise=new va(function(a,b){c.resolve=a,c.reject=b}),b.deferredOperations.push(c),b.dbReady?b.dbReady=b.dbReady.then(function(){return c.promise}):b.dbReady=c.promise}function p(a){var b=ya[a.name],c=b.deferredOperations.pop();if(c)return c.resolve(),c.promise}function q(a,b){var c=ya[a.name],d=c.deferredOperations.pop();if(d)return d.reject(b),d.promise}function r(a,b){return new va(function(c,d){if(ya[a.name]=ya[a.name]||B(),a.db){if(!b)return c(a.db);o(a),a.db.close()}var e=[a.name];b&&e.push(a.version);var f=ua.open.apply(ua,e);b&&(f.onupgradeneeded=function(b){var c=f.result;try{c.createObjectStore(a.storeName),b.oldVersion<=1&&c.createObjectStore(wa)}catch(c){if("ConstraintError"!==c.name)throw c;console.warn(\'The database "\'+a.name+\'" has been upgraded from version \'+b.oldVersion+" to version "+b.newVersion+\', but the storage "\'+a.storeName+\'" already exists.\')}}),f.onerror=function(a){a.preventDefault(),d(f.error)},f.onsuccess=function(){var b=f.result;b.onversionchange=function(a){a.target.close()},c(b),p(a)}})}function s(a){return r(a,!1)}function t(a){return r(a,!0)}function u(a,b){if(!a.db)return!0;var c=!a.db.objectStoreNames.contains(a.storeName),d=a.version<a.db.version,e=a.version>a.db.version;if(d&&(a.version!==b&&console.warn(\'The database "\'+a.name+"\\" can\'t be downgraded from version "+a.db.version+" to version "+a.version+"."),a.version=a.db.version),e||c){if(c){var f=a.db.version+1;f>a.version&&(a.version=f)}return!0}return!1}function v(a){return new va(function(b,c){var d=new FileReader;d.onerror=c,d.onloadend=function(c){var d=btoa(c.target.result||"");b({__local_forage_encoded_blob:!0,data:d,type:a.type})},d.readAsBinaryString(a)})}function w(a){return g([l(atob(a.data))],{type:a.type})}function x(a){return a&&a.__local_forage_encoded_blob}function y(a){var b=this,c=b._initReady().then(function(){var a=ya[b._dbInfo.name];if(a&&a.dbReady)return a.dbReady});return i(c,a,a),c}function z(a){o(a);for(var b=ya[a.name],c=b.forages,d=0;d<c.length;d++){var e=c[d];e._dbInfo.db&&(e._dbInfo.db.close(),e._dbInfo.db=null)}return a.db=null,s(a).then(function(b){return a.db=b,u(a)?t(a):b}).then(function(d){a.db=b.db=d;for(var e=0;e<c.length;e++)c[e]._dbInfo.db=d}).catch(function(b){throw q(a,b),b})}function A(a,b,c,d){void 0===d&&(d=1);try{var e=a.db.transaction(a.storeName,b);c(null,e)}catch(e){if(d>0&&(!a.db||"InvalidStateError"===e.name||"NotFoundError"===e.name))return va.resolve().then(function(){if(!a.db||"NotFoundError"===e.name&&!a.db.objectStoreNames.contains(a.storeName)&&a.version<=a.db.version)return a.db&&(a.version=a.db.version+1),t(a)}).then(function(){return z(a).then(function(){A(a,b,c,d-1)})}).catch(c);c(e)}}function B(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function C(a){function b(){return va.resolve()}var c=this,d={db:null};if(a)for(var e in a)d[e]=a[e];var f=ya[d.name];f||(f=B(),ya[d.name]=f),f.forages.push(c),c._initReady||(c._initReady=c.ready,c.ready=y);for(var g=[],h=0;h<f.forages.length;h++){var i=f.forages[h];i!==c&&g.push(i._initReady().catch(b))}var j=f.forages.slice(0);return va.all(g).then(function(){return d.db=f.db,s(d)}).then(function(a){return d.db=a,u(d,c._defaultConfig.version)?t(d):a}).then(function(a){d.db=f.db=a,c._dbInfo=d;for(var b=0;b<j.length;b++){var e=j[b];e!==c&&(e._dbInfo.db=d.db,e._dbInfo.version=d.version)}})}function D(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.get(a);h.onsuccess=function(){var a=h.result;void 0===a&&(a=null),x(a)&&(a=w(a)),b(a)},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function E(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.openCursor(),i=1;h.onsuccess=function(){var c=h.result;if(c){var d=c.value;x(d)&&(d=w(d));var e=a(d,c.key,i++);void 0!==e?b(e):c.continue()}else b()},h.onerror=function(){d(h.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function F(a,b,c){var d=this;a=j(a);var e=new va(function(c,e){var f;d.ready().then(function(){return f=d._dbInfo,"[object Blob]"===za.call(b)?n(f.db).then(function(a){return a?b:v(b)}):b}).then(function(b){A(d._dbInfo,Ba,function(f,g){if(f)return e(f);try{var h=g.objectStore(d._dbInfo.storeName);null===b&&(b=void 0);var i=h.put(b,a);g.oncomplete=function(){void 0===b&&(b=null),c(b)},g.onabort=g.onerror=function(){var a=i.error?i.error:i.transaction.error;e(a)}}catch(a){e(a)}})}).catch(e)});return h(e,c),e}function G(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){A(c._dbInfo,Ba,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=g.delete(a);f.oncomplete=function(){b()},f.onerror=function(){d(h.error)},f.onabort=function(){var a=h.error?h.error:h.transaction.error;d(a)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function H(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Ba,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.clear();e.oncomplete=function(){a()},e.onabort=e.onerror=function(){var a=g.error?g.error:g.transaction.error;c(a)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function I(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.count();g.onsuccess=function(){a(g.result)},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function J(a,b){var c=this,d=new va(function(b,d){if(a<0)return void b(null);c.ready().then(function(){A(c._dbInfo,Aa,function(e,f){if(e)return d(e);try{var g=f.objectStore(c._dbInfo.storeName),h=!1,i=g.openKeyCursor();i.onsuccess=function(){var c=i.result;if(!c)return void b(null);0===a?b(c.key):h?b(c.key):(h=!0,c.advance(a))},i.onerror=function(){d(i.error)}}catch(a){d(a)}})}).catch(d)});return h(d,b),d}function K(a){var b=this,c=new va(function(a,c){b.ready().then(function(){A(b._dbInfo,Aa,function(d,e){if(d)return c(d);try{var f=e.objectStore(b._dbInfo.storeName),g=f.openKeyCursor(),h=[];g.onsuccess=function(){var b=g.result;if(!b)return void a(h);h.push(b.key),b.continue()},g.onerror=function(){c(g.error)}}catch(a){c(a)}})}).catch(c)});return h(c,a),c}function L(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;if(a.name){var f=a.name===c.name&&e._dbInfo.db,g=f?va.resolve(e._dbInfo.db):s(a).then(function(b){var c=ya[a.name],d=c.forages;c.db=b;for(var e=0;e<d.length;e++)d[e]._dbInfo.db=b;return b});d=a.storeName?g.then(function(b){if(b.objectStoreNames.contains(a.storeName)){var c=b.version+1;o(a);var d=ya[a.name],e=d.forages;b.close();for(var f=0;f<e.length;f++){var g=e[f];g._dbInfo.db=null,g._dbInfo.version=c}return new va(function(b,d){var e=ua.open(a.name,c);e.onerror=function(a){e.result.close(),d(a)},e.onupgradeneeded=function(){e.result.deleteObjectStore(a.storeName)},e.onsuccess=function(){var a=e.result;a.close(),b(a)}}).then(function(a){d.db=a;for(var b=0;b<e.length;b++){var c=e[b];c._dbInfo.db=a,p(c._dbInfo)}}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})}}):g.then(function(b){o(a);var c=ya[a.name],d=c.forages;b.close();for(var e=0;e<d.length;e++){d[e]._dbInfo.db=null}return new va(function(b,c){var d=ua.deleteDatabase(a.name);d.onerror=function(){var a=d.result;a&&a.close(),c(d.error)},d.onblocked=function(){console.warn(\'dropInstance blocked for database "\'+a.name+\'" until all open connections are closed\')},d.onsuccess=function(){var a=d.result;a&&a.close(),b(a)}}).then(function(a){c.db=a;for(var b=0;b<d.length;b++)p(d[b]._dbInfo)}).catch(function(b){throw(q(a,b)||va.resolve()).catch(function(){}),b})})}else d=va.reject("Invalid arguments");return h(d,b),d}function M(){return"function"==typeof openDatabase}function N(a){var b,c,d,e,f,g=.75*a.length,h=a.length,i=0;"="===a[a.length-1]&&(g--,"="===a[a.length-2]&&g--);var j=new ArrayBuffer(g),k=new Uint8Array(j);for(b=0;b<h;b+=4)c=Da.indexOf(a[b]),d=Da.indexOf(a[b+1]),e=Da.indexOf(a[b+2]),f=Da.indexOf(a[b+3]),k[i++]=c<<2|d>>4,k[i++]=(15&d)<<4|e>>2,k[i++]=(3&e)<<6|63&f;return j}function O(a){var b,c=new Uint8Array(a),d="";for(b=0;b<c.length;b+=3)d+=Da[c[b]>>2],d+=Da[(3&c[b])<<4|c[b+1]>>4],d+=Da[(15&c[b+1])<<2|c[b+2]>>6],d+=Da[63&c[b+2]];return c.length%3==2?d=d.substring(0,d.length-1)+"=":c.length%3==1&&(d=d.substring(0,d.length-2)+"=="),d}function P(a,b){var c="";if(a&&(c=Ua.call(a)),a&&("[object ArrayBuffer]"===c||a.buffer&&"[object ArrayBuffer]"===Ua.call(a.buffer))){var d,e=Ga;a instanceof ArrayBuffer?(d=a,e+=Ia):(d=a.buffer,"[object Int8Array]"===c?e+=Ka:"[object Uint8Array]"===c?e+=La:"[object Uint8ClampedArray]"===c?e+=Ma:"[object Int16Array]"===c?e+=Na:"[object Uint16Array]"===c?e+=Pa:"[object Int32Array]"===c?e+=Oa:"[object Uint32Array]"===c?e+=Qa:"[object Float32Array]"===c?e+=Ra:"[object Float64Array]"===c?e+=Sa:b(new Error("Failed to get type for BinaryArray"))),b(e+O(d))}else if("[object Blob]"===c){var f=new FileReader;f.onload=function(){var c=Ea+a.type+"~"+O(this.result);b(Ga+Ja+c)},f.readAsArrayBuffer(a)}else try{b(JSON.stringify(a))}catch(c){console.error("Couldn\'t convert value into a JSON string: ",a),b(null,c)}}function Q(a){if(a.substring(0,Ha)!==Ga)return JSON.parse(a);var b,c=a.substring(Ta),d=a.substring(Ha,Ta);if(d===Ja&&Fa.test(c)){var e=c.match(Fa);b=e[1],c=c.substring(e[0].length)}var f=N(c);switch(d){case Ia:return f;case Ja:return g([f],{type:b});case Ka:return new Int8Array(f);case La:return new Uint8Array(f);case Ma:return new Uint8ClampedArray(f);case Na:return new Int16Array(f);case Pa:return new Uint16Array(f);case Oa:return new Int32Array(f);case Qa:return new Uint32Array(f);case Ra:return new Float32Array(f);case Sa:return new Float64Array(f);default:throw new Error("Unkown type: "+d)}}function R(a,b,c,d){a.executeSql("CREATE TABLE IF NOT EXISTS "+b.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],c,d)}function S(a){var b=this,c={db:null};if(a)for(var d in a)c[d]="string"!=typeof a[d]?a[d].toString():a[d];var e=new va(function(a,d){try{c.db=openDatabase(c.name,String(c.version),c.description,c.size)}catch(a){return d(a)}c.db.transaction(function(e){R(e,c,function(){b._dbInfo=c,a()},function(a,b){d(b)})},d)});return c.serializer=Va,e}function T(a,b,c,d,e,f){a.executeSql(c,d,e,function(a,g){g.code===g.SYNTAX_ERR?a.executeSql("SELECT name FROM sqlite_master WHERE type=\'table\' AND name = ?",[b.storeName],function(a,h){h.rows.length?f(a,g):R(a,b,function(){a.executeSql(c,d,e,f)},f)},f):f(a,g)},f)}function U(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName+" WHERE key = ? LIMIT 1",[a],function(a,c){var d=c.rows.length?c.rows.item(0).value:null;d&&(d=e.serializer.deserialize(d)),b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function V(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT * FROM "+e.storeName,[],function(c,d){for(var f=d.rows,g=f.length,h=0;h<g;h++){var i=f.item(h),j=i.value;if(j&&(j=e.serializer.deserialize(j)),void 0!==(j=a(j,i.key,h+1)))return void b(j)}b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function W(a,b,c,d){var e=this;a=j(a);var f=new va(function(f,g){e.ready().then(function(){void 0===b&&(b=null);var h=b,i=e._dbInfo;i.serializer.serialize(b,function(b,j){j?g(j):i.db.transaction(function(c){T(c,i,"INSERT OR REPLACE INTO "+i.storeName+" (key, value) VALUES (?, ?)",[a,b],function(){f(h)},function(a,b){g(b)})},function(b){if(b.code===b.QUOTA_ERR){if(d>0)return void f(W.apply(e,[a,h,c,d-1]));g(b)}})})}).catch(g)});return h(f,c),f}function X(a,b,c){return W.apply(this,[a,b,c,1])}function Y(a,b){var c=this;a=j(a);var d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"DELETE FROM "+e.storeName+" WHERE key = ?",[a],function(){b()},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function Z(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"DELETE FROM "+d.storeName,[],function(){a()},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function $(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT COUNT(key) as c FROM "+d.storeName,[],function(b,c){var d=c.rows.item(0).c;a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function _(a,b){var c=this,d=new va(function(b,d){c.ready().then(function(){var e=c._dbInfo;e.db.transaction(function(c){T(c,e,"SELECT key FROM "+e.storeName+" WHERE id = ? LIMIT 1",[a+1],function(a,c){var d=c.rows.length?c.rows.item(0).key:null;b(d)},function(a,b){d(b)})})}).catch(d)});return h(d,b),d}function aa(a){var b=this,c=new va(function(a,c){b.ready().then(function(){var d=b._dbInfo;d.db.transaction(function(b){T(b,d,"SELECT key FROM "+d.storeName,[],function(b,c){for(var d=[],e=0;e<c.rows.length;e++)d.push(c.rows.item(e).key);a(d)},function(a,b){c(b)})})}).catch(c)});return h(c,a),c}function ba(a){return new va(function(b,c){a.transaction(function(d){d.executeSql("SELECT name FROM sqlite_master WHERE type=\'table\' AND name <> \'__WebKitDatabaseInfoTable__\'",[],function(c,d){for(var e=[],f=0;f<d.rows.length;f++)e.push(d.rows.item(f).name);b({db:a,storeNames:e})},function(a,b){c(b)})},function(a){c(a)})})}function ca(a,b){b=k.apply(this,arguments);var c=this.config();a="function"!=typeof a&&a||{},a.name||(a.name=a.name||c.name,a.storeName=a.storeName||c.storeName);var d,e=this;return d=a.name?new va(function(b){var d;d=a.name===c.name?e._dbInfo.db:openDatabase(a.name,"","",0),b(a.storeName?{db:d,storeNames:[a.storeName]}:ba(d))}).then(function(a){return new va(function(b,c){a.db.transaction(function(d){function e(a){return new va(function(b,c){d.executeSql("DROP TABLE IF EXISTS "+a,[],function(){b()},function(a,b){c(b)})})}for(var f=[],g=0,h=a.storeNames.length;g<h;g++)f.push(e(a.storeNames[g]));va.all(f).then(function(){b()}).catch(function(a){c(a)})},function(a){c(a)})})}):va.reject("Invalid arguments"),h(d,b),d}function da(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(a){return!1}}function ea(a,b){var c=a.name+"/";return a.storeName!==b.storeName&&(c+=a.storeName+"/"),c}function fa(){var a="_localforage_support_test";try{return localStorage.setItem(a,!0),localStorage.removeItem(a),!1}catch(a){return!0}}function ga(){return!fa()||localStorage.length>0}function ha(a){var b=this,c={};if(a)for(var d in a)c[d]=a[d];return c.keyPrefix=ea(a,b._defaultConfig),ga()?(b._dbInfo=c,c.serializer=Va,va.resolve()):va.reject()}function ia(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo.keyPrefix,c=localStorage.length-1;c>=0;c--){var d=localStorage.key(c);0===d.indexOf(a)&&localStorage.removeItem(d)}});return h(c,a),c}function ja(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo,d=localStorage.getItem(b.keyPrefix+a);return d&&(d=b.serializer.deserialize(d)),d});return h(d,b),d}function ka(a,b){var c=this,d=c.ready().then(function(){for(var b=c._dbInfo,d=b.keyPrefix,e=d.length,f=localStorage.length,g=1,h=0;h<f;h++){var i=localStorage.key(h);if(0===i.indexOf(d)){var j=localStorage.getItem(i);if(j&&(j=b.serializer.deserialize(j)),void 0!==(j=a(j,i.substring(e),g++)))return j}}});return h(d,b),d}function la(a,b){var c=this,d=c.ready().then(function(){var b,d=c._dbInfo;try{b=localStorage.key(a)}catch(a){b=null}return b&&(b=b.substring(d.keyPrefix.length)),b});return h(d,b),d}function ma(a){var b=this,c=b.ready().then(function(){for(var a=b._dbInfo,c=localStorage.length,d=[],e=0;e<c;e++){var f=localStorage.key(e);0===f.indexOf(a.keyPrefix)&&d.push(f.substring(a.keyPrefix.length))}return d});return h(c,a),c}function na(a){var b=this,c=b.keys().then(function(a){return a.length});return h(c,a),c}function oa(a,b){var c=this;a=j(a);var d=c.ready().then(function(){var b=c._dbInfo;localStorage.removeItem(b.keyPrefix+a)});return h(d,b),d}function pa(a,b,c){var d=this;a=j(a);var e=d.ready().then(function(){void 0===b&&(b=null);var c=b;return new va(function(e,f){var g=d._dbInfo;g.serializer.serialize(b,function(b,d){if(d)f(d);else try{localStorage.setItem(g.keyPrefix+a,b),e(c)}catch(a){"QuotaExceededError"!==a.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==a.name||f(a),f(a)}})})});return h(e,c),e}function qa(a,b){if(b=k.apply(this,arguments),a="function"!=typeof a&&a||{},!a.name){var c=this.config();a.name=a.name||c.name,a.storeName=a.storeName||c.storeName}var d,e=this;return d=a.name?new va(function(b){b(a.storeName?ea(a,e._defaultConfig):a.name+"/")}).then(function(a){for(var b=localStorage.length-1;b>=0;b--){var c=localStorage.key(b);0===c.indexOf(a)&&localStorage.removeItem(c)}}):va.reject("Invalid arguments"),h(d,b),d}function ra(a,b){a[b]=function(){var c=arguments;return a.ready().then(function(){return a[b].apply(a,c)})}}function sa(){for(var a=1;a<arguments.length;a++){var b=arguments[a];if(b)for(var c in b)b.hasOwnProperty(c)&&($a(b[c])?arguments[0][c]=b[c].slice():arguments[0][c]=b[c])}return arguments[0]}var ta="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},ua=e();"undefined"==typeof Promise&&a(3);var va=Promise,wa="local-forage-detect-blob-support",xa=void 0,ya={},za=Object.prototype.toString,Aa="readonly",Ba="readwrite",Ca={_driver:"asyncStorage",_initStorage:C,_support:f(),iterate:E,getItem:D,setItem:F,removeItem:G,clear:H,length:I,key:J,keys:K,dropInstance:L},Da="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ea="~~local_forage_type~",Fa=/^~~local_forage_type~([^~]+)~/,Ga="__lfsc__:",Ha=Ga.length,Ia="arbf",Ja="blob",Ka="si08",La="ui08",Ma="uic8",Na="si16",Oa="si32",Pa="ur16",Qa="ui32",Ra="fl32",Sa="fl64",Ta=Ha+Ia.length,Ua=Object.prototype.toString,Va={serialize:P,deserialize:Q,stringToBuffer:N,bufferToString:O},Wa={_driver:"webSQLStorage",_initStorage:S,_support:M(),iterate:V,getItem:U,setItem:X,removeItem:Y,clear:Z,length:$,key:_,keys:aa,dropInstance:ca},Xa={_driver:"localStorageWrapper",_initStorage:ha,_support:da(),iterate:ka,getItem:ja,setItem:pa,removeItem:oa,clear:ia,length:na,key:la,keys:ma,dropInstance:qa},Ya=function(a,b){return a===b||"number"==typeof a&&"number"==typeof b&&isNaN(a)&&isNaN(b)},Za=function(a,b){for(var c=a.length,d=0;d<c;){if(Ya(a[d],b))return!0;d++}return!1},$a=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},_a={},ab={},bb={INDEXEDDB:Ca,WEBSQL:Wa,LOCALSTORAGE:Xa},cb=[bb.INDEXEDDB._driver,bb.WEBSQL._driver,bb.LOCALSTORAGE._driver],db=["dropInstance"],eb=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(db),fb={description:"",driver:cb.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},gb=function(){function a(b){d(this,a);for(var c in bb)if(bb.hasOwnProperty(c)){var e=bb[c],f=e._driver;this[c]=f,_a[f]||this.defineDriver(e)}this._defaultConfig=sa({},fb),this._config=sa({},this._defaultConfig,b),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return a.prototype.config=function(a){if("object"===(void 0===a?"undefined":ta(a))){if(this._ready)return new Error("Can\'t call config() after localforage has been used.");for(var b in a){if("storeName"===b&&(a[b]=a[b].replace(/\\W/g,"_")),"version"===b&&"number"!=typeof a[b])return new Error("Database version must be a number.");this._config[b]=a[b]}return!("driver"in a&&a.driver)||this.setDriver(this._config.driver)}return"string"==typeof a?this._config[a]:this._config},a.prototype.defineDriver=function(a,b,c){var d=new va(function(b,c){try{var d=a._driver,e=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!a._driver)return void c(e);for(var f=eb.concat("_initStorage"),g=0,i=f.length;g<i;g++){var j=f[g];if((!Za(db,j)||a[j])&&"function"!=typeof a[j])return void c(e)}(function(){for(var b=function(a){return function(){var b=new Error("Method "+a+" is not implemented by the current driver"),c=va.reject(b);return h(c,arguments[arguments.length-1]),c}},c=0,d=db.length;c<d;c++){var e=db[c];a[e]||(a[e]=b(e))}})();var k=function(c){_a[d]&&console.info("Redefining LocalForage driver: "+d),_a[d]=a,ab[d]=c,b()};"_support"in a?a._support&&"function"==typeof a._support?a._support().then(k,c):k(!!a._support):k(!0)}catch(a){c(a)}});return i(d,b,c),d},a.prototype.driver=function(){return this._driver||null},a.prototype.getDriver=function(a,b,c){var d=_a[a]?va.resolve(_a[a]):va.reject(new Error("Driver not found."));return i(d,b,c),d},a.prototype.getSerializer=function(a){var b=va.resolve(Va);return i(b,a),b},a.prototype.ready=function(a){var b=this,c=b._driverSet.then(function(){return null===b._ready&&(b._ready=b._initDriver()),b._ready});return i(c,a,a),c},a.prototype.setDriver=function(a,b,c){function d(){g._config.driver=g.driver()}function e(a){return g._extend(a),d(),g._ready=g._initStorage(g._config),g._ready}function f(a){return function(){function b(){for(;c<a.length;){var f=a[c];return c++,g._dbInfo=null,g._ready=null,g.getDriver(f).then(e).catch(b)}d();var h=new Error("No available storage method found.");return g._driverSet=va.reject(h),g._driverSet}var c=0;return b()}}var g=this;$a(a)||(a=[a]);var h=this._getSupportedDrivers(a),j=null!==this._driverSet?this._driverSet.catch(function(){return va.resolve()}):va.resolve();return this._driverSet=j.then(function(){var a=h[0];return g._dbInfo=null,g._ready=null,g.getDriver(a).then(function(a){g._driver=a._driver,d(),g._wrapLibraryMethodsWithReady(),g._initDriver=f(h)})}).catch(function(){d();var a=new Error("No available storage method found.");return g._driverSet=va.reject(a),g._driverSet}),i(this._driverSet,b,c),this._driverSet},a.prototype.supports=function(a){return!!ab[a]},a.prototype._extend=function(a){sa(this,a)},a.prototype._getSupportedDrivers=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c];this.supports(e)&&b.push(e)}return b},a.prototype._wrapLibraryMethodsWithReady=function(){for(var a=0,b=eb.length;a<b;a++)ra(this,eb[a])},a.prototype.createInstance=function(b){return new a(b)},a}(),hb=new gb;b.exports=hb},{3:3}]},{},[4])(4)});',
';',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph          = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG      = RGraph.SVG || {};',
'    RGraph.SVG.AJAX = RGraph.SVG.AJAX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    /**',
'    * Makes an AJAX call. It calls the given callback (a function) when ready',
'    * ',
'    * @param string   url      The URL to retrieve',
'    * @param function callback A function that is called when the response is ready, there\'s an example below',
'    *                          called "myCallback".',
'    */',
'    RG.SVG.AJAX = function (url, callback)',
'    {',
'        // Mozilla, Safari, ...',
'        if (window.XMLHttpRequest) {',
'            var httpRequest = new XMLHttpRequest();',
'        // MSIE',
'        } else if (window.ActiveXObject) {',
'            var httpRequest = new ActiveXObject("Microsoft.XMLHTTP");',
'        }',
'        httpRequest.onreadystatechange = function ()',
'        {',
'            if (this.readyState == 4 && this.status == 200) {',
'                this.__user_callback__ = callback;',
'                this.__user_callback__(this.responseText);',
'            }',
'        }',
'        httpRequest.open(\'GET\', url, true);',
'        httpRequest.send();',
'    };',
'    /**',
'    * Makes an AJAX POST request. It calls the given callback (a function) when ready',
'    * ',
'    * @param string   url      The URL to retrieve',
'    * @param object   data     The POST data',
'    * @param function callback A function that is called when the response is ready, there\'s an example below',
'    *                          called "myCallback".',
'    */',
'    RG.SVG.AJAX.POST = function (url, data, callback)',
'    {',
'        // Used when building the POST string',
'        var crumbs = [];',
'        // Mozilla, Safari, ...',
'        if (window.XMLHttpRequest) {',
'            var httpRequest = new XMLHttpRequest();',
'        // MSIE',
'        } else if (window.ActiveXObject) {',
'            var httpRequest = new ActiveXObject("Microsoft.XMLHTTP");',
'        }',
'        httpRequest.onreadystatechange = function ()',
'        {',
'            if (this.readyState == 4 && this.status == 200) {',
'                this.__user_callback__ = callback;',
'                this.__user_callback__(this.responseText);',
'            }',
'        }',
'        httpRequest.open(\'POST\', url, true);',
'        httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded");',
'        for (i in data) {',
'            if (typeof i == \'string\') {',
'                crumbs.push(i + \'=\' + encodeURIComponent(data[i]));',
'            }',
'        }',
'        httpRequest.send(crumbs.join(\'&\'));',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing a number as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the number as an argument)',
'    */',
'    RG.SVG.AJAX.getNumber = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var num = parseFloat(this.responseText);',
'            callback(num);',
'        });',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing a string as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the string as an argument)',
'    */',
'    RG.SVG.AJAX.getString = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var str = String(this.responseText);',
'            callback(str);',
'        });',
'    };',
'    /**',
'    * Uses the above function but calls the call back passing JSON (ie a JavaScript object ) as its argument',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the JSON object as an argument)',
'    */',
'    RG.SVG.AJAX.getJSON = function (url, callback)',
'    {',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var json = eval(\'(\' + this.responseText + \')\');',
'            callback(json);',
'        });',
'    };',
'    /**',
'    * Uses the above RGraph.AJAX function but calls the call back passing an array as its argument.',
'    * Useful if you\'re retrieving CSV data',
'    * ',
'    * @param url string The URL to fetch',
'    * @param callback function Your callback function (which is passed the CSV/array as an argument)',
'    */',
'    RG.SVG.AJAX.getCSV = function (url, callback)',
'    {',
'        var seperator = (typeof arguments[2] === \'string\'  ? arguments[2] : \',\'),',
'            lineSep   = (typeof arguments[3] === \'string\' ? arguments[3] : "\\r?\\n");',
'        RG.SVG.AJAX(url, function ()',
'        {',
'            var text   = this.responseText,',
'                regexp = new RegExp(seperator),',
'                lines  = this.responseText.split(lineSep),',
'                rows   = [];',
'            for (var i=0; i<lines.length; ++i) {',
'                var row = lines[i].split(seperator);',
'                for (var j=0,len=row.length;j<len;++j) {',
'                    if (row[j].match(/^[0-9.]+$/)) {',
'                        row[j] = parseFloat(row[j]);',
'                    }',
'                }',
'                rows.push(row);',
'            }',
'            callback(rows);',
'        });',
'    };',
'// End module pattern',
'})(window, document);;',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph        = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG    = RGraph.SVG    || {};',
'    RGraph.SVG.FX = RGraph.SVG.FX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    RG.SVG.REG = {',
'        store: []',
'    };',
'    // ObjectRegistry',
'    RG.SVG.OR = {objects: []};',
'    // Used to categorise trigonometery functions',
'    RG.SVG.TRIG        = {};',
'    RG.SVG.TRIG.HALFPI = ma.PI * .4999;',
'    RG.SVG.TRIG.PI     = RG.SVG.TRIG.HALFPI * 2;',
'    RG.SVG.TRIG.TWOPI  = RG.SVG.TRIG.PI * 2;',
'    RG.SVG.ISIE = ua.indexOf(\'rident\') > 0;',
'    RG.SVG.ISFF = ua.indexOf(\'irefox\') > 0;',
'    RG.SVG.events = [];',
'    // This allows you to set globalconfiguration values that are copied to',
'    // all objects automatically.',
'    RG.SVG.GLOBALS = {};',
'    RG.SVG.ISFF     = ua.indexOf(\'Firefox\') != -1;',
'    RG.SVG.ISOPERA  = ua.indexOf(\'Opera\') != -1;',
'    RG.SVG.ISCHROME = ua.indexOf(\'Chrome\') != -1;',
'    RG.SVG.ISSAFARI = ua.indexOf(\'Safari\') != -1 && !RG.ISCHROME;',
'    RG.SVG.ISWEBKIT = ua.indexOf(\'WebKit\') != -1;',
'    RG.SVG.ISIE     = ua.indexOf(\'Trident\') > 0 || navigator.userAgent.indexOf(\'MSIE\') > 0;',
'    RG.SVG.ISIE6    = ua.indexOf(\'MSIE 6\') > 0;',
'    RG.SVG.ISIE7    = ua.indexOf(\'MSIE 7\') > 0;',
'    RG.SVG.ISIE8    = ua.indexOf(\'MSIE 8\') > 0;',
'    RG.SVG.ISIE9    = ua.indexOf(\'MSIE 9\') > 0;',
'    RG.SVG.ISIE10   = ua.indexOf(\'MSIE 10\') > 0;',
'    RG.SVG.ISIE11UP = ua.indexOf(\'MSIE\') == -1 && ua.indexOf(\'Trident\') > 0;',
'    RG.SVG.ISIE10UP = RG.SVG.ISIE10 || RG.SVG.ISIE11UP;',
'    RG.SVG.ISIE9UP  = RG.SVG.ISIE9 || RG.SVG.ISIE10UP;',
'    //',
'    // Create an SVG tag',
'    //',
'    RG.SVG.createSVG = function (opt)',
'    {',
'        var container = opt.container,',
'            obj       = opt.object;',
'        if (container.__svg__) {',
'            return container.__svg__;',
'        }',
'        var svg = doc.createElementNS("http://www.w3.org/2000/svg", "svg");',
'            svg.setAttribute(\'style\', \'top: 0; left: 0; position: absolute\');',
'            svg.setAttribute(\'width\', container.offsetWidth);',
'            svg.setAttribute(\'height\', container.offsetHeight);',
'            svg.setAttribute(\'version\', \'1.1\');',
'            svg.setAttributeNS("http://www.w3.org/2000/xmlns/", \'xmlns\', \'http://www.w3.org/2000/svg\');',
'            svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");',
'        container.appendChild(svg);',
'        container.__svg__ = svg;',
'        var style = getComputedStyle(container);',
'        if (style.position !== \'absolute\' && style.position !== \'fixed\' && style.position !== \'sticky\') {',
'            container.style.position = \'relative\';',
'        }',
'        // Add the groups that facilitate "background layers"',
'        var numLayers = 10;',
'        for (var i=1; i<=numLayers; ++i) {',
'            var group = RG.SVG.create({',
'                svg: svg,',
'                type: \'g\',',
'                attr: {',
'                    className: \'background\' + i',
'                }',
'            });',
'            // Store a reference to the group',
'            obj.layers[\'background\' + i] = group;',
'            svg[\'background\' + i]        = group;',
'        }',
'        // Add the group tag to the SVG that contains all of the elements',
'        var group = RG.SVG.create({',
'            svg: svg,',
'            type: \'g\',',
'            attr: {',
'                className: \'all-elements\'',
'            }',
'        });',
'        container.__svg__.all = group;',
'        return svg;',
'    };',
'    //',
'    // Create a defs tag inside the SVG',
'    //',
'    RG.SVG.createDefs = function (obj)',
'    {',
'        if (!obj.svg.defs) {',
'            var defs = RG.SVG.create({',
'                svg: obj.svg,',
'                type: \'defs\'',
'            });',
'            obj.svg.defs = defs;',
'        }',
'        return defs;',
'    };',
'    //',
'    // Creates a tag depending on the args that you give',
'    //',
'    //@param opt object The options for the function',
'    //',
'    RG.SVG.create = function (opt)',
'    {',
'        var ns  = "http://www.w3.org/2000/svg",',
'            tag = doc.createElementNS(ns, opt.type);',
'        // Add the attributes',
'        for (var o in opt.attr) {',
'            if (typeof o === \'string\') {',
'                var name = o;',
'                if (o === \'className\') {',
'                    name = \'class\';',
'                }',
'                if ( (opt.type === \'a\' || opt.type === \'image\') && o === \'xlink:href\') {',
'                    tag.setAttributeNS(\'http://www.w3.org/1999/xlink\', o, String(opt.attr[o]));',
'                } else {',
'                    tag.setAttribute(name, String(opt.attr[o]));',
'                }',
'            }',
'        }',
'        // Add the style',
'        for (var o in opt.style) {',
'            if (typeof o === \'string\') {',
'                tag.style[o] = String(opt.style[o]);',
'            }',
'        }',
'        if (opt.parent) {',
'            opt.parent.appendChild(tag);',
'        } else {',
'            opt.svg.appendChild(tag);',
'        }',
'        return tag;',
'    };',
'    //',
'    // Function that adds up all of the offsetLeft and offsetTops to get',
'    // X/Y coords for the mouse',
'    //',
'    //@param object e The event object',
'    //@return array   The X/Y coordinate pair representing the mouse',
'    //                location in relation to the SVG tag.',
'    //',
'    RG.SVG.getMouseXY = function(e)',
'    {',
'        // This is necessary for IE9',
'        if (!e.target) {',
'            return;',
'        }',
'        var el = e.target, offsetX = 0, offsetY = 0, x, y;',
'        if (typeof el.offsetParent !== \'undefined\') { ',
'            do {',
'                offsetX += el.offsetLeft;',
'                offsetY += el.offsetTop;',
'            } while ((el = el.offsetParent));',
'        }',
'        x = e.pageX;',
'        y = e.pageY;',
'        x -= (2 * (parseInt(document.body.style.borderLeftWidth) || 0));',
'        y -= (2 * (parseInt(document.body.style.borderTopWidth) || 0));',
'        // We return a javascript array with x and y defined',
'        return [x, y];',
'    };',
'    //',
'    // Draws an X axis',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawXAxis = function (obj)',
'    {',
'        var prop = obj.properties;',
'        // Draw the axis',
'        if (prop.xaxis) {',
'            var y = obj.type === \'hbar\' ? obj.height - prop.gutterBottom : obj.getYCoord(obj.scale.min < 0 && obj.scale.max < 0 ? obj.scale.max : (obj.scale.min > 0 && obj.scale.max > 0 ? obj.scale.min : 0));',
'            var axis = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    d: \'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft,',
'                        y,',
'                        obj.width - prop.gutterRight,',
'                        y',
'                    ),',
'                    fill: prop.xaxisColor,',
'                    stroke: prop.xaxisColor,',
'                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                    \'shape-rendering\': \'crispEdges\',',
'                    \'stroke-linecap\': \'square\'',
'                }',
'            });',
'            // HBar X axis',
'            if (obj.type === \'hbar\') {',
'                var width  = obj.graphWidth / obj.data.length,',
'                    x      = prop.gutterLeft,',
'                    startY = (obj.height - prop.gutterBottom),',
'                    endY   = (obj.height - prop.gutterBottom) + prop.xaxisTickmarksLength;',
'            // Line/Bar/Waterfall/Scatter X axis',
'            } else {',
'                var width  = obj.graphWidth / obj.data.length,',
'                    x      = prop.gutterLeft,',
'                    startY = obj.getYCoord(0) - (prop.yaxisMin < 0 ? prop.xaxisTickmarksLength : 0),',
'                    endY   = obj.getYCoord(0) + prop.xaxisTickmarksLength;',
'                if (obj.scale.min < 0 && obj.scale.max <= 0) {',
'                    startY = prop.gutterTop;',
'                    endY   = prop.gutterTop - prop.xaxisTickmarksLength;',
'                }',
'                if (obj.scale.min > 0 && obj.scale.max > 0) {',
'                    startY = obj.getYCoord(obj.scale.min);',
'                    endY   = obj.getYCoord(obj.scale.min) + prop.xaxisTickmarksLength;',
'                }',
'            }',
'            // Draw the tickmarks',
'            if (prop.xaxisTickmarks) {',
'                // The HBar uses a scale',
'                if (prop.xaxisScale) {',
'                    for (var i=0; i<(typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\' ? prop.xaxisLabelsPositionEdgeTickmarksCount : (obj.scale.numlabels + (prop.yaxis && prop.xaxisMin === 0 ? 0 : 1))); ++i) {',
'                        if (obj.type === \'hbar\') {',
'                            var dataPoints = obj.data.length;',
'                        }',
'                        x = prop.gutterLeft + ((i+(prop.yaxis && prop.xaxisMin === 0 ? 1 : 0)) * (obj.graphWidth / obj.scale.numlabels));',
'                        // Allow Manual specification of number of tickmarks',
'                        if (typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                            dataPoints = prop.xaxisLabelsPositionEdgeTickmarksCount;',
'                            var gap    = (obj.graphWidth / prop.xaxisLabelsPositionEdgeTickmarksCount);',
'                            x          = (gap * i) + prop.gutterLeft + gap;',
'                        }',
'                        RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    x,',
'                                    startY,',
'                                    x,',
'                                    endY',
'                                ),',
'                                stroke: prop.xaxisColor,',
'                                \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                } else {',
'                    // This style is used by Bar and Scatter charts',
'                    if (prop.xaxisLabelsPosition === \'section\') {',
'                        if (obj.type === \'bar\' || obj.type === \'waterfall\') {',
'                            var dataPoints = obj.data.length;',
'                        } else if (obj.type === \'line\'){',
'                            var dataPoints = obj.data[0].length;',
'                        } else if (obj.type === \'scatter\') {',
'                            var dataPoints = prop.xaxisLabels ? prop.xaxisLabels.length : 10;',
'                        }',
'                        // Allow Manual specification of number of tickmarks',
'                        if (typeof prop.xaxisLabelsPositionSectionTickmarksCount === \'number\') {',
'                            dataPoints = prop.xaxisLabelsPositionSectionTickmarksCount;',
'                        }',
'                        for (var i=0; i<dataPoints; ++i) {',
'                            x = prop.gutterLeft + ((i+1) * (obj.graphWidth / dataPoints));',
'                            RG.SVG.create({',
'                                svg: obj.svg,',
'                                parent: obj.svg.all,',
'                                type: \'path\',',
'                                attr: {',
'                                    d: \'M{1} {2} L{3} {4}\'.format(',
'                                        x + 0.001,',
'                                        startY,',
'                                        x,',
'                                        endY',
'                                    ),',
'                                    stroke: prop.xaxisColor,',
'                                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                    \'shape-rendering\': "crispEdges"',
'                                }',
'                            });',
'                        }',
'                    // This style is used by line charts',
'                    } else if (prop.xaxisLabelsPosition === \'edge\') {',
'                        if (typeof prop.xaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                            var len = prop.xaxisLabelsPositionEdgeTickmarksCount;',
'                        } else {',
'                            var len = obj.data && obj.data[0] && obj.data[0].length ? obj.data[0].length : 0;',
'                        }',
'                        for (var i=0; i<len; ++i) {',
'                            var gap = ( (obj.graphWidth) / (len - 1)),',
'                                x   = prop.gutterLeft + ((i+1) * gap);',
'                            RG.SVG.create({',
'                                svg: obj.svg,',
'                                parent: obj.svg.all,',
'                                type: \'path\',',
'                                attr: {',
'                                    d: \'M{1} {2} L{3} {4}\'.format(',
'                                        x + 0.001,',
'                                        startY,',
'                                        x,',
'                                        endY',
'                                    ),',
'                                    stroke: prop.xaxisColor,',
'                                    \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                                    \'shape-rendering\': "crispEdges"',
'                                }',
'                            });',
'                        }',
'                    }',
'                }',
'                // Draw an extra tick if the Y axis is not being shown',
'                if (prop.yaxis === false) {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        parent: obj.svg.all,',
'                        type: \'path\',',
'                        attr: {',
'                            d: \'M{1} {2} L{3} {4}\'.format(',
'                                prop.gutterLeft + 0.001,',
'                                startY,',
'                                prop.gutterLeft,',
'                                endY',
'                            ),',
'                            stroke: obj.properties.xaxisColor,',
'                            \'stroke-width\': typeof prop.xaxisLinewidth === \'number\' ? prop.xaxisLinewidth : 1,',
'                            \'shape-rendering\': "crispEdges",',
'                            parent: obj.svg.all,',
'                        }',
'                    });',
'                }',
'            }',
'        }',
'        //',
'        // Draw an X axis scale',
'        //',
'        if (prop.xaxisScale) {',
'            if (obj.type === \'scatter\') {',
'                obj.xscale = RG.SVG.getScale({',
'                    object:    obj,',
'                    numlabels: prop.xaxisLabelsCount,',
'                    unitsPre:  prop.xaxisUnitsPre,',
'                    unitsPost: prop.xaxisUnitsPost,',
'                    max:       prop.xaxisMax,',
'                    min:       prop.xaxisMin,',
'                    point:     prop.xaxisPoint,',
'                    round:     prop.xaxisRound,',
'                    thousand:  prop.xaxisThousand,',
'                    decimals:  prop.xaxisDecimals,',
'                    strict:    typeof prop.xaxisMax === \'number\',',
'                    formatter: prop.xaxisFormatter',
'                });',
'                var segment = obj.graphWidth / prop.xaxisLabelsCount',
'                for (var i=0; i<obj.xscale.labels.length; ++i) {',
'                    var x = prop.gutterLeft + (segment * i) + segment + prop.xaxisLabelsOffsetx;',
'                    var y = (obj.height - prop.gutterBottom) + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                    RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text:   obj.xscale.labels[i],',
'                        x:      x,',
'                        y:      y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'                // Add the minimum label if labels are enabled',
'                if (prop.xaxisLabelsCount > 0) {',
'                    var y   = obj.height - prop.gutterBottom + prop.xaxisLabelsOffsety + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10),',
'                        str = RG.SVG.numberFormat({',
'                            object:     obj,',
'                            num:        prop.xaxisMin.toFixed(prop.xaxisDecimals),',
'                            prepend:    prop.xaxisUnitsPre,',
'                            append:     prop.xaxisUnitsPost,',
'                            point:      prop.xaxisPoint,',
'                            thousand:   prop.xaxisThousand,',
'                            formatter:  prop.xaxisFormatter',
'                        });',
'                    var text = RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text: typeof prop.xaxisFormatter === \'function\' ? (prop.xaxisFormatter)(this, prop.xaxisMin) : str,',
'                        x: prop.gutterLeft + prop.xaxisLabelsOffsetx,',
'                        y: y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'            // =========================================================================',
'            } else {',
'                var segment = obj.graphWidth / prop.xaxisLabelsCount,',
'                    scale   = obj.scale;',
'                for (var i=0; i<scale.labels.length; ++i) {',
'                    var x = prop.gutterLeft + (segment * i) + segment + prop.xaxisLabelsOffsetx;',
'                    var y = (obj.height - prop.gutterBottom) + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                    RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text:   obj.scale.labels[i],',
'                        x:      x,',
'                        y:      y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'                // Add the minimum label if labels are enabled',
'                if (prop.xaxisLabelsCount > 0) {',
'                    var y   = obj.height - prop.gutterBottom + prop.xaxisLabelsOffsety + (prop.xaxis ? prop.xaxisTickmarksLength + 6 : 10),',
'                        str = RG.SVG.numberFormat({',
'                            object:     obj,',
'                            num:        prop.xaxisMin.toFixed(prop.xaxisDecimals),',
'                            prepend:    prop.xaxisUnitsPre,',
'                            append:     prop.xaxisUnitsPost,',
'                            point:      prop.xaxisPoint,',
'                            thousand:   prop.xaxisThousand,',
'                            formatter:  prop.xaxisFormatter',
'                        });',
'                    var text = RG.SVG.text({',
'                        object: obj,',
'                        parent: obj.svg.all,',
'                        text: typeof prop.xaxisFormatter === \'function\' ? (prop.xaxisFormatter)(this, prop.xaxisMin) : str,',
'                        x: prop.gutterLeft + prop.xaxisLabelsOffsetx,',
'                        y: y,',
'                        halign: \'center\',',
'                        valign: \'top\',',
'                        tag:    \'labels.xaxis\',',
'                        font:   prop.xaxisTextFont   || prop.textFont,',
'                        size:   prop.xaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                        bold:   prop.xaxisTextBold   || prop.textBold,',
'                        italic: prop.xaxisTextItalic || prop.textItalic,',
'                        color:  prop.xaxisTextColor  || prop.textColor',
'                    });',
'                }',
'            }',
'        //',
'        // Draw the X axis labels',
'        //',
'        } else {',
'            if (typeof prop.xaxisLabels === \'object\' && !RG.SVG.isNull(prop.xaxisLabels) ) {',
'                var angle = prop.xaxisTextAngle;',
'                // Loop through the X labels',
'                if (prop.xaxisLabelsPosition === \'section\') {',
'                    var segment = (obj.width - prop.gutterLeft - prop.gutterRight) / prop.xaxisLabels.length;',
'                    for (var i=0; i<prop.xaxisLabels.length; ++i) {',
'                        var x = prop.gutterLeft + (segment / 2) + (i * segment);',
'                        if (obj.scale.max <=0 && obj.scale.min < obj.scale.max) {',
'                            var y = prop.gutterTop - (RG.SVG.ISFF ? 5 : 10)  - (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                            var valign = \'bottom\';',
'                        } else {',
'                            var y = obj.height - prop.gutterBottom + (RG.SVG.ISFF ? 5 : 10) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                            var valign = \'top\';',
'                        }',
'                        RG.SVG.text({',
'                            object: obj,',
'                            parent: obj.svg.all,',
'                            text: prop.xaxisLabels[i],',
'                            x: x + prop.xaxisLabelsOffsetx,',
'                            y: y,',
'                            valign: (typeof angle === \'number\' && angle) ? \'center\' : valign,',
'                            halign: (typeof angle === \'number\' && angle) ? \'right\' : \'center\',',
'                            angle: angle,',
'                            tag:    \'labels.xaxis\',',
'                            size:   prop.xaxisTextSize   || prop.textSize,',
'                            italic: prop.xaxisTextItalic || prop.textItalic,',
'                            font:   prop.xaxisTextFont   || prop.textFont,',
'                            bold:   prop.xaxisTextBold   || prop.textBold,',
'                            color:  prop.xaxisTextColor  || prop.textColor',
'                        });',
'                    }',
'                } else if (prop.xaxisLabelsPosition === \'edge\') {',
'                    if (obj.type === \'line\') {',
'                        var hmargin = prop.hmargin;',
'                    } else {',
'                        var hmargin = 0;',
'                    }',
'                    var segment = (obj.graphWidth - hmargin - hmargin) / (prop.xaxisLabels.length - 1);',
'                    for (var i=0; i<prop.xaxisLabels.length; ++i) {',
'                        var x = prop.gutterLeft + (i * segment) + hmargin;',
'                        if (obj.scale.max <= 0 && obj.scale.min < 0) {',
'                            valign = \'bottom\';',
'                            y = prop.gutterTop - (RG.SVG.ISFF ? 5 : 10) - (prop.xaxisTickmarksLength - 5)  - (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety',
'                        } else {',
'                            valign = \'top\';',
'                            y = obj.height - prop.gutterBottom + (RG.SVG.ISFF ? 5 : 10) + (prop.xaxisTickmarksLength - 5) + (prop.xaxisLinewidth || 1) + prop.xaxisLabelsOffsety;',
'                        }',
'                        RG.SVG.text({',
'                            object: obj,',
'                            parent: obj.svg.all,',
'                            text: prop.xaxisLabels[i],',
'                            x: x + prop.xaxisLabelsOffsetx,',
'                            y: y,',
'                            valign: (typeof angle === \'number\' && angle) ? \'center\' : valign,',
'                            halign: (typeof angle === \'number\' && angle) ? \'right\' : \'center\',',
'                            angle: angle,',
'                            tag:    \'labels.xaxis\',',
'                            size:   prop.xaxisTextSize   ||  prop.textSize,',
'                            italic: prop.xaxisTextItalic ||  prop.textItalic,',
'                            font:   prop.xaxisTextFont   ||  prop.textFont,',
'                            bold:   prop.xaxisTextBold   ||  prop.textBold,',
'                            color:  prop.xaxisTextColor  ||  prop.textColor',
'                        });',
'                    }',
'                }',
'            }',
'        }',
'    };',
'    //',
'    // Draws an Y axis',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawYAxis = function (obj)',
'    {',
'        var prop = obj.properties;',
'        if (prop.yaxis) {',
'            // The X coordinate that the Y axis is positioned at',
'            if (obj.type === \'hbar\') {',
'                var x = obj.getXCoord(prop.xaxisMin > 0 ? prop.xaxisMin : 0);',
'                if (prop.xaxisMin < 0 && prop.xaxisMax <= 0) {',
'                    x = obj.getXCoord(prop.xaxisMax);',
'                }',
'            } else {',
'                var x = prop.gutterLeft;',
'            }',
'            var axis = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    d: \'M{1} {2} L{3} {4}\'.format(',
'                        x,',
'                        prop.gutterTop,',
'                        x,',
'                        obj.height - prop.gutterBottom',
'                    ),',
'                    stroke: prop.yaxisColor,',
'                    fill: prop.yaxisColor,',
'                    \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                    \'shape-rendering\': "crispEdges",',
'                    \'stroke-linecap\': \'square\'',
'                }',
'            });',
'            if (obj.type === \'hbar\') {',
'                var height = (obj.graphHeight - prop.vmarginTop - prop.vmarginBottom) / prop.yaxisLabels.length,',
'                    y      = prop.gutterTop + prop.vmarginTop,',
'                    len    = prop.yaxisLabels.length,',
'                    startX = obj.getXCoord(0) + (prop.xaxisMin < 0 ? prop.yaxisTickmarksLength : 0),',
'                    endX   = obj.getXCoord(0) - prop.yaxisTickmarksLength;',
'                if (prop.xaxisMin < 0 && prop.xaxisMax <=0) {',
'                    startX = obj.getXCoord(prop.xaxisMax);',
'                    endX   = obj.getXCoord(prop.xaxisMax) + 5;',
'                }',
'                // A custom number of tickmarks',
'                if (typeof prop.yaxisLabelsPositionSectionTickmarksCount === \'number\') {',
'                    len    = prop.yaxisLabelsPositionSectionTickmarksCount;',
'                    height = (obj.graphHeight - prop.vmarginTop - prop.vmarginBottom) / len;',
'                }',
'                //',
'                // Draw the tickmarks',
'                //',
'                if (prop.yaxisTickmarks) {',
'                    for (var i=0; i<len; ++i) {',
'                        // Draw the axis',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    y,',
'                                    endX,',
'                                    y + 0.001',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                        y += height;',
'                    }',
'                    // Draw an extra tick if the X axis position is not zero or',
'                    // if the xaxis is not being shown',
'                    if (prop.xaxis === false) {',
'                        if (obj.type === \'hbar\' && prop.xaxisMin <= 0 && prop.xaxisMax < 0) {',
'                            var startX = obj.getXCoord(prop.xaxisMax);',
'                            var endX   = obj.getXCoord(prop.xaxisMax) + prop.yaxisTickmarksLength;',
'                        } else {',
'                            var startX = obj.getXCoord(0) - prop.yaxisTickmarksLength;',
'                            var endX   = obj.getXCoord(0) + (prop.xaxisMin < 0 ? prop.yaxisTickmarksLength : 0);',
'                        }',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    ma.round(obj.height - prop.gutterBottom - parseFloat(prop.vmarginBottom)),',
'                                    endX,',
'                                    ma.round(obj.height - prop.gutterBottom - parseFloat(prop.vmarginBottom))',
'                                ),',
'                                stroke: obj.properties.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                }',
'            //',
'            // Bar, Line etc types of chart',
'            //',
'            } else {',
'                var height = obj.graphHeight / prop.yaxisLabelsCount,',
'                    y      = prop.gutterTop,',
'                    len    = prop.yaxisLabelsCount,',
'                    startX = prop.gutterLeft,',
'                    endX   = prop.gutterLeft - prop.yaxisTickmarksLength;',
'                // A custom number of tickmarks',
'                if (typeof prop.yaxisLabelsPositionEdgeTickmarksCount === \'number\') {',
'                    len    = prop.yaxisLabelsPositionEdgeTickmarksCount;',
'                    height = obj.graphHeight / len;',
'                }',
'                //',
'                // Draw the tickmarks',
'                //',
'                if (prop.yaxisTickmarks) {',
'                    for (var i=0; i<len; ++i) {',
'                        // Draw the axis',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    startX,',
'                                    y,',
'                                    endX,',
'                                    y',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                        y += height;',
'                    }',
'                    // Draw an extra tick if the X axis position is not zero or',
'                    //if the xaxis is not being shown',
'                    if (    (prop.yaxisMin !== 0 || prop.xaxis === false)',
'                        && !(obj.scale.min > 0 && obj.scale.max > 0) ) {',
'                        var axis = RG.SVG.create({',
'                            svg: obj.svg,',
'                            parent: obj.svg.all,',
'                            type: \'path\',',
'                            attr: {',
'                                d: \'M{1} {2} L{3} {4}\'.format(',
'                                    prop.gutterLeft - prop.yaxisTickmarksLength,',
'                                    obj.height - prop.gutterBottom,',
'                                    prop.gutterLeft,',
'                                    obj.height - prop.gutterBottom - 0.001',
'                                ),',
'                                stroke: prop.yaxisColor,',
'                                \'stroke-width\': typeof prop.yaxisLinewidth === \'number\' ? prop.yaxisLinewidth : 1,',
'                                \'shape-rendering\': "crispEdges"',
'                            }',
'                        });',
'                    }',
'                }',
'            }',
'        }',
'        //',
'        // Draw the Y axis labels',
'        //',
'        if (prop.yaxisScale) {',
'            var segment = (obj.height - prop.gutterTop - prop.gutterBottom) / prop.yaxisLabelsCount;',
'            for (var i=0; i<obj.scale.labels.length; ++i) {',
'                var y = obj.height - prop.gutterBottom - (segment * i) - segment;',
'                RG.SVG.text({',
'                    object: obj,',
'                    parent: obj.svg.all,',
'                    text:   obj.scale.labels[i],',
'                    x:      prop.gutterLeft - 7 - (prop.yaxis ? (prop.yaxisTickmarksLength - 3) : 0) + prop.yaxisLabelsOffsetx,',
'                    y:      y + prop.yaxisLabelsOffsety,',
'                    halign: prop.yaxisLabelsHalign || \'right\',',
'                    valign: prop.yaxisLabelsValign || \'center\',',
'                    tag:    \'labels.yaxis\',',
'                    font:   prop.yaxisTextFont   || prop.textFont,',
'                    size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                    bold:   prop.yaxisTextBold   || prop.textBold,',
'                    italic: prop.yaxisTextItalic || prop.textItalic,',
'                    color:  prop.yaxisTextColor  || prop.textColor',
'                });',
'            }',
'            //',
'            // Add the minimum label',
'            //',
'            var y   = obj.height - prop.gutterBottom,',
'                str = (prop.yaxisUnitsPre + prop.yaxisMin.toFixed(prop.yaxisDecimals).replace(/\\./, prop.yaxisPoint) + prop.yaxisUnitsPost);',
'            var text = RG.SVG.text({',
'                object: obj,',
'                parent: obj.svg.all,',
'                text: typeof prop.yaxisFormatter === \'function\' ? (prop.yaxisFormatter)(this, prop.yaxisMin) : str,',
'                x: prop.gutterLeft - 7 - (prop.yaxis ? (prop.yaxisTickmarksLength - 3) : 0) + prop.yaxisLabelsOffsetx,',
'                y: y + prop.yaxisLabelsOffsety,',
'                halign: \'right\',',
'                valign: \'center\',',
'                tag:    \'labels.yaxis\',',
'                font:   prop.yaxisTextFont   || prop.textFont,',
'                size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                bold:   prop.yaxisTextBold   || prop.textBold,',
'                italic: prop.yaxisTextItalic || prop.textItalic,',
'                color:  prop.yaxisTextColor  || prop.textColor',
'            });',
'        //',
'        // Draw Y axis labels (eg when specific labels are defined or',
'        //the chart is an HBar',
'        //',
'        } else if (prop.yaxisLabels && prop.yaxisLabels.length) {',
'            for (var i=0; i<prop.yaxisLabels.length; ++i) {',
'                var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / prop.yaxisLabels.length,',
'                    y       = prop.gutterTop + (prop.vmarginTop || 0) + (segment * i) + (segment / 2) + prop.yaxisLabelsOffsety,',
'                    x       = prop.gutterLeft - 7 /*- (prop.yaxis ? (prop.yaxisTickmarksLength) : 0)*/ - (prop.yaxisLinewidth || 1) + prop.yaxisLabelsOffsetx,',
'                    halign  = \'right\';',
'                // HBar labels',
'                if (obj.type === \'hbar\' && obj.scale.min < obj.scale.max && obj.scale.max <= 0) {',
'                    halign = \'left\';',
'                    x      = obj.width - prop.gutterRight + 7 + prop.yaxisLabelsOffsetx;',
'                // HBar labels (again?)',
'                } else if (obj.type === \'hbar\' && !prop.yaxisLabelsSpecific) {',
'                    var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / (prop.yaxisLabels.length);',
'                    y = prop.gutterTop + (prop.vmarginTop || 0) + (segment * i) + (segment / 2) + prop.yaxisLabelsOffsety;',
'                // Specific scale',
'                } else {',
'                    var segment = (obj.graphHeight - (prop.vmarginTop || 0) - (prop.vmarginBottom || 0) ) / (prop.yaxisLabels.length - 1);',
'                    y = obj.height - prop.gutterBottom - (segment * i) + prop.yaxisLabelsOffsety;',
'                }',
'                var text = RG.SVG.text({',
'                    object: obj,',
'                    parent: obj.svg.all,',
'                    text:   prop.yaxisLabels[i] ? prop.yaxisLabels[i] : \'\',',
'                    x:      x,',
'                    y:      y,',
'                    halign: halign,',
'                    valign: \'center\',',
'                    tag:    \'labels.yaxis\',',
'                    font:   prop.yaxisTextFont   || prop.textFont,',
'                    size:   prop.yaxisTextSize   || (typeof prop.textSize === \'number\' ? prop.textSize + \'pt\' : prop.textSize),',
'                    bold:   typeof prop.yaxisTextBold === \'boolean\' ? prop.yaxisTextBold : prop.textBold,',
'                    italic: typeof prop.yaxisTextItalic === \'boolean\' ? prop.yaxisTextItalic : prop.textItalic,',
'                    color:  prop.yaxisTextColor  || prop.textColor',
'                });',
'            }',
'        }',
'    };',
'    //',
'    // Draws the background',
'    //',
'    //@param The chart object',
'    //',
'    RG.SVG.drawBackground = function (obj)',
'    {',
'        var prop = obj.properties;',
'        // Set these properties so that if it doesn\'t exist things don\'t fail',
'        if (typeof prop.variant3dOffsetx !== \'number\') prop.variant3dOffsetx = 0;',
'        if (typeof prop.variant3dOffsety !== \'number\') prop.variant3dOffsety = 0;',
'        if (prop.backgroundColor) {',
'            RG.SVG.create({',
'                svg:  obj.svg,',
'                parent: obj.svg.all,',
'                type: \'rect\',',
'                attr: {',
'                    x: -1 + prop.variant3dOffsetx + prop.gutterLeft,',
'                    y: -1 - prop.variant3dOffsety + prop.gutterTop,',
'                    width: parseFloat(obj.svg.getAttribute(\'width\')) + 2 - prop.gutterLeft - prop.gutterRight,',
'                    height: parseFloat(obj.svg.getAttribute(\'height\')) + 2 - prop.gutterTop - prop.gutterBottom,',
'                    fill: prop.backgroundColor',
'                }',
'            });',
'        }',
'        // Render a background image',
'        // <image xlink:href="firefox.jpg" x="0" y="0" height="50px" width="50px"/>',
'        if (prop.backgroundImage) {',
'            var attr = {',
'                \'xlink:href\': prop.backgroundImage,',
'                //preserveAspectRatio: \'xMidYMid slice\',',
'                preserveAspectRatio: prop.backgroundImageAspect || \'none\',',
'                x: prop.gutterLeft,',
'                y: prop.gutterTop',
'            };',
'            if (prop.backgroundImageStretch) {',
'                attr.x      = prop.gutterLeft + prop.variant3dOffsetx;',
'                attr.y      = prop.gutterTop + prop.variant3dOffsety;',
'                attr.width  = obj.width - prop.gutterLeft - prop.gutterRight;',
'                attr.height = obj.height - prop.gutterTop - prop.gutterBottom;',
'            } else {',
'                if (typeof prop.backgroundImageX === \'number\') {',
'                    attr.x =  prop.backgroundImageX + prop.variant3dOffsetx;',
'                } else {',
'                    attr.x =  prop.gutterLeft + prop.variant3dOffsetx;',
'                }',
'                if (typeof prop.backgroundImageY === \'number\') {',
'                    attr.y =  prop.backgroundImageY + prop.variant3dOffsety;',
'                } else {',
'                    attr.y =  prop.gutterTop + prop.variant3dOffsety;',
'                }',
'                if (typeof prop.backgroundImageW === \'number\') {',
'                    attr.width =  prop.backgroundImageW;',
'                }',
'                if (typeof prop.backgroundImageH === \'number\') {',
'                    attr.height =  prop.backgroundImageH;',
'                }',
'            }',
'            //',
'            // Account for the chart being 3d',
'            //',
'            if (prop.variant === \'3d\') {',
'                attr.x += prop.variant3dOffsetx;',
'                attr.y -= prop.variant3dOffsety;',
'            }',
'            var img = RG.SVG.create({',
'                svg:  obj.svg,',
'                parent: obj.svg.all,',
'                type: \'image\',',
'                attr: attr,',
'                style: {',
'                    opacity: typeof prop.backgroundImageOpacity === \'number\' ? prop.backgroundImageOpacity : 1',
'                }',
'            });',
'            // Set the width and height if necessary',
'            if (!prop.backgroundImageStretch) {',
'                var img2    = new Image();',
'                img2.src    = prop.backgroundImage;',
'                img2.onload = function ()',
'                {',
'                    img.setAttribute(\'width\', typeof prop.backgroundImageW === \'number\' ? prop.backgroundImageW : img2.width);',
'                    img.setAttribute(\'height\', typeof prop.backgroundImageH === \'number\' ? prop.backgroundImageH : img2.height);',
'                };',
'            }',
'        }',
'        if (prop .backgroundGrid) {',
'            var parts = [];',
'            // Add the horizontal lines to the path',
'            if (prop.backgroundGridHlines) {',
'                if (typeof prop.backgroundGridHlinesCount === \'number\') {',
'                    var count = prop.backgroundGridHlinesCount;',
'                } else if (obj.type === \'hbar\' || obj.type === \'bipolar\') {',
'                    if (typeof prop.yaxisLabels === \'object\' && !RG.SVG.isNull(prop.yaxisLabels) && prop.yaxisLabels.length) {',
'                        var count = prop.yaxisLabels.length;',
'                    } else if (obj.type === \'hbar\') {',
'                        var count = obj.data.length;',
'                    } else if (obj.type === \'bipolar\') {',
'                        var count = obj.left.length;',
'                    }',
'                } else {',
'                    var count = prop.yaxisLabelsCount || 5;',
'                }',
'                for (var i=0; i<=count; ++i) {',
'                    parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft + prop.variant3dOffsetx,',
'                        prop.gutterTop + (obj.graphHeight / count) * i - prop.variant3dOffsety,',
'                        obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                        prop.gutterTop + (obj.graphHeight / count) * i - prop.variant3dOffsety',
'                    ));',
'                }',
'                // Add an extra background grid line to the path - this its',
'                // underneath the X axis and shows up if its not there.',
'                parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                ));',
'            }',
'            // Add the vertical lines to the path',
'            if (prop.backgroundGridVlines) {',
'                if (obj.type === \'line\' && RG.SVG.isArray(obj.data[0])) {',
'                    var len = obj.data[0].length;',
'                } else if (obj.type === \'hbar\') {',
'                    var len = prop.xaxisLabelsCount || 10;',
'                } else if (obj.type === \'bipolar\') {',
'                    var len = prop.xaxisLabelsCount || 10;',
'                } else if (obj.type === \'scatter\') {',
'                    var len = (prop.xaxisLabels && prop.xaxisLabels.length) || 10;',
'                } else if (obj.type === \'waterfall\') {',
'                    var len = obj.data[0].length;',
'                } else {',
'                    var len = obj.data.length;',
'                }',
'                var count = typeof prop.backgroundGridVlinesCount === \'number\' ? prop.backgroundGridVlinesCount : len;',
'                if (prop.xaxisLabelsPosition === \'edge\') {',
'                    count--;',
'                }',
'                for (var i=0; i<=count; ++i) {',
'                    parts.push(\'M{1} {2} L{3} {4}\'.format(',
'                        prop.gutterLeft + ((obj.graphWidth / count) * i) + prop.variant3dOffsetx,',
'                        prop.gutterTop - prop.variant3dOffsety,',
'                        prop.gutterLeft + ((obj.graphWidth / count) * i) + prop.variant3dOffsetx,',
'                        obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                    ));',
'                }',
'            }',
'            // Add the box around the grid',
'            if (prop.backgroundGridBorder) {',
'                parts.push(\'M{1} {2} L{3} {4} L{5} {6} L{7} {8} z\'.format(',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    prop.gutterTop  - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    prop.gutterTop - prop.variant3dOffsety,',
'                    obj.width - prop.gutterRight + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety,',
'                    prop.gutterLeft + prop.variant3dOffsetx,',
'                    obj.height - prop.gutterBottom - prop.variant3dOffsety',
'                ));',
'            }',
'            // Get the dash array if its defined to be dotted or dashed',
'            var dasharray;',
'            if (prop.backgroundGridDashed) {',
'                dasharray = [3,5];',
'            } else if (prop.backgroundGridDotted) {',
'                dasharray = [1,3];',
'            } else if (prop.backgroundGridDashArray) {',
'                dasharray = prop.backgroundGridDashArray;',
'            } else {',
'                dasharray = \'\';',
'            }',
'            // Now draw the path',
'            var grid = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                type: \'path\',',
'                attr: {',
'                    className: \'rgraph_background_grid\',',
'                    d: parts.join(\' \'),',
'                    stroke: prop.backgroundGridColor,',
'                    fill: \'rgba(0,0,0,0)\',',
'                    \'stroke-width\': prop.backgroundGridLinewidth,',
'                    \'shape-rendering\': "crispEdges",',
'                    \'stroke-dasharray\': dasharray',
'                },',
'                style: {',
'                    pointerEvents: \'none\'',
'                }',
'            });',
'        }',
'        // Draw the title and subtitle',
'        if (obj.type !== \'bipolar\') {',
'            RG.SVG.drawTitle(obj);',
'        }',
'    };',
'    /**',
'    * Returns true/false as to whether the given variable is null or not',
'    * ',
'    * @param mixed arg The argument to check',
'    */',
'    RG.SVG.isNull = function (arg)',
'    {',
'        // must BE DOUBLE EQUALS - NOT TRIPLE',
'        if (arg == null || typeof arg === \'object\' && !arg) {',
'            return true;',
'        }',
'        return false;',
'    };',
'    /**',
'    * Returns an appropriate scale. The return value is actualy an object consisting of:',
'    *  scale.max',
'    *  scale.min',
'    *  scale.scale',
'    * ',
'    * @param  obj object  The graph object',
'    * @param  prop object An object consisting of configuration properties',
'    * @return     object  An object containg scale information',
'    */',
'    RG.SVG.getScale = function (opt)',
'    {',
'        var obj          = opt.object,',
'            prop         = obj.properties,',
'            numlabels    = opt.numlabels,',
'            unitsPre     = opt.unitsPre,',
'            unitsPost    = opt.unitsPost,',
'            max          = Number(opt.max),',
'            min          = Number(opt.min),',
'            strict       = opt.strict,',
'            decimals     = Number(opt.decimals),',
'            point        = opt.point,',
'            thousand     = opt.thousand,',
'            originalMax  = max,',
'            round        = opt.round,',
'            scale        = {max:1,labels:[],values:[]},',
'            formatter    = opt.formatter;',
'        /**',
'        * Special case for 0',
'        * ',
'        * ** Must be first **',
'        */',
'        if (max === 0 && min === 0) {',
'            var max = 1;',
'            for (var i=0; i<numlabels; ++i) {',
'                var label = ((((max - min) / numlabels) * (i + 1)) + min).toFixed(decimals);',
'                scale.labels.push(unitsPre + label + unitsPost);',
'                scale.values.push(parseFloat(label))',
'            }',
'        /**',
'        * Manually do decimals',
'        */',
'        } else if (max <= 1 && !strict) {',
'            var arr = [',
'                1,0.5,',
'                0.10,0.05,',
'                0.010,0.005,',
'                0.0010,0.0005,',
'                0.00010,0.00005,',
'                0.000010,0.000005,',
'                0.0000010,0.0000005,',
'                0.00000010,0.00000005,',
'                0.000000010,0.000000005,',
'                0.0000000010,0.0000000005,',
'                0.00000000010,0.00000000005,',
'                0.000000000010,0.000000000005,',
'                0.0000000000010,0.0000000000005',
'            ], vals = [];',
'            for (var i=0; i<arr.length; ++i) {',
'                if (max > arr[i]) {',
'                    i--;',
'                    break;',
'                }',
'            }',
'            scale.max    = arr[i]',
'            scale.labels = [];',
'            scale.values = [];',
'            for (var j=0; j<numlabels; ++j) {',
'                var value = ((((arr[i] - min) / numlabels) * (j + 1)) + min).toFixed(decimals);',
'                scale.values.push(value);',
'                scale.labels.push(RG.SVG.numberFormat({',
'                    object: obj,',
'                    num: value,',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: prop.yaxisPoint,',
'                    thousand: prop.yaxisThousand,',
'                    formatter: formatter',
'                }));',
'            }',
'        } else if (!strict) {',
'            /**',
'            * Now comes the scale handling for integer values',
'            */',
'            // This accomodates decimals by rounding the max up to the next integer',
'            max = ma.ceil(max);',
'            var interval = ma.pow(10, ma.max(1, Number(String(Number(max) - Number(min)).length - 1)) );',
'            var topValue = interval;',
'            while (topValue < max) {',
'                topValue += (interval / 2);',
'            }',
'            // Handles cases where the max is (for example) 50.5',
'            if (Number(originalMax) > Number(topValue)) {',
'                topValue += (interval / 2);',
'            }',
'            // Custom if the max is greater than 5 and less than 10',
'            if (max <= 10) {',
'                topValue = (Number(originalMax) <= 5 ? 5 : 10);',
'            }',
'            // Added 02/11/2010 to create "nicer" scales',
'            if (obj && typeof(round) == \'boolean\' && round) {',
'                topValue = 10 * interval;',
'            }',
'            scale.max = topValue;',
'            for (var i=0; i<numlabels; ++i) {',
'                var label = RG.SVG.numberFormat({',
'                    object: obj,',
'                    num: ((((i+1) / numlabels) * (topValue - min)) + min).toFixed(decimals),',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: point,',
'                    thousand: thousand,',
'                    formatter: formatter',
'                });',
'                scale.labels.push(label);',
'                scale.values.push(((((i+1) / numlabels) * (topValue - min)) + min).toFixed(decimals));',
'            }',
'        } else if (typeof max === \'number\' && strict) {',
'            /**',
'            * ymax is set and also strict',
'            */',
'            for (var i=0; i<numlabels; ++i) {',
'                scale.labels.push(RG.SVG.numberFormat({',
'                    object: obj,',
'                    formatter: formatter,',
'                    num: ((((i+1) / numlabels) * (max - min)) + min).toFixed(decimals),',
'                    prepend: unitsPre,',
'                    append: unitsPost,',
'                    point: point,',
'                    thousand: thousand',
'                }));',
'                scale.values.push(',
'                    ((((i+1) / numlabels) * (max - min)) + min).toFixed(decimals)',
'                );',
'            }',
'            // ???',
'            scale.max = max;',
'        }',
'        scale.unitsPre  = unitsPre;',
'        scale.unitsPost = unitsPost;',
'        scale.point     = point;',
'        scale.decimals  = decimals;',
'        scale.thousand  = thousand;',
'        scale.numlabels = numlabels;',
'        scale.round     = Boolean(round);',
'        scale.min       = min;',
'        //',
'        // Convert all of the scale values to numbers',
'        //',
'        for (var i=0; i<scale.values.length; ++i) {',
'            scale.values[i] = parseFloat(scale.values[i]);',
'        }',
'        return scale;',
'    };',
'    /**',
'    * Pads/fills the array',
'    * ',
'    * @param  array arr The array',
'    * @param  int   len The length to pad the array to',
'    * @param  mixed     The value to use to pad the array (optional)',
'    */',
'    RG.SVG.arrayFill = ',
'    RG.SVG.arrayPad  = function (opt)',
'    {',
'        var arr   = opt.array,',
'            len   = opt.length,',
'            value = (typeof opt.value === \'undefined\' ? null : opt.value);',
'        if (arr.length < len) {            ',
'            for (var i=arr.length; i<len; i+=1) {',
'                arr[i] = value;',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * An array sum function',
'    * ',
'    * @param  array arr The  array to calculate the total of',
'    * @return int       The summed total of the arrays elements',
'    */',
'    RG.SVG.arraySum = function (arr)',
'    {',
'        // Allow integers',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        // Account for null',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        var i, sum, len = arr.length;',
'        for(i=0,sum=0;i<len;sum+=arr[i++]);',
'        return sum;',
'    };',
'    /**',
'    * Returns the maximum numeric value which is in an array. This function IS NOT',
'    * recursive',
'    * ',
'    * @param  array arr The array (can also be a number, in which case it\'s returned as-is)',
'    * @param  int       Whether to ignore signs (ie negative/positive)',
'    * @return int       The maximum value in the array',
'    */',
'    RG.SVG.arrayMax = function (arr)',
'    {',
'        var max = null',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            if (typeof arr[i] === \'number\') {',
'                var val = arguments[1] ? ma.abs(arr[i]) : arr[i];',
'                if (typeof max === \'number\') {',
'                    max = ma.max(max, val);',
'                } else {',
'                    max = val;',
'                }',
'            }',
'        }',
'        return max;',
'    };',
'    /**',
'    * Returns the minimum numeric value which is in an array',
'    * ',
'    * @param  array arr The array (can also be a number, in which case it\'s returned as-is)',
'    * @param  int       Whether to ignore signs (ie negative/positive)',
'    * @return int       The minimum value in the array',
'    */',
'    RG.SVG.arrayMin = function (arr)',
'    {',
'        var max = null,',
'            min = null,',
'            ma  = Math;',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            if (typeof arr[i] === \'number\') {',
'                var val = arguments[1] ? ma.abs(arr[i]) : arr[i];',
'                if (typeof min === \'number\') {',
'                    min = ma.min(min, val);',
'                } else {',
'                    min = val;',
'                }',
'            }',
'        }',
'        return min;',
'    };',
'    /**',
'    * Returns the maximum value which is in an array',
'    * ',
'    * @param  array arr The array',
'    * @param  int   len The length to pad the array to',
'    * @param  mixed     The value to use to pad the array (optional)',
'    */',
'    RG.SVG.arrayPad = function (arr, len)',
'    {',
'        if (arr.length < len) {',
'            var val = arguments[2] ? arguments[2] : null;',
'            for (var i=arr.length; i<len; i+=1) {',
'                arr[i] = val;',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * An array sum function',
'    * ',
'    * @param  array arr The  array to calculate the total of',
'    * @return int       The summed total of the arrays elements',
'    */',
'    RG.SVG.arraySum = function (arr)',
'    {',
'        // Allow integers',
'        if (typeof arr === \'number\') {',
'            return arr;',
'        }',
'        // Account for null',
'        if (RG.SVG.isNull(arr)) {',
'            return 0;',
'        }',
'        var i, sum, len = arr.length;',
'        for(i=0,sum=0;i<len;sum+=arr[i++]);',
'        return sum;',
'    };',
'    /**',
'    * Takes any number of arguments and adds them to one big linear array',
'    * which is then returned',
'    * ',
'    * @param ... mixed The data to linearise. You can strings, booleans, numbers or arrays',
'    */',
'    RG.SVG.arrayLinearize = function ()',
'    {',
'        var arr  = [],',
'            args = arguments',
'        for (var i=0,len=args.length; i<len; ++i) {',
'            if (typeof args[i] === \'object\' && args[i]) {',
'                for (var j=0,len2=args[i].length; j<len2; ++j) {',
'                    var sub = RG.SVG.arrayLinearize(args[i][j]);',
'                    for (var k=0,len3=sub.length; k<len3; ++k) {',
'                        arr.push(sub[k]);',
'                    }',
'                }',
'            } else {',
'                arr.push(args[i]);',
'            }',
'        }',
'        return arr;',
'    };',
'    /**',
'    * Takes one off the front of the given array and returns the new array.',
'    * ',
'    * @param array arr The array from which to take one off the front of array ',
'    * ',
'    * @return array The new array',
'    */',
'    RG.SVG.arrayShift = function(arr)',
'    {',
'        var ret = [];',
'        for(var i=1,len=arr.length; i<len; ++i) {',
'            ret.push(arr[i]);',
'        }',
'        return ret;',
'    };',
'    /**',
'    * Reverses the order of an array',
'    * ',
'    * @param array arr The array to reverse',
'    */',
'    RG.SVG.arrayReverse = function (arr)',
'    {',
'        if (!arr) {',
'            return;',
'        }',
'        var newarr=[];',
'        for(var i=arr.length - 1; i>=0; i-=1) {',
'            newarr.push(arr[i]);',
'        }',
'        return newarr;',
'    };',
'    /**',
'    * Makes a clone of an object',
'    * ',
'    * @param obj val The object to clone',
'    */',
'    RG.SVG.arrayClone = function (obj)',
'    {',
'        if(obj === null || typeof obj !== \'object\') {',
'            return obj;',
'        }',
'        if (RG.SVG.isArray(obj)) {',
'            var temp = [];',
'            for (var i=0,len=obj.length;i<len; ++i) {',
'                if (typeof obj[i]  === \'number\') {',
'                    temp[i] = (function (arg) {return Number(arg);})(obj[i]);',
'                } else if (typeof obj[i]  === \'string\') {',
'                    temp[i] = (function (arg) {return String(arg);})(obj[i]);',
'                } else if (typeof obj[i] === \'function\') {',
'                    temp[i] = obj[i];',
'                } else {',
'                    temp[i] = RG.SVG.arrayClone(obj[i]);',
'                }',
'            }',
'        } else if (typeof obj === \'object\') {',
'            var temp = {};',
'            for (var i in obj) {',
'                if (typeof i === \'string\') {',
'                    temp[i] = obj[i];',
'                }',
'            }',
'        }',
'        return temp;',
'    };',
'    //',
'    // Converts an the truthy values to falsey values and vice-versa',
'    //',
'    RG.SVG.arrayInvert = function (arr)',
'    {',
'        for (var i=0,len=arr.length; i<len; ++i) {',
'            arr[i] = !arr[i];',
'        }',
'        return arr;',
'    };',
'    //',
'    // An array_trim function that removes the empty elements off',
'    //both ends',
'    //',
'    RG.SVG.arrayTrim = function (arr)',
'    {',
'        var out = [], content = false;',
'        // Trim the start',
'        for (var i=0; i<arr.length; i++) {',
'            if (arr[i]) {',
'                content = true;',
'            }',
'            if (content) {',
'                out.push(arr[i]);',
'            }',
'        }',
'        // Reverse the array and trim the start again',
'        out = RG.SVG.arrayReverse(out);',
'        var out2 = [], content = false ;',
'        for (var i=0; i<out.length; i++) {',
'            if (out[i]) {',
'                content = true;',
'            }',
'            if (content) {',
'                out2.push(out[i]);',
'            }',
'        }',
'        // Now reverse the array and return it',
'        out2 = RG.SVG.arrayReverse(out2);',
'        return out2;',
'    };',
'    /**',
'    * Determines if the given object is an array or not',
'    * ',
'    * @param mixed obj The variable to test',
'    */',
'    RG.SVG.isArray = function (obj)',
'    {',
'        if (obj && obj.constructor) {',
'            var pos = obj.constructor.toString().indexOf(\'Array\');',
'        } else {',
'            return false;',
'        }',
'        return obj != null &&',
'               typeof pos === \'number\' &&',
'               pos > 0 &&',
'               pos < 20;',
'    };',
'    /**',
'    * Returns the absolute value of a number. You can also pass in an',
'    * array and it will run the abs() function on each element. It',
'    * operates recursively so sub-arrays are also traversed.',
'    * ',
'    * @param array arr The number or array to work on',
'    */',
'    RG.SVG.abs = function (value)',
'    {',
'        if (typeof value === \'string\') {',
'            value = parseFloat(value) || 0;',
'        }',
'        if (typeof value === \'number\') {',
'            return ma.abs(value);',
'        }',
'        if (typeof value === \'object\') {',
'            for (i in value) {',
'                if (   typeof i === \'string\'',
'                    || typeof i === \'number\'',
'                    || typeof i === \'object\') {',
'                    value[i] = RG.SVG.abs(value[i]);',
'                }',
'            }',
'            return value;',
'        }',
'        return 0;',
'    };',
'    //',
'    // Formats a number with thousand seperators so it\'s easier to read',
'    //',
'    // @param opt object The options to the function',
'    //',
'    RG.SVG.numberFormat = function (opt)',
'    {',
'        var obj                = opt.object,',
'            prepend            = opt.prepend ? String(opt.prepend) : \'\',',
'            append             = opt.append ? String(opt.append) : \'\',',
'            output             = \'\',',
'            decimal_seperator  = typeof opt.point === \'string\' ? opt.point : \'.\',',
'            thousand_seperator = typeof opt.thousand === \'string\' ? opt.thousand : \',\',',
'            num                = opt.num',
'            decimals_trim      = opt.decimals_trim;',
'        RegExp.$1   = \'\';',
'        if (typeof opt.formatter === \'function\') {',
'            return opt.formatter(obj, num);',
'        }',
'        // Ignore the preformatted version of "1e-2"',
'        if (String(num).indexOf(\'e\') > 0) {',
'            return String(prepend + String(num) + append);',
'        }',
'        // We need then number as a string',
'        num = String(num);',
'        // Take off the decimal part - we re-append it later',
'        if (num.indexOf(\'.\') > 0) {',
'            var tmp = num;',
'            num     = num.replace(/\\.(.*)/, \'\'); // The front part of the number',
'            decimal = tmp.replace(/(.*)\\.(.*)/, \'$2\'); // The decimal part of the number',
'        } else {',
'            decimal = \'\';',
'        }',
'        // Thousand seperator',
'        //var seperator = arguments[1] ? String(arguments[1]) : \',\';',
'        var seperator = thousand_seperator;',
'        /**',
'        * Work backwards adding the thousand seperators',
'        */',
'        var foundPoint;',
'        for (i=(num.length - 1),j=0; i>=0; j++,i--) {',
'            var character = num.charAt(i);',
'            if ( j % 3 == 0 && j != 0) {',
'                output += seperator;',
'            }',
'            /**',
'            * Build the output',
'            */',
'            output += character;',
'        }',
'        /**',
'        * Now need to reverse the string',
'        */',
'        var rev = output;',
'        output = \'\';',
'        for (i=(rev.length - 1); i>=0; i--) {',
'            output += rev.charAt(i);',
'        }',
'        // Tidy up',
'        //output = output.replace(/^-,/, \'-\');',
'        if (output.indexOf(\'-\' + thousand_seperator) == 0) {',
'            output = \'-\' + output.substr((\'-\' + thousand_seperator).length);',
'        }',
'        // Reappend the decimal',
'        if (decimal.length) {',
'            output =  output + decimal_seperator + decimal;',
'            decimal = \'\';',
'            RegExp.$1 = \'\';',
'        }',
'        //',
'        // Trim the decimals if it\'s all zeros',
'        //',
'        if (decimals_trim) {',
'            output = output.replace(/0+$/,\'\');',
'            output = output.replace(/\\.$/,\'\');',
'        }',
'        // Minor bugette',
'        if (output.charAt(0) == \'-\') {',
'            output = output.replace(/-/, \'\');',
'            prepend = \'-\' + prepend;',
'        }',
'        return prepend + output + append;',
'    };',
'    //',
'    // A function that adds text to the chart',
'    //',
'    RG.SVG.text = function (opt)',
'    {',
'        var obj        = opt.object,',
'            parent     = opt.parent || opt.object.svg.all,',
'            size       = typeof opt.size === \'number\' ? opt.size + \'pt\' : (typeof opt.size === \'string\' ? opt.size.replace(/pt$/,\'\') : 12) + \'pt\',',
'            bold       = opt.bold ? \'bold\' : \'normal\',',
'            font       = opt.font ? opt.font : \'sans-serif\',',
'            italic     = opt.italic ? \'italic\' : \'normal\',',
'            halign     = opt.halign,',
'            valign     = opt.valign,',
'            str        = opt.text,',
'            x          = opt.x,',
'            y          = opt.y,',
'            color      = opt.color ? opt.color : \'black\',',
'            background = opt.background || null,',
'            padding    = opt.padding || 0,',
'            link       = opt.link || \'\',',
'            linkTarget = opt.linkTarget || \'_blank\',',
'            events     = (opt.events === false ? false : true),',
'            angle      = opt.angle;',
'        //',
'        // Change numbers to strings',
'        //',
'        if (typeof str === \'number\') {',
'            str = String(str);',
'        }',
'        //',
'        // If the string starts with a carriage return add a unicode non-breaking',
'        // space to the start of it.',
'        //',
'        if (str.substr(0,2) == \'\\r\\n\' || str.substr(0,1) === \'\\n\') {',
'            str = "\\u00A0" + str;',
'        }',
'        // Horizontal alignment',
'        if (halign === \'right\') {',
'            halign = \'end\';',
'        } else if (halign === \'center\' || halign === \'middle\') {',
'            halign = \'middle\';',
'        } else {',
'            halign = \'start\';',
'        }',
'        // Vertical alignment',
'        if (valign === \'top\') {',
'            valign = \'hanging\';',
'        } else if (valign === \'center\' || valign === \'middle\') {',
'            valign = \'central\';',
'            valign = \'middle\';',
'        } else {',
'            valign = \'bottom\';',
'        }',
'        //',
'        // If a link has been specified then the text node should',
'        // be a child of an a node',
'        if (link) {',
'            var a = RGraph.SVG.create({',
'                svg: obj.svg,',
'                type: \'a\',',
'                parent: parent,',
'                attr: {',
'                    \'xlink:href\': link,',
'                    target: linkTarget',
'                }',
'            });',
'        }',
'        //',
'        // Text does not include carriage returns',
'        //',
'        if (str && str.indexOf && str.indexOf("\\n") === -1) {',
'            var text = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: link ? a : opt.parent,',
'                type: \'text\',',
'                attr: {',
'                    tag: opt.tag ? opt.tag : \'\',',
'                    fill: color,',
'                    x: x,',
'                    y: y,',
'                    \'font-size\':         size,',
'                    \'font-weight\':       bold,',
'                    \'font-family\':       font,',
'                    \'font-style\':        italic,',
'                    \'text-anchor\':       halign,',
'                    \'dominant-baseline\': valign',
'                }',
'            });',
'            var textNode = document.createTextNode(str);',
'            text.appendChild(textNode);',
'            if (!events) {',
'                text.style.pointerEvents = \'none\';',
'            }',
'        //',
'        // Includes carriage returns',
'        //',
'        } else if (str && str.indexOf) {',
'            // Measure the text',
'            var dimensions = RG.SVG.measureText({',
'                text: \'My\',',
'                bold: bold,',
'                font: font,',
'                size: size',
'            });',
'            var lineHeight = dimensions[1];',
'            str = str.split(/\\r?\\n/);',
'            //',
'            // Account for the carriage returns and move the text',
'            // up as required',
'            //',
'            if (valign === \'bottom\') {',
'                y -= str.length * lineHeight;',
'            }',
'            if (valign === \'center\' || valign === \'middle\') {',
'                y -= (str.length * lineHeight) / 2;',
'            }',
'            var text = RG.SVG.create({',
'                svg: obj.svg,',
'                parent: link ? a : opt.parent,',
'                type: \'text\',',
'                attr: {',
'                    tag: opt.tag ? opt.tag : \'\',',
'                    fill: color,',
'                    x: x,',
'                    y: y,',
'                    \'font-size\':         size,',
'                    \'font-weight\':       bold,',
'                    \'font-family\':       font,',
'                    \'font-style\':        italic,',
'                    \'text-anchor\':       halign,',
'                    \'dominant-baseline\': valign',
'                }',
'            });',
'            if (!events) {',
'                text.style.pointerEvents = \'none\';',
'            }',
'            for (var i=0; i<str.length; ++i) {',
'                var tspan = RG.SVG.create({',
'                    svg: obj.svg,',
'                    parent: text,',
'                    type: \'tspan\',',
'                    attr: {',
'                        x: x,',
'                        dy: dimensions ? (dimensions[1] * (i ? 1 : 0)) + 3 : 0',
'                    }',
'                });',
'                var textNode = document.createTextNode(str[i]);',
'                tspan.appendChild(textNode);',
'                if (!events) {',
'                    tspan.style.pointerEvents = \'none\';',
'                }',
'                var dimensions = RG.SVG.measureText({',
'                    text: str[i],',
'                    bold: bold,',
'                    font: font,',
'                    size: parseInt(size)',
'                });',
'            }',
'        }',
'        // Now add the rotation if necessary',
'        if (typeof angle === \'number\' && angle && text) {',
'            text.setAttribute(\'x\', 0);',
'            text.setAttribute(\'y\', 0);',
'            text.setAttribute(\'transform\', \'translate({1} {2}) rotate({3})\'.format(x, y, -1 * angle));',
'        }',
'        //',
'        // Add a background color if specified',
'        //',
'        if (typeof background === \'string\') {',
'            var parent = link ? a : parent;',
'            var bbox = text.getBBox(),',
'                rect = RG.SVG.create({',
'                    svg:    obj.svg,',
'                    parent: parent,',
'                    type:   \'rect\',',
'                    attr: {',
'                        x:      bbox.x - padding,',
'                        y:      bbox.y - padding,',
'                        width:  bbox.width + (padding * 2),',
'                        height: bbox.height + (padding * 2),',
'                        fill:   background',
'                    }',
'                });',
'                if (!events) {',
'                    rect.style.pointerEvents = \'none\';',
'                }',
'            text.parentNode.insertBefore(rect, text);',
'        }',
'        if (RG.SVG.ISIE && (valign === \'hanging\') && text) {',
'            text.setAttribute(\'y\', y + (text.scrollHeight / 2));',
'        } else if (RG.SVG.ISIE && valign === \'middle\') {',
'            text.setAttribute(\'y\', y + (text.scrollHeight / 3));',
'        }',
'        if (RG.SVG.ISFF && text) {',
'            Y = y + (text.scrollHeight / 3);',
'        }',
'        return text;',
'    };',
'    //',
'    // Helps you get hold of the SPAN tag nodes that hold the text on the chart',
'    //',
'    RG.SVG.text.find = function (opt)',
'    {',
'        // Search criteria should include:',
'        //  o text (literal string and regex)',
'        if (typeof opt.object === \'object\' && opt.object.isRGraph) {',
'            var svg = opt.object.svg;',
'        } else if (typeof opt.svg === \'object\' && opt.svg.all) {',
'            var svg = opt.svg;',
'        }',
'        // Look for text nodes based on the text',
'        var nodes = svg.getElementsByTagName(\'text\');',
'        var found = [];',
'        for (var i=0,len=nodes.length; i<len; ++i) {',
'            var text = false,',
'                tag  = false;',
'            // Exact match or regex on the text',
'            if (typeof opt.text === \'string\' && nodes[i].innerHTML === opt.text) {',
'                text = true;',
'            } else if (typeof opt.text === \'object\' && nodes[i].innerHTML.match(opt.text)) {',
'                text = true;',
'            } else if (typeof opt.text === \'undefined\') {',
'                text = true;',
'            }',
'            // Exact match or regex on the tag',
'            if (typeof opt.tag === \'string\' && nodes[i].getAttribute(\'tag\') === opt.tag) {',
'                tag = true;',
'            } else if (typeof opt.tag === \'object\' && nodes[i].getAttribute(\'tag\').match(opt.tag)) {',
'                tag = true;',
'            } else if (typeof opt.tag === \'undefined\') {',
'                tag = true;',
'            }',
'            // Did all of the conditions pass?',
'            if (text === true && tag === true) {',
'                found.push(nodes[i])',
'            }',
'        }',
'        return found;',
'    };',
'    //',
'    // Creates a UID that is applied to the object',
'    //',
'    RG.SVG.createUID = function ()',
'    {',
'        return \'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\'.replace(/[xy]/g, function(c)',
'        {',
'            var r = ma.random()*16|0, v = c == \'x\' ? r : (r&0x3|0x8);',
'            return v.toString(16);',
'        });',
'    };',
'    //',
'    // Determines if the SVG DIV container is fixed',
'    //',
'    RG.SVG.isFixed = function (svg)',
'    {',
'        var obj = svg.parentNode,',
'            i   = 0;',
'        while (obj && obj.tagName.toLowerCase() != \'body\' && i < 99) {',
'            if (obj.style.position === \'fixed\') {',
'                return obj;',
'            }',
'            obj = obj.offsetParent;',
'        }',
'        return false;',
'    };',
'    /**',
'    * Sets an object in the RGraph registry',
'    * ',
'    * @param string name The name of the value to set',
'    */',
'    RG.SVG.REG.set = function (name, value)',
'    {',
'        RG.SVG.REG.store[name] = value;',
'        return value;',
'    };',
'    /**',
'    * Gets an object from the RGraph registry',
'    * ',
'    * @param string name The name of the value to fetch',
'    */',
'    RG.SVG.REG.get = function (name)',
'    {',
'        return RG.SVG.REG.store[name];',
'    };',
'    /**',
'    * Removes white-space from the start aqnd end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.trim = function (str)',
'    {',
'        return RG.SVG.ltrim(RG.SVG.rtrim(str));',
'    };',
'    /**',
'    * Trims the white-space from the start of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.ltrim = function (str)',
'    {',
'        return str.replace(/^(\\s|\\0)+/, \'\');',
'    };',
'    /**',
'    * Trims the white-space off of the end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.rtrim = function (str)',
'    {',
'        return str.replace(/(\\s|\\0)+$/, \'\');',
'    };',
'    //',
'    // Hides the currently shown tooltip',
'    //',
'    RG.SVG.hideTooltip = function ()',
'    {',
'        var tooltip = RG.SVG.REG.get(\'tooltip\');',
'        if (tooltip && tooltip.parentNode /*&& (!uid || uid == tooltip.__canvas__.uid)*/) {',
'            tooltip.parentNode.removeChild(tooltip);',
'            tooltip.style.display = \'none\';                ',
'            tooltip.style.visibility = \'hidden\';',
'            RG.SVG.REG.set(\'tooltip\', null);',
'        }',
'        if (tooltip && tooltip.__object__) {',
'            RG.SVG.removeHighlight(tooltip.__object__);',
'        }',
'    };',
'    //',
'    // Creates a shadow',
'    //',
'    RG.SVG.setShadow = function (options)',
'    {',
'        var obj     = options.object,',
'            offsetx = options.offsetx  || 0,',
'            offsety = options.offsety || 0,',
'            blur    = options.blur || 0,',
'            opacity = options.opacity || 0,',
'            id      = options.id;',
'        var filter = RG.SVG.create({',
'            svg: obj.svg,',
'            parent: obj.svg.defs,',
'            type: \'filter\',',
'            attr: {',
'                id: id,',
'                 width: "130%",',
'                 height: "130%"',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feOffset\',',
'            attr: {',
'                result: \'offOut\',',
'                \'in\': \'SourceGraphic\',',
'                dx: offsetx,',
'                dy: offsety',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feColorMatrix\',',
'            attr: {',
'                result: \'matrixOut\',',
'                \'in\': \'offOut\',',
'                type: \'matrix\',',
'                values: \'0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 {1} 0\'.format(',
'                    opacity',
'                )',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feGaussianBlur\',',
'            attr: {',
'                result: \'blurOut\',',
'                \'in\': \'matrixOut\',',
'                stdDeviation: blur',
'            }',
'        });',
'        RG.SVG.create({',
'            svg: obj.svg,',
'            parent: filter,',
'            type: \'feBlend\',',
'            attr: {',
'                \'in\': \'SourceGraphic\',',
'                \'in2\': \'blurOut\',',
'                mode: \'normal\'',
'            }',
'        });',
'    };',
'    /**',
'    * Takes a sequential index and returns the group/index variation of it. Eg if you have a',
'    * sequential index from a grouped bar chart this function can be used to convert that into',
'    * an appropriate group/index combination',
'    * ',
'    * @param nindex number The sequential index',
'    * @param data   array  The original data (which is grouped)',
'    * @return              The group/index information',
'    */',
'    RG.SVG.sequentialIndexToGrouped = function (index, data)',
'    {',
'        var group         = 0,',
'            grouped_index = 0;',
'        while (--index >= 0) {',
'            if (RG.SVG.isNull(data[group])) {',
'                group++;',
'                grouped_index = 0;',
'                continue;',
'            }',
'            // Allow for numbers as well as arrays in the dataset',
'            if (typeof data[group] == \'number\') {',
'                group++',
'                grouped_index = 0;',
'                continue;',
'            }',
'            grouped_index++;',
'            if (grouped_index >= data[group].length) {',
'                group++;',
'                grouped_index = 0;',
'            }',
'        }',
'        return [group, grouped_index];',
'    };',
'    //',
'    // This is the reverse of the above function - converting',
'    // group/index to a sequential index',
'    //',
'    // @return number The sequential index',
'    //',
'    RG.SVG.groupedIndexToSequential = function (opt)',
'    {',
'        var dataset = opt.dataset,',
'            index   = opt.index,',
'            obj     = opt.object;',
'        for (var i=0,seq=0; i<=dataset; ++i) {',
'            for (var j=0; j<obj.data[dataset].length; ++j) {',
'                if (i === dataset && j === index) {',
'                    return seq;',
'                }',
'                seq++;',
'            }',
'        }',
'        return seq;',
'    };',
'    //',
'    // This function converts coordinates into the type understood by',
'    // SVG for drawing arcs',
'    //',
'    RG.SVG.TRIG.toCartesian = function (options)',
'    {',
'        return {',
'            x: options.cx + (options.r * ma.cos(options.angle)),',
'            y: options.cy + (options.r * ma.sin(options.angle))',
'        };',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @patam object options The options/arg to the function',
'    //',
'    // NB ** Still used by the Pie chart and the semi-circular Meter **',
'    //',
'    RG.SVG.TRIG.getArcPath = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= 1.57;',
'        options.end   -= 1.57;',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start}',
'        );',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = options.end - options.start;',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        if (options.anticlockwise && diff > 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'0\';',
'        } else if (options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'0\';',
'        } else if (!options.anticlockwise && diff > 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'1\';',
'        } else if (!options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'1\';',
'        }',
'        if (options.start > options.end && options.anticlockwise && diff <= 3.14) {',
'            largeArc = \'0\';',
'            sweep    = \'0\';',
'        }',
'        if (options.start > options.end && options.anticlockwise && diff > 3.14) {',
'            largeArc = \'1\';',
'            sweep    = \'1\';',
'        }',
'        if (typeof options.moveto === \'boolean\' && options.moveto === false) {',
'            var d = [',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "M", start.x, start.y, ',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @patam object options The options/arg to the function',
'    //',
'    RG.SVG.TRIG.getArcPath2 = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= 1.57;',
'        options.end   -= 1.57;',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start',
'        });',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = ma.abs(options.end - options.start);',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        //TODO Put various options here for the correct combination of flags to use',
'        if (!options.anticlockwise) {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'1\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'1\';',
'            }',
'        } else {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'0\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'0\';',
'            }',
'        }',
'        if (typeof options.lineto === \'boolean\' && options.lineto === false) {',
'            var d = [',
'                "M", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "M", options.cx, options.cy,',
'                "L", start.x, start.y, ',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    //',
'    // Gets a path that is usable by the SVG A path command',
'    //',
'    // @param object options The options/arg to the function',
'    //',
'    RG.SVG.TRIG.getArcPath3 = function (options)',
'    {',
'        //',
'        // Make circles start at the top instead of the right hand side',
'        //',
'        options.start -= (ma.PI / 2);',
'        options.end   -= (ma.PI / 2);',
'        var start = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.start',
'        });',
'        var end = RG.SVG.TRIG.toCartesian({',
'            cx:    options.cx,',
'            cy:    options.cy,',
'            r:     options.r,',
'            angle: options.end',
'        });',
'        var diff = ma.abs(options.end - options.start);',
'        // Initial values',
'        var largeArc = \'0\';',
'        var sweep    = \'0\';',
'        //TODO Put various options here for the correct combination of flags to use',
'        if (!options.anticlockwise) {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'1\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'1\';',
'            }',
'        } else {',
'            if (diff > RG.SVG.TRIG.PI) {',
'                largeArc = \'1\';',
'                sweep    = \'0\';',
'            } else {',
'                largeArc = \'0\';',
'                sweep    = \'0\';',
'            }',
'        }',
'        if (typeof options.lineto === \'boolean\' && options.lineto === false) {',
'            var d = [',
'                "M", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        } else {',
'            var d = [',
'                "L", start.x, start.y,',
'                "A", options.r, options.r, 0, largeArc, sweep, end.x, end.y',
'            ];',
'        }',
'        if (options.array === true) {',
'            return d;',
'        } else {',
'            return d.join(" ");',
'        }',
'    };',
'    /**',
'    * This function gets the end point (X/Y coordinates) of a given radius.',
'    * You pass it the center X/Y and the radius and this function will return',
'    * the endpoint X/Y coordinates.',
'    * ',
'    * @param number cx    The center X coord',
'    * @param number cy    The center Y coord',
'    * @param number r     The length of the radius',
'    * @param number angle The anle to use',
'    */',
'    RG.SVG.TRIG.getRadiusEndPoint = function (opt)',
'    {',
'        // Allow for two arguments style',
'        if (arguments.length === 1) {',
'            var angle = opt.angle,',
'                r     = opt.r;',
'        } else if (arguments.length === 4) {',
'            var angle = arguments[0],',
'                r     = arguments[1];',
'        }',
'        var x = ma.cos(angle) * r,',
'            y = ma.sin(angle) * r;',
'        return [x, y];',
'    };',
'    /**',
'    * This function draws the title. This function also draws the subtitle.',
'    */',
'    RG.SVG.drawTitle = function (obj)',
'    {',
'        var prop                   = obj.properties,',
'            valign                 = \'bottom\',',
'            originalTitleX         = prop.titleX,',
'            originalTitleY         = prop.titleY,',
'            originalTitleSubtitleX = prop.titleSubtitleX,',
'            originalTitleSubtitleY = prop.titleSubtitleY;',
'        if (typeof originalTitleX === \'string\')         originalTitleX.replace(/^\\+/,\'\');',
'        if (typeof originalTitleY === \'string\')         originalTitleY.replace(/^\\+/,\'\');',
'        if (typeof originalTitleSubtitleX === \'string\') originalTitleSubtitleX.replace(/^\\+/,\'\');',
'        if (typeof originalTitleSubtitleY === \'string\') originalTitleSubtitleY.replace(/^\\+/,\'\');',
'        //',
'        // The Pie chart title should default to being above the centerx',
'        //',
'        if (obj.type === \'pie\') {',
'            if (RG.SVG.isNull(prop.titleX)) {',
'                prop.titleX         = obj.centerx;',
'                prop.titleSubtitleX = obj.centerx;',
'            }',
'            if (RG.SVG.isNull(prop.titleY)) {',
'                prop.titleY = obj.centery - obj.radius - 10;',
'            }',
'        }',
'        if (obj.scale && obj.scale.max <= 0 && obj.scale.min < 0 && typeof prop.titleY !== \'number\' && obj.type !== \'hbar\') {',
'            prop.titleY = obj.height - prop.gutterBottom + 10;',
'            var positionBottom = true;',
'            valign = \'top\';',
'        } else if (typeof prop.titleY !== \'number\') {',
'            var positionBottom = false;',
'            prop.titleY = prop.gutterTop - 10;',
'            valign      = \'bottom\';',
'            // Account for the key',
'            if (!RG.SVG.isNull(prop.key)) {',
'                prop.titleY -= (2 * (prop.keyTextSize || prop.textSize));',
'            }',
'        }',
'        // If a subtitle is specified move the title up a bit in',
'        // order to accommodate it',
'        if (prop.titleSubtitle && typeof prop.titleSubtitleY !== \'number\' && !positionBottom) {',
'            prop.titleY = prop.titleY - (prop.titleSubtitleSize * 1.5);',
'        }',
'        // Work out the subtitle size',
'        prop.titleSubTitleSize = prop.titleSubTitleSize || prop.textSize;',
'        // Work out the subtitle Y position',
'        prop.titleSubtitleY = prop.titleSubtitleY || prop.titleY + 18;',
'        if (positionBottom && typeof prop.titleSubtitleY !== \'number\') {',
'            prop.titleSubtitleY = prop.titleY + 26;',
'        }',
'        // Draw the title',
'        if (prop.title) {',
'            var x = typeof prop.titleX === \'number\' ? prop.titleX + (prop.variant3dOffsetx || 0) : prop.gutterLeft + (obj.graphWidth / 2) + (prop.variant3dOffsetx || 0);',
'            var y = prop.titleY + (prop.variant3dOffsety || 0);',
'            // Add any adjustment to the positioning',
'            if (typeof originalTitleX === \'string\') {',
'                x += parseFloat(originalTitleX);',
'            }',
'            if (typeof originalTitleY === \'string\') {',
'                y += parseFloat(originalTitleY);',
'            }',
'            RG.SVG.text({',
'                object: obj,',
'                svg:    obj.svg,',
'                parent: obj.svg.all,',
'                tag:    \'title\',',
'                text:   prop.title.toString(),',
'                size:   prop.titleSize   || (prop.textSize + 4) || 16,',
'                x:      x,',
'                y:      y,',
'                halign: prop.titleHalign || \'center\',',
'                valign: prop.titleValign || valign,',
'                color:  prop.titleColor  || prop.textColor || \'black\',',
'                bold:   prop.titleBold   || false,',
'                italic: prop.titleItalic || false,',
'                font:   prop.titleFont   || prop.textFont || \'Arial\'',
'            });',
'        }',
'        // Draw the subtitle',
'        if (typeof prop.title === \'string\' && typeof prop.titleSubtitle === \'string\') {',
'            // By default, the X and Y coordinates place the subtitle',
'            // underneath the title. Though the y coord is now adjusted',
'            // so that the subtitle sits underneath the title.',
'            y += (prop.titleSubtitleSize * 1.5);',
'            // Is the subtitleX or subtitleY are numbers then just use those',
'            if (typeof originalTitleSubtitleX === \'number\') {',
'                x = originalTitleSubtitleX;',
'            }',
'            if (typeof originalTitleSubtitleY === \'number\') {',
'                y = originalTitleSubtitleY;',
'            }',
'            // Add the subtitles adjustment to the position',
'            if (typeof originalTitleSubtitleX === \'string\') {',
'                x += parseFloat(originalTitleSubtitleX);',
'            }',
'            // Add the subtitles adjustment to the position',
'            if (typeof originalTitleSubtitleY === \'string\') {',
'                y += parseFloat(originalTitleSubtitleY);',
'            }',
'            RG.SVG.text({',
'                object: obj,',
'                svg: obj.svg,',
'                parent: obj.svg.all,',
'                tag:    \'subtitle\',',
'                text:   prop.titleSubtitle,',
'                size:   prop.titleSubtitleSize,',
'                x:      x,',
'                y:      y,',
'                halign: prop.titleSubtitleHalign || \'center\',',
'                valign: prop.titleSubtitleValign || valign,',
'                color:  prop.titleSubtitleColor  || prop.textColor || \'#aaa\',',
'                bold:   prop.titleSubtitleBold   || false,',
'                italic: prop.titleSubtitleItalic || false,',
'                font:   prop.titleSubtitleFont   || prop.textFont || \'Arial\'',
'            });',
'        }',
'    };',
'    /**',
'    * Removes white-space from the start and end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.trim = function (str)',
'    {',
'        return RG.SVG.ltrim(RG.SVG.rtrim(str));',
'    };',
'    /**',
'    * Trims the white-space from the start of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.ltrim = function (str)',
'    {',
'        return String(str).replace(/^(\\s|\\0)+/, \'\');',
'    };',
'    /**',
'    * Trims the white-space off of the end of a string',
'    * ',
'    * @param string str The string to trim',
'    */',
'    RG.SVG.rtrim = function (str)',
'    {',
'        return String(str).replace(/(\\s|\\0)+$/, \'\');',
'    };',
'    /**',
'    * This parses a single color value',
'    */',
'    RG.SVG.parseColorLinear = function (opt)',
'    {',
'        var obj   = opt.object,',
'            color = opt.color;',
'        if (!color || typeof color !== \'string\') {',
'            return color;',
'        }',
'        if (color.match(/^gradient\\((.*)\\)$/i)) {',
'            var parts = RegExp.$1.split(\':\'),',
'                diff  = 1 / (parts.length - 1);',
'            if (opt && opt.direction && opt.direction === \'horizontal\') {',
'                var grad = RG.SVG.create({',
'                    type: \'linearGradient\',',
'                    parent: obj.svg.defs,',
'                    attr: {',
'                        id: \'RGraph-linear-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                        x1: opt.start || 0,',
'                        x2: opt.end || \'100%\',',
'                        y1: 0,',
'                        y2: 0,',
'                        gradientUnits: "userSpaceOnUse"',
'                    }',
'                });',
'            } else {',
'                var grad = RG.SVG.create({',
'                    type: \'linearGradient\',',
'                    parent: obj.svg.defs,',
'                    attr: {',
'                        id: \'RGraph-linear-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                        x1: 0,',
'                        x2: 0,',
'                        y1: opt.start || 0,',
'                        y2: opt.end || \'100%\',',
'                        gradientUnits: "userSpaceOnUse"',
'                    }',
'                });',
'            }',
'            // Add the first color stop',
'            var stop = RG.SVG.create({',
'                type: \'stop\',',
'                parent: grad,',
'                attr: {',
'                    offset: \'0%\',',
'                    \'stop-color\': RG.SVG.trim(parts[0])',
'                }',
'            });',
'            // Add the rest of the color stops',
'            for (var j=1,len=parts.length; j<len; ++j) {',
'                RG.SVG.create({',
'                    type: \'stop\',',
'                    parent: grad,',
'                    attr: {',
'                        offset: (j * diff * 100) + \'%\',',
'                        \'stop-color\': RG.SVG.trim(parts[j])',
'                    }',
'                });',
'            }',
'        }',
'        color = grad ? \'url(#RGraph-linear-gradient-\' + obj.uid + \'-\' + (obj.gradientCounter++) + \')\' : color;',
'        return color;',
'    };',
'    /**',
'    * This parses a single color value',
'    */',
'    RG.SVG.parseColorRadial = function (opt)',
'    {',
'        var obj   = opt.object,',
'            color = opt.color;',
'        if (!color || typeof color !== \'string\') {',
'            return color;',
'        }',
'        if (color.match(/^gradient\\((.*)\\)$/i)) {',
'            var parts = RegExp.$1.split(\':\'),',
'                diff  = 1 / (parts.length - 1);',
'            var grad = RG.SVG.create({',
'                type: \'radialGradient\',',
'                parent: obj.svg.defs,',
'                attr: {',
'                    id: \'RGraph-radial-gradient-\' + obj.uid + \'-\' + obj.gradientCounter,',
'                    gradientUnits: opt.gradientUnits || \'userSpaceOnUse\',',
'                    cx: opt.cx || obj.centerx,',
'                    cy: opt.cy || obj.centery,',
'                    fx: opt.fx || obj.centerx,',
'                    fy: opt.fy || obj.centery,',
'                    r:  opt.r  || obj.radius',
'                }',
'            });',
'            // Add the first color stop',
'            var stop = RG.SVG.create({',
'                type: \'stop\',',
'                parent: grad,',
'                attr: {',
'                    offset: \'0%\',',
'                    \'stop-color\': RG.SVG.trim(parts[0])',
'                }',
'            });',
'            // Add the rest of the color stops',
'            for (var j=1,len=parts.length; j<len; ++j) {',
'                RG.SVG.create({',
'                    type: \'stop\',',
'                    parent: grad,',
'                    attr: {',
'                        offset: (j * diff * 100) + \'%\',',
'                        \'stop-color\': RG.SVG.trim(parts[j])',
'                    }',
'                });',
'            }',
'        }',
'        color = grad ? \'url(#RGraph-radial-gradient-\' + obj.uid + \'-\' + (obj.gradientCounter++) + \')\' : color;',
'        return color;',
'    };',
'    /**',
'    * Reset all of the color values to their original values',
'    * ',
'    * @param object',
'    */',
'    RG.SVG.resetColorsToOriginalValues = function (opt)',
'    {',
'        var obj = opt.object;',
'        if (obj.originalColors) {',
'            // Reset the colors to their original values',
'            for (var j in obj.originalColors) {',
'                if (typeof j === \'string\') {',
'                    obj.properties[j] = RG.SVG.arrayClone(obj.originalColors[j]);',
'                }',
'            }',
'        }',
'        /**',
'        * If the function is present on the object to reset specific',
'        * colors - use that',
'        */',
'        if (typeof obj.resetColorsToOriginalValues === \'function\') {',
'            obj.resetColorsToOriginalValues();',
'        }',
'        // Hmmm... Should this be necessary? I don\'t think it will',
'        // do any harm to leave it in.',
'        obj.originalColors = {};',
'        // Reset the colorsParsed flag so that they\'re parsed for gradients again',
'        obj.colorsParsed = false;',
'        // Reset the gradient counter',
'        obj.gradientCounter = 1;',
'    };',
'    //',
'    // Clear the SVG tag by deleting all of its',
'    // child nodes',
'    //',
'    // @param object svg The SVG tag (same as what is returned',
'    //                   by document.getElementById() )',
'    //',
'    RG.SVG.clear = function (svg)',
'    {',
'        // Clear all the layer nodes',
'        for (var i=1; i<=100; ++i) {',
'            if (svg[\'background\' + i]) {',
'                // Clear all the nodes within this group',
'                while (svg[\'background\' + i].lastChild) {',
'                    svg[\'background\' + i].removeChild(svg[\'background\' + i].lastChild);',
'                }',
'            } else {',
'                break;',
'            }',
'        }',
'        // Clear all the node within the "all" group',
'        while (svg.all.lastChild) {',
'            svg.all.removeChild(svg.all.lastChild);',
'        }',
'        // Clear Line chart hotspots',
'        if (svg.all.line_tooltip_hotspots) {',
'            while (svg.all.line_tooltip_hotspots.lastChild) {',
'                svg.all.line_tooltip_hotspots.removeChild(svg.all.line_tooltip_hotspots.lastChild);',
'            }',
'        }',
'    };',
'    /**',
'    * Adds an event listener',
'    * ',
'    * @param object obj   The graph object',
'    * @param string event The name of the event, eg ontooltip',
'    * @param object func  The callback function',
'    */',
'    RG.SVG.addCustomEventListener = function (obj, name, func)',
'    {',
'        // Initialise the events array if necessary',
'        if (typeof RG.SVG.events[obj.uid] === \'undefined\') {',
'            RG.SVG.events[obj.uid] = [];',
'        }',
'        // Prepend "on" if necessary',
'        if (name.substr(0, 2) !== \'on\') {',
'            name = \'on\' + name;',
'        }',
'        RG.SVG.events[obj.uid].push({',
'            object: obj,',
'            event:  name,',
'            func:   func',
'        });',
'        return RG.SVG.events[obj.uid].length - 1;',
'    };',
'    /**',
'    * Used to fire one of the RGraph custom events',
'    * ',
'    * @param object obj   The graph object that fires the event',
'    * @param string event The name of the event to fire',
'    */',
'    RG.SVG.fireCustomEvent = function (obj, name)',
'    {',
'        if (obj && obj.isRGraph) {',
'            var uid = obj.uid;',
'            if (   typeof uid === \'string\'',
'                && typeof RG.SVG.events === \'object\'',
'                && typeof RG.SVG.events[uid] === \'object\'',
'                && RG.SVG.events[uid].length > 0) {',
'                for(var j=0,len=RG.SVG.events[uid].length; j<len; ++j) {',
'                    if (RG.SVG.events[uid][j] && RG.SVG.events[uid][j].event === name) {',
'                        RG.SVG.events[uid][j].func(obj);',
'                    }',
'                }',
'            }',
'        }',
'    };',
'    /**',
'    * Clears all the custom event listeners that have been registered',
'    * ',
'    * @param string optional Limits the clearing to this object UID',
'    */',
'    RG.SVG.removeAllCustomEventListeners = function ()',
'    {',
'        var uid = arguments[0];',
'        if (uid && RG.SVG.events[uid]) {',
'            RG.SVG.events[uid] = {};',
'        } else {',
'            RG.SVG.events = [];',
'        }',
'    };',
'    /**',
'    * Clears a particular custom event listener',
'    * ',
'    * @param object obj The graph object',
'    * @param number i   This is the index that is return by .addCustomEventListener()',
'    */',
'    RG.SVG.removeCustomEventListener = function (obj, i)',
'    {',
'        if (   typeof RG.SVG.events === \'object\'',
'            && typeof RG.SVG.events[obj.uid] === \'object\'',
'            && typeof RG.SVG.events[obj.uid][i] === \'object\') {',
'            RG.SVG.events[obj.uid][i] = null;',
'        }',
'    };',
'    //',
'    // Removes the highlight from the chart added by tooltips (possibly others too)',
'    //',
'    RG.SVG.removeHighlight = function (obj)',
'    {',
'        var highlight = RG.SVG.REG.get(\'highlight\');',
'        if (highlight && RG.SVG.isArray(highlight) && highlight.length) {',
'            for (var i=0,len=highlight.length; i<len; ++i) {',
'                if (highlight[i].parentNode) {',
'                    //obj.svg.removeChild(highlight[i]);',
'                    highlight[i].parentNode.removeChild(highlight[i]);',
'                }',
'            }',
'        } else if (highlight && highlight.parentNode) {',
'            if (obj.type === \'scatter\') {',
'                highlight.setAttribute(\'fill\', \'transparent\');',
'            } else {',
'                highlight.parentNode.removeChild(highlight);',
'            }',
'        }',
'    };',
'    //',
'    // Removes the highlight from the chart added by tooltips (possibly others too)',
'    //',
'    RG.SVG.redraw = function ()',
'    {',
'        if (arguments.length === 1) {',
'            var svg = arguments[0];',
'            RG.SVG.clear(svg);',
'            var objects = RG.SVG.OR.get(\'id:\' + svg.parentNode.id);',
'            for (var i=0,len=objects.length; i<len; ++i) {',
'                // Reset the colors to the original values',
'                RG.SVG.resetColorsToOriginalValues({object: objects[i]});',
'                objects[i].draw();',
'            }',
'        } else {',
'            var tags = RG.SVG.OR.tags();',
'            for (var i in tags) {',
'                RG.SVG.redraw(tags[i]);',
'            }',
'        }',
'    };',
'    //',
'    // A better, more flexible, date parsing function',
'    //',
'    //@param  string str The string to parse',
'    //@return number     A number, as returned by Date.parse()',
'    //',
'    RG.SVG.parseDate = function (str)',
'    {',
'        var d = new Date();',
'        // Initialise the default values',
'        var defaults = {',
'            seconds: \'00\',',
'            minutes: \'00\',',
'            hours: \'00\',',
'            date: d.getDate(),',
'            month: d.getMonth() + 1,',
'            year: d.getFullYear()',
'        };',
'        // Create the months array for turning textual months back to numbers',
'        var months       = [\'january\',\'february\',\'march\',\'april\',\'may\',\'june\',\'july\',\'august\',\'september\',\'october\',\'november\',\'december\'],',
'            months_regex = months.join(\'|\');',
'        for (var i=0; i<months.length; ++i) {',
'            months[months[i]] = i;',
'            months[months[i].substring(0,3)] = i;',
'            months_regex = months_regex + \'|\' + months[i].substring(0,3);',
'        }',
'        // These are the seperators allowable for d/m/y and y/m/d dates',
'        // (Its part of a regexp so the position of the square brackets',
'        //  is crucial)',
'        var sep = \'[-./_=+~#:;,]+\';',
'        // Tokenise the string',
'        var tokens = str.split(/ +/);',
'        // Loop through each token checking what is is',
'        for (var i=0,len=tokens.length; i<len; ++i) {',
'            if (tokens[i]) {',
'                // Year',
'                if (tokens[i].match(/^\\d\\d\\d\\d$/)) {',
'                    defaults.year = tokens[i];',
'                }',
'                // Month',
'                var res = isMonth(tokens[i]);',
'                if (typeof res === \'number\') {',
'                    defaults.month = res + 1; // Months are zero indexed',
'                }',
'                // Date',
'                if (tokens[i].match(/^\\d?\\d(?:st|nd|rd|th)?$/)) {',
'                    defaults.date = parseInt(tokens[i]);',
'                }',
'                // Time',
'                if (tokens[i].match(/^(\\d\\d):(\\d\\d):?(?:(\\d\\d))?$/)) {',
'                    defaults.hours   = parseInt(RegExp.$1);',
'                    defaults.minutes = parseInt(RegExp.$2);',
'                    if (RegExp.$3) {',
'                        defaults.seconds = parseInt(RegExp.$3);',
'                    }',
'                }',
'                // Dateformat: XXXX-XX-XX',
'                if (tokens[i].match(new RegExp(\'^(\\\\d\\\\d\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)$\', \'i\'))) {',
'                    defaults.date  = parseInt(RegExp.$3);',
'                    defaults.month = parseInt(RegExp.$2);',
'                    defaults.year  = parseInt(RegExp.$1);',
'                }',
'                // Dateformat: XX-XX-XXXX',
'                if (tokens[i].match(new RegExp(\'^(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d)\' + sep + \'(\\\\d\\\\d\\\\d\\\\d)$\',\'i\') )) {',
'                    defaults.date  = parseInt(RegExp.$1);',
'                    defaults.month = parseInt(RegExp.$2);',
'                    defaults.year  = parseInt(RegExp.$3);',
'                }',
'            }',
'        }',
'        // Now put the defaults into a format thats recognised by Date.parse()',
'        str = \'{1}/{2}/{3} {4}:{5}:{6}\'.format(',
'            defaults.year,',
'            String(defaults.month).length     === 1 ? \'0\' + (defaults.month) : defaults.month,',
'            String(defaults.date).length      === 1 ? \'0\' + (defaults.date)      : defaults.date,',
'            String(defaults.hours).length     === 1 ? \'0\' + (defaults.hours)     : defaults.hours,',
'            String(defaults.minutes).length   === 1 ? \'0\' + (defaults.minutes)   : defaults.minutes,',
'            String(defaults.seconds).length   === 1 ? \'0\' + (defaults.seconds)   : defaults.seconds',
'        );',
'        return Date.parse(str);',
'        //',
'        // Support functions',
'        //',
'        function isMonth(str)',
'        {',
'            var res = str.toLowerCase().match(months_regex);',
'            return res ? months[res[0]] : false;',
'        }',
'    };',
'    // The ObjectRegistry add function',
'    RG.SVG.OR.add = function (obj)',
'    {',
'        RG.SVG.OR.objects.push(obj);',
'        return obj;',
'    };',
'    // The ObjectRegistry function that returns all of the objects. Th argument',
'    // can aither be:',
'    //',
'    // o omitted  All of the registered objects are returned',
'    // o id:XXX  All of the objects on that SVG tag are returned',
'    // o type:XXX All the objects of that type are returned',
'    //',
'    RG.SVG.OR.get = function ()',
'    {',
'        // Fetch objects that are on a particular SVG tag',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 3).toLowerCase() === \'id:\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].id === arguments[0].substr(3)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        // Fetch objects that are of a particular type',
'        //',
'        // TODO Allow multiple types to be specified',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 4).toLowerCase() === \'type\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].type === arguments[0].substr(5)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        // Fetch an object that has a specific UID',
'        if (typeof arguments[0] === \'string\' && arguments[0].substr(0, 3).toLowerCase() === \'uid\') {',
'            var ret = [];',
'            for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'                if (RG.SVG.OR.objects[i].uid === arguments[0].substr(4)) {',
'                    ret.push(RG.SVG.OR.objects[i]);',
'                }',
'            }',
'            return ret;',
'        }',
'        return RG.SVG.OR.objects;',
'    };',
'    // The ObjectRegistry function that returns all of the registeredt SVG tags',
'    //',
'    RG.SVG.OR.tags = function ()',
'    {',
'        var tags = [];',
'        for (var i=0; i<RG.SVG.OR.objects.length; ++i) {',
'            if (!tags[RG.SVG.OR.objects[i].svg.parentNode.id]) {',
'                tags[RG.SVG.OR.objects[i].svg.parentNode.id] = RG.SVG.OR.objects[i].svg;',
'            }',
'        }',
'        return tags;',
'    };',
'    //',
'    // This function returns a two element array of the SVG x/y position in',
'    // relation to the page',
'    // ',
'    // @param object svg',
'    //',
'    RG.SVG.getSVGXY = function (svg)',
'    {',
'        var x  = 0,',
'            y  = 0,',
'            el = svg.parentNode; // !!!',
'        do {',
'            x += el.offsetLeft;',
'            y += el.offsetTop;',
'            // Account for tables in webkit',
'            if (el.tagName.toLowerCase() == \'table\' && (RG.SVG.ISCHROME || RG.SVG.ISSAFARI)) {',
'                x += parseInt(el.border) || 0;',
'                y += parseInt(el.border) || 0;',
'            }',
'            el = el.offsetParent;',
'        } while (el && el.tagName && el.tagName.toLowerCase() != \'body\');',
'        var paddingLeft = svg.style.paddingLeft ? parseInt(svg.style.paddingLeft) : 0,',
'            paddingTop  = svg.style.paddingTop ? parseInt(svg.style.paddingTop) : 0,',
'            borderLeft  = svg.style.borderLeftWidth ? parseInt(svg.style.borderLeftWidth) : 0,',
'            borderTop   = svg.style.borderTopWidth  ? parseInt(svg.style.borderTopWidth) : 0;',
'        if (navigator.userAgent.indexOf(\'Firefox\') > 0) {',
'            x += parseInt(document.body.style.borderLeftWidth) || 0;',
'            y += parseInt(document.body.style.borderTopWidth) || 0;',
'        }',
'        return [x + paddingLeft + borderLeft, y + paddingTop + borderTop];',
'    };',
'    //',
'    // This function is a compatibility wrapper around',
'    // the requestAnimationFrame function.',
'    //',
'    // @param function func The function to give to the',
'    //                      requestAnimationFrame function',
'    //',
'    RG.SVG.FX.update = function (func)',
'    {',
'        win.requestAnimationFrame =',
'            win.requestAnimationFrame ||',
'            win.webkitRequestAnimationFrame ||',
'            win.msRequestAnimationFrame ||',
'            win.mozRequestAnimationFrame ||',
'            (function (func){setTimeout(func, 16.666);});',
'        win.requestAnimationFrame(func);',
'    };',
'    /**',
'    * This function returns an easing multiplier for effects so they eas out towards the',
'    * end of the effect.',
'    * ',
'    * @param number frames The total number of frames',
'    * @param number frame  The frame number',
'    */',
'    RG.SVG.FX.getEasingMultiplier = function (frames, frame)',
'    {',
'        var multiplier = ma.pow(ma.sin((frame / frames) * RG.SVG.TRIG.HALFPI), 3);',
'        return multiplier;',
'    };',
'    /**',
'    * Measures text by creating a DIV in the document and adding the relevant',
'    * text to it, then checking the .offsetWidth and .offsetHeight.',
'    * ',
'    * @param  object opt An object containing the following:',
'    *                        o text( string) The text to measure',
'    *                        o bold (bool)   Whether the text is bold or not',
'    *                        o font (string) The font to use',
'    *                        o size (number) The size of the text (in pts)',
'    * ',
'    * @return array         A two element array of the width and height of the text',
'    */',
'    RG.SVG.measureText = function (opt)',
'    {',
'        //text, bold, font, size',
'        var text = opt.text || \'\',',
'            bold = opt.bold || false,',
'            font = opt.font || \'Arial\',',
'            size = opt.size || 10,',
'            str  = text + \':\' + bold + \':\' + font + \':\' + size;',
'        // Add the sizes to the cache as adding DOM elements is costly and causes slow downs',
'        if (typeof RG.SVG.measuretext_cache === \'undefined\') {',
'            RG.SVG.measuretext_cache = [];',
'        }',
'        if (typeof RG.SVG.measuretext_cache == \'object\' && RG.SVG.measuretext_cache[str]) {',
'            return RG.SVG.measuretext_cache[str];',
'        }',
'        if (!RG.SVG.measuretext_cache[\'text-span\']) {',
'            var span = document.createElement(\'SPAN\');',
'                span.style.position = \'absolute\';',
'                //span.style.backgroundColor = \'red\';',
'                span.style.padding    = 0;',
'                span.style.display    = \'inline\';',
'                span.style.top        = \'-200px\';',
'                span.style.left       = \'-200px\';',
'                span.style.lineHeight = \'1em\';',
'            document.body.appendChild(span);',
'            // Now store the newly created DIV',
'            RG.SVG.measuretext_cache[\'text-span\'] = span;',
'        } else if (RG.SVG.measuretext_cache[\'text-span\']) {',
'            var span = RG.SVG.measuretext_cache[\'text-span\'];',
'        }',
'        span.innerHTML        = text.replace(/\\r?\\n/g, \'<br />\');',
'        span.style.fontFamily = font;',
'        span.style.fontWeight = bold ? \'bold\' : \'normal\';',
'        span.style.fontSize   = String(size).replace(/pt$/, \'\') + \'pt\';',
'        var sizes = [span.offsetWidth, span.offsetHeight];',
'        //document.body.removeChild(span);',
'        RG.SVG.measuretext_cache[str] = sizes;',
'        return sizes;',
'    };',
'    /**',
'    * This function converts an array of strings to an array of numbers. Its used by the meter/gauge',
'    * style charts so that if you want you can pass in a string. It supports various formats:',
'    * ',
'    * \'45.2\'',
'    * \'-45.2\'',
'    * [\'45.2\']',
'    * [\'-45.2\']',
'    * \'45.2,45.2,45.2\' // A CSV style string',
'    * ',
'    * @param number frames The string or array to parse',
'    */',
'    RG.SVG.stringsToNumbers = function (str)',
'    {',
'        // An optional seperator to use intead of a comma',
'        var sep = arguments[1] || \',\';',
'        // If it\'s already a number just return it',
'        if (typeof str === \'number\') {',
'            return str;',
'        }',
'        if (typeof str === \'string\') {',
'            if (str.indexOf(sep) != -1) {',
'                str = str.split(sep);',
'            } else {',
'                str = parseFloat(str);',
'            }',
'        }',
'        if (typeof str === \'object\') {',
'            for (var i=0,len=str.length; i<len; i+=1) {',
'                str[i] = parseFloat(str[i]);',
'            }',
'        }',
'        return str;',
'    };',
'    // This function allows for numbers that are given as a +/- adjustment',
'    RG.SVG.getAdjustedNumber = function (opt)',
'    {',
'        var value = opt.value,',
'            prop  = opt.prop;',
'        if (typeof prop === \'string\' && match(/^(\\+|-)([0-9.]+)/)) {',
'            if (RegExp.$1 === \'+\') {',
'                value += parseFloat(RegExp.$2);',
'            } else if (RegExp.$1 === \'-\') {',
'                value -= parseFloat(RegExp.$2);',
'            }',
'        }',
'        return value;',
'    };',
'    // NOT USED ANY MORE',
'    RG.SVG.attribution=function(){return;};',
'    /**',
'    * Parse a gradient and returns the various parts',
'    * ',
'    * @param string str The gradient string',
'    */',
'    RG.SVG.parseGradient = function (str)',
'    {',
'    };',
'    /**',
'    * Generates a random number between the minimum and maximum',
'    * ',
'    * @param number min The minimum value',
'    * @param number max The maximum value',
'    * @param number     OPTIONAL Number of decimal places',
'    */',
'    RG.SVG.random = function (opt)',
'    {',
'        var min = opt.min,',
'            max = opt.max,',
'            dp  = opt.dp || opt.decimals || 0,',
'            r   = ma.random();',
'        return Number((((max - min) * r) + min).toFixed(dp));',
'    };',
'    /**',
'    * Fill an array full of random numbers',
'    */',
'    RG.SVG.arrayRand    =',
'    RG.SVG.arrayRandom  =',
'    RG.SVG.random.array = function (opt)',
'    {',
'        var num = opt.num,',
'            min = opt.min,',
'            max = opt.max,',
'            dp  = opt.dp || opt.decimals || 0;',
'        for(var i=0,arr=[]; i<num; i+=1) {',
'            arr.push(RG.SVG.random({min: min, max: max, dp: dp}));',
'        }',
'        return arr;',
'    };',
'    //',
'    // This function is called by each objects setter so that common BC',
'    // and adjustments are centralised. And there\'s less typing for me too.',
'    //',
'    // @param object opt An object of options to the function, which are:',
'    //                    object: The chart object',
'    //                    name:   The name of the config parameter',
'    //                    value:  The value thats being set',
'    //',
'    RG.SVG.commonSetter = function (opt)',
'    {',
'        var obj   = opt.object,',
'            name  = opt.name,',
'            value = opt.value;',
'        // The default event for tooltips is click',
'        if (name === \'tooltipsEvent\'&& value !== \'click\' && value !== \'mousemove\') {',
'            value = \'click\';',
'        }',
'        return {',
'            name:  name,',
'            value: value',
'        };',
'    };',
'    //',
'    // Generates logs for... log charts',
'    //',
'    // @param object opt The options:',
'    //                     o num  The number',
'    //                     o base The base',
'    //',
'    RG.SVG.log = function (opt)',
'    {',
'        var num  = opt.num,',
'            base = opt.base;',
'        return ma.log(num) / (base ? ma.log(base) : 1);',
'    };',
'    RG.SVG.donut = function (opt)',
'    {',
'        var arcPath1 = RG.SVG.TRIG.getArcPath3({',
'            cx: opt.cx,',
'            cy: opt.cy,',
'            r: opt.outerRadius,',
'            start: 0,',
'            end: RG.SVG.TRIG.TWOPI,',
'            anticlockwise: false,',
'            lineto: false',
'        });',
'        var arcPath2 = RG.SVG.TRIG.getArcPath3({',
'            cx: opt.cx,',
'            cy: opt.cy,',
'            r: opt.innerRadius,',
'            start: RG.SVG.TRIG.TWOPI,',
'            end: 0,',
'            anticlockwise: true,',
'            lineto: false',
'        });',
'        //',
'        // Create the red circle',
'        //',
'        var path = RG.SVG.create({',
'            svg: opt.svg,',
'            type: \'path\',',
'            attr: {',
'                d: arcPath1 + arcPath2,',
'                stroke: opt.stroke,',
'                fill: opt.fill',
'            }',
'        });',
'        return path;',
'    };',
'    //',
'    // Copy the globals (if any have been set) from the global object to',
'    // this instances configuration',
'    //',
'    RG.SVG.getGlobals = function (obj)',
'    {',
'        var prop = obj.properties;',
'        for (i in RG.SVG.GLOBALS) {',
'            if (typeof i === \'string\') {',
'                prop[i] = RG.SVG.arrayClone(RG.SVG.GLOBALS[i]);',
'            }',
'        }',
'    };',
'    //',
'    // This function adds a link to the SVG document',
'    //',
'    // @param object opt The various options to the function',
'    //',
'    RG.SVG.link = function (opt)',
'    {',
'        var a = RGraph.SVG.create({',
'            svg: bar.svg,',
'            type: \'a\',',
'            parent: bar.svg.all,',
'            attr: {',
'                \'xlink:href\': href,',
'                target:       target',
'            }',
'        });',
'        var text = RGraph.SVG.create({',
'            svg: bar.svg,',
'            type: \'text\',',
'            parent: a,',
'            attr: {',
'                x: x,',
'                y: y,',
'                fill: fill',
'            }',
'        });',
'        text.innerHTML = text;',
'    };',
'    // This function is used to get the errorbar MAXIMUM value. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsMaxValue = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'number\') {',
'            var value = prop.errorbars[index];',
'        } else if (   typeof prop.errorbars === \'object\'',
'                   && !RG.SVG.isNull(prop.errorbars)',
'                   && typeof prop.errorbars[index] === \'object\'',
'                   && !RG.SVG.isNull(prop.errorbars[index])',
'                   && typeof prop.errorbars[index].max === \'number\'',
'                  ) {',
'            var value = prop.errorbars[index].max;',
'        } else {',
'            var value = 0;',
'        }',
'        return value;',
'    };',
'    // This function is used to get the errorbar MINIMUM value. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsMinValue = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        if (   typeof prop.errorbars === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars)',
'            && typeof prop.errorbars[index] === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars[index])',
'            && typeof prop.errorbars[index].min === \'number\'',
'           ) {',
'            var value = prop.errorbars[index].min;',
'        } else {',
'            var value = null;',
'        }',
'        return value;',
'    };',
'    // This function is used to get the errorbar color. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsColor = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var color = prop.errorbarsColor || \'black\';',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'object\' && !RG.SVG.isNull(prop.errorbars[index]) && typeof prop.errorbars[index].color === \'string\') {',
'            color = prop.errorbars[index].color;',
'        }',
'        return color;',
'    };',
'    // This function is used to get the errorbar linewidth. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsLinewidth = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var linewidth = prop.errorbarsLinewidth || 1',
'        if (typeof prop.errorbars === \'object\' && !RG.SVG.isNull(prop.errorbars) && typeof prop.errorbars[index] === \'object\' && !RG.SVG.isNull(prop.errorbars[index]) && typeof prop.errorbars[index].linewidth === \'number\') {',
'            linewidth = prop.errorbars[index].linewidth;',
'        }',
'        return linewidth;',
'    };',
'    // This function is used to get the errorbar capWidth. Its in the common',
'    // file because it\'s used by multiple chart libraries',
'    //',
'    // @param object opt An object containing the arguments to the function',
'    //         o object: The chart object',
'    //         o index:  The index to fetch',
'    RG.SVG.getErrorbarsCapWidth = function (opt)',
'    {',
'        var obj   = opt.object,',
'            prop  = obj.properties,',
'            index = opt.index;',
'        var capwidth = prop.errorbarsCapwidth || 10',
'        if (   typeof prop.errorbars === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars)',
'            && typeof prop.errorbars[index] === \'object\'',
'            && !RG.SVG.isNull(prop.errorbars[index])',
'            && typeof prop.errorbars[index].capwidth === \'number\'',
'            ) {',
'            capwidth = prop.errorbars[index].capwidth;',
'        }',
'        return capwidth;',
'    };',
'    //',
'    // This is here so that if the tooltip library has not',
'    // been included, this function will show an alert',
'    //informing the user',
'    //',
'    if (typeof RG.SVG.tooltip !== \'function\') {',
'        RG.SVG.tooltip = function ()',
'        {',
'            $$a(\'The tooltip library has not been included!\');',
'        };',
'    }',
'// End module pattern',
'})(window, document);',
'/**',
'* Loosly mimicks the PHP function print_r();',
'*/',
'window.$p = function (obj)',
'{',
'    var indent = (arguments[2] ? arguments[2] : \'    \');',
'    var str    = \'\';',
'    var counter = typeof arguments[3] == \'number\' ? arguments[3] : 0;',
'    if (counter >= 5) {',
'        return \'\';',
'    }',
'    switch (typeof obj) {',
'        case \'string\':    str += obj + \' (\' + (typeof obj) + \', \' + obj.length + \')\'; break;',
'        case \'number\':    str += obj + \' (\' + (typeof obj) + \')\'; break;',
'        case \'boolean\':   str += obj + \' (\' + (typeof obj) + \')\'; break;',
'        case \'function\':  str += \'function () {}\'; break;',
'        case \'undefined\': str += \'undefined\'; break;',
'        case \'null\':      str += \'null\'; break;',
'        case \'object\':',
'            // In case of null',
'            if (RGraph.SVG.isNull(obj)) {',
'                str += indent + \'null\\n\';',
'            } else {',
'                str += indent + \'Object {\' + \'\\n\'',
'                for (j in obj) {',
'                    str += indent + \'    \' + j + \' => \' + window.$p(obj[j], true, indent + \'    \', counter + 1) + \'\\n\';',
'                }',
'                str += indent + \'}\';',
'            }',
'            break;',
'        default:',
'            str += \'Unknown type: \' + typeof obj + \'\';',
'            break;',
'    }',
'    /**',
'    * Finished, now either return if we\'re in a recursed call, or alert()',
'    * if we\'re not.',
'    */',
'    if (!arguments[1]) {',
'        alert(str);',
'    }',
'    return str;',
'};',
'/**',
'* A shorthand for the default alert() function',
'*/',
'window.$$a = function (v)',
'{',
'    alert(v);',
'};',
'/**',
'* Short-hand for console.log',
'* ',
'* @param mixed v The variable to log to the console',
'*/',
'window.$cl = function (v)',
'{',
'    return console.log(v);',
'};',
'/**',
'* A basic string formatting function. Use it like this:',
'* ',
'* var str = \'{1} {2} {3}\'.format(\'a\', \'b\', \'c\');',
'* ',
'* Outputs: a b c',
'*/',
'if (!String.prototype.format) {',
'  String.prototype.format = function()',
'  {',
'    var args = arguments;',
'    return this.replace(/{(\\d+)}/g, function(str, idx)',
'    {',
'      return typeof args[idx - 1] !== \'undefined\' ? args[idx - 1] : str;',
'    });',
'  };',
'};',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph = window.RGraph || {isRGraph: true};',
'    RGraph.CSV = function (url, func)',
'    {',
'        var RG  = RGraph,',
'            ua  = navigator.userAgent,',
'            ma  = Math;',
'        /**',
'        * Some default values',
'        */',
'        this.url       = url;',
'        this.ready     = func;',
'        this.data      = null;',
'        this.numrows   = null;',
'        this.numcols   = null;',
'        this.seperator = arguments[2] || \',\';',
'        this.endofline = arguments[3] || /\\r?\\n/;',
'        /**',
'        * A Custom split function',
'        * ',
'        * @param string str  The CSV string to split',
'        * @param mixed  char The character to split on - or it can also be an object like this:',
'        *                    {',
'        *                        preserve: false, // Whether to preserve whitespace',
'        *                        char: \',\'        // The character to split on',
'        *                    }',
'        */',
'        this.splitCSV = function (str, split)',
'        {',
'            // Defaults',
'            var arr            = [];',
'            var field          = \'\';',
'            var inDoubleQuotes = false;',
'            var inSingleQuotes = false;',
'            var preserve       = (typeof split === \'object\' && split.preserve) ? true : false;',
'            // The character to split the CSV string on',
'            if (typeof split === \'object\') {',
'                if (typeof split.char === \'string\') {',
'                    split = split.char;',
'                } else {',
'                    split = \',\';',
'                }',
'            } // If not an object just leave the char as it\'s supplied',
'            for (var i=0,len=str.length; i<len; i+=1) {',
'                char = str.charAt(i);',
'                if ( (char === \'"\') && !inDoubleQuotes) {',
'                    inDoubleQuotes = true;',
'                    continue;',
'                } else if ( (char === \'"\') && inDoubleQuotes) {',
'                    inDoubleQuotes = false;',
'                    continue;',
'                }',
'                if ( (char === "\'") && !inSingleQuotes) {',
'                    inSingleQuotes = true;',
'                    continue;',
'                } else if ( (char === "\'") && inSingleQuotes) {',
'                    inSingleQuotes = false;',
'                    continue;',
'                } else if (char === split && !inDoubleQuotes && !inSingleQuotes) {',
'// TODO look ahead in order to allow for multi-character seperators',
'                    arr.push(field);',
'                    field = \'\';',
'                    continue;',
'                } else {',
'                    field = field + char;',
'                }',
'            }',
'            // Add the last field',
'            arr.push(field);',
'            // Now trim each value if necessary',
'            if (!preserve) {',
'                for (i=0,len=arr.length; i<len; i+=1) {',
'                    arr[i] = arr[i].trim();',
'                }',
'            }',
'            return arr;',
'        };',
'        /**',
'        * This function splits the CSV data into an array so that it can be useful.',
'        */',
'        this.fetch = function ()',
'        {',
'            var sep = this.seperator,',
'                eol = this.endofline,',
'                obj = this;',
'            if (this.url.substring(0,3) === \'id:\' || this.url.substring(0,4) === \'str:\') {',
'                // Get rid of any surrounding whitespace',
'                if (this.url.substring(0,3) === \'id:\') {',
'                    var data = document.getElementById(this.url.substring(3)).innerHTML.trim();',
'                } else if (this.url.substring(0,4) === \'str:\') {',
'                    var data = this.url.substring(4).trim();',
'                }',
'                // Store the CSV data on the CSV object (ie - this object)',
'                obj.data = data.split(eol);',
'                // Store the number of rows',
'                obj.numrows = obj.data.length;',
'                for (var i=0,len=obj.data.length; i<len; i+=1) {',
'                    /**',
'                    * Split the individual line',
'                    */',
'                    //var row = obj.data[i].split(sep);',
'                    var row = obj.splitCSV(obj.data[i], {preserve: false, char: sep});',
'                    if (!obj.numcols) {',
'                        obj.numcols = row.length;',
'                    }',
'                    /**',
'                    * If the cell is purely made up of numbers - convert it',
'                    */',
'                    for (var j=0; j<row.length; j+=1) {',
'                        if ((/^\\-?[0-9.]+$/).test(row[j])) {',
'                            row[j] = parseFloat(row[j]);',
'                        }',
'                        // Assign the split-up-row back to the data array',
'                        obj.data[i] = row;',
'                    }',
'                }',
'                // Call the ready function straight away',
'                obj.ready(obj);',
'            } else {',
'                RGraph.SVG.AJAX.getString(this.url, function (data)',
'                {',
'                    data = data.replace(/(\\r?\\n)+$/, \'\');',
'                    /**',
'                    * Split the lines in the CSV',
'                    */',
'                    obj.data = data.split(eol);',
'                    /**',
'                    * Store the number of rows',
'                    */',
'                    obj.numrows = obj.data.length;',
'                    /**',
'                    * Loop thru each lines in the CSV file',
'                    */',
'                    for (var i=0,len=obj.data.length; i<len; i+=1) {',
'                        /**',
'                        * Use the new split function to split each row NOT preserving whitespace',
'                        */',
'                        //var row = obj.data[i].split(sep);',
'                        var row = obj.splitCSV(obj.data[i], {preserve: false, char: sep});',
'                        if (!obj.numcols) {',
'                            obj.numcols = row.length;',
'                        }',
'                        /**',
'                        * If the cell is purely made up of numbers - convert it',
'                        */',
'                        for (var j=0; j<row.length; j+=1) {',
'                            if ((/^\\-?[0-9.]+$/).test(row[j])) {',
'                                row[j] = parseFloat(row[j]);',
'                            }',
'                            // Assign the split-up-row back to the data array',
'                            obj.data[i] = row;',
'                        }',
'                    }',
'                    // Call the ready function straight away',
'                    obj.ready(obj);',
'                });',
'            }',
'        };',
'        /**',
'        * Returns a row of the CSV file',
'        * ',
'        * @param number index The index of the row to fetch',
'        * @param        start OPTIONAL If desired you can specify a column to start at (which starts at 0 by default)',
'        */',
'        this.getRow = function (index)',
'        {',
'            var row   = [];',
'            var start = arguments[1] || 0;',
'            for (var i=start; i<this.numcols; i+=1) {',
'                row.push(this.data[index][i]);',
'            }',
'            return row;',
'        };',
'        /**',
'        * Returns a column of the CSV file',
'        * ',
'        * @param number index The index of the column to fetch',
'        * @param        start OPTIONAL If desired you can specify a row to start at (which starts at 0 by default)',
'        */',
'        this.getCol =',
'        this.getColumn = function (index)',
'        {',
'            var col   = [];',
'            var start = arguments[1] || 0;',
'            for (var i=start; i<this.numrows; i+=1) {',
'                col.push(this.data[i][index]);',
'            }',
'            return col;',
'        };',
'        // Fetch the CSV file',
'        this.fetch();',
'    };;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * This is a library of a few functions that make it easier to do',
'    * effects like fade-ins or eaxpansion.',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph        = window.RGraph || {isRGraph: true};',
'    RGraph.SVG    = RGraph.SVG    || {};',
'    RGraph.SVG.FX = RGraph.SVG.FX || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG = RGraph,',
'        ua = navigator.userAgent,',
'        ma = Math;',
'    /**',
'    * This functions adds the generic effects to thechart object',
'    * ',
'    * @param object obj The chart object',
'    */',
'    RG.SVG.FX.decorate = function (obj)',
'    {',
'        for (i in RG.SVG.FX) {',
'            if (typeof RG.SVG.FX[i] === \'function\') {',
'                obj[i] = RG.SVG.FX[i];',
'            }',
'        }',
'    };',
'    /**',
'    * fadeIn',
'    * ',
'    * This function simply uses the CSS opacity property - initially set to zero and',
'    * increasing to 1 over the period of 0.5 second',
'    */',
'    RG.SVG.FX.fadein = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {};',
'        // Initially the opacity should be zero',
'        obj.svg.style.opacity = 0;',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Now fade the chart in',
'        for (var i=1; i<=frames; ++i) {',
'            (function (index)',
'            {',
'                setTimeout(function ()',
'                {',
'                    obj.svg.style.opacity = (index / frames);',
'                    if (index >= frames) {',
'                        callback(obj);',
'                    }',
'                }, (index / frames) * duration);',
'            })(i)',
'        }',
'        return this;',
'    };',
'    /**',
'    * fadeOut',
'    * ',
'    * This function is a reversal of the above function - fading out instead of in',
'    */',
'    RG.SVG.FX.fadeout = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {};',
'         //RG.SVG.redraw()',
'        // Now fade the chart out',
'        for (var i=1; i<=frames; ++i) {',
'            (function (index)',
'            {',
'                setTimeout(function ()',
'                {',
'                    obj.svg.style.opacity = 1 - (index / frames);',
'                    if (index >= frames) {',
'                        callback(obj);',
'                    }',
'                }, (index / frames) * duration);',
'            })(i)',
'        }',
'        return this;',
'    };',
'    /**',
'    * fadeSlideIn',
'    * ',
'    * This function fades the canvas in in a sliding motion',
'    */',
'    RG.SVG.FX.fadeslidein = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            pc       = -20,',
'            step     = (120 - pc) / frames,',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'linear-gradient(135deg, rgba(255,255,255,0) \' + pc + \'%, \' + color + \' \' + (pc + 20) + \'%)\',',
'            width:      width  + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(this.container));',
'        function iterator ()',
'        {',
'            if (pc < 120) {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                    background: \'linear-gradient(135deg, rgba(255,255,255,0) \' + pc + \'%, \' + color + \' \' + (pc + 20) + \'%)\'',
'                });',
'                pc += step;',
'                RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeSlideOut',
'    //',
'    // Fades the canvas out in a sliding motion. This function gets added',
'    // to the chart object - so the this variable is the chart object',
'    //',
'    RG.SVG.FX.fadeslideout = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            pc       = -20,',
'            step     = (120 - pc) / frames,',
'            canvasXY = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'linear-gradient(135deg, \' + color + \' \' + pc + \'%, rgba(255,255,255,0) \' + (pc + 20) + \'%)\',',
'            width:      width + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (pc < 120) {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                                                               background: \'linear-gradient(135deg, \' + color + \' \' + pc + \'%, rgba(255,255,255,0) \' + (pc + 20) + \'%)\'',
'                                                              });',
'                pc += step;',
'                RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeCircularIn',
'    // ',
'    // This function uses radial CSS gradients to cover the canvas with a radial fade in effect',
'    // (from the center outwards)',
'    //',
'    RG.SVG.FX.fadecircularinoutwards = function ()',
'    {',
'        // This function gets added to the chart object - so the \'this\'',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 1,',
'            radius   = 0,',
'            svgXY    = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadecircularinoutwards_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, \' + color + \' \' + radius + \'%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadecircularinoutwards_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(rgba(255,255,255,0) \' + ((frame++ / frames) * 100) + \'%, \' + color + \' \' + ((frame++ / frames) * 150) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadecircularinoutwards_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadecircularoutoutwards',
'    // ',
'    // This function uses radial CSS gradients to cover the canvas with a radial fade out effect',
'    // (from the center outwards)',
'    //',
'    RG.SVG.FX.fadecircularoutoutwards = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            width    = this.container.offsetWidth,',
'            height   = this.container.offsetHeight,',
'            canvasXY = RG.SVG.getSVGXY(obj.svg),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, transparent 0%)\',',
'            width:      width + \'px\',',
'            height:     height + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(\' + color + \' \' + ((frame++ / frames) * 100) + \'%, rgba(255,255,255,0) \' + ((frame++ / frames) * 150) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadeCircularInInwards',
'    //',
'    // This function gets added to the chart object - so the \'this\'',
'    // variable is the chart object',
'    //',
'    RG.SVG.FX.fadecircularininwards = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            radius   = ma.max(',
'                obj.container.offsetWidth,',
'                obj.container.offsetHeight',
'            ),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + obj.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 100%, rgba(255,255,255,0) 0%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(\' + color + \' \' + (( (frames - frame++) / frames) * 100) + \'%, rgba(255,255,255,0) \' + (( (frames - frame++) / frames) * 120) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // fadecircularoutinwards',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    //',
'    RG.SVG.FX.fadecircularoutinwards = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            frame    = 0,',
'            radius   = ma.max(',
'                this.container.offsetWidth,',
'                this.container.offsetHeight',
'            ),',
'            color    = opt.color || \'white\',',
'            callback = opt.callback || function () {};',
'        // Draw the chart',
'        //RG.SVG.redraw(this.svg);',
'        // Create the cover',
'        $(\'<div id="rgraph_fadeslide_cover_\' + this.id + \'"></div>\').css({',
'            background: \'radial-gradient(rgba(255,255,255,0) 0%, rgba(255,255,255,0) 0%)\',',
'            width:      this.container.offsetWidth + \'px\',',
'            height:     this.container.offsetHeight + \'px\',',
'            top:        0,',
'            left:       0,',
'            position:   \'absolute\'',
'        }).appendTo($(obj.svg.parentNode));',
'        function iterator ()',
'        {',
'            if (frame < frames) {',
'                    $(\'div#rgraph_fadeslide_cover_\' + obj.id).css({',
'                        background: \'radial-gradient(rgba(255,255,255,0) \' + (( (frames - frame++) / frames) * 100) + \'%, \' + color + \' \' + (( (frames - frame++) / frames) * 120) + \'%)\'',
'                    });',
'                    RG.SVG.FX.update(iterator);',
'            } else {',
'                RG.SVG.clear(obj.svg);',
'                $(\'div#rgraph_fadeslide_cover_\' + obj.id).remove();',
'                callback(obj);',
'            }',
'        }',
'        iterator();',
'        return this;',
'    };',
'    //',
'    // Reveal',
'    // ',
'    // With this effect the chart is slowly revealed from the centre outwards. This',
'    // function gets added to the chart object - so the \'this\' variable is the chart',
'    // object',
'    // ',
'    // @param object    Options for the effect. You can give frames here',
'    // @param function  An optional callback function',
'    //',
'    RG.SVG.FX.reveal = function ()',
'    {',
'        var obj       = this,',
'            opt       = arguments[0] || {}',
'            color     = opt.color    || \'white\',',
'            frames    = opt.frames   || 90,',
'            duration  = (frames / 60) * 1000,',
'            callback  = opt.callback || function () {}',
'        var divs = [',
'            [\'rgraph_reveal_left_\'   + this.id, 0, 0, this.container.offsetWidth  / 2, this.container.offsetHeight],',
'            [\'rgraph_reveal_right_\'  + this.id,(this.container.offsetWidth  / 2),0,(this.container.offsetWidth  / 2),this.container.offsetHeight],',
'            [\'rgraph_reveal_top_\'    + this.id,0,0,this.container.offsetWidth,(this.container.offsetHeight / 2)],',
'            [\'rgraph_reveal_bottom_\' + this.id,0,(this.container.offsetHeight  / 2),this.container.offsetWidth,(this.container.offsetHeight / 2)]',
'        ];',
'        for (var i=0,len=divs.length; i<len; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = divs[i][0];',
'                div.style.left            = divs[i][1] + \'px\';',
'                div.style.top             = divs[i][2] + \'px\';',
'                div.style.width           = divs[i][3] + \'px\';',
'                div.style.height          = divs[i][4] + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'        }',
'        // Redraw',
'        RG.SVG.redraw(obj.svg);',
'        // Animate the shrinking of the DIVs',
'        jQuery(\'#rgraph_reveal_left_\'   + obj.id).animate({width: 0}, duration);',
'        jQuery(\'#rgraph_reveal_right_\'  + obj.id).animate({left: \'+=\' + (this.container.offsetWidth / 2),width: 0}, duration);',
'        jQuery(\'#rgraph_reveal_top_\'    + obj.id).animate({height: 0}, duration);',
'        jQuery(\'#rgraph_reveal_bottom_\' + obj.id).animate({top: \'+=\' + (this.container.offsetHeight / 2),height: 0}, duration);',
'        // Remove the DIVs from the DOM 100ms after the animation ends',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_top_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_bottom_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_left_" + obj.id));',
'            obj.container.removeChild(doc.getElementById("rgraph_reveal_right_" + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Conceal',
'    // ',
'    // This effect is the reverse of the Reveal effect - instead of revealing',
'    // the canvas it conceals it. Combined with the reveal effect would make',
'    // for a nice wipe effect.',
'    // ',
'    // @param object obj The chart object',
'    ///',
'    RG.SVG.FX.conceal = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames   || 90,',
'            callback = opt.callback || function () {},',
'            color    = opt.color    || \'white\',',
'            duration = (frames / 60) * 1000,',
'            frame    = 0;',
'        var divs = [',
'            [\'rgraph_conceal_left_\' + obj.id, 0, 0, 0, this.container.offsetHeight],',
'            [\'rgraph_conceal_right_\' + obj.id,this.container.offsetWidth,0,0,this.container.offsetHeight],',
'            [\'rgraph_conceal_top_\' + obj.id,0,0,this.container.offsetWidth,0],',
'            [\'rgraph_conceal_bottom_\' + obj.id,0,this.container.offsetHeight,this.container.offsetWidth,0]',
'        ];',
'        for (var i=0,len=divs.length; i<len; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = divs[i][0];',
'                div.style.left            = divs[i][1] + \'px\';',
'                div.style.top             = divs[i][2] + \'px\';',
'                div.style.width           = divs[i][3] + \'px\';',
'                div.style.height          = divs[i][4] + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'        }',
'        jQuery(\'#rgraph_conceal_left_\' + obj.id).animate({width: \'+=\' + (this.container.offsetWidth / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_right_\' + obj.id).animate({left: \'-=\' + (this.container.offsetWidth / 2),width: (this.container.offsetWidth / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_top_\' + obj.id).animate({height: \'+=\' + (this.container.offsetHeight / 2)}, duration);',
'        jQuery(\'#rgraph_conceal_bottom_\' + obj.id).animate({top: \'-=\' + (this.container.offsetHeight / 2),height: (this.container.offsetHeight / 2)}, duration);',
'        // Remove the DIVs from the DOM 100ms after the animation ends',
'        setTimeout(',
'            function ()',
'            {',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_top_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_bottom_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_left_" + obj.id));',
'                obj.container.removeChild(doc.getElementById("rgraph_conceal_right_" + obj.id));',
'                RG.SVG.clear(obj.svg);',
'                callback(obj);',
'            },',
'            duration',
'        );',
'        return this;',
'    };',
'    //',
'    // Horizontal Blinds (open)',
'    // ',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.hblindsopen = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = 0;',
'                div.style.top             = ((this.container.offsetHeight * (i / 5))) + \'px\';',
'                div.style.width           = this.container.offsetWidth + \'px\';',
'                div.style.height          = (this.container.offsetHeight / 5) + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_hblinds_\' + i + \'_\' + obj.id).animate({height: 0}, duration);',
'        }',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_0_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_1_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_2_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_3_\' + obj.id));}, duration);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_4_\' + obj.id));}, duration);',
'        setTimeout(function () {callback(obj);}, duration);',
'        return this;',
'    };',
'    //',
'    // Horizontal Blinds (close)',
'    // ',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    //',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.hblindsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color = \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = 0;',
'                div.style.top             = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                div.style.width           = this.container.offsetWidth + \'px\';',
'                div.style.height          = 0;',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_hblinds_\' + i + \'_\' + obj.id)',
'                .animate({',
'                    height: height + \'px\'',
'                }, duration);',
'        }',
'        setTimeout(function () {RG.SVG.clear(obj.svg);}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_hblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'    };',
'    //',
'    // Vertical Blinds (open)',
'    // ',
'    // @params object obj The graph object',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    RG.SVG.FX.vblindsopen = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(obj.svg);',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id = \'rgraph_vblinds_\' + i + \'_\' + obj.id;',
'                div.style.width           =  width + \'px\';',
'                div.style.height          = this.container.offsetHeight + \'px\';',
'                div.style.left            = (this.container.offsetWidth * (i / 10)) + \'px\';',
'                div.style.top             = 0;',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            obj.container.appendChild(div);',
'            jQuery(\'#rgraph_vblinds_\' + i + \'_\' + obj.id).animate({width: 0}, duration);',
'        }',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_5_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_6_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_7_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_8_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_9_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'        return this;',
'    };',
'    //',
'    // Vertical Blinds (close)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @params object obj The graph object',
'    //',
'    RG.SVG.FX.vblindsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        // Create the blinds',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_vblinds_\' + i + \'_\' + obj.id;',
'                div.style.left            = (this.container.offsetWidth * (i / 10)) + \'px\';',
'                div.style.top             = 0;',
'                div.style.width           = 0;',
'                div.style.height          = this.container.offsetHeight + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            jQuery(\'#rgraph_vblinds_\' + i + \'_\' + obj.id).animate({width: width}, duration);',
'        }',
'        setTimeout(function () {RG.SVG.clear(obj.svg);}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_0_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_1_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_2_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_3_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_4_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_5_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_6_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_7_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_8_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {obj.container.removeChild(doc.getElementById(\'rgraph_vblinds_9_\' + obj.id));}, duration + 100);',
'        setTimeout(function () {callback(obj);}, duration + 100);',
'        return this;',
'    };',
'    //',
'    // Slide in',
'    // ',
'    // This function is a wipe that can be used when switching the canvas to a',
'    // new graph',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param object obj The graph object',
'    //',
'    RG.SVG.FX.slidein = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10,',
'            from     = opt.from || \'left\';',
'        this.container.style.overflow = \'hidden\';',
'        RG.SVG.redraw(this.svg);',
'        this.svg.style.position = \'relative\';',
'        if (from == \'left\') {',
'            this.svg.style.left = (0 - this.container.offsetWidth) + \'px\';',
'            this.svg.style.top  = 0;',
'        } else if (from == \'top\') {',
'            this.svg.style.left = 0;',
'            this.svg.style.top  = (0 - this.container.offsetHeight) + \'px\';',
'        } else if (from == \'bottom\') {',
'            this.svg.style.left = 0;',
'            this.svg.style.top  = this.container.offsetHeight + \'px\';',
'        } else {',
'            this.svg.style.left = this.container.offsetWidth + \'px\';',
'            this.svg.style.top  = 0;',
'        }',
'        jQuery(this.svg).animate({left:0,top:0}, duration, function ()',
'        {',
'            callback(obj);',
'        });',
'        return this;',
'    };',
'    //',
'    // Slide out',
'    // ',
'    // This function is a wipe that can be used when switching the canvas to a new graph',
'    // ',
'    // @param object   Optional object containing configuration.',
'    // @param function Optional callback function',
'    //',
'    RG.SVG.FX.slideout = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var opt      = arguments[0] || {},',
'            frames   = opt.frames   || 90,',
'            color    = opt.color    || \'white\',',
'            to       = opt.to       || \'left\',',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            width    = this.container.offetsWidth / 10;',
'        this.container.style.overflow= \'hidden\';',
'        this.svg.style.position = \'relative\';',
'        this.svg.style.left     = 0;',
'        this.svg.style.top      = 0;',
'        if (to == \'left\') {',
'            jQuery(this.svg).animate({left: (0 - this.container.offsetWidth) + \'px\'}, duration, function () {callback(this);});',
'        } else if (to == \'top\') {',
'            jQuery(this.svg).animate({left: 0, top: (0 - this.container.offsetHeight) + \'px\'}, duration, function () {callback(this);});',
'        } else if (to == \'bottom\') {',
'            jQuery(this.svg).animate({top: (0 + this.container.offsetHeight) + \'px\'}, duration, function () {callback(this);});',
'        } else {',
'            jQuery(this.svg).animate({left: (0 + this.container.offsetWidth) + \'px\'}, duration, function () {callback(this);});',
'        }',
'        return this;',
'    };',
'    //',
'    // Horizontal Scissors (open)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param object      Optional array of options',
'    // @param function     Optional callback function',
'    // ',
'    //',
'    RG.SVG.FX.hscissorsopen = function ()',
'    {',
'        var opt      = arguments[0] || {},',
'            obj      = this,',
'            frames   = opt.frames   || 90,',
'            callback = opt.callback || function () {},',
'            color    = opt.color    || \'white\',',
'            to       = opt.to       || \'left\',',
'            frame    = 0,',
'            duration = (frames / 60) * 1000,',
'            width    = this.container.offsetWidth / 10,',
'            height   = this.container.offsetHeight / 5;',
'        //',
'        // First draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<5; ++i) {',
'            var div = doc.getElementById("rgraph_hscissors_" + i + \'_\' + this.id)',
'            if (!div) {',
'                var div    = doc.createElement(\'DIV\');',
'                    div.id = \'rgraph_hscissors_\' + i + \'_\' + this.id;',
'                    div.style.width =  this.container.offsetWidth + \'px\';',
'                    div.style.height = (this.container.offsetHeight / 5) + \'px\';',
'                    div.style.left   = 0;',
'                    div.style.top   = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                    div.style.position = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({left: this.container.offsetWidth + \'px\', width: 0}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({width: 0}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_0_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_1_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_2_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_3_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_hscissors_4_\' + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Horizontal Scissors (Close)',
'    //',
'    // This function gets added to the chart object - so the this',
'    // variable is the chart object',
'    // ',
'    // @param @object      Optional object of options',
'    // @param function     Optional callback function',
'    // ',
'    //',
'    RG.SVG.FX.hscissorsclose = function ()',
'    {',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 60,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            height   = this.container.offsetHeight / 5;',
'        for (var i=0; i<5; ++i) {',
'            var div                       = doc.createElement(\'DIV\');',
'                div.id                    = \'rgraph_hscissors_\' + i + \'_\' + this.id;',
'                div.style.width           = 0;',
'                div.style.height          = height + \'px\';',
'                div.style.left            = (i % 2 == 0 ? this.container.offsetWidth : 0) + \'px\';',
'                div.style.top             = (this.container.offsetHeight * (i / 5)) + \'px\';',
'                div.style.position        = \'absolute\';',
'                div.style.backgroundColor = color;',
'            this.container.appendChild(div);',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({left: 0, width: this.container.offsetWidth + \'px\'}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_hscissors_\' + i + \'_\' + this.id).animate({width: this.container.offsetWidth + \'px\'}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            RG.SVG.clear(obj.svg);',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 0 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 1 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 2 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 3 + \'_\' + obj.id).remove();',
'            jQuery(\'#\' + \'rgraph_hscissors_\' + 4 + \'_\' + obj.id).remove();',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Vertical Scissors (open)',
'    // ',
'    // @param @object  Optional An object of options. It can consist of:',
'    //                  o color    - The color of the scissors. The default is white',
'    //                  o frames   - Number of animation frames in the effect. Default',
'    //                               is 60',
'    //                  o callback - A function that\'s called when the effect is',
'    //                               finished',
'    //',
'    RG.SVG.FX.vscissorsopen = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        //',
'        // First (re)draw the chart',
'        //',
'        RG.SVG.redraw(this.svg);',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.getElementById("rgraph_vscissors_" + i + \'_\' + this.id);',
'            if (!div) {',
'                var div = doc.createElement(\'DIV\');',
'                    div.id = \'rgraph_vscissors_\' + i + \'_\' + this.id;',
'                    div.style.width           =  width + \'px\';',
'                    div.style.height          = this.container.offsetHeight + \'px\';',
'                    div.style.left            = this.container.offsetWidth * (i / 10) + \'px\';',
'                    div.style.top             = 0;',
'                    div.style.position        = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({top: this.container.offsetHeight + \'px\', height: 0}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({height: 0}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_0\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_1\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_2\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_3\' + \'_\' + obj.id));',
'            obj.container.removeChild(doc.getElementById(\'rgraph_vscissors_4\' + \'_\' + obj.id));',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'    //',
'    // Vertical Scissors (close)',
'    //',
'    RG.SVG.FX.vscissorsclose = function ()',
'    {',
'        // This function gets added to the chart object - so the this',
'        // variable is the chart object',
'        var obj      = this,',
'            opt      = arguments[0] || {},',
'            frames   = opt.frames || 90,',
'            duration = (frames / 60) * 1000,',
'            frame    = 0,',
'            callback = opt.callback || function () {},',
'            color    = opt.color  || \'white\',',
'            width    = this.container.offsetWidth / 10;',
'        for (var i=0; i<10; ++i) {',
'            var div = doc.getElementById("rgraph_vscissors_" + i + \'_\' + this.id)',
'            if (!div) {',
'                var div                = doc.createElement(\'DIV\');',
'                    div.id             = \'rgraph_vscissors_\' + i + \'_\' + this.id;',
'                    div.style.width    =  width + \'px\';',
'                    div.style.height   = 0;',
'                    div.style.left     = (width * i) + \'px\';',
'                    div.style.top      = (i % 2 == 0 ? this.container.offsetHeight : 0) + \'px\';',
'                    div.style.position = \'absolute\';',
'                    div.style.backgroundColor = color;',
'                this.container.appendChild(div);',
'            }',
'            if (i % 2 == 0) {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({top: 0, height: this.container.offsetHeight + \'px\'}, duration);',
'            } else {',
'                jQuery(\'#\' + \'rgraph_vscissors_\' + i + \'_\' + this.id).animate({height: this.container.offsetHeight + \'px\'}, duration);',
'            }',
'        }',
'        setTimeout(function ()',
'        {',
'            RG.SVG.clear(obj.svg);',
'            for (var i=0; i<10; i++) {',
'                jQuery(\'#rgraph_vscissors_\' + i + \'_\' + obj.id).remove();',
'            }',
'            callback(obj);',
'        }, duration);',
'        return this;',
'    };',
'// End Module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph          = window.RGraph || {isRGraph: true};',
'    RGraph.SVG      = RGraph.SVG || {};',
'    RGraph.SVG.HTML = RGraph.SVG.HTML || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG = RGraph,',
'        ua = navigator.userAgent,',
'        ma = Math;',
'    /**',
'    * Draws the graph key (used by various graphs)',
'    * ',
'    * @param object obj The graph object',
'    * @param array  key An array of the texts to be listed in the key',
'    * @param colors An array of the colors to be used',
'    */',
'    RG.SVG.drawKey = function (obj)',
'    {',
'        var prop          = obj.properties,',
'            key           = prop.key,',
'            colors        = prop.keyColors || prop.colors,',
'            defaultFont   = \'Arial\',',
'            blobSize      = 0,',
'            width         = 0,',
'            keyColorShape = prop.keyColorShape;',
'        // Work out the center point of the SVG tag',
'        var centerx = obj.svg.getAttribute(\'width\') / 2;',
'        // If we\'re drawing a key on a funnel then work out the center of',
'        // the chart differently. This may be useful to other chart types',
'        // too',
'        if (obj.type === \'funnel\') {',
'            centerx = (obj.graphWidth / 2) + prop.gutterLeft;',
'        }',
'        // Loop thru the key and draw them',
'        if (key && key.length) {',
'            // First measure the length so that the key can be centered',
'            for (var i=0,length = 0; i<key.length; i++) {',
'                // First measure the text',
'                var textDimensions = RG.SVG.measureText({',
'                    text: key[i],',
'                    bold: prop.keyTextBold || false,',
'                    font: prop.keyTextFont || prop.textFont || defaultFont,',
'                    size: prop.keyTextSize || prop.textSize',
'                });',
'                blobSize = ma.max(blobSize, textDimensions[1]);',
'                width = width + 10 + blobSize + 5 + textDimensions[0];',
'            }',
'            // Center the key',
'            x = centerx - width / 2;',
'            for (var i=0,y=prop.gutterTop - 5; i<key.length; ++i) {',
'                // Do this on the first iteration only',
'                if (i === 0) {',
'                    if (obj.type === \'pie\' && prop.highlightStyle == \'outline\') {',
'                        y -= prop.highlightStyleOutlineWidth;',
'                    }',
'                }',
'                // First measure the text',
'                var textDimensions = RG.SVG.measureText({',
'                    text: key[i],',
'                    bold: prop.keyTextBold || false,',
'                    font: prop.keyTextFont || prop.textFont || defaultFont,',
'                    size: prop.keyTextSize || prop.textSize',
'                });',
'                //',
'                // Draw the blob of color (accounting for it being an array first)',
'                //',
'                var shape = prop.keyColorShape;',
'                if (typeof shape === \'object\') {',
'                    shape = prop.keyColorShape[i];',
'                }',
'                // A circle',
'                if (shape === \'circle\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'circle\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            cx: x + (blobSize / 2)  + prop.keyOffsetx,',
'                            cy: y - (blobSize / 2) + prop.keyOffsety,',
'                            r: blobSize / 2,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A triangle',
'                } else if (shape === \'triangle\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4} L {5} {6} z\'.format(',
'                                x + prop.keyOffsetx + (blobSize / 2),',
'                                y - blobSize + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y + prop.keyOffsety,',
'                                x + prop.keyOffsetx,',
'                                y + prop.keyOffsety                                ',
'                            ),',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A line',
'                } else if (shape === \'line\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                // A dot',
'                } else if (shape === \'dot\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'circle\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            cx: x + (blobSize / 2)  + prop.keyOffsetx,',
'                            cy: y - (blobSize / 2) + prop.keyOffsety,',
'                            r: blobSize / 4,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // A dot',
'                } else if (shape === \'squaredot\' || shape === \'rectdot\') {',
'                    // Create the line',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'rect\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            x: x + (blobSize / 4) + prop.keyOffsetx,',
'                            y: y + (blobSize / 4) - blobSize + prop.keyOffsety,',
'                            width: blobSize / 2,',
'                            height: blobSize / 2,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                // Ccustom',
'                } else if (typeof shape === \'function\') {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'path\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            d: \'M {1} {2} L {3} {4}\'.format(',
'                                x + prop.keyOffsetx,',
'                                y - (blobSize / 2) + prop.keyOffsety,',
'                                x + prop.keyOffsetx + blobSize,',
'                                y - (blobSize / 2) + prop.keyOffsety',
'                            ),',
'                            stroke: colors[i],',
'                            \'stroke-width\': 2,',
'                            \'stroke-linecap\': \'round\'',
'                        }',
'                    });',
'                // A rectangle default',
'                } else {',
'                    RG.SVG.create({',
'                        svg: obj.svg,',
'                        type: \'rect\',',
'                        parent: obj.svg.all,',
'                        attr: {',
'                            x: x + prop.keyOffsetx,',
'                            y: y - blobSize + prop.keyOffsety,',
'                            width: blobSize,',
'                            height: blobSize,',
'                            fill: colors[i]',
'                        }',
'                    });',
'                }',
'                //',
'                // Add the text',
'                //',
'                RGraph.SVG.text({',
'                    object:     obj,',
'                    parent:     obj.svg.all,',
'                    tag:        \'key\',',
'                    size:       prop.keyTextSize || prop.textSize,',
'                    bold:       typeof prop.keyTextBold === \'boolean\' ? prop.keyTextBold : prop.textBold,',
'                    italic:     typeof prop.keyTextItalic === \'boolean\' ? prop.keyTextItalic : prop.textItalic,',
'                    font:       prop.keyTextFont || prop.textFont,',
'                    halign:     \'left\',',
'                    valign:     \'bottom\',',
'                    text:       key[i],',
'                    x:          x + blobSize + 5 + prop.keyTextOffsetx + prop.keyOffsetx,',
'                    y:          y + prop.keyTextOffsety + prop.keyOffsety,',
'                    color:      prop.keyTextColor || \'black\',',
'                    background: prop.keyTextBackground || \'white\',',
'                    padding:    0',
'                })',
'                x += 10 + blobSize + 5 + textDimensions[0];',
'            }',
'        }',
'    };',
'    /**',
'    * Create a TABLE based HTML key. There\'s lots of options so it\'s',
'    * suggested that you consult the documentation page',
'    * ',
'    * @param mixed id   This should be a string consisting of the ID of the container',
'    * @param object prop An object map of the various properties that you can use to',
'    *                    configure the key. See the documentation page for a list.',
'    */',
'    RG.SVG.HTML.key = function (id, prop)',
'    {',
'        var div = doc.getElementById(id);',
'        /**',
'        * Create the table that becomes the key',
'        */',
'        var str = \'<table border="0" cellspacing="0" cellpadding="0" id="rgraph_key" style="display: inline;\' + (function ()',
'            {',
'                var style = \'\'',
'                for (i in prop.tableCss) {',
'                    if (typeof i === \'string\') {',
'                        style = style + i + \': \' + prop.tableCss[i] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'" \' + (prop.tableClass ? \'class="\' + prop.tableClass + \'"\' : \'\') + \'>\';',
'        /**',
'        * Add the individual key elements',
'        */',
'        for (var i=0; i<prop.labels.length; i+=1) {',
'            str += \'<tr><td><div style="\' + (function ()',
'            {',
'                var style = \'\';',
'                for (var j in prop.blobCss) {',
'                    if (typeof j === \'string\') {',
'                        style = style + j + \': \' + prop.blobCss[j] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'display: inline-block; margin-right: 5px; margin-top: 4px; width: 15px; height: 15px; background-color: \' + prop.colors[i] + \'"\' + (prop.blobClass ? \'class="\' + prop.blobClass + \'"\' : \'\') + \'>&nbsp;</div><td>\' + (prop.links && prop.links[i] ? \'<a href="\' + prop.links[i] + \'">\' : \'\') + \'<span \' + (prop.labelClass ? \'class="\' + prop.labelClass + \'"\' : \'\') + \'" style="\' + (function ()',
'            {',
'                var style = \'\';',
'                for (var j in prop.labelCss) {',
'                    if (typeof j === \'string\') {',
'                        style = style + j + \': \' + prop.labelCss[j] + \';\';',
'                    }',
'                }',
'                return style;',
'            })() + \'" \' + (function ()',
'            {',
'                var style = \'\';',
'                if (prop[\'labelCss_\' + i]) {',
'                    for (var j in prop[\'labelCss_\' + i]) {',
'                        style = style + j + \': \' + prop[\'labelCss_\' + i][j] + \';\';',
'                    }',
'                }',
'                return style ? \'style="\' + style + \'"\' : \'\';',
'            })() + \'>\' + prop.labels[i] + \'</span>\' + (prop.links && prop.links[i] ? \'</a>\' : \'\') + \'</td></tr>\';',
'        }',
'        div.innerHTML += (str + \'</table>\');',
'        // Return the TABLE object that is the HTML key',
'        return doc.getElementById(\'rgraph_key\');',
'    };',
'// End module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    /**',
'    * Initialise the various objects',
'    */',
'    RGraph = window.RGraph || {isRGraph: true};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    RGraph.Sheets = function (key)',
'    {',
'        var worksheet,',
'            callback,',
'            letters = \'ABCDEFGHIJKLMNOPQRSTUVWXYZ\';',
'        // 3 arguments',
'        if (arguments.length === 3) {',
'            worksheet = Number(arguments[1]);',
'            callback  = arguments[2];',
'        // 2 arguments',
'        } else {',
'            worksheet = 1;',
'            callback  = arguments[1];',
'        }',
'        var url = \'https://spreadsheets.google.com/feeds/cells/[KEY]/[WORKSHEET]/public/full?alt=json-in-script&callback=__rgraph_JSONPCallback\'.replace(/\\[KEY\\]/, key).replace(/\\[WORKSHEET\\]/, worksheet);',
'        /*',
'        * https://spreadsheets.google.com/feeds/cells/1q_BMjvKO_kKbAO3VjoaITSDyrLAk8f0SK5UFMmE3oRs/2/public/full?alt=json-in-script',
'        */',
'        //',
'        // Loads the spreadsheet',
'        //',
'        this.load = function(url, userCallback)',
'        {',
'            var obj = this;',
'            // A global on purpose',
'            __rgraph_JSONPCallback = function (json)',
'            {',
'                // Save the JSON on the RGraph.Sheets object',
'                obj.json = json;',
'                //',
'                // Put the entries in the JSON feed into a grid',
'                //',
'                var grid = [], row = 0, col = 0;',
'                for (var i=0; i<json.feed.entry.length; ++i) {',
'                    row = json.feed.entry[i].gs$cell.row - 1;',
'                    col = json.feed.entry[i].gs$cell.col - 1;',
'                    if (!grid[row]) {',
'                        grid[row] = [];',
'                    }',
'                    grid[row][col] = json.feed.entry[i].content.$t;',
'                }',
'                //',
'                // Determine the longest row',
'                //',
'                var maxcols = 0; // The max length of the rows',
'                for (var i=0; i<grid.length; ++i) {',
'                    maxcols = grid[i] ? Math.max(maxcols, grid[i].length) : maxcols;',
'                }',
'                //',
'                // Now go through the array and fill in any blank holes.',
'                //',
'                for (var i=0; i<grid.length; ++i) {',
'                    if (typeof grid[i] === \'undefined\') {',
'                        grid[i] = new Array(maxcols);',
'                    }',
'                    for (var j=0; j<maxcols; j++) {',
'                        if (typeof grid[i][j] === \'undefined\') {',
'                            grid[i][j] = \'\';',
'                        }',
'                        // Convert numbers to real numbers and floats here too',
'                        if (grid[i][j].match(/^[0-9]+$/)) {',
'                            grid[i][j] = parseInt(grid[i][j]);',
'                        } else if (grid[i][j].match(/^[0-9.]+$/)) {',
'                            grid[i][j] = parseFloat(grid[i][j]);',
'                        }',
'                    }',
'                }',
'                //',
'                // Save the grid on the object',
'                //',
'                obj.data = grid;',
'                //',
'                // Call the users callback function. Users can access the raw data if',
'                // they want with the obj.data property or by using the accessor',
'                // methods (better)',
'                //',
'                userCallback(obj);',
'            };',
'            // Add the new script tag to the document that pulls in the JSON',
'            //',
'            // With jQuery...',
'            //',
'            //jQuery(\'body\').append("<script src=\'" + url + "\'></script>");',
'            //',
'            // And without jQuery...',
'            var scriptNode = document.createElement(\'SCRIPT\');',
'            scriptNode.src = url;',
'            document.body.appendChild(scriptNode);',
'        };',
'        //',
'        // Fetches a row of data and returns it',
'        //',
'        // @param id    number The numeric index of the column to fetch (starts at 1)',
'        // @param start number The index to start fetching/returning at. The first',
'        //                     character is 1',
'        // @param opt        An option object containing options',
'        //',
'        this.row = function (index, start)',
'        {',
'            var opt = {}, row;',
'            // Default for start is 1',
'            start = start || 1;',
'            //',
'            // Parse the .trim argument',
'            //',
'            if (arguments && typeof arguments[2] === \'object\' && typeof arguments[2].trim === \'boolean\') {',
'                opt.trim = arguments[2].trim;',
'            } else {',
'                opt.trim = true;',
'            }',
'            row = this.data[index - 1].slice(start - 1);',
'            // Trim the array if required',
'            if (opt.trim) {',
'                row = RGraph.SVG.arrayTrim(row);',
'            }',
'            return row;',
'        };',
'        //',
'        // Fetches a column of data and returns it',
'        //',
'        // @param id    number The letter that corresponds to the column',
'        // @param start number The index to start fetching/returning at. The first',
'        //                     character is 1',
'        // @param opt        An option object containing options',
'        //',
'        this.col = function (index, start)',
'        {',
'            var opt = {},',
'                col = [];',
'            // Default for start is 1',
'            start = start || 1;',
'            if (arguments && typeof arguments[2] === \'object\' && typeof arguments[2].trim === \'boolean\') {',
'                opt.trim = arguments[2].trim;',
'            } else {',
'                opt.trim = true;',
'            }',
'            for (var i=0; i<this.data.length; ++i) {',
'                col.push(this.data[i][index - 1]);',
'            }',
'            // Trim the array if required',
'            if (opt.trim) {',
'                col = RGraph.SVG.arrayTrim(col);',
'            }',
'            // Now account for the start index',
'            col = col.slice(start - 1);',
'            return col;',
'        };',
'        //',
'        // Returns the index (zero index) of the given letters',
'        //',
'        this.getIndexOfLetters = function (l)',
'        {',
'            var parts = l.split(\'\');',
'            if (parts.length === 1) {',
'                return letters.indexOf(l) + 1;',
'            } else if (parts.length === 2){',
'                var idx = ((letters.indexOf(parts[0]) + 1) * 26) + (letters.indexOf(parts[1]) + 1);',
'                return idx;',
'            }',
'        }',
'        //',
'        // The get method makes retrieving cells very straightforward,',
'        // for example: obj.get(\'B1\');',
'        //',
'        // @param str string The cells(s) to fetch',
'        // @param     string Optional set of options that are passed',
'        //                   to the relevant row/col function',
'        //',
'        this.get = function (str)',
'        {',
'            // Uppercase letters please!',
'            str = str.toUpperCase();',
'            //',
'            // Handle the style of .get(\'C\') or .get(\'AA\'',
'            //',
'            if (str.match(/^[a-z]+$/i)) {',
'                if (str.length === 1) {',
'                    var index = letters.indexOf(str) + 1;',
'                    return this.col(index, 1, arguments[1]);',
'                } else if (str.length === 2) {',
'                    var index = ((letters.indexOf(str[0]) + 1) * 26) + letters.indexOf(str[1]) + 1;',
'                    return this.col(index, 1, arguments[1]);',
'                }',
'            }',
'            //',
'            // Handle the style of .get(\'2\');',
'            //(fetching a whole row',
'            //',
'            if (str.match(/^[0-9]+$/i)) {',
'                return this.row(str, null, arguments[1]);',
'            }',
'            //',
'            // Handle the style of .get(\'E2\');',
'            //(fetching a single cell)',
'            //',
'            if (str.match(/^([a-z]{1,2})([0-9]+)$/i)) {',
'                var letter = RegExp.$1,',
'                    number = RegExp.$2,',
'                    col    = this.get(letter, {trim: false});',
'                return col[number - 1];',
'            }',
'            //',
'            // Handle the style of .get(\'B2:E2\');',
'            //(fetching the E2 cell to the E2 cell)',
'            //',
'            if (str.match(/^([a-z]{1,2})([0-9]+):([a-z]{1,2})([0-9]+)$/i)) {',
'                var letter1 = RegExp.$1,',
'                    number1 = RegExp.$2,',
'                    letter2 = RegExp.$3,',
'                    number2 = RegExp.$4',
'                if (letter1 === letter2) {',
'                    var cells = [],',
'                        index = this.getIndexOfLetters(letter1),',
'                        col   = this.col(index, null, {trim: false});',
'                    for (var i=(number1 - 1); i<=(number2 - 1); ++i) {',
'                        cells.push(col[i]);',
'                    }',
'                } else if (number1 === number2) {',
'                    var cells = [],',
'                        row   = this.row(number1, null, {trim: false}),',
'                        index1 = this.getIndexOfLetters(letter1),',
'                        index2 = this.getIndexOfLetters(letter2)',
'                    for (var i=(index1 - 1); i<=(index2 - 1); ++i) {',
'                        cells.push(row[i]);',
'                    }',
'                }',
'                // Trim the results',
'                if (arguments[1] && arguments[1].trim === false) {',
'                    // Nada',
'                } else {',
'                    cells = RGraph.SVG.arrayTrim(cells);',
'                }',
'                return cells;',
'            }',
'        };',
'        //',
'        // Load the data',
'        //',
'        this.load(url, callback);',
'    };',
'// End module pattern',
'})(window, document);;',
'// version: 2018-06-24-143455',
'    /**',
'    * o--------------------------------------------------------------------------------o',
'    * | This file is part of the RGraph package - you can learn more at:               |',
'    * |                                                                                |',
'    * |                          http://www.rgraph.net                                 |',
'    * |                                                                                |',
'    * | RGraph is licensed under the Open Source MIT license. That means that it\'s     |',
'    * | totally free to use and there are no restrictions on what you can do with it!  |',
'    * o--------------------------------------------------------------------------------o',
'    */',
'    RGraph     = window.RGraph || {isRGraph: true,isRGraphSVG: true};',
'    RGraph.SVG = RGraph.SVG || {};',
'// Module pattern',
'(function (win, doc, undefined)',
'{',
'    var RG  = RGraph,',
'        ua  = navigator.userAgent,',
'        ma  = Math;',
'    /**',
'    * This is used in two functions, hence it\'s here',
'    */',
'    RG.SVG.tooltips       = {};',
'    RG.SVG.tooltips.style = {',
'        display:    \'inline-block\',',
'        position:   \'absolute\',',
'        padding:    \'6px\',',
'        fontFamily: \'Arial\',',
'        fontSize:   \'12pt\',',
'        fontWeight: \'normal\',',
'        textAlign:  \'center\',',
'        left:       0,',
'        top:        0,',
'        backgroundColor: \'rgb(255,255,239)\',',
'        color:      \'black\',',
'        visibility: \'visible\',',
'        zIndex:     3,',
'        borderRadius: \'5px\',',
'        boxShadow:  \'rgba(96,96,96,0.5) 0 0 5px\',',
'        transition: \'left ease-out .25s, top ease-out .25s\'',
'    };',
'    //',
'    // Shows a tooltip',
'    //',
'    // @param obj The chart object',
'    // @param opt The options',
'    //',
'    RG.SVG.tooltip = function (opt)',
'    {',
'        var obj = opt.object;',
'        // Fire the beforetooltip event',
'        RG.SVG.fireCustomEvent(obj, \'onbeforetooltip\');',
'        if (!opt.text || typeof opt.text === \'undefined\' || RG.SVG.trim(opt.text).length === 0) {',
'            return;',
'        }',
'        var prop = obj.properties;',
'        /**',
'        * chart.tooltip.override allows you to totally take control of rendering the tooltip yourself',
'        */',
'        if (typeof prop.tooltipsOverride === \'function\') {',
'            // Add the body click handler that clears the highlight if necessary',
'            //',
'            document.body.addEventListener(\'mouseup\', function (e)',
'            {',
'                obj.removeHighlight();',
'            }, false);',
'            return (prop.tooltipsOverride)(obj, opt);',
'        }',
'        // Create the tooltip DIV element',
'        if (!RG.SVG.REG.get(\'tooltip\')) {',
'            var tooltipObj        = document.createElement(\'DIV\');',
'            tooltipObj.className  = prop.tooltipsCssClass;',
'            // Add the default CSS to the tooltip',
'            for (var i in RG.SVG.tooltips.style) {',
'                if (typeof i === \'string\') {',
'                    tooltipObj.style[i] = RG.SVG.tooltips.style[i];',
'                }',
'            }',
'        // Reuse an existing tooltip',
'        } else {',
'            var tooltipObj = RG.SVG.REG.get(\'tooltip\');',
'            tooltipObj.__object__.removeHighlight();',
'            // This prevents the object from continuously growing',
'            tooltipObj.style.width = \'\';',
'        }',
'        if (RG.SVG.REG.get(\'tooltip-lasty\')) {',
'            tooltipObj.style.left = RG.SVG.REG.get(\'tooltip-lastx\') + \'px\';',
'            tooltipObj.style.top  = RG.SVG.REG.get(\'tooltip-lasty\') + \'px\';',
'        }',
'        tooltipObj.innerHTML  = opt.text;',
'        tooltipObj.__text__   = opt.text; // This is set because the innerHTML can change when it\'s set',
'        tooltipObj.id         = \'__rgraph_tooltip_\' + obj.id + \'_\' + obj.uid + \'_\'+  opt.index;',
'        tooltipObj.__event__  = prop.tooltipsEvent || \'click\';',
'        tooltipObj.__object__ = obj;',
'        // Add the index',
'        if (typeof opt.index === \'number\') {',
'            tooltipObj.__index__ = opt.index;',
'        }',
'        // Add the dataset',
'        if (typeof opt.dataset === \'number\') {',
'            tooltipObj.__dataset__ = opt.dataset;',
'        }',
'        // Add the group',
'        if (typeof opt.group === \'number\' || RG.SVG.isNull(opt.group)) {',
'            tooltipObj.__group__ = opt.group;',
'        }',
'        // Add the sequentialIndex',
'        if (typeof opt.sequentialIndex === \'number\') {',
'            tooltipObj.__sequentialIndex__ = opt.sequentialIndex;',
'        }',
'        // Add the tooltip to the document',
'        document.body.appendChild(tooltipObj);',
'        var width  = tooltipObj.offsetWidth,',
'            height = tooltipObj.offsetHeight;',
'        // Move the tooltip into position',
'        tooltipObj.style.left = opt.event.pageX - (width / 2) + \'px\';',
'        tooltipObj.style.top  = opt.event.pageY - height - 15 + \'px\';',
'        /**',
'        * Set the width on the tooltip so it doesn\'t resize if the window is resized',
'        */',
'        tooltipObj.style.width = width + \'px\';',
'        // Fade the tooltip in if the tooltip is not the first view',
'        if (!RG.SVG.REG.get(\'tooltip-lastx\')) {',
'            for (var i=0; i<=30; ++i) {',
'                (function (idx)',
'                {',
'                    setTimeout(function ()',
'                    {',
'                        tooltipObj.style.opacity = (idx / 30) * 1;',
'                    }, (idx / 30) * 200);',
'                })(i);',
'            }',
'        }',
'        // If the left is less than zero - set it to 5',
'        if (parseFloat(tooltipObj.style.left) <= 5) {',
'            tooltipObj.style.left = \'5px\';',
'        }',
'        // If the tooltip goes over the right hand edge then',
'        // adjust the positioning',
'        if (parseFloat(tooltipObj.style.left) + parseFloat(tooltipObj.style.width) > window.innerWidth) {',
'            tooltipObj.style.left  = \'\'',
'            tooltipObj.style.right = \'5px\'',
'        }',
'        // If the canvas has fixed positioning then set the tooltip position to',
'        // fixed too',
'        if (RG.SVG.isFixed(obj.svg)) {',
'            var scrollTop = window.scrollY || document.documentElement.scrollTop;',
'            tooltipObj.style.position = \'fixed\';',
'            tooltipObj.style.top      = opt.event.pageY - scrollTop - height - 10 + \'px\';',
'        }',
'        // Cancel the mousedown event',
'        tooltipObj.onmousedown = function (e)',
'        {',
'            e.stopPropagation();',
'        };',
'        // Cancel the mouseup event',
'        tooltipObj.onmouseup = function (e)',
'        {',
'            e.stopPropagation();',
'        };',
'        // Cancel the click event',
'        tooltipObj.onclick  = function (e)',
'        {',
'            if (e.button == 0) {',
'                e.stopPropagation();',
'            }',
'        };',
'        // Add the body click handler that clears the tooltip',
'        document.body.addEventListener(\'mouseup\', function (e)',
'        {',
'            RG.SVG.hideTooltip();',
'        }, false);',
'        /**',
'        * Keep a reference to the tooltip in the registry',
'        */',
'        RG.SVG.REG.set(\'tooltip\', tooltipObj);',
'        RG.SVG.REG.set(\'tooltip-lastx\', parseFloat(tooltipObj.style.left));',
'        RG.SVG.REG.set(\'tooltip-lasty\', parseFloat(tooltipObj.style.top));',
'        //',
'        // Fire the tooltip event',
'        //',
'        RG.SVG.fireCustomEvent(obj, \'ontooltip\');',
'    };',
'// End module pattern',
'})(window, document);;',
'RGraph.SVG.tooltips.style.zIndex     = \'10000\';',
'{UXPRERENDEREDALIAS}_DlgObj._navigationBar = function(id) {',
'\t\tvar styleName = this.styleName;',
'\t\tvar _id = id //specify the id of the element where the viewbox should be rendered. Typically a div on the component. Set the div style height and width properties',
'\t\tvar _settings = {',
'\t\t\t"dialogId" : this.dialogId + \'_DlgObj\',',
'\t\t\t"inputId": "",',
'\t\t\t"variableName": "",',
'\t\t\t"theme": this.styleName,',
'\t\t\t"animation": {',
'\t\t\t\t"allow": true',
'\t\t\t},',
'\t\t\t"datasource": {',
'\t\t\t\t"lowLevel": "Data",',
'\t\t\t\t"type": "Static JSON"',
'\t\t\t},',
'\t\t\t"multiple": false,',
'\t\t\t"loopNavigate": false,',
'\t\t\t"loopNavigateNullSelection": true,',
'\t\t\t"allowNullSelection": false,',
'\t\t\t"allowTextSelection": false,',
'\t\t\t"allowNullDeselection": false,',
'\t\t\t"autoRefresh": false,',
'\t\t\t"allowAnyValue": false,',
'\t\t\t"captureFocus": false,',
'\t\t\t"scroll": false,',
'\t\t\t"generateLinks": function(data) {',
'\t\t\t\tvar buttonSubTheme = \'circle\';',
'\t\t\t\tvar buttonSubThemeDisabled = \'circleSubtle\'',
'\t\t\t\t//var buttonSubTheme = \'deny\';',
'\t\t\t\t//var buttonSubThemeDisabled = \'deny\';',
'\t\t\t\tif(typeof data.settings == \'undefined\') return \'\';',
'\t\t\t\tvar _ss = data.settings;',
'\t\t\t\tif(_ss.buttonsubtheme != \'undefined\') { ',
'\t\t\t\t\tvar buttonSubTheme = _ss.buttonsubtheme',
'\t\t\t\t\tvar buttonSubThemeDisabled = _ss.buttonsubtheme',
'\t\t\t\t}',
'\t\t\t\tvar listName = data.listName;',
'\t\t\t\t//var listObj = _dlgObj.getControl(listName);',
'\t\t\t\tvar listObj = window[this.dialogId].getControl(listName);',
'\t\t\t\tvar suffix = \'&nbsp;&nbsp;&nbsp;\';',
'\t\t\t\tvar _type = \'list\';',
'\t\t\t\tif(typeof listObj.listVariableName == \'undefined\') _type = \'ss\';',
'\t\t\t\tvar recordsPerPage = \'\';',
'\t\t\t\tif(_ss.showPageSizeSelector) {',
'\t\t\t\t\tvar recordsPerPageOptions = _ss.pageSizes;',
'\t\t\t\t\tvar _s = [];',
'\t\t\t\t\tvar _r = recordsPerPageOptions.split(\',\');',
'\t\t\t\t\tif(_type == \'list\') { ',
'\t\t\t\t\t\tif(_r.indexOf(\'\'+listObj._state.pageSize) == -1) _r.push(\'\'+listObj._state.pageSize);',
'\t\t\t\t\t} else { ',
'\t\t\t\t\t\tif(_r.indexOf(\'\'+listObj.pagination.__pageSize) == -1) _r.push(\'\'+listObj.pagination.__pageSize);',
'\t\t\t\t\t}',
'\t\t\t\t\tif(_type == \'list\') { ',
'\t\t\t\t\t\tfor(var i = 0; i < _r.length; i++) {',
'\t\t\t\t\t\t\tif(_r[i] ==listObj._state.pageSize) {',
'\t\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'" selected="selected">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}\telse {',
'\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} ',
'\t\t\t\t\tif(_type == \'ss\') { ',
'\t\t\t\t\t\tfor(var i = 0; i < _r.length; i++) {',
'\t\t\t\t\t\t\tif(_r[i] == listObj.pagination.__pageSize) {',
'\t\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'" selected="selected">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}\telse {',
'\t\t\t\t\t\t\t_s.push(\'<option value="\'+_r[i]+\'">\' + _r[i] + \'</option>\');',
'\t\t\t\t\t\t\t}',
'\t\t\t\t\t\t}',
'\t\t\t\t\t} ',
'\t\t\t\t\t_s = _s.join(\' \');',
'\t\t\t\t\tvar _classEdit;',
'\t\t\t\t\tif(window[this.dialogId].styleVersion >=4) {',
'\t\t\t\t\t\t_classEdit = \'edit\';',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\t_classEdit = styleName + \'Edit\';',
'\t\t\t\t\t}',
'\t\t\t\t\trecordsPerPage = \'<select id="s1" value="{pageSize}" class="\'+_classEdit+\'" onchange="var listObj = window[\\\'\'+this.dialogId+\'\\\'].getControl(\\\'\'+listName+\'\\\');listObj._setPageSize(this.value);">\' + _s + \'</select>\';',
'\t\t\t\t\tvar templatePageSize = _ss.pageSizeSelectorTemplate',
'\t\t\t\t\trecordsPerPage = templatePageSize.replace(\'{pageSizeSelector}\',recordsPerPage) + suffix;',
'\t\t\t\t}',
'\t\t\t\tvar _classEdit;',
'\t\t\t\tif(window[this.dialogId].styleVersion >=4) {',
'\t\t\t\t\t_classEdit = \'editPrimary\';',
'\t\t\t\t} else {',
'\t\t\t\t\t_classEdit = styleName + \'Edit\';',
'\t\t\t\t}',
'\t\t\t\tvar pageNavigator = \'<input class="\'+_classEdit+\'" style="width: \'+_ss.currentPageNumberInputControlSize+\'" value="{pageNumber}"  onkeyup="if(event.keyCode == 13) {window[\\\'\'+this.dialogId+\'\\\']._listNavigateToPage(\\\'\'+listName+\'\\\',this.value)}" />\'',
'\t\t\t\t//var pageNumberTemplateButton = A5.buttons.html("",{theme: styleName + ":"+buttonSubThemeDisabled,html: "{pageNumber}",layout: "text"});',
'\t\t\t\tvar pageNumberTemplateButton = A5.buttons.html("",{theme: styleName + ":"+buttonSubTheme,html: "{pageNumber}",layout: "text"},"","disabled");',
'\t\t\t\tvar pnTemplate = \'\';',
'\t\t\t\tif(_ss.showCurrentPageNumber) {',
'\t\t\t\t\tpnTemplate = _ss.currentPageNumberTemplate;',
'\t\t\t\t\tif(_ss.showCurrentPageNumberasInputControl) {',
'\t\t\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageNumber}\',pageNavigator);',
'\t\t\t\t\t} else {',
'\t\t\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageNumber}\',pageNumberTemplateButton);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tvar firstButtonImage, prevButtonImage, nextButtonImage, lastButtonImage;',
'\t\t\t\tfirstButtonImage = _ss.firstIcon;',
'\t\t\t\tprevButtonImage = _ss.prevIcon;',
'\t\t\t\tlastButtonImage = _ss.lastIcon',
'\t\t\t\tnextButtonImage = _ss.nextIcon',
'\t\t\t\tvar flagShowCurrentPageNumber = _ss.showCurrentPageNumber;',
'\t\t\t\tvar totalPagesTemplate = _ss.currentPageNumberTemplate;',
'\t\t\t\tif(flagShowCurrentPageNumber) {',
'\t\t\t\t\tvar flagShowpageNavigator = _ss.showCurrentPageNumberasInputControl;',
'\t\t\t\t} else {',
'\t\t\t\t\tvar flagShowpageNavigator = false;',
'\t\t\t\t\ttotalPagesTemplate = \'\';',
'\t\t\t\t}',
'\t\t\t\tvar template =  A5.buttons.html("",{theme: styleName + ":"+buttonSubTheme,html: "{pageNumber}",layout: "text"},\'a5-item=\\\'clickNavigationLink:{listName}|{pageNumber}\\\'\');',
'\t\t\t\tvar firstbutton, prevbutton,nextbutton,lastbutton;',
'\t\t\t\tif(data.pageNumber == 1) {',
'\t\t\t\t\t//firstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:firstButtonImage},"") + suffix;',
'\t\t\t\t\t//prevbutton = A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:prevButtonImage},"") + suffix;',
'\t\t\t\t\tfirstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:firstButtonImage},"","disabled") + suffix;',
'\t\t\t\t\tprevbutton = A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:prevButtonImage},"","disabled") + suffix;',
'\t\t\t\t} else {',
'\t\t\t\t\tfirstbutton = A5.buttons.html(listObj.contId + \'.FIRST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:firstButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|first\\\'\') + suffix;',
'\t\t\t\t\tprevbutton =  A5.buttons.html(listObj.contId + \'.PREV\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:prevButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|prev\\\'\') + suffix;',
'\t\t\t\t}',
'\t\t\t\tif(data.pageNumber == data.totalPages) {',
'\t\t\t\t\t//lastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:lastButtonImage},"") + suffix;',
'\t\t\t\t\t//nextbutton = A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubThemeDisabled,layout: "icon",icon:nextButtonImage},"") + suffix;',
'\t\t\t\t\tlastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:lastButtonImage},"","disabled") + suffix;',
'\t\t\t\t\tnextbutton = A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:nextButtonImage},"","disabled") + suffix;',
'\t\t\t\t} else {',
'\t\t\t\t\tlastbutton = A5.buttons.html(listObj.contId + \'.LAST\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:lastButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|last\\\'\') + suffix;',
'\t\t\t\t\tnextbutton =  A5.buttons.html(listObj.contId + \'.NEXT\',{theme: styleName + ":"+buttonSubTheme,layout: "icon",icon:nextButtonImage},\'a5-item=\\\'clickNavigationLink:{listName}|next\\\'\') + suffix;',
'\t\t\t\t}',
'\t\t\t\tvar pageNumber = data.pageNumber;',
'\t\t\t\tvar links = _ss.numberOfLinks',
'\t\t\t\tvar totalPages = data.totalPages;',
'\t\t\t\tvar totalRecords = data.totalRecords;',
'\t\t\t\tvar selectedClass = data.selectedClass;',
'\t\t\t\tvar before = [];',
'\t\t\t\tvar after = [];',
'\t\t\t\tvar linksBefore = \'\';',
'\t\t\t\tvar linksAfter = \'\';',
'\t\t\t\tvar totalPagesText = totalPagesTemplate.replace(/{pageCount}/g,\'\'+totalPages);',
'\t\t\t\tvar totalPagesText = totalPagesText.replace(/{recordCount}/g,\'\'+totalRecords);',
'\t\t\t\tif(template == \'\') template = \'{pageNumber}\';',
'\t\t\t\tlinks = $u.n.round((links/2),0,\'d\');',
'\t\t\t\tif( (data.totalPages - data.pageNumber) <=links ) {',
'\t\t\t\t\tlinksAfter = data.totalPages - data.pageNumber',
'\t\t\t\t\tlinksBefore = (links * 2) - linksAfter;',
'\t\t\t\t} else if (pageNumber>links) {',
'\t\t\t\t\tlinksBefore = links',
'\t\t\t\t\tlinksAfter = links',
'\t\t\t\t} else {',
'\t\t\t\t\tvar _p = \'\';',
'\t\t\t\t\tfor(var i = links; i > 0; i--) {',
'\t\t\t\t\t\t_p = pageNumber - i;',
'\t\t\t\t\t\tif(_p >0) {',
'\t\t\t\t\t\t\tbefore.push(_p);',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t\tlinksBefore = before.length',
'\t\t\t\t\tif(linksBefore > links) {',
'\t\t\t\t\t\tlinksBefore = links;',
'\t\t\t\t\t}',
'\t\t\t\t\tlinksAfter = ( (links*2) - linksBefore)',
'\t\t\t\t}',
'\t\t\t\tbefore = [];',
'\t\t\t\tafter = [];',
'\t\t\t\tvar _p = \'\';',
'\t\t\t\tvar _template_i = \'\';',
'\t\t\t\tfor(var i = linksBefore; i > 0; i--) {',
'\t\t\t\t\tif((pageNumber-i) > 0){',
'\t\t\t\t\t\tvar _pn = \'\' + (pageNumber-i);',
'\t\t\t\t\t\t_p = template.replace(/{pageNumber}/g, _pn) + suffix;',
'\t\t\t\t\t\tbefore.push(_p);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tfor(var i = 1; i <= linksAfter; i++) {',
'\t\t\t\t\tif( (pageNumber + i) <= totalPages) {',
'\t\t\t\t\t\tvar _pn = \'\' + (pageNumber + i);',
'\t\t\t\t\t\t_p =  template.replace(/{pageNumber}/g, _pn) + suffix;',
'\t\t\t\t\t\tafter.push(_p);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\tpnTemplate = pnTemplate.replace(\'{pageCount}\',totalPages);',
'\t\t\t\tvar pageNumberText = pnTemplate.replace(/{pageNumber}/g, pageNumber);',
'\t\t\t\tpageNumberText = pageNumberText.replace(/{recordCount}/g,\'\'+totalRecords);',
'\t\t\t\tif(pageNumberText != \'\') {',
'\t\t\t\t\tpageNumberText = pageNumberText + suffix;',
'\t\t\t\t};',
'\t\t\t\tvar string = recordsPerPage + firstbutton + prevbutton + before.join(\' \') +  pageNumberText +    after.join(\' \') + nextbutton + lastbutton;',
'\t\t\t\tvar _class = \'\';',
'\t\t\t\tif(_ss.buttonSize == "Compact") _class = \'compact\';',
'\t\t\t\tstring = \'<div class="\'+_class+\'">\' + string.replace(/{listName}/g,listName) + \'</div>\'',
'\t\t\t\treturn string;',
'\t\t\t},',
'\t\t\t"layout": "default",',
'\t\t\t"layouts": {',
'\t\t\t\t\'default\' : {',
'\t\t\t\t\ttype: \'template\',',
'\t\t\t\t\ttemplate: [',
'\t\t\t\t\t\'{@[scope].generateLinks}\'',
'\t\t\t\t\t].join(\'\')',
'\t\t\t\t}',
'\t\t\t},',
'\t\t\t"_onInitialize": function() { $acn(listObj.contId,\'{UXPRERENDEREDALIAS}_\' + this.variableName); },',
'\t\t\t"items": {',
'\t\t\t\t\'clickNavigationLink\' : {',
'\t\t\t\t\titemName: \'clickNavigationLink\',',
'\t\t\t\t\tselectable: false,',
'\t\t\t\t\tonClick: function(v,ia,i,ele) {',
'\t\t\t\t\t\tia = ia.split(\'|\');',
'\t\t\t\t\t\tvar list = ia[0];',
'\t\t\t\t\t\tvar target = ia[1];',
'\t\t\t\t\t\tif(target == \'first\' || target == \'prev\' || target == \'next\' || target == \'last\') {',
'\t\t\t\t\t\t\twindow[this.dialogId]._listNavigate(list,target)',
'\t\t\t\t\t\t} else {',
'\t\t\t\t\t\t\twindow[this.dialogId]._listNavigateToPage(list,target)',
'\t\t\t\t\t\t}',
'\t\t\t\t\t}',
'\t\t\t\t},',
'\t\t\t\t\'setRecordsPerPage\' : {',
'\t\t\t\t\titemName: \'setRecordsPerPage\',',
'\t\t\t\t\tselectable: false,',
'\t\t\t\t\tonClick: function(v,ia,i,ele) {',
'\t\t\t\t\t\talert(ia);',
'\t\t\t\t\t}',
'\t\t\t\t}',
'\t\t\t\t}',
'\t\t}',
'\t\tvar _data = {};',
'\t\t//_settings.onBeforePopulate = function() { debugger;}',
'\t\tvar navBar =  new A5.ViewBox(_id,_data,_settings);',
'\t\treturn navBar',
'\t}',
'{UXPRERENDEREDALIAS}_DlgObj._layoutMode = \'containerwidth\';',
'{UXPRERENDEREDALIAS}_DlgObj._responsiveRulesMode = \'firsttrue\';',
'{UXPRERENDEREDALIAS}_DlgObj.__controlNesting = {',
'PANELHEADER_2: [\'frame:FRAME_1\'],',
'FRAME_1: [\'SEARCH_fromuser\',\'SEARCH_touser\',\'SEARCH_PRIORITY\',\'SEARCH_done\'],',
'PANELFOOTER_2: [],',
'PANELHEADER_3: [],',
'CONTAINER_1: [\'date\',\'From\',\'To\',\'container:CONTAINER_2\',\'container:CONTAINER_3\',\'container:CONTAINER_4\'],',
'CONTAINER_2: [\'message\'],',
'CONTAINER_3: [\'PRIORITY\',\'duedate\',\'done\'],',
'CONTAINER_4: [\'addtoroute\',\'poiid\',\'textbox1\'],',
'PANELHEADER_4: []',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._listsDV = [\'LSTMESSAGE\'];',
'//Add methods to the List prototype for Lists with Detail Views',
'$u.o.assign(A5.ListBox.prototype,',
'{',
' __deleteOrphanFiles_new: function() {',
'var lObj = this;',
'try{',
' if(lObj._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch) {',
'  if(lObj._phoneGap.mediaFiles.download.deleteOrphansAfterSync) {',
'   var flagDeleteOrphans = true;',
'  }',
' }',
'}catch(e) {',
' var flagDeleteOrphans = false;',
'}',
' var obj = this;',
' var cb = function(arr) {',
'  var countOK =0;',
'  var countFail = 0;',
'  var ok = function(count,countOK,countError) { alert(\'total count: \' +count + \' deleted: \' + countOK) }',
'  var fail = function(count,countOK, countError) { alert(\'failed\'); }',
'  if(arr.length ==0) {',
'   ok.call(this,0,0,0);',
'  } else {',
'   for(var i = 0; i < arr.length; i++) {',
'    var f = arr[i];',
'    var _onDeleteSuccess = function(count,countOK,countFail) {countOK++ };',
'    var _error = function(e) {countFail++ };',
'   }',
'   {UXPRERENDEREDALIAS}_DlgObj.deleteArrayOfFiles(arr,ok,fail)',
'  }',
' }',
' obj.__findOrphanFiles(cb);',
'}',
',',
' _getMediaFilesInPermanentStorage: function(cb) {',
' var obj = this;',
' var listName = obj.listVariableName;',
' var flag2 = obj._phoneGap.mediaFiles.fireMediaFileCleanup',
' var fs2 = obj._phoneGap.mediaFiles.mediafilefolderlocation',
' var folder2 = obj._phoneGap.mediaFiles.mediafilefoldertoclean;',
' var _onCompletion = function(filelist) {',
'  var f2 = [];',
'  for(var i = 0; i < filelist.length; i++) {',
'   var fi = filelist[i];',
'   if(fi[fi.length-1] != \'/\') f2.push(fi)',
'  }',
'  filelist = f2;',
'  for(var i = 0; i <filelist.length; i++) {',
'   filelist[i] = _dirPath + filelist[i];',
'  }',
'  if(typeof cb == \'function\') cb.call(this,filelist);',
' };',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _error = function(e) { alert(\'error\');};',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(fs2);;',
' var _dirName = folder2 +\'/\' ;;',
' var _dirPath = _baseURI + _dirName;',
' _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onCompletion, _error);',
'}',
',',
' __findOrphanFiles: function(cb) {',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var obj = this;',
' var listName = obj.listVariableName;',
' var flag = obj._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch',
' var fs = obj._phoneGap.mediaFiles.download.targetFileSystem',
' var folder = obj._phoneGap.mediaFiles.download.targetFolder',
' var _onCompletion = function(filelist) {',
' var f2 = [];',
'  for(var i = 0; i < filelist.length; i++) {',
'   var fi = filelist[i];',
'   if(fi[fi.length-1] != \'/\') f2.push(fi)',
'  }',
'  filelist = f2;',
'  for(var i = 0; i <filelist.length; i++) {',
'   filelist[i] = _dirPath + filelist[i];',
'  }',
'  var obj = _dlgObj.getControl(\'images_parent\')',
'  var rows = \'all\';',
'  var arr = obj._harvestMediaFields({cleanOnly: true},rows);',
'  var referencedFiles = [];',
'  for(var i = 0; i < arr.length; i++) {',
'   var fi = arr[i].filename',
'   fi = fi.split(\'//\').join(\'/\');',
'   fi = fi.split(\'file://\').join(\'file:///\')',
'   referencedFiles.push(fi)',
'  }',
'  var subtractArray = function(arrToSubtractFrom,arrToSubtract) {',
'   var arr3 = [];',
'   var index = \'\';',
'   for(var i = 0; i < arrToSubtractFrom.length; i++) {',
'    indx = arrToSubtract.indexOf(arrToSubtractFrom[i])',
'    if(indx == -1) arr3.push(arrToSubtractFrom[i])',
'   }',
'   return arr3;',
'  }',
'  var arrToSubtractFrom = filelist;',
'  var arrToSubtract = referencedFiles',
'  var orphans = subtractArray(arrToSubtractFrom,arrToSubtract)',
'  if(typeof cb == \'function\') {',
'   cb.call(this,orphans);',
'  }',
' };',
' var _error = function(e) { alert(\'error\');};',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(fs);;',
' var _dirName = folder +\'/\' + listName + \'/\';;',
' var _matchRegex = \'\';',
' var _dirPath = _baseURI + _dirName;',
' _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onCompletion, _error);',
'}',
',',
' __cleanMediaFiles: function() {',
' var obj = this;',
' var rows = \'all\';',
' var arr = obj._harvestMediaFields({cleanOnly: true},rows);',
' var arr2 = [];',
' for(var i = 0; i < arr.length; i++) {',
'  var fi = arr[i].filename',
'  fi = fi.split(\'//\');',
'  fi = fi.join(\'/\');',
'  arr2.push(fi)',
' }',
' return arr2',
'}',
',',
' _deleteOrphanMediaFiles_low: function() {',
' var obj = this;',
' var listName = obj.listVariableName;',
' var folder = \'\';',
' obj._deleteMediaFilesFromPermanentStorage()',
' try{',
'  var fspart = obj._phoneGap.mediaFiles.download.targetFileSystem',
'  var folder = obj._phoneGap.mediaFiles.download.targetFolder',
' }catch(e) {',
'  alert(\'You have not configured the List download folder for media files\');',
'  return;',
' }',
' if(folder == \'\') return;',
' var keep = this.__cleanMediaFiles()',
' var _onSuccess = function(filelist) {',
'  var f = [];',
'  for(var i = 0; i < filelist.length;  i++) {',
'   var txt = filelist[i]',
'   if(txt[txt.length-1] != \'/\') {',
'    txt = _dirPath + txt;',
'    txt = txt.split(\'///\').join(\'//\');',
'    f.push(txt)',
'   }',
'  }',
'  filelist = f;',
'  var orphan = [];',
'  for(var i = 0; i < filelist.length; i++) {',
'   var fi = filelist[i]',
'   var indx = keep.indexOf(fi)',
'   if(indx == -1) {',
'    $(\'pre1\').innerHTML = \'file: \' + fi;',
'    orphan.push(fi)',
'   }',
'  }',
'  var _dlgObj = window[that._hostComponentId + \'_DlgObj\'];',
'  var orphanCount = orphan.length;',
'  var result = _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.beforeDeleteOrphanMediaFiles\',{array:orphan});',
'  if(orphanCount == 0) {',
'   _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.afterDeleteOrphanMediaFiles\',{countFilesDeleted:0});',
'  }',
'  if(result == false) return;',
'  var flagDeleteOrphans = true;',
'  if(flagDeleteOrphans) {',
'   var count = 0;',
'   var okCount = 0;',
'   var errorCount = 0;',
'   var _onDeleteSuccess = function() {',
'    count++;',
'    okCount++;',
'    if(count == orphanCount) {',
'     _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.afterDeleteOrphanMediaFiles\',{countFilesDeleted:okCount});',
'    }',
'   };',
'   var _onDeleteError = function(e) {',
'    count++;',
'    errorCount++;',
'    if(count == orphanCount) {',
'     _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.afterDeleteOrphanMediaFiles\',{countFilesDeleted:okCount});',
'    }',
'     };',
'   for(var i =0; i < orphan.length; i++) {',
'    var _filePath = orphan[i];',
'    var fileToDelete = _filePath;',
'    fileToDelete = fileToDelete.split(\'//\').join(\'///\');',
'    _dlgObj.phoneGapDeleteFileURL(fileToDelete, _onDeleteSuccess,_onDeleteError);',
'   }',
'  }',
' };',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _error = function(e) { alert(\'xxx failed\' + JSON.stringify(e))};',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(fspart);;',
' var _dirName = folder + \'/\';;',
' var _dirPath = _baseURI + _dirName;',
' var that = this;',
' if(typeof cordova == \'undefined\') {',
' } else {',
'  _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
' }',
'}',
',',
' _deleteMediaFilesFromPermanentStorage: function() {',
' var obj = this;',
' var mode = \'\';',
' try{mode = arguments[0].mode}catch(e) { }',
' var rows = \'all\';',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var arr = obj._harvestMediaFields({},rows);',
' var arrClean = obj._harvestMediaFields({cleanOnly: true},rows)',
' var dirtyFiles = [];',
' for(var i = 0; i < arr.length; i++) {',
'  dirtyFiles.push(arr[i].filename);',
' }',
' var flagDoCleanup = false;',
' try{',
'  var flagDoCleanup = obj._phoneGap.mediaFiles.fireMediaFileCleanup;',
'  var folderToClean = obj._phoneGap.mediaFiles.mediafilefoldertoclean + \'/\';',
'  var folderToCleanLocation = obj._phoneGap.mediaFiles.mediafilefolderlocation;',
' }catch(e) { }',
' if(!flagDoCleanup) return;',
' var allfilesinFolder = [];',
' var _onSuccess = function(filelist) {',
' ;',
'  allfilesinFolder = filelist;',
'  for(var i = 0 ; i < allfilesinFolder.length; i++) {',
'   allfilesinFolder[i] = _baseURI + folderToClean + allfilesinFolder[i];',
'  }',
'  var filesToKeep = dirtyFiles;',
'  var filesToDelete = [];',
'  for(var i = 0; i < allfilesinFolder.length; i++) {',
'   var fi = allfilesinFolder[i];',
'   if(filesToKeep.indexOf(fi) == -1) {',
'    filesToDelete.push(fi);',
'   }',
'  }',
'  var cleanImagesShortName= [];',
'  for(var i = 0; i < arrClean.length; i++) {',
'   delete o;',
'   var o = A5.parseFilename(arrClean[i].filename)',
'   cleanImagesShortName.push(o.name);',
'  }',
'  var actualFilesToDelete = [];',
'  for(var i = 0; i < filesToDelete.length; i++) {',
'   var o = A5.parseFilename(filesToDelete[i])',
'   var fn = o.name;',
'   var indx = cleanImagesShortName.indexOf(o.name);',
'   if(indx > -1) {',
'    actualFilesToDelete.push(filesToDelete[i]);',
'   }',
'  }',
'  if(mode.toLowerCase() != \'allfiles\')  filesToDelete = actualFilesToDelete;',
'  var countFilesToDelete = filesToDelete.length',
'  if(countFilesToDelete > 0) {',
'   var _clearOK = function() {',
'   }',
'   var _clearError = function() {',
'   }',
'   _dlgObj.deleteArrayOfFiles(filesToDelete, _clearOK  ,_clearError)',
'  } else {',
'  }',
' };',
' var _error = function(e) { alert(\'failed\')};',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(folderToCleanLocation);;',
' var _dirName = folderToClean;;',
' var _dirPath = _baseURI + _dirName;',
' _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess, _error);',
'}',
',',
' _deleteOrphanIndexDBImages: function(flagForce) {',
' if(typeof flagForce == \'undefined\') flagForce = false;',
' var lObj = this;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var ok = function(data) {',
'  var arr = lObj._harvestMediaFields({indexDB:true, dirtyOnly: false});',
'  var filenamesUsed = [];',
'  for( var i = 0; i < arr.length; i++){',
'   filenamesUsed.push(arr[i].filename);',
'  }',
'   lObj._putIndexDBKeyNamesIntoListData(arr);',
'   var arr = lObj._harvestMediaFields({indexDB:true, dirtyOnly: false});',
'  var filenamesUsed = [];',
'  for( var i = 0; i < arr.length; i++){',
'   filenamesUsed.push(arr[i].filename);',
'  }',
'  var orphan = [];',
'  for(var i = 0; i < data.length; i++) {',
'   if( filenamesUsed.indexOf(data[i]) == -1) {',
'    if(data[i].indexOf(\'INDEXDB\') > -1) {',
'     orphan.push(data[i]);',
'    }',
'   }',
'  }',
'  var result = _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.beforeDeleteOrphanMediaFiles\',{array:orphan});',
'  var flagDeleteOrphans = false;',
'  try{',
'   flagDeleteOrphans = lObj._phoneGap.mediaFiles.download.deleteOrphansAfterSync;',
'  }catch(e) { }',
'  if(flagForce) flagDeleteOrphans = true;',
'  if( result && flagDeleteOrphans) {',
'   if(orphan.length > 0) {',
'    for(var i = 0;i <orphan.length; i++) {',
'     _dlgObj.idbDeleteItem(orphan[i]);',
'    }',
'   }',
'  } else {',
'  }',
'  var txt = JSON.stringify(orphan,\'\',\'\\t\');',
'  lObj.__loadImages();',
'  lObj.populateUXControls()',
' }',
' var error = function() { alert(\'error\');}',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' _dlgObj.idbGetKeys(ok,error);',
'}',
',',
' _indexDBResetImageURLs: function() {',
' var lObj = this;',
' var _data = lObj._data',
' var _dataJSON = JSON.stringify(_data)',
' var rArr = lObj.__replace;',
' var s = \'\';',
' var r = \'\';',
' if (typeof rArr == \'undefined\') return;',
'  for(var i = 0; i < rArr.length; i++) {',
'   s = rArr[i].key;',
'   r = rArr[i].url;',
'   _dataJSON = _dataJSON.replace(s,r)',
' }',
' _dataJSON = _dataJSON.split(\'INDEXDB_\').join(\'\');',
' var _data2 = JSON.parse(_dataJSON);',
' lObj.populate(_data2);',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var obj = {};',
' obj.phase2 = true;',
' _dlgObj.saveListEdits(lObj.listVariableName,obj);',
'}',
',',
' _putIndexDBKeyNamesIntoListData: function(arr) {',
' var lObj = this;',
' var putdata = function(arr,lObj) {',
'  var route = \'\';',
'  var r = \'\';',
'  var d = \'\';',
'  function getData(lObj,route) {',
'   route  = JSON.parse(route);',
'   r = [];',
'   for(var i = 0; i < route.length; i++) {',
'    r.push(route[i].table);',
'    r.push(route[i].row);',
'   }',
'   r.shift();',
'   data = lObj._data;',
'   var d = \'\';',
'   for(var i = 0; i < r.length; i++) {',
'    d = data[r[i]];',
'    data = d;',
'   }',
'   return d;',
'  }',
'  for(var i = 0; i < arr.length; i++) {',
'   var route = arr[i].route;',
'   var data = getData(lObj,route);',
'   if(data[arr[i].listFieldName].indexOf(\'INDEXDB_\') != 0) {',
'    data[arr[i].listFieldName] = \'INDEXDB_\' +arr[i].filename;',
'   }',
'  }',
' }',
' putdata(arr,lObj);',
' lObj.refresh();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' _dlgObj.persistListToLocalStorage(this.listVariableName);',
'}',
',',
' _getBase64Data: function(flagRefreshMode) {',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var listName = this.listVariableName;',
' var lObj = this;',
' if(typeof flagRefreshMode == \'undefined\') flagRefreshMode = false;',
' if(flagRefreshMode) {',
'  var arr = lObj._harvestMediaFields({indexDB:true, dirtyOnly: false});',
'  this._putIndexDBKeyNamesIntoListData(arr);',
' }',
' var okGotKeys = function(data) {',
'  var datajson0 = JSON.stringify(data,\'\',\'\\t\')',
'  var lObj = _dlgObj.getControl(listName)',
'  var arr = lObj._harvestMediaFields({indexDB:true, dirtyOnly: false});',
'  var fetchImages = [];',
'  var msg = JSON.stringify(arr,\'\',\'\\t\');',
'  msg = \'Images found: \' + arr.length + \'\\n\'; + msg;',
'  var countImagesFound = 0;',
'  for(var i = 0; i < arr.length; i++) {',
'   arr[i]._found = false;',
'   var url = arr[i].filename;',
'   var idx = -1;',
'   for(var i2 = 0; i2 < data.length; i2++) {',
'    if(data[i2] == \'\' + url || data[i2] == \'INDEXDB_\' + url) {',
'     arr[i]._found = true;',
'     idx = i2;',
'     countImagesFound++',
'     break;',
'    }',
'   }',
'   if(idx == -1) {',
'    fetchImages.push(arr[i].filename);',
'   } else {',
'   }',
'  }',
'  if(fetchImages.length > 0 ) {',
'  }',
'  var countImagesToFetch = (arr.length - countImagesFound);',
'  var data = [];',
'  data.push(A5.ajax.buildURLParam(\'__array\',JSON.stringify(arr)));',
'  data.push(A5.ajax.buildURLParam(\'__listname\',listName));',
'  data.push(A5.ajax.buildURLParam(\'__progress\',JSON.stringify(lObj._indexdb.mediafiles)));',
'  data = data.join(\'&\')',
'  var that = this;',
'  var result = _dlgObj._list_executeEvent(listName,\'detailView.beforeMediaFilesDownloaded\',{array:arr, originalArray:arr});',
'  if(!result) {',
'   _dlgObj._list_executeEvent(listName,\'detailView.afterMediaFilesDownloaded\',{array:arr, aborted: true, originalArray: arr});',
'   setTimeout(function() {',
'   })',
'   return false;',
'  }',
'  _dlgObj.ajaxCallback(\'\',\'\',\'system:getBase64dataForImages\',\'\',data,{chunkedResponses: {allow: true,maxMessages: -1,maxTime: 600},deviceOfflineFunction: function() {   },checkifserveravailable: true,serveravailabletimeout: 2000,onServerNotAvailable: function() { alert(\'The server is not available\');},retryCount: 0});',
' }',
' var errorGettingKeys = function() { alert(\'error\');}',
' _dlgObj.idbGetKeys(okGotKeys,errorGettingKeys);',
'}',
',',
' applyData: function() {',
' var rn = {UXPRERENDEREDALIAS}_DlgObj.__rownumbers;',
' var data = {UXPRERENDEREDALIAS}_DlgObj.__data;',
' var findData = function(pk) {',
'  for(var i = 0; i < data.length; i++) {',
'   if((\'\'+data[i].__primaryKey).toUpperCase() == (\'\'+pk).toUpperCase()) {',
'    return data[i]',
'   }',
'  }',
'  alert(\'error 9346 in applydata data not found for primary key: \' + pk);',
'  return {}',
' }',
' for(var i = 0; i < rn.length; i++) {',
'  var _pk = rn[i].primaryKey;',
'  var _row = rn[i].rowNumber;',
'  var d = findData(_pk);',
'  var _rowPhysical = this._dataMap[_row]',
'  this._data[_rowPhysical] = d;',
' }',
' this.refresh();',
'}',
',',
' applyData2: function() {',
' if(arguments.length == 0) {',
'  var rn = {UXPRERENDEREDALIAS}_DlgObj.__rownumbers;',
'  var data = {UXPRERENDEREDALIAS}_DlgObj.__data;',
'  var fdata = this._data;',
'  var errors = [];',
'  if(typeof {UXPRERENDEREDALIAS}_DlgObj.__errors != \'undefined\') errors = {UXPRERENDEREDALIAS}_DlgObj.__errors;',
'  var cleanRows = [];',
'  if(typeof {UXPRERENDEREDALIAS}_DlgObj.__cleanRows != \'undefined\') cleanRows = {UXPRERENDEREDALIAS}_DlgObj.__cleanRows;',
'  var _row;',
'  for(var i = 0; i < cleanRows.length; i++) {',
'   var _r = cleanRows[i];',
'   var d = this._getDataFromRoute(_r);',
'   delete d._oldData;',
'  }',
' } else {',
'  var rn = arguments[0];',
'  var data = arguments[1];',
'  var fdata = arguments[2];',
' }',
' var findData = function(pk) {',
'  for(var i = 0; i < data.length; i++) {',
'   if((\'\'+data[i].__primaryKey).toUpperCase() == (\'\'+pk).toUpperCase()) {',
'    return data[i]',
'   }',
'  }',
'  alert(\'error 9345 data not found for primary key: \' + pk);',
'  return {}',
' }',
' for(var i = 0; i < rn.length; i++) {',
'  var _pk = rn[i].primaryKey;',
'  var _row = rn[i].rowNumber;',
'  var d = findData(_pk);',
'  d._isDirty = false;',
'  d._isNewRow = false;',
'  d._hasGlobalErrors = false;',
'  d._flagGlobalErrorInChild = false;',
'  d._hasServerSideError = false;',
'  d._flagServerSideErrorInChild = false;',
'  d._globalErrors = \'\';',
'  d._globalErrorsRaw = \'\';',
'  if(arguments.length == 0) {',
'   var _rowPhysical = this._dataMap[_row];',
'  } else {',
'   var _rowPhysical = _row;',
'  }',
'  var od = fdata[_rowPhysical]',
'  for(var p in d) {',
'   if(p.indexOf(\'__LIST__\') == 0 ) {',
'    var crn = [];',
'    var cData = d[p];',
'    if(typeof od != \'undefined\') {',
'     var oData = od[p];',
'    } else {',
'     var oData = [];',
'     od = {};',
'    }',
'    if(oData.length == 0 && (cData &&cData.length > 0)) {',
'     od[p] = d[p];',
'    } else if(Array.isArray(cData) && oData.length > 0) {',
'     for(var k = 0; k < cData.length; k++) {',
'      var krn = A5.u.array.search(oData,{\'*value\': cData[k].__primaryKey})',
'      if(krn == -1) {',
'       var krn = A5.u.array.search(oData,{\'__primaryKey\': cData[k].__primaryKey});',
'      }',
'      crn.push({primaryKey: cData[k].__primaryKey, rowNumber: krn});',
'     }',
'     this.applyData2(crn,cData,oData);',
'    }',
'   }else { try{od[p] = d[p]} catch(e) { };',
'   }',
'  }',
' }',
' if(arguments.length == 0){',
'  for(var i = 0; i < errors.length; i++) {',
'   var d = this._getDataFromRoute(errors[i].route);',
'   if(d) {',
'    var txt = errors[i].error',
'    var txtRaw = txt;',
'    d._globalErrors = txt;',
'    d._globalErrorsRaw = txtRaw;',
'    d._hasGlobalErrors = true;',
'   }',
'  }',
'  for(var i = 0; i < cleanRows.length; i++) {',
'   var d = this._getDataFromRoute(cleanRows[i]);',
'   if(d) {',
'    d._isNewRow = false;',
'    d._isDirty = false;',
'   }',
'   this._populateMyChildren();',
'  }',
'  this.refresh();',
' }',
'}',
',',
' _pullSyncStart: function() {',
'}',
',',
' _pullSyncEnd: function() {',
' if(this._beforePersistToStorage) this._beforePersistToStorage({mode:\'incrementalRefresh\', data: data});',
' if(this.persistToStorage) this.persistToStorage({mode:\'incrementalRefresh\', data: data});',
'}',
',',
' _setRouteClean: function(route) {',
' var listName = this.listVariableName;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var lObj = _dlgObj.getControl(listName);',
' lObj.setRowClean(route);',
' for(var i = 0; i < route.length; i++) {',
'  if(route[i].constructor == String) {',
'   if(route[i].indexOf(\'__LIST__\') > -1) {',
'    listName = route[i].split(\'__LIST__\')',
'    listName = listName[1];',
'    lObj = _dlgObj.getControl(listName);',
'   }',
'  } else {',
'   lObj.setRowClean(route[i]);',
'  }',
' }',
'}',
',',
' _removeRowsInRoute: function(route) {',
' var listName = this.listVariableName;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var lObj = _dlgObj.getControl(listName);',
' var _d = lObj._data;',
' for(var i = 0; i < route.length; i++) {',
'  if(route[i].constructor == String) {',
'   listName = route[i].split(\'__LIST__\')',
'   listName = listName[1];',
'   lObj = _dlgObj.getControl(listName);',
'  } else {',
'   if(i == route.length-1) {',
'    lObj.removeRows( [route[i]]);',
'    _d.splice( route[i],1);',
'   }',
'  }',
'  _d = _d[route[i]];',
' }',
'}',
',',
' _setLinkValue: function(route,linkfield,linkvalue) {',
' var lObj = this;',
' var _d = lObj._data;',
' for(var i = 0; i < route.length; i++) {',
'   _d = _d[route[i]];',
' }',
' _d[linkfield] = linkvalue;',
' lObj.refresh();',
' lObj._populateMyChildren();',
'}',
',',
' _setPrimaryKey: function(route,pkvalue,pkfields){',
' var lObj = this;',
' var _d = lObj._data;',
' for(var i = 0; i < route.length; i++) {',
'  _d = _d[route[i]];',
' }',
' _d[\'__primaryKey\'] = pkvalue;',
' var f = pkfields.split(\'.\');',
' var v = pkvalue.split(\'|||\');',
' for(var i = 0; i < f.length; i++) {',
'  _d[f[i]] = v[i];',
' }',
' lObj.refresh();',
' lObj._populateMyChildren();',
'}',
',',
' _isValidValue: function(value) {',
' for(var i = 0; i < this._data.length; i++) {',
'  if(this._data[i][\'*value\'] == value) return true;',
' }',
' return false;',
'}',
',',
' _getTopParentListObject: function() {',
' var topParent = this.allParentLists[this.allParentLists.length -1];',
' if(typeof topParent == \'undefined\') {',
'  return this;',
' } else {',
'  var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(topParent);',
'  return lObj;',
' }',
'}',
',',
' _clearNestedArrays: function(row) {',
' var _data = this._data[row];',
' var __clearSubarray = function(_data) {',
'  for(var n in _data) {',
'   if(n.indexOf(\'__LIST__\') == 0) {',
'    _data[n] = []',
'   }',
'  }',
' }',
' __clearSubarray(_data);',
'}',
',',
' _controlDefaultValueForListField: function(fieldName) {',
' var controlName = this._getUXDetailViewControlName(fieldName);',
' if(controlName == \'\') return \'\';',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  return _dlgObj.defaultValues[controlName.toUpperCase()];',
'}',
',',
' _updateRowAfterSync: function(pk,data) {',
' this.updateRow(pk,data);',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' if(_mode == \'edits\') {',
'  _dlgObj._saveSyncedEdits(lObjP.listVariableName,pk,data);',
' }',
'}',
',',
' _updateNewRow: function(rowNum,data) {',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' var _currRow = this.selection[0];',
' this.updateRow(rowNum,data);',
' if(typeof _currRow != \'undefined\') this.setValue(_currRow,false);',
' if(_mode == \'edits\') {',
'  _dlgObj._appendNewRowToSyncedEdits(lObjP.listVariableName,data);',
' }',
'}',
',',
' _updateExistingRow: function(rowNum,data) {',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' this.updateRow(rowNum,data);',
' if(_mode == \'edits\') {',
'  _dlgObj._updateDataInSyncedEdits(lObjP.listVariableName,rowNum,data);',
' }',
'}',
',',
' _removeRowsPullSync: function(array) {',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' if(_mode == \'edits\') {',
'  _dlgObj._updateDeletesInSyncedDeletes(lObjP.listVariableName,array);',
' }',
' this.removeRows(array);',
'}',
',',
' _appendNewRow2: function(data) {',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' this.appendRows(data);',
' if(_mode == \'edits\') {',
'  _dlgObj._appendNewRowToSyncedEdits(lObjP.listVariableName,data);',
' }',
'}',
',',
' _appendNewRow: function(data) {',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' this.appendRows(data);',
' if(_mode == \'edits\') {',
'  _dlgObj._updateDataInSyncedEdits(lObjP.listVariableName,false,data);',
' }',
'}',
',',
' _applyEditsToOriginalData: function(originalData,listEdits) {',
' var flagAdd = false;',
' if(typeof arguments[2] != \'undefined\') flagAdd = arguments[2];',
' var ol = originalData;',
' var edits = listEdits;',
' var findRowDataByKey = function(data,pk) {',
'  var ix = -1;',
'  for(var i = 0; i < data.length; i++) {',
'   if(data[i][\'__primaryKey\'] == pk) {',
'    ix = i;',
'    break;',
'   }',
'  }',
'  var rd = false;',
'  if(ix > -1) {',
'   rd = ix',
'  }',
'  return rd;',
' }',
' var _pk;',
' var _rowData;',
' var flagDoAppend;',
' for (var i = 0; i < edits.length; i++) {',
'  _pk = edits[i][\'__primaryKey\'];',
'  if(typeof _pk == \'undefined\') {',
'   flagDoAppend = true;',
'   if(typeof edits[i]._isDeleted != \'undefined\') {',
'    if(edits[i]._isDeleted) {',
'     flagDoAppend = true',
'    }',
'   }',
'   if(flagAdd && flagDoAppend) originalData.push(edits[i]);',
'  } else {',
'   _rowData = findRowDataByKey(ol,_pk);',
'   if(_rowData != false || typeof _rowData == \'number\') {',
'    originalData[_rowData] = {};',
'    $u.o.assign(originalData[_rowData],edits[i]);',
'   } else {',
'    flagDoAppend = true;',
'    if(typeof edits[i]._isDeleted != \'undefined\') {',
'     if(edits[i]._isDeleted) {',
'      flagDoAppend = true',
'     }',
'    }',
'    if(flagAdd && flagDoAppend) originalData.push(edits[i]);',
'   }',
'  }',
' }',
' return ol;',
'}',
',',
' _applyDeletesToOriginalData: function(data,deletedPK) {',
' for(var i = 0; i < deletedPK.length; i++) {',
'  for(var j = 0; j < data.length; j++) {',
'   if(data[j][\'__primaryKey\'] == deletedPK[i]) {',
'    data.splice(j,1);',
'    break;',
'   }',
'  }',
' }',
' return data;',
'}',
',',
' queryByFormClearControls: function() {',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var controlName;',
' for(var i = 0; i < this._listFields.length; i++) {',
'  controlName = this._getUXDetailViewControlName(this._listFields[i].name);',
'  if(controlName != \'\') {',
'   val = \'\';',
'   _dlgObj.setValue(controlName,val,false);',
'  }',
' }',
'}',
',',
' removeRowFromListByKey: function(rowKey) {',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var curVal = this.value[0];',
' this.nullOutDetailViewRecord();',
' _dlgObj.persistVariablesToLocalStorage();',
' if(curVal != rowKey) {',
'  this.removeRows([rowKey]);',
'  if(typeof curVal != \'undefined\') {',
'   this.setValue(curVal,false);',
'   this._selectedRow = curVal;',
'  }',
'  this.__currentRoute = this._getRoute();',
' } else {',
'  var index = this.indexFromValue(curVal);',
'  var newIndex = \'\';',
'  if( (index+1) < this._dataMap.length) {',
'   newIndex = index;',
'  } else {',
'   newIndex = index -1;',
'  }',
'  this.removeRows([rowKey]);',
'  this.setValue(newIndex,false);',
'  this._selectedRow = newIndex;',
'  this.__currentRoute = this._getRoute();',
' }',
' _dlgObj.refreshClientSideComputations();',
' var lObj = this;',
' if (this._data.length == 0) {',
'  this.setValue(0,false);',
'  this._selectedRow = -1;',
'  var mode = this._noRecordInListIsSelectedSettingForDetailView;',
'  if(mode == \'newrecord\') {',
'   var lObj = this;',
'   setTimeout(function() {lObj.newDetailViewRecord();},10);',
'  } else if (mode == \'disabledetailview\') {',
'   var lObj = this;',
'   setTimeout(function() {lObj.disableDetailView();},10);',
'  }',
' }',
' _dlgObj._listRowSelect(this.listVariableName);',
' var lObjP = this._getTopParentListObject();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
' if(_mode == \'edits\') {',
'  _dlgObj._updateDeletesInSyncedDeletes(lObjP.listVariableName,[rowKey]);',
' }',
'}',
',',
' searchModeOff: function() {',
' if(this._dvmode != \'search\') return true;',
' var val = this._searchModeReturnValue;',
' if(typeof val != \'undefined\') {',
'  if(val != \'\') {',
'   this.setValue(this._searchModeReturnValue);',
'  } else {',
'   this.newDetailViewRecord();',
'  }',
' } else {',
'  this.newDetailViewRecord();',
' }',
'}',
',',
' searchModeOn: function() {',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' if(this.detailViewIsDirty()) {',
'  alert(\'cannot switch to search mode because detail view is dirty\');',
'  return false;',
' }',
' this._dvmode = \'search\';',
' this._setNullMode();',
' this._searchModeReturnValue = this.value;',
' this._deselectAll();',
' this.queryByFormClearControls();',
' if(typeof this.__queryByFormValues != \'undefined\') {',
'  for(var i = 0; i < this.__queryByFormValues.length; i++) {',
'   _dlgObj.setValue(this.__queryByFormValues[i].control,this.__queryByFormValues[i].value,false);',
'  }',
' }',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.modeChanged\',{mode: \'search\'});',
' _dlgObj.refreshClientSideComputations();',
'}',
',',
' populateUXControls: function() {',
' var r = this.selection[0];',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var lObj = this;',
' var listId = this.listVariableName;',
' var rowNum = this.selection[0];',
' if(typeof rowNum == \'undefined\') {',
'  this.nullOutDetailViewRecord();',
'  return;',
' }',
' var flagForce = arguments[1];',
' if(typeof flagForce == \'undefined\') flagForce = false;',
' if(!flagForce)  if(this.detailViewOrChildListDetailViewIsDirty() ) return false;',
' setTimeout(function() {',
'  _dlgObj._listSystemOnClick(listId,rowNum);',
' },100);',
' if(typeof _dlgObj._freeformLayoutLists != \'undefined\') {',
'  if(typeof _dlgObj._freeformLayoutLists[this.listVariableName.toUpperCase()] != \'undefined\') {',
'   var js = _dlgObj._freeformLayoutLists[this.listVariableName.toUpperCase()].javascript;',
'   try{',
'    var data = this._data[rowNum];',
'    eval(js);',
'   }catch(e) { }',
'  }',
' }',
' var ops = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
' ops.listVariableName = this.listVariableName;',
' ops.listObj = this;',
' if(this._detailView.method == \'fieldMap\') argIn = this._detailView.fieldMap;',
' else argIn = this._detailView.container;',
' var _d = this.getData(this.selection[0]);',
' var n = \'\';',
' var b64prefix = \'\'',
' this._currentDetailViewKey = undefined;',
' if(typeof _d == \'undefined\' || _d == null || this.selectionData.length == 0) {',
'  this.nullOutDetailViewRecord();',
'  return false;',
' }',
' if(this._data.length == 0) return false;',
' this._currentDetailViewKey = _d[\'*key\'];',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.beforeDetailViewPopulate\',{});',
' window[this._hostComponentId + \'_DlgObj\']._populateUXControlsWithListData(_d,argIn,ops);',
' for(var id in window[this._hostComponentId + \'_DlgObj\']._floatingLabels) {',
'  window[this._hostComponentId + \'_DlgObj\']._floatingLabels[id](id);',
' };',
' this._clearServerSideErrors();',
' this._showServerSideErrors();',
' this._showWriteConflictErrors();',
' this._dvmode = \'edit\';',
' this._setNullMode();',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.modeChanged\',{mode: \'edit\'});',
' _dlgObj.refreshClientSideComputations();',
' this._setParentIsDeletedOnChildren();',
' if(!this._restoringList) _dlgObj.persistVariablesToLocalStorage();',
' if(typeof _d._flagViewed != \'undefined\') {',
'  if(_d._flagViewed == false) {',
'   _d._flagViewed = true;',
'   this.updateRow(this.selection[0],_d);',
'  }',
' }',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterDetailViewPopulate\',{});',
' if(this._hasDetailView) {',
'  if(this._JSONForm) {',
'   var that = this;',
'   setTimeout(function() {',
'    that.resize();',
'   },0);',
'  }',
' }',
'}',
',',
' _listSystemOnClickPopulateJSONForm: function(rowNum) {',
' var lObj = this;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var flagClientSide = false;',
'  if(lObj.__JSONFormDefinition.indexOf(\'client-side\') > -1) {',
'   flagClientSide = true;',
'  }',
' if(flagClientSide) {',
'  var fName = lObj._JSONFormName;',
'  var fObj = _dlgObj.getControl(fName);',
'  rowNum = lObj._dataMap[rowNum];',
'  var _d = lObj._data[rowNum];',
'  var d = JSON.parse(JSON.stringify(_d))',
'  delete d[\'*key\'];',
'  delete d[\'*renderIndex\'];',
'  delete d[\'*value\'];',
'  var json = JSON.stringify(d);',
'  var itemsJSON = lObj.generateJSONFormDefinitionFromSampleJSON(json);',
'  var items = JSON.parse(itemsJSON)',
'  A5.u.json.postparse(items)',
'  var formDef = {form: {items: items}};',
'  formDef.guides = {',
'   "layouts": {',
'    "flex-label": "<div style=\\"display: flex; width: 100%;\\">\\t<div style=\\"flex: 1 1;\\">{label}</div>\\t<div >{content}</div></div>{error}{description}",',
'    "label-float-above": { draw: function(dObj){  var l = dObj.item.def.sys.item.layout.settings;    if(dObj.item.isNull) return \'<div style="position: relative;"><div float-state="1" style="position: absolute; top: 0px; left: 0px; right: 0px; height: 100%;"><div style="position: absolute; top: 50%; transform: translate(0px,-50%);">{label}</div></div>{content}</div><div>{error}</div><div>{description}</div>\';  else return \'<div style="position: relative;"><div float-state="2" style="position: absolute; top: -\'+l.size+\'; left: 0px; right: 0px; height: \'+l.size+\';\'+l.style+\'"><div style="position: absolute; top: 50%; transform: translate(0px,-50%);">{label}</div></div>{content}</div><div>{error}</div><div>{description}</div>\'; }, settings: {  size: \'14px\',  style: \'\',  duration: 300 }, handle: {  focus: function(dObj){   var e = this.getElements(dObj.item.path.def);   if(e){    e = e[0].children[0].children[0];    if(e && e.getAttribute(\'float-state\') == \'1\'){     var l = dObj.item.def.sys.item.layout.settings;     e.setAttribute(\'float-state\',\'2\');     if(dObj.item.isNull){      if(l.style != \'\') A5.u.element.style(e,\'+=\'+l.style);      A5.u.element.transition(e,{       from: {top: \'0px\', height: \'100%\'},       to: {top: \'-\'+l.size, height: l.size},       duration: l.duration      });     }    }   }  },  blur: function(dObj){   var e = this.getElements(dObj.item.path.def);   if(e){    e = e[0].children[0].children[0];    if(e && e.getAttribute(\'float-state\') == \'2\'){          var l = dObj.item.def.sys.item.layout.settings;     e.setAttribute(\'float-state\',\'1\');     if(dObj.item.isNull){      if(l.style != \'\') A5.u.element.style(e,\'-=\'+l.style);      A5.u.element.transition(e,{       from: {top: \'-\'+l.size, height: l.size},       to: {top: \'0px\', height: \'100%\'},       duration: l.duration      });     }    }   }  } }}',
'   }',
'  };',
'  fObj.setDefinition(formDef)',
'  fObj.populate(d);',
'  return;',
' }',
' rowNum = lObj._dataMap[rowNum];',
' var _d = lObj._data[rowNum];',
' if(typeof _d == \'undefined\') return;',
' var jfObj = _dlgObj.getControl(lObj._JSONFormName);',
' if(jfObj) {',
'  jfObj.__listName = lObj.listVariableName;',
'  var d2 = JSON.parse(JSON.stringify(_d))',
'  jfObj.populate(d2);',
'  jfObj.refresh();',
' }',
' }',
',',
' generateJSONFormDefinitionFromSampleJSON: function (json) {    var lObj = this;',
'    var generateFormLow = function (items, data, path) {',
'        if (data == null) return;',
'        if (data.constructor == Array) {',
'            if (data.length > 0) {',
'                var item = {',
'                    type: \'frame\',',
'                    container: {',
'                        collapse: { allow: true, initial: true },',
'                        className: \'formIndent\',',
'                        title: {',
'                            html: \'<div style="margin-left: -8px;">\' + path + \'</div>\',',
'                            className: \'[theme:accordion.base.titleClassName] formIndentable\',',
'                            selectedClassName: \'[theme:accordion.base.titleSelectedClassName] formIndentable\'',
'                        }',
'                    },',
'                    items: [',
'                        {',
'                            type: \'repeat\',',
'                            data: { from: path },',
'                            items: []',
'                        }',
'                    ]',
'                }',
'                generateFormLow(item.items[0].items, data[0], \'\');',
'                items.push(item);',
'            }',
'        } else if (data.constructor == Object) {',
'            if (path != \'\') {',
'                var item = {',
'                    type: \'frame\',',
'                    container: {',
'                        collapse: { allow: true, initial: true },',
'                        className: \'formIndent\',',
'                        title: {',
'                            html: \'<div style="margin-left: -8px;">\' + path + \'</div>\',',
'                            className: \'[theme:accordion.base.titleClassName] formIndentable\',',
'                            selectedClassName: \'[theme:accordion.base.titleSelectedClassName] formIndentable\'',
'                        }',
'                    },',
'                    data: { from: path },',
'                    items: []',
'                }',
'                generateFormLow(item.items, data, \'\');',
'                items.push(item);',
'            } else {',
'                for (var n in data) {',
'                    var sysFields = [',
'                        \'_flagGlobalErrorInChild\',',
'                        \'_flagServerSideErrorInChild\',',
'                        \'_flagWriteConflictErrorInChild\',',
'                        \'_hasGlobalErrors\',',
'                        \'_hasServerSideError\',',
'                        \'_hasUnsyncedMediaFiles\',',
'                        \'_hasWriteConflictErrors\',',
'                        \'_isDirty\',',
'                        \'_isNewRow\',',
'                        \'_serverSideErrors\',',
'                        \'_writeConflictErrors\',',
'                        \'__proto__\',',
'                        \'_dirtyImages\'',
'                    ]',
'                    if (sysFields.indexOf(n) > -1 || n.indexOf(\'__\') >= 0 || n.indexOf(\'*\') >= 0) {',
'                    } else {',
'                        generateFormLow(items, data[n], n);',
'                    }',
'                }',
'            }',
'        } else {',
'            if (typeof data == \'boolean\') {',
'                items.push({',
'                    type: \'switch\',',
'                    layout: \'label-above\',',
'                    label: { text: path },',
'                    data: { from: path },',
'                    control: {',
'                        values: {',
'                            on: true,',
'                            off: false',
'                        }',
'                    }',
'                });',
'            } else if (typeof data == \'number\') {',
'                items.push({',
'                    type: \'step-number\',',
'                    layout: \'label-above\',',
'                    label: { text: path },',
'                    data: { from: path },',
'                    control: {',
'                        flow: \'rtl\',',
'                        layout: \'after\'',
'                    }',
'                });',
'            } else {',
'                items.push({',
'                    type: \'edit\',',
'                    layout: \'label-before\',',
'                    label: { text: path, style: \'width:200px; \' },',
'                    data: { from: path },',
'                    control: {',
'                        width: \'100%\'',
'                    }',
'                });',
'            }',
'        }',
'    }',
'    var formData = null;',
'    try {',
'        formData = JSON.parse(json);',
'    } catch (e) {',
'        alert(\'Error - could not parse JSON\')',
'    }',
'    if (formData) {',
'        var bSave = {',
'            "type": "button",',
'            "disabled": function (d) { return this._saveButtonIsDisabled() },',
'            "control": {',
'                "layout": "icon text",',
'                "html": "Save",',
'                "style": "white-space:nowrap",',
'                "icon": lObj.__jsonformicons.save,',
'                "onClick": function () {',
'                    this._listDetailView(\'save\')',
'                }',
'            },',
'            "container": {',
'                "style": ";",',
'                "className": ""',
'            }',
'        }',
'        var bNewRecord = {',
'            "type": "button",',
'            "disabled": function (d) { return this._newRecordButtonIsDisabled() },',
'            "control": {',
'                "layout": "icon text",',
'                "html": "New Record",',
'                "icon": lObj.__jsonformicons.newrecord,',
'                "listName": lObj.listVariableName,',
'                "style": "white-space:nowrap",',
'                "onClick": function () {',
'                    this._listDetailView(\'newrecord\')',
'                }',
'            },',
'            "container": {',
'                "style": ";",',
'                "className": ""',
'            }',
'        }',
'        var bDeleteRecord = {',
'            "type": "button",',
'            "disabled": function (d) { return this._deleteRecordButtonIsDisabled() },',
'            "control": {',
'                "layout": "icon text",',
'                "html": "Delete Record",',
'                "style": "white-space:nowrap",',
'                "icon": lObj.__jsonformicons.deleterecord,',
'                "listName": lObj.listVariableName,',
'                "onClick": function () {',
'                    this._listDetailView(\'deleterecord\')',
'                }',
'            },',
'            "container": {',
'                "style": ";",',
'                "className": ""',
'            }',
'        }',
'        var bresetRecord = {',
'            "type": "button",',
'            "disabled": function (d) { return this._resetRecordButtonIsDisabled() },',
'            "control": {',
'                "layout": "icon text",',
'                "html": "Reset",',
'                "icon": lObj.__jsonformicons.reset,',
'                "style": "white-space:nowrap",',
'                "listName": lObj.listVariableName,',
'                "onClick": function () {',
'                    this._listDetailView(\'reset\')',
'                }',
'            },',
'            "container": {',
'                "style": ";",',
'                "className": ""',
'            }',
'        }',
'        var bSnchronizeRecord = {',
'            "type": "button",',
'            "disabled": function (d) { return this._synchronizeButtonIsDisabled() },',
'            "control": {',
'                "layout": "icon text",',
'                "html": "Synchronize",',
'                "style": "white-space:nowrap",',
'                "icon": lObj.__jsonformicons.synchronize,',
'                "listName": lObj.listVariableName,',
'                "onClick": function () {',
'                    this._listDetailView(\'synchronize\')',
'                }',
'            },',
'            "container": {',
'                "style": ";",',
'                "className": ""',
'            }',
'        }',
'        var formDef = { form: { items: [] } };',
'        generateFormLow(formDef.form.items, formData, \'\');',
'        var buttonsDef = {',
'            type: \'group\',',
'            container: {',
'                style: \'display:flex; flex-direction:row;\'',
'            },',
'            items: [{',
'                type: \'html\',',
'                container: {',
'                    style: \'flex:1 1 auto;\'',
'                }',
'            }, bSave, bNewRecord, bDeleteRecord, bresetRecord, bSnchronizeRecord]',
'        };',
'        formDef.form.items.push(buttonsDef)',
'        A5.u.json.preparse(formDef.form.items)',
'        var itemsJSON = JSON.stringify(formDef.form.items)',
'        return itemsJSON;',
'    }',
'}',
',',
' _setParentIsDeletedOnChildren: function() {',
'  var _d = this.getData(this.selection[0]);',
'  if(typeof _d == \'undefined\' || _d == null || this.selectionData.length == 0) {',
'   return false;',
'  }',
'  var flagDel = false;',
'  if(typeof _d[\'_isDeleted\'] != \'undefined\') flagDel = _d[\'_isDeleted\'];',
'  if(!flagDel) {',
'   var flagParentIsDeleted = false;',
'   var pData = \'\';',
'   if(typeof this.allParentLists == \'undefined\') return false;',
'   if(this.allParentLists.length > 0) {',
'    for(var i = 0; i < this.allParentLists.length; i++) {',
'     pObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.allParentLists[i]);',
'     if(typeof pObj.selection[0] != \'undefined\') {',
'      pData = pObj.getData(pObj.selection[0]);',
'      if(typeof pData._isDeleted != \'undefined\') {',
'       if(pData._isDeleted) {',
'        flagParentIsDeleted = true;',
'        break;',
'       }',
'      }',
'     }',
'    }',
'   }',
'   if(flagParentIsDeleted) flagDel = true;',
'  }',
'  var flagParentIsDeleted = false;',
'  if(typeof this._parentIsDeleted != \'undefined\') flagParentIsDeleted =  this._parentIsDeleted;',
'  this.disableDetailView(flagDel || flagParentIsDeleted);',
'  var lChildObj = \'\';',
'  for(var i = 0; i < this.childLists.length; i++) {',
'   lChildObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'   if(lChildObj) {',
'    lChildObj.disableDetailView(flagDel);',
'    if(flagDel) $acn(lChildObj.contId,\'parentIsDeleted\');',
'    else $rcn(lChildObj.contId,\'parentIsDeleted\');',
'    lChildObj._parentIsDeleted = flagDel;',
'    lChildObj._setParentIsDeletedOnChildren();',
'   }',
'  }',
' }',
',',
' _saveTFEdits: function() {   if(this._dataSourceType != \'undefined\') {',
'    if(this._dataSourceType.toLowerCase() == \'transform\') {',
'     if(typeof {UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls != \'undefined\') {',
'      var lName = this.listVariableName;',
'      if(typeof {UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls[lName] !=\'undefined\') {',
'       tfDataViewer = {UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls[lName]["tfcontrol"];',
'       if(tfDataViewer != \'\') {',
'        var tfObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(tfDataViewer);',
'        tfObj.dirty = false;;',
'        if(tfObj.saveEditedRenderedFields) tfObj.saveEditedRenderedFields()',
'        var initialState = \'edit\';',
'        if(typeof tfObj.initialState != \'undefined\') initialState = tfObj.initialState;',
'        if(initialState.toLowerCase() == \'view\') {',
'         tfObj.editMode(false);',
'        }',
'        if(tfObj){',
'         tfObj.renderForm();',
'         var _d = tfObj.fieldsdata.formdata;',
'        }',
'        var r = this.selection[0];',
'        this.updateTableRow(r,_d);',
'       }',
'      }',
'     }',
'    }',
'   }',
' }',
',',
' __captureDetailViewControlsDirtyState: function() {',
'  var lObj = this;',
'  var _dlgObj2 = window[lObj._hostComponentId + \'_DlgObj\'];',
'  if (lObj._detailView.method == \'fieldMap\') {',
'   var arr = lObj._detailView.fieldMap',
'   for(var i = 0; i < arr.length; i++) {',
'    arr[i].isDirty = _dlgObj2.getControlDirty(arr[i].control.toUpperCase());',
'   }',
'  } else {',
'   var cont = lObj._detailView.container',
'   var a1 = {UXPRERENDEREDALIAS}_DlgObj.getControlsInContainer(cont)',
'   var arr = []',
'   for(var i = 0; i < a1.length; i++) {',
'    arr.push({control: a1[i], isDirty:  {UXPRERENDEREDALIAS}_DlgObj.getControlDirty(a1[i].toUpperCase()) });',
'   }',
'  }',
'  return arr;',
' }',
',',
' __pktoRecno: function(pk) { var d = this._data;',
' for(var i = 0; i < d.length; i++) {',
'  if(d[i].__primaryKey == pk ) return i;',
' }',
' return -1;',
'}',
',',
' __modifyOldData: function(arr,rowIn) {',
'  return',
'  rowIn = this._dataMap[rowIn]',
'  var _method = \'fieldMap\';',
'  try{',
'   _method = this._detailView.method;',
'  }catch(e) { };',
'  if(_method.toLowerCase() == \'container\') {',
'   for(var i = 0; i < arr.length; i++) {',
'    arr[i].field = arr[i].control;',
'   }',
'  }',
'  var lObj = this',
'  if(typeof rowIn == \'undefined\') {',
'   var row = lObj.selection[0];',
'  } else {',
'   var row = rowIn;',
'  }',
'  if(typeof row == \'string\') row = this.__pktoRecno(row);',
'  if(typeof row == \'undefined\') return ;',
'  var oldData = lObj._data[row]._oldData;',
'  if(typeof oldData == \'undefined\') return;',
'  if(typeof lObj._data[row]._editedByUser == \'undefined\') {',
'   lObj._data[row]._editedByUser = [];',
'  }',
'  for(var i = 0; i < arr.length; i++) {',
'   if(arr[i].isDirty) {',
'    if(lObj._data[row]._editedByUser.indexOf(arr[i].field) == -1) lObj._data[row]._editedByUser.push(arr[i].field);',
'    if(oldData[arr[i].field] == null) {',
'     oldData[arr[i].field] =  \':::___null___::::::___DIRTY___:::\';',
'    } else {',
'     if( ( \'\' +oldData[arr[i].field]).indexOf(\':::___DIRTY___:::\') == -1) {',
'      oldData[arr[i].field] = oldData[arr[i].field] + \':::___DIRTY___:::\';',
'     }',
'    }',
'   }',
'  }',
' }',
',',
' updateListFromUXControls: function() {',
'  var lObj = this;',
'  try{',
'   var jformstocommit = lObj._detailView.jsonformstoWatch;',
'  }catch(e) {',
'   var jformstocommit = \'\'',
'  }',
'  if(typeof jformstocommit == \'undefined\') jformstocommit = \'\';',
'  if(jformstocommit != \'\') {',
'   jformstocommit = jformstocommit.split(\',\')',
'   for(var i = 0; i < jformstocommit.length; i++) {',
'    var jfi = jformstocommit[i];',
'    var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'    var fObj = _dlgObj.getControl(jfi);',
'    if(fObj && fObj.commit) fObj.commit()',
'   }',
'  }',
'  if(lObj._updatingListFromUXControls) return false;',
'  lObj._updatingListFromUXControls = true;',
'  if(lObj._propertyGrid) {',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var propertyGridName = this._propertyGridName;',
'   var pObj = _dlgObj.getControl(propertyGridName);',
'   pObj.state.isDirtyImmediate = false;',
'   pObj.state.isDirty = false;',
'   pObj.refresh();',
'   var flag = this.detailViewIsDirty();',
'   var data = _dlgObj.getValue(propertyGridName);',
'   _dlgObj.refreshClientSideComputations();',
'   var d = JSON.parse(data);',
'   d = d.v;',
'   var d2 = {}',
'   for(var n in d) {',
'    if(n.indexOf(\'*\') != 0) {',
'     d2[n] = d[n];',
'    }',
'   }',
'   var r = lObj.selection[0];',
'   if(typeof r != \'undefined\') {',
'    lObj.updateTableRow(r,d2);',
'   } else {',
'    lObj.addTableRow(d2,{setFocusToTargetRow: true})',
'   }',
'  }',
'  if(lObj._JSONForm) {',
'   var formName = lObj._JSONFormName;',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var data = _dlgObj.getValue(formName);',
'   var d = JSON.parse(data);',
'   var d2 = {}',
'   for(var n in d) {',
'    if(n.indexOf(\'*\') != 0) {',
'     d2[n] = d[n];',
'    }',
'   }',
'   var r = lObj.selection[0];',
'   if(typeof r != \'undefined\') {',
'    lObj.updateTableRow(r,d2);',
'   } else {',
'    lObj.addTableRow(d2,{setFocusToTargetRow: true})',
'   }',
'   var fObj = _dlgObj.getControl(formName);',
'   fObj.state.isDirty = false;',
'   fObj.refresh();',
'  }',
'  var arrState = this.__captureDetailViewControlsDirtyState();',
'  var dirtyControls = [];',
'  for(var i = 0; i < arrState.length; i++) {',
'   if(arrState[i].isDirty) dirtyControls.push(arrState[i].field)',
'  }',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var arr = this._getControlsInDv()',
'  for(var i = 0; i < arr.length; i++) {',
'   _dlgObj.clientSideValidateField(arr[i],1,null);',
'  }',
'  var flagCSE = this._hasClientSideError();',
'  if(flagCSE) {',
'   _dlgObj._list_executeEvent(this.listVariableName,\'detailView.hasClientSideValidationErrors\',{});',
'   var msg = this.customization.dv.clientSideErrorWarning;',
'   if(typeof msg != \'undefined\' && msg != \'\') this._showGlobalError(msg);',
'   lObj._updatingListFromUXControls = false;',
'   return false;',
'  } else {',
'   this._clearGlobalError();',
'  }',
'  var _route = this._getRoute();',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var flagGetLocationData = this._submitLocationInfo',
'  if( _dlgObj._embeddedMode || _dlgObj._livePreviewInBuilder) flagGetLocationData = false;',
'  var that = this;',
'  if(flagGetLocationData) {',
'   var _locationHighAccuracy = _dlgObj.locationHighAccuracy;',
'   var _locationTimeout = _dlgObj.locationTimeout;',
'   var _locationMaximumAge = _dlgObj.locationMaximumAge;',
'   var classInst = this;',
'   navigator.geolocation.getCurrentPosition(',
'    function(pos) {',
'     if(typeof _dlgObj._location == \'undefined\') _dlgObj._location = {};',
'     _dlgObj._location.lat = pos.coords.latitude;',
'     _dlgObj._location.lng = pos.coords.longitude;',
'     classInst._updateListFromUXControlsLow();',
'     classInst.__modifyOldData(arrState);',
'     delete classInst;',
'     if(that.synchronizeImmediately) {',
'      var flagOnLine = _dlgObj._getOnlineStatus();',
'      if (flagOnLine) {',
'        _dlgObj.saveListEdits(that.listVariableName)',
'      } else {',
'      }',
'     }',
'     var dirtyClass = \'\';',
'     if(typeof that.dirtyControlClassName != \'undefined\') dirtyClass = that.dirtyControlClassName;',
'     if(dirtyClass != \'\') that.populateUXControls();',
'     that._setRoute(_route);',
'     if(!that._restoringList)  _dlgObj.persistVariablesToLocalStorage();',
'     _dlgObj.refreshClientSideComputations();',
'     return true;',
'    },',
'    function(error) {',
'     delete _dlgObj._location;',
'     classInst._updateListFromUXControlsLow();',
'     classInst.__modifyOldData(arrState);',
'     delete classInst;',
'     if(that.synchronizeImmediately) {',
'      var flagOnLine = _dlgObj._getOnlineStatus();',
'      if (flagOnLine) {',
'        _dlgObj.saveListEdits(that.listVariableName)',
'      } else {',
'      }',
'     }',
'     var dirtyClass = \'\';',
'     if(typeof that.dirtyControlClassName != \'undefined\') dirtyClass = that.dirtyControlClassName;',
'     if(dirtyClass != \'\') that.populateUXControls();',
'     that._setRoute(_route);',
'     if(!that._restoringList)  _dlgObj.persistVariablesToLocalStorage();',
'     _dlgObj.refreshClientSideComputations();',
'     return true;',
'    } , {enableHighAccuracy : _locationHighAccuracy, timeout: _locationTimeout, maximumAge: _locationMaximumAge})',
'    lObj._updatingListFromUXControls = false;',
'    return true;',
'  } else {',
'   this.__modifyOldData(arrState);',
'   if(!(lObj._JSONForm|| lObj._propertyGrid)) {',
'    this._updateListFromUXControlsLow();',
'    lObj.__setJSONFormsInFieldMapClean();',
'   }',
'  }',
'  this._saveTFEdits();',
'  this._setRoute(_route);',
'  if(!this._restoringList)  _dlgObj.persistVariablesToLocalStorage();',
'  _dlgObj.refreshClientSideComputations();',
'  if(this.synchronizeImmediately) {',
'   var flagOnLine = _dlgObj._getOnlineStatus();',
'   if (flagOnLine) {',
'     this.__modifyOldData(arrState);',
'     _dlgObj.saveListEdits(this.listVariableName)',
'   } else {',
'    this.__modifyOldData(arrState);',
'   }',
'  }',
'  var dirtyClass = \'\';',
'  if(typeof this.dirtyControlClassName != \'undefined\') dirtyClass = this.dirtyControlClassName;',
'  if(dirtyClass != \'\') this.populateUXControls();',
'  if(this.showHideDetailView) this.__toggleDetailView(\'hide\');',
'  this.__modifyOldData(arrState);',
'  if(this.__pkisguid && this.__assignPKGuidClientSide) {',
'   var r = this.selection[0];',
'   if(typeof r != \'undefined\') {',
'    if(typeof this._data[r][this.__pkfieldname] != \'undefined\' && this._data[r][this.__pkfieldname] == \'\') {',
'     var flagNewRow = this._data[r]._isNewRow;',
'     if(flagNewRow) {',
'      var obj2 = {};',
'      obj2[this.__pkfieldname] = A5.UUID();',
'      if(!this.__stripcurlyfromguid) {',
'       obj2[this.__pkfieldname] = \'{\' + obj2[this.__pkfieldname] + \'}\';',
'      }',
'      this.updateTableRow(r,obj2);',
'     }',
'    }',
'   }',
'  }',
'  if(this._detailView.method == \'JSONForm\') {',
'   var _name = this._JSONFormName;',
'   var jObj = _dlgObj.getControl(_name);',
'   if(jObj) {',
'    jObj.state.isDirtyImmediate = false;',
'    jObj.refresh();',
'   }',
'  }',
'  _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterDetailViewSave\',{dirtyFields: dirtyControls.toString()});',
'  this.__indexDBAfterDetailViewSaveImages(dirtyControls.toString())',
'  lObj._updatingListFromUXControls = false;',
' }',
' ,',
' __setJSONFormsInFieldMapClean: function() {  if (this._detailView.method != \'fieldMap\') return;',
'  var arr = this._detailView.fieldMap;',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  for(var i = 0; i < arr.length; i++) {',
'   var jformname = arr[i].control.split(\'::\')[1];',
'   if(typeof jformname != \'undefined\') {',
'    var obj = _dlgObj.getControl(jformname);',
'    if(obj) obj.state.isDirty = false;',
'   }',
'  }',
' }',
' ,',
' __indexDBAfterDetailViewSaveImages: function(dirtyFields) {',
'  var lTemp = this._getTopParentListObject();',
'  var persistLocation = \'\';',
'  if(lTemp.__flagPersist) {',
'   persistLocation = lTemp.__persistWhere;',
'  };',
'  var flagRepopulateUXControls = false;',
'  if(persistLocation.toLowerCase() == \'indexdb\' ) {',
'   var dirtyFields = dirtyFields.split(\',\');',
'   var data = {};',
'   for(var i = 0; i < dirtyFields.length; i++) {',
'    var fieldi = dirtyFields[i]',
'    var indx = this._mediaFields.indexOf(fieldi);',
'    if(indx > -1) {',
'     var r = this.selection[0];',
'     var b64 = this._rData[r][fieldi];',
'     b64 = b64.split(\'base64,\')[1]',
'     var key = \'INDEXDB_temporary_\' + A5.UUID() + \'.JPG\';',
'     var lObj = this;',
'     var _itemSaved = function() {',
'      lObj.__loadImages(false,true);',
'     }',
'     var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'     _dlgObj.idbSetItem(key,b64,_itemSaved);',
'     data[fieldi] = key ;',
'     flagRepopulateUXControls = true;',
'    }',
'   }',
'   if(typeof r != \'undefined\') {',
'    this.updateTableRow(r,data);',
'   }',
'   if(flagRepopulateUXControls) {',
'    setTimeout(function() { lObj.populateUXControls();},100);',
'   }',
'  }',
' }',
' ,',
' _updateListFromUXControlsLow: function() {  var flagCSE = this._hasClientSideError();',
' if(flagCSE) {',
'  var msg = this.customization.dv.clientSideErrorWarning;',
'  if(msg != \'\') this._showGlobalError(msg);',
'  return false;',
' } else {',
'  this._clearGlobalError();',
' }',
' flagAllParentListsHaveActiveRow = true;',
' var pObj = \'\';',
' if(this.allParentLists.length > 0) {',
'  for(var i = 0; i < this.allParentLists.length; i++) {',
'   pObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.allParentLists[i]);',
'   if(typeof pObj.selection[0] == \'undefined\') {',
'    flagAllParentListsHaveActiveRow = false;',
'    alert(\'List: \' + this.listVariableName + \': Can\\\'t save record because there is no active record in the parent List. Parent list id: \\\'\'+this.allParentLists[i]+\'\\\'\');',
'    this.resetForm({prompt: false});',
'    return false;',
'    break;',
'   }',
'  }',
' }',
' var ops = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
' var flagSynchronize = this.synchronizeImmediately;',
' if(typeof ops.synchronize == \'undefined\') {',
'  ops.synchronize = flagSynchronize;',
' }',
' if(this._detailView.method == \'fieldMap\') {',
'  var res = window[this._hostComponentId + \'_DlgObj\']._updateListDataFromUXControls(this.listVariableName,this._detailView.fieldMap,ops); this._refreshDebugInfo();',
' } else {',
'  var res = window[this._hostComponentId + \'_DlgObj\']._updateListDataFromUXControls(this.listVariableName,this._detailView.container,ops); this._refreshDebugInfo();',
' }',
' var parentListName = this.parentList;',
' if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'  var thisData = this.getData(this.selection[0]);',
'  var flagIsNewRow = false;',
'  if(typeof thisData._isNewRow != \'undefined\') flagIsNewRow = thisData._isNewRow;',
'  var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.parentList);',
'  if(plObj._setDirtyByChild) {',
'   if (flagIsNewRow == false)   plObj._setDirtyByChild(false);',
'   else plObj._setDirtyByChild(true,thisData,this.listVariableName);',
'  }',
' }',
' this._populateMyChildren();',
' var that = this;',
' setTimeout(function() {var r = that.selection[0];that.refresh(); that.setValue(r,false);},10);',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterUpdateList\',{});',
' _dlgObj._list_executeEvent(this.listVariableName,\'detailView.onStateChanged\',{isDirty:false});',
' delete this.__detailViewWentDirtyHasFired == \'undefined\'',
' var arr = this._getControlsInDv();',
' for(var i = 0; i < arr.length; i++) {',
'  _type = _dlgObj._getControlType(arr[i]);',
'  if(_type == \'formbox\') {',
'   var _obj = _dlgObj.getControl(arr[i])',
'   if(_obj) _obj.state.isDirty = false;',
'  }',
' }',
' return res;',
'},',
' _setDirtyByChild: function(flagNewRow) {',
'  var rn = this.selection[0];',
'  if(typeof rn == \'undefined\') rn = 0;',
'  if(flagNewRow) {',
'   var newData = arguments[1];',
'   var listName = arguments[2];',
'   this.setRowDirty(rn,true,newData,listName);',
'  } else {',
'   this.setRowDirty(rn,false);',
'  }',
'  var parentListName = this.parentList;',
'  if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'   if(parentListName != \'\') {',
'    var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentListName);',
'    if(plObj._setDirtyByChild)  plObj._setDirtyByChild(false);',
'   }',
'  }',
'  window[this._hostComponentId + \'_DlgObj\'].refreshClientSideComputations();',
' }',
' ,',
' _getChildData: function(existingData,childListName) {  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var clObj = _dlgObj.getControl(childListName);',
'  if(!clObj) return false;',
'  if(clObj._dataSourceType.toLowerCase() == \'sql\') {',
'   return existingData[\'__LIST__\' + childListName];',
'  } else {',
'   return existingData[clObj._objectNameInParentListForData];',
'  }',
' }',
' ,',
' _getChildDataObjectName: function(childListName) {   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var clObj = _dlgObj.getControl(childListName);',
'  if(!clObj) return \'__LIST__\' + childListName.toUpperCase();',
'  if(clObj._dataSourceType.toLowerCase() == \'sql\') {',
'   return \'__LIST__\' + childListName.toUpperCase();',
'  } else {',
'   return clObj._objectNameInParentListForData',
'  }',
' }',
' ,',
' setRowDirty: function(rn,flagNewRow) {',
'  var existingData = this.getData(rn);',
'  if(typeof existingData == \'undefined\') return;',
'  existingData._isDirty = true;',
'  if(flagNewRow) {',
'   var newData = arguments[2];',
'   var listName = arguments[3];',
'   var childData = this._getChildData(existingData,listName);',
'   if(typeof childData == \'undefined\') return false;',
'   var childDataObjectName = this._getChildDataObjectName(listName);',
'   var n = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(childData,\'*key\',newData[\'*key\']);',
'   if(n == -1) {',
'    if(existingData[childDataObjectName].constructor == Array) {',
'     existingData[childDataObjectName].push(newData);',
'    } else {',
'     existingData[childDataObjectName] =  [];',
'     existingData[childDataObjectName].push(newData);',
'    }',
'   } else {',
'   }',
'  }',
'  this.updateRow(rn,existingData);',
' }',
' ,',
' _showDirtyDetailViewWarning: function() {',
'  if(!this.detailViewIsDirty(true)) return true;',
'  else {',
'   var obj = {};',
'   obj.thisListName = this.listVariableName;',
'   obj.dirtyListName = this._nameOfListWithDirtyDetailView;',
'   obj.handled = false;',
'   window[this._hostComponentId + \'_DlgObj\']._list_executeEvent(this.listVariableName,\'detailView.afterListRowSelectCancelled\',obj);',
'   if(obj.handled) return false;',
'   var msg = this.customization.dv.dirtyDetailViewRecord.message;',
'   if(msg.toLowerCase().indexOf(\'javascript:\') == 0) {',
'    var fn = msg.split(\':\')[1];',
'    fn = fn.split(\'(\')[0];',
'    window[fn].call();',
'    return false;',
'   }',
'   var image = this.customization.dv.dirtyDetailViewRecord.icon;',
'   var iconType = window[this._hostComponentId + \'_DlgObj\']._iconType(image);',
'   var imageHTML = window[this._hostComponentId + \'_DlgObj\']._getImageHTML(image,iconType);',
'   var flagThisListHasDirtyDv = false;',
'   if(this.listVariableName == this._nameOfListWithDirtyDetailView) flagThisListHasDirtyDv = true;;',
'   if(!flagThisListHasDirtyDv) {',
'    msg = msg + \'<br>(List with dirty Detail View: \\\'\' + this._nameOfListWithDirtyDetailView + \'\\\')\';',
'   }',
'   msg = \'<div style="padding: 10px;" >\' + imageHTML + msg + \'<br style="clear: both;" /></div>\';',
'   var title = this.customization.dv.dirtyDetailViewRecord.title;',
'   A5.msgBox.show(title,msg,\'O\',function() {} );',
'   return false;',
'  }',
' }',
' ,',
' _getListFieldFromControl: function(ctrl) {',
'  var indx = \'\';',
'  if(this._detailView.method == \'fieldMap\') {',
'   var map = this._detailView.fieldMap;',
'   indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(map,\'control\',ctrl);',
'   if(indx > -1) return map[indx].field',
'  } else {',
'   ctrl = ctrl.toUpperCase();',
'   var la = this._listFields;',
'   for(var i = 0; i < la.length; i++) {',
'    if(la[i].name.toUpperCase() == ctrl) return la[i].name;',
'   }',
'   return false;',
'  }',
' }',
' ,',
' disableDetailView: function() {   var flag = typeof arguments[0] != \'undefined\' ? arguments[0] : true;',
'  window[this._hostComponentId + \'_DlgObj\'].setDisabled(this._getControlsInDv(),flag);',
' }',
' ,',
' _getControlsInDv: function() {  if(typeof this._controlsInDV != \'undefined\') {',
'   return this._controlsInDV;',
'  }',
'  var arr = [];',
'  if(typeof this._detailView == \'undefined\') return \'\';',
'  if(typeof this._detailView.method == \'undefined\') return \'\';',
'  if(this._detailView.method == \'fieldMap\') {',
'   var ele = \'\';',
'   for (var i = 0; i < this._detailView.fieldMap.length; i++) {',
'    ele = $(this._hostComponentId + \'.V.R1.\' + this._detailView.fieldMap[i].control.toUpperCase());',
'    if(ele) arr.push(this._detailView.fieldMap[i].control.toUpperCase());',
'   }',
'   this._controlsInDV = arr;',
'   return arr;',
'  } else {',
'   var indx = -1;',
'   var ctrlList = window[this._hostComponentId + \'_DlgObj\'].getControlsInContainer(this._detailView.container);',
'   for(var c = 0; c < ctrlList.length; c++) {',
'    for(var i = 0; i < this._listFields.length; i++) {',
'     if(this._listFields[i].name.toLowerCase() == ctrlList[c].toLowerCase()) arr.push(ctrlList[c].toUpperCase());',
'    }',
'   }',
'   this._controlsInDV = arr;',
'   return arr;',
'  }',
' }',
' ,',
' _stripCleanBase64Data: function(_d) {   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var _dc = {}',
'  var cn = \'\';',
'  var ct = \'\';',
'  var flagDirty = \'\';',
'  var flagCapture = \'\';',
'  var ix = \'\';',
'  var flagEmbeddedImage = \'\';',
'  for(var prop in _d) {',
'   flagCapture = true;',
'   cn = this._getUXDetailViewControlName(prop);',
'   if(cn != \'\') {',
'    ct = _dlgObj._getControlType(cn).toLowerCase();',
'    if(ct == \'signaturecapture\' || ct == \'image\') {',
'     flagCapture = false;',
'     var _dirtyImages = _d[\'_dirtyImages\'];',
'     var flagImageDirty = false;',
'     if(typeof _dirtyImages != \'undefined\') {',
'      flagImageDirty = _dirtyImages[prop];',
'      if(typeof flagImageDirty != \'undefined\') flagCapture = true;',
'     } else {',
'      flagCapture = true;',
'     }',
'    }',
'   }',
'   if(flagCapture) _dc[prop] = _d[prop];',
'  }',
'  return _dc;',
' }',
' ,',
' _getData2: function(row) {',
'  var _d = this.getData(row);',
'  return this._stripCleanBase64Data(_d);',
' }',
' ,',
' harvestListRow: function() {',
'  var rn = typeof arguments[0] != \'undefined\' ? arguments[0] : -1;',
'  var obj = typeof arguments[1] != \'undefined\' ? arguments[1] : {};',
'  var flagSumbmitAllChildRecords = false;',
'  if(typeof obj.flagSumbmitAllChildRecords != \'undefined\') flagSumbmitAllChildRecords = obj.flagSumbmitAllChildRecords;',
'  var flagCaptureImages = false;',
'  if(typeof obj.flagCaptureImages != \'undefined\') flagCaptureImages = obj.flagCaptureImages;',
'  if(typeof rn != \'number\') {',
'   if(!rn._isNewRow){',
'    if(flagCaptureImages) {',
'     var existingData = rn;',
'    } else {',
'     var existingData = this._stripCleanBase64Data(rn);',
'    }',
'   } else {',
'    var existingData = rn;',
'   }',
'  } else {',
'   if(rn > -1) {',
'    var existingData = this._getData2(rn);',
'   } else {',
'    if(this.selection[0] != \'undefined\') var existingData = this._getData2(this.selection[0]);',
'   }',
'  }',
'  if(typeof existingData == \'undefined\') return {};',
'  var flagDirty = false;',
'  var flagNewRow = false;',
'  if(typeof existingData._isDirty != \'undefined\') flagDirty = existingData._isDirty;',
'  if(typeof existingData._isNewRow != \'undefined\') flagNewRow = existingData._isNewRow;',
'  delete existingData._previousData;',
'  if(flagDirty || flagNewRow) {',
'   if(!flagSumbmitAllChildRecords) {',
'    this._createKeysLow(existingData);',
'    var dirtyDataOnly = this._trimNonDirtyData(existingData);',
'    return dirtyDataOnly;',
'   } else {',
'    this._createKeysLow(existingData);',
'    return existingData;',
'   }',
'  }',
'  return {};',
' }',
' ,',
' _createKeysLow: function(d) {   var count = 0;',
'  for(var p in d) {',
'   if(d[p] != null) {',
'    if(d[p].constructor == Array) {',
'     count = 0;',
'     for(var i = 0; i < d[p].length; i++) {',
'      if(typeof d[p][i] == \'object\') {',
'       if(typeof d[p][i][\'*title\'] == \'undefined\' && typeof d[p][i][\'*static\'] == \'undefined\') {',
'        d[p][i][\'*key\'] = i;',
'        count++;',
'        this._createKeysLow(d[p][i]);',
'       }',
'      }',
'     }',
'    }',
'   }',
'  }',
' }',
' ,',
' fieldIsDirty: function(field) {   var rSel = this.selection[0];',
'  var rn = typeof arguments[1] != \'undefined\' ? arguments[1] : rSel;',
'  if(typeof rSel == \'undefined\') return false;',
'  var _d = this.getData(rn);',
'  var _dv = _d[field];',
'  var flagNewRow = _d[\'_isNewRow\'];',
'  if(typeof flagNewRow == \'undefined\') flagNewRow = false;',
'  if(flagNewRow) {',
'   if(_dv == \'\') return false;',
'   return true;',
'  }',
'  var _od = _d[\'_oldData\'];',
'  if(typeof _od == \'undefined\') return false;',
'  var _odv = _od[field];',
'  if(typeof _dv == \'undefined\') return false;',
'  if(typeof _odv == \'undefined\') return false;',
'  if(_dv == _odv ) return false;',
'  else return true;',
' }',
' ,',
' _trimNonDirtyData: function(data) {   var data2 = {};',
'  var tData = [];',
'  for(var prop in data) {',
'   if(data[prop] != null) {',
'    if(data[prop].constructor == Array) {',
'     tData = [];',
'     for(var i = 0; i < data[prop].length; i++) {',
'      if(data[prop][i]._isNewRow || data[prop][i]._isDirty ) {',
'       tData.push(this._trimNonDirtyData(data[prop][i]));',
'      }',
'     }',
'     data2[prop] = tData;',
'    } else {',
'     data2[prop] = data[prop];',
'    }',
'   } else {',
'    data2[prop] = null;',
'   }',
'  }',
'  return data2;',
' }',
' ,',
' _logicalRow2PhysicalRow: function(rn) {',
'  if(typeof rn != \'number\') {',
'   return rn;',
'  }',
'  var u = this._dataMap;',
'  return $u.a.find(u,rn);',
' }',
' ,',
' __fixData: function(lObj) {',
'  var _data = lObj._data;',
'  if(_data.length == 0) return;',
'  if(typeof _data[0] == \'undefined\') lObj._data = [];',
' }',
' ,',
' harvestListKeys: function() {   var existingData = {};',
'  var arr = [];',
'  var key = \'\';',
'  this.__fixData(this);',
'  for (var i = 0; i < this._data.length; i++) {',
'   existingData = this._data[i];',
'   if(typeof existingData == \'undefined\') continue;',
'   if(typeof existingData.__primaryKey != \'undefined\') {',
'    key = existingData.__primaryKey;',
'   } else {',
'    key = existingData[\'*value\']',
'   }',
'   if(key != \'\') arr.push(key);',
'  }',
'  return arr;',
' }',
' ,',
' _hasMediaFileUploadErrors: function(data) {',
'  var flag = false;',
'  var r = A5.u.object.each(data,function(name,value,path,result){',
'   if(name == \'_flagMediaFileUploadError\'){',
'    if(value) flag =  true;',
'      }',
'  });',
'  return flag;',
' }',
',',
' harvestList: function() {',
'  var flagPKOnly = typeof arguments[0] != \'undefined\' ? arguments[0] : false;',
'  var obj = typeof arguments[1] != \'undefined\' ? arguments[1] : {};',
'  var startingRow = 1;',
'  var batchSize = 0;',
'  var flagSumbmitAllChildRecords = false;',
'  var flagInPersistListToStorage = false;',
'  var flagCaptureImages = false;',
'  if(typeof obj.batchSize != \'undefined\') batchSize = obj.batchSize;',
'  if(typeof obj.startingRow != \'undefined\') startingRow = obj.startingRow;',
'  if(typeof obj.flagSumbmitAllChildRecords != \'undefined\') flagSumbmitAllChildRecords = obj.flagSumbmitAllChildRecords;',
'  if(typeof obj.flagInPersistListToStorage != \'undefined\') flagInPersistListToStorage = obj.flagInPersistListToStorage;',
'  if(typeof obj.flagCaptureImages != \'undefined\') flagCaptureImages = obj.flagCaptureImages',
'  var flagDirty = false;',
'  var flagNewRow = false;',
'  var flagHasMediaFileUploadError = false;',
'  var existingData = \'\';',
'  var arr = [];',
'  var _tempData = \'\';',
'  this.__fixData(this);',
'  if(batchSize > 0 && startingRow > 1 && flagPKOnly == false) {',
'   var arr2 = [];',
'   var count = 0;',
'   for(var i = startingRow -1; i < this.__arrDirtyRows.length; i++) {',
'    rowToGet = this.__arrDirtyRows[i];',
'    existingData = this._data[rowToGet];',
'    if(typeof existingData == \'undefined\') continue;',
'    _tempData = this.harvestListRow(existingData, {flagSumbmitAllChildRecords: flagSumbmitAllChildRecords, flagCaptureImages: flagCaptureImages});',
'    arr2.push(_tempData);',
'    count = count + 1;',
'    if(count >= batchSize) break;',
'   }',
'   return arr2;',
'  }',
'  if(flagInPersistListToStorage == false) {',
'   this.__arrDirtyRows = [];',
'  }',
'  this.__fixData(this);',
'  for (var i = 0; i < this._data.length; i++) {',
'   existingData = this._data[i];',
'   if(typeof existingData == \'undefined\') continue;',
'   flagDirty = false; flagNewRow = false;',
'   if(typeof existingData._isDirty != \'undefined\') flagDirty = existingData._isDirty;',
'   if(typeof existingData._isNewRow != \'undefined\') flagNewRow = existingData._isNewRow;',
'   if(flagDirty || flagNewRow) {',
'    flagHasMediaFileUploadError = this._hasMediaFileUploadErrors(existingData);',
'   }',
'   if( (flagDirty || flagNewRow) && !flagHasMediaFileUploadError ) {',
'    if(flagPKOnly == false) {',
'     _tempData = this.harvestListRow(existingData, {flagSumbmitAllChildRecords: flagSumbmitAllChildRecords, flagCaptureImages: flagCaptureImages});',
'     arr.push(_tempData);',
'    } else {',
'     if(typeof existingData.__primaryKey != \'undefined\') {',
'      arr.push(existingData.__primaryKey);',
'     } else {',
'      arr.push(existingData[\'*value\']);',
'     }',
'    }',
'    if(flagInPersistListToStorage == false) {',
'     if(batchSize > 0 && startingRow == 1 && flagPKOnly == false)  {',
'      if(flagPKOnly == false) {',
'       this.__arrDirtyRows.push(existingData[\'*key\']);',
'      }',
'     }',
'    }',
'   }',
'  }',
'  if(batchSize > 0 && flagPKOnly == false) {',
'   var arr2 = [];',
'   var count = 0;',
'   for(var i = startingRow -1; i < this.__arrDirtyRows.length; i++) {',
'    rowToGet = this.__arrDirtyRows[i];',
'    arr2.push(this._getRowByKey(arr,rowToGet));',
'    count = count + 1;',
'    if(count >= batchSize) break;',
'   }',
'   return arr2',
'  }',
'  return arr;',
' }',
' ,',
' _getRowByKey: function(arr,key) {  for(var i = 0; i < arr.length; i++) {',
'   if(arr[i][\'*key\'] == key) return arr[i];',
'  }',
'  return false;',
' }',
',',
' listRowIsDirty: function() {  var rn = typeof arguments[0] != \'undefined\' ? arguments[0] : -1;',
'  var flagNewRow = typeof arguments[1] != \'undefined\' ? arguments[1] : false;',
'  if(rn > -1) {',
'   var existingData = this.getData(rn);',
'  } else {',
'   var existingData = this.getData(this.selection[0]);',
'  }',
'  if(typeof existingData == \'undefined\') return false;',
'  if(!flagNewRow) {',
'   if(typeof existingData._isDirty != \'undefined\') return existingData._isDirty;',
'   else return false;',
'  } else {',
'   if(typeof existingData._isNewRow != \'undefined\') return existingData._isNewRow;',
'   else return false;',
'  }',
' }',
' ,',
' listRowIsNew: function() {  var rn = typeof arguments[0] != \'undefined\' ? arguments[0] : -1;',
'  return this.listRowIsDirty(rn,true);',
' }',
' ,',
' _getDataFromRoute: function(route) {   var rn = [].concat(route);',
'  var topParent = this.allParentLists[this.allParentLists.length -1];',
'  if(typeof topParent == \'undefined\') var lObj = this;',
'  else var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(topParent);',
'  var _td = lObj._data;',
'  for(var i = 0; i < rn.length; i++) {',
'   try{',
'      _td = _td[ rn[i] ];',
'    }catch(e) { _td = []};',
'  }',
'  return _td;',
' }',
' ,',
' _isRowInRouteVisible: function(route) {   var rn = [].concat(route);',
'  var topParent = this.allParentLists[this.allParentLists.length -1];',
'  if(typeof topParent == \'undefined\') var lObj = this;',
'  else var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(topParent);',
'  var index = 0;',
'  while(rn.length >1) {',
'   index = lObj._logicalRow2PhysicalRow(rn.shift());',
'   if(lObj.selection[0] != index) return false;',
'   lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(rn.shift().replace(\'__LIST__\',\'\'));',
'  }',
'  return true;',
' }',
' ,',
' _isRouteBranchDirty: function(route) {   var rn = [].concat(route);',
'  if( typeof  rn[rn.length-1] == \'number\' ) rn.pop();',
'  var _d = this._getDataFromRoute(rn);',
'  for(var i = 0; i < _d.length; i++) {',
'   if( _d[i]._isDirty || _d[i]._isNewRow || _d[i]._isDeletedRow) return true;',
'  }',
'  return false;',
' }',
' ,',
' _routeBranchHasServerSideError: function(route) {   var rn = [].concat(route);',
'  if( typeof  rn[rn.length-1] == \'number\' ) rn.pop();',
'  var _d = this._getDataFromRoute(rn);',
'  for(var i = 0; i < _d.length; i++) {',
'   if(  _d[i]._hasServerSideError ||  _d[i]._flagServerSideErrorInChild  || _d[i]._hasWriteConflictErrors ||  _d[i]._flagWriteConflictErrorInChild      ) return true;',
'  }',
'  return false;',
' }',
' ,',
' _responseStart: function() {  this.__inSyncResponse = true;',
'  this.__responseEndHasFired = false;',
'  delete this._rowGUIDS;',
'  this._rowGUIDS = [];',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' }',
',',
' _responseEnd: function() {  this.__responseEndHasFired = true;',
'  var flagUsingSyncLog = false;',
'  flagUsingSyncLog = this._useServerSideSyncLog;',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  if(typeof flagUsingSyncLog == \'undefined\') flagUsingSyncLog = false;',
'  if(flagUsingSyncLog) {',
'   var flagClearLog = this._clearServerSideSyncLog;',
'   if(typeof flagClearLog == \'undefined\') flagClearLog = true;',
'   if(flagClearLog) {',
'    _dlgObj.synchronizeComplete(this._rowGUIDS);',
'   }',
'  }',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var _mode = _dlgObj.__listPersistMode(this.listVariableName);',
'  var lObj = this;',
'  lObj.count = 0;',
'  if(_mode == \'edits\' || _mode == \'add\') {',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   if(_dlgObj._executePendingUpdatesToFileSystem) _dlgObj._executePendingUpdatesToFileSystem(this.listVariableName);',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   _dlgObj.persistListToLocalStorage(this.listVariableName);',
'  }',
'  setTimeout(function() { lObj.__inSyncResponse = false; },1000);',
' }',
',',
' _getTopParentList: function() {',
'  var allParentLists = this.allParentLists;',
'  if(typeof allParentLists == \'undefined\') return this.listVariableName;',
'  if(allParentLists.length == 0) return this.listVariableName;',
'  return allParentLists[allParentLists.length -1];',
' }',
',',
' setRowCleanPreserveState: function() {',
'  this.setRowClean(arguments[0],-1,true);',
' }',
',',
' setListClean: function() {  for(var i = 0; i < this._data.length; i++) {',
'   this.setRowClean(i);',
'  }',
' }',
' ,',
' setRowClean: function() {',
'  var topObj = this._getTopParentListObject()',
'  var flagSyncMediaFields = true;',
'  if (typeof topObj.flagSyncMediaFields != \'undefined\') flagSyncMediaFields = topObj.flagSyncMediaFields',
'  var rn = typeof arguments[0] != \'undefined\' ? arguments[0] : -1;',
'  var mode = typeof arguments[1] != \'undefined\' ? arguments[1] : -1;',
'  var flagSetParentClean = typeof arguments[2] != \'undefined\' ? arguments[2] : false;',
'  flagSetParentClean = false;',
'  if( flagSetParentClean) {',
'   var rn2 = rn;',
'   rn2.pop()',
'   rn2.pop()',
'   var parentList = this.parentList;',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var obj2 = _dlgObj.getControl(parentList);',
'   obj2.setRowClean(rn2);',
'  }',
'  var flagPreserveState = typeof arguments[2] != \'undefined\' ? arguments[2] : false;',
'  var flagRouteArray = false;',
'  if(rn.constructor == Array) {',
'   flagRouteArray = true;',
'   var existingData = this._getDataFromRoute(rn);',
'   if(typeof existingData == \'undefined\') return;',
'   var _row = rn[rn.length -1];',
'   _row = this._logicalRow2PhysicalRow(_row);',
'  } else {',
'   var _row = \'\';',
'   var existingData = this.getData(this.selection[0]);',
'   if(rn > -1) {',
'    _row = rn;',
'    _row = this._logicalRow2PhysicalRow(_row);',
'   } else _row = existingData[\'*key\'];',
'   var existingData = this.getData(_row);',
'  }',
'  if(typeof existingData == \'undefined\' || existingData == null) return false;',
'  existingData._editedByUser = [];',
'  if(!flagSyncMediaFields) {',
'   if(typeof existingData._dirtyImages != \'undefined\') {',
'    var _dirtyImageArrayJSON = existingData._dirtyImages;',
'    var _dirtyImages = [];',
'    for(var n in existingData._dirtyImages) {',
'     _dirtyImages.push(n);',
'    }',
'   } else {',
'    flagSyncMediaFields = true;',
'   }',
'   if (existingData._dirtyImages == false) {',
'    flagSyncMediaFields = true;',
'   }',
'  }',
'  if(mode == 1 ) {',
'   if(typeof existingData._oldData != \'undefined\') return false;',
'  }',
'  var rn2 = [].concat(rn);',
'  if(!flagPreserveState) {',
'   if(typeof existingData != \'undefined\' && existingData != null) {',
'    existingData._isDirty = false;',
'    existingData._isNewRow = false;',
'   }',
'  }',
'  var __rowGUID = null;',
'  existingData._hasServerSideError = false;',
'  existingData._serverSideErrors = false;',
'  existingData._flagServerSideErrorInChild = false;',
'  existingData._hasWriteConflictErrors = false;',
'  existingData._hasGlobalErrors = false;',
'  existingData._flagWriteConflictErrorInChild = false;',
'  existingData._flagGlobalErrorInChild = false;',
'  if(flagSyncMediaFields) {',
'   existingData._dirtyImages = false;',
'   existingData._hasUnsyncedMediaFiles = false;',
'  } else {',
'   existingData._hasUnsyncedMediaFiles = true;',
'   existingData._isDirty = true;',
'   existingData._oldData = {};',
'   existingData._oldData.image = \'\';',
'  }',
'  var topParentList = this._getTopParentList();',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var lTop = _dlgObj.getControl(topParentList);',
'  if(typeof lTop._rowGUIDS == \'undefined\') lTop._rowGUIDS = [];',
'  lTop._rowGUIDS.push(existingData[\'*rowGUID\']);',
'  __rowGUID = existingData[\'*rowGUID\'];',
'  delete existingData[\'*rowGUID\'];',
'  existingData._writeConflictErrors = false;',
'  if(!flagPreserveState) delete existingData._oldData;',
'  if(!flagSyncMediaFields) {',
'   existingData._isDirty = true;',
'   existingData._oldData = {};',
'   for(var ii = 0; ii < _dirtyImages.length; ii++) {',
'    existingData._oldData[_dirtyImages[ii]] = \'\';',
'   }',
'  }',
'  delete existingData._globalErrors;',
'  delete existingData._globalErrorsRaw;',
'  var _currRowNum = this.selection[0];',
'  if(existingData._isDeleted) {',
'  }',
'  if(flagRouteArray) {',
'   if(this._isRowInRouteVisible(rn)) {',
'    if(_row > -1) this.updateRow(_row,existingData);',
'    else this.updateRow( existingData[\'*value\'],existingData);',
'   } else {',
'   }',
'  } else {',
'   if(_row > -1) this.updateRow(_row,existingData);',
'   else this.updateRow( existingData[\'*value\'],existingData);',
'  }',
'  if(typeof _currRowNum != \'undefined\') this.setValue(_currRowNum,false);',
'  var parentList = this.parentList;',
'  if(typeof parentList != \'undefined\' ) {',
'   if(flagRouteArray) var flagListIsDirty =  this._isRouteBranchDirty(rn);',
'   else var flagListIsDirty = this.listIsDirty();',
'   if (flagListIsDirty == false) {',
'    var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentList);',
'    if(flagRouteArray) {',
'     rn.pop();',
'     rn.pop();',
'     if(lObj && lObj.setRowClean) lObj.setRowClean(rn,1);',
'    } else {',
'     if(!arguments[3]) lObj.setRowClean(-1,1);',
'    }',
'   } else {',
'    if(flagPreserveState) {',
'     this._setRouteDirty(rn);',
'    }',
'   }',
'  }',
' }',
' ,',
' _updateDataInTopParent: function() {',
' var removeDeletedRows = function(data) {',
'  for(var i = data.length-1; i >= 0; i--) {',
'   if(data[i]._isDeleted) {',
'    data.splice(i,1);',
'   } else {',
'    for(var p in data[i]) {',
'     if(p.indexOf(\'__LIST__\') == 0 && Array.isArray(data[i][p])) removeDeletedRows(data[i][p]);',
'    }',
'   }',
'  }',
' };',
' var lObjTopParent = this._getTopParentListObject();',
' var data = lObjTopParent._data',
' removeDeletedRows(data)',
' lObjTopParent.refresh();',
'}',
',',
' _setRouteDirty: function(route) {   route.pop();',
'  route.pop();',
'  var flagLoop = true;',
'  if(route.length == 0) flagLoop = false;',
'  while(flagLoop) {',
'   var existingData = this._getDataFromRoute(route);',
'   if(typeof existingData != \'undefined\') {',
'    existingData._isDirty = true;',
'   }',
'   route.pop();',
'   route.pop();',
'   if(route.length == 0) break;',
'  }',
' }',
',',
' _showError: function(id,moreTxt,lessTxt) {   var e = $(id);',
'  var e2 = $(id + \'.LINK\');',
'  if(e.style.display == \'\') {',
'   e.style.display = \'none\';',
'   e2.innerHTML = moreTxt;',
'  } else {',
'   e.style.display = \'\';',
'   e2.innerHTML = lessTxt;',
'  }',
' }',
' ,',
' _setGlobalCRUDErrors: function(rowNum,txt,mode) {',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var ePH =  this._globalErrorPlaceHolder;',
'  if(typeof ePH == \'undefined\') ePH = \'\';',
'  var flagPH = $(ePH);',
'  if(typeof mode == \'undefined\') mode = \'\';',
'  var txtRaw = txt;',
'  if(mode != \'\' && ePH != \'\' && flagPH) {',
'   var customMessage = this.customization.dv.databaseError[mode];',
'   customMessage = customMessage.split(\'|\');',
'   txt = \'<div onclick="window[\\\'\'+this._hostComponentId + \'_DlgObj\\\'].getControl(\\\'\'+this.listVariableName+\'\\\')._showError(\\\'\'+this.listVariableName +\'.GLOBALERROR\\\',\\\'\'+customMessage[1]+\'\\\',\\\'\'+customMessage[2]+\'\\\');">\' + customMessage[0] + \'&nbsp;<a id="\'+this._hostComponentId+\'.\'+this.listVariableName + \'.GLOBALERROR.LINK" class="Alpha-MagentaLink" style="cursor: pointer;color:red; font-size: 8pt;" href=\\\'#\\\'>\'+customMessage[1]+\'</a>\' + \'<div id="\'+this.listVariableName+\'.GLOBALERROR" style="display: none; font-size: 8pt;">\'+txt+\'</div></div>\';',
'  }',
'  if(rowNum.constructor == Array) {',
'   if(txt != \'\') this.setServerSideError(true,rowNum,txt,\'ge\',txtRaw);',
'   _dlgObj._listRowSelect(this.listVariableName);',
'   return true;',
'  }',
'  var _d = this._getRowData(rowNum);',
'  _d._globalErrors = txt;',
'  _d._globalErrorsRaw = txtRaw;',
'  _d._hasServerSideError = false;',
'  _d._serverSideErrors = false;',
'  this.updateRow(rowNum,_d);',
'  _dlgObj._listRowSelect(this.listVariableName);',
' }',
' ,',
' getAllErrors: function(rows) {   var lObj = this;',
'  var data = lObj._data;',
'  if(typeof rows != \'undefined\') {',
'   if(typeof rows == \'string\') rows = rows.split(\',\');',
'   var d2 = [];',
'   var r = \'\';',
'   for(var j = 0; j < rows.length; j++) {',
'    r = this._dataMap[rows[j]]',
'    d2.push(data[r]);',
'   }',
'   data = d2;',
'  }',
'  var r = A5.u.object.each(data,function(name,value,path,result){',
'   path = path.splice(0,path.length -1);',
'   var _dr = data;',
'   for(var i = 0; i < path.length; i++) {',
'    var _dr = _dr[path[i]];',
'   }',
'   if(name == \'_hasServerSideError\') {',
'    if(value) {',
'     result.push({errorType: \'serverSide\', path:path, error: _dr[\'_serverSideErrors\']});',
'    }',
'   }',
'   if(name == \'_hasWriteConflictErrors\') {',
'    if(value) {',
'     var _wc = _dr[\'_writeConflictErrors\'];',
'     var _wc2 = [];',
'     $u.o.assign(_wc2,_wc);',
'     for(var i = 0; i < _wc2.length; i++) {',
'      delete _wc2[i].errorText;',
'     }',
'     result.push({errorType: \'writeConflict\', path: path, error: _wc2});',
'    }',
'   }',
'   if(name == \'_hasGlobalErrors\') {',
'    if(value) {',
'     result.push({errorType: \'globalError\', path: path, error: _dr[\'_globalErrorsRaw\']});',
'    }',
'   }',
'  })',
'  return r;',
' }',
' ,',
' _setWriteConflictErrors: function(rowNum,eArr) {  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  if(rowNum.constructor == Array) {',
'   this.setServerSideError(true,rowNum,eArr,\'wc\');',
'   _dlgObj._listRowSelect(this.listVariableName);',
'   return true;',
'  }',
'  rowNum = this._logicalRow2PhysicalRow(rowNum);',
'  var _d = this._getRowData(rowNum);',
'  _d._writeConflictErrors = eArr;',
'  _d._hasWriteConflictErrors = true;',
'  _d._hasServerSideError = false;',
'  _d._serverSideErrors = false;',
'  _d._globalErrors = \'\';',
'  _d._hasGlobalErrors = false;',
'  _d._globalErrorsRaw = \'\';',
'  _d._globalErrors = \'\';',
'  this.updateRow(rowNum,_d);',
'  _dlgObj._listRowSelect(this.listVariableName);',
' }',
' ,',
' _setGenericByChild: function(rn,mode) {',
'  var parentListName = this.parentList;',
'  if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'   if(parentListName != \'\') {',
'    var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentListName);',
'    var existingData = plObj._getDataFromRoute(rn);',
'    if(typeof existingData == \'undefined\') return;',
'    if(mode == \'sse\') {',
'     existingData._flagServerSideErrorInChild = true;',
'     existingData._isDirty = true;',
'    } else if (mode == \'wc\') {',
'     existingData._flagWriteConflictErrorInChild = true;',
'     existingData._isDirty = true;',
'    } else if (mode == \'ge\') {',
'     existingData._flagGlobalErrorInChild = true;',
'     existingData._isDirty = true;',
'    }',
'    var _row = rn[rn.length -1];',
'    _row = plObj._logicalRow2PhysicalRow(_row);',
'    if(plObj._isRowInRouteVisible(rn)) plObj.updateRow(_row,existingData);',
'    rn.pop();',
'    rn.pop();',
'    plObj._setGenericByChild(rn,mode)',
'   }',
'  }',
' }',
' ,',
' setServerSideError: function(flag) {',
'  var rn = typeof arguments[1] != \'undefined\' ? arguments[1] : -1;',
'  var flagRouteArray = false;',
'  if(rn.constructor == Array) {',
'   flagRouteArray = true;',
'  }',
'  var errObj =  typeof arguments[2] != \'undefined\' ? arguments[2] : {};',
'  if(flag == false) {',
'   errObj = false;',
'  }',
'  var mode = typeof arguments[3] != \'undefined\' ? arguments[3] : \'sse\'',
'  var txtRaw = typeof arguments[4] != \'undefined\' ? arguments[4] : \'\';',
'  var _row = \'\';',
'  if(flagRouteArray) {',
'   var existingData = this._getDataFromRoute(rn);',
'   if(typeof existingData == \'undefined\') return;',
'   var _row = rn[rn.length -1];',
'   _row = this._logicalRow2PhysicalRow(_row);',
'  } else {',
'   var existingData = this.getData(this.selection[0]);',
'   if(typeof existingData == \'undefined\') return;',
'   if(rn > -1) {',
'    _row = rn;',
'    _row = this._logicalRow2PhysicalRow(_row);',
'   } else _row = existingData[\'*key\'];',
'   var existingData = this.getData(_row);',
'   if(typeof existingData == \'undefined\') return;',
'  }',
'  if(mode == \'sse\') {',
'   existingData._hasServerSideError = flag;',
'   existingData._serverSideErrors = errObj;',
'   existingData._globalErrors = false;',
'   existingData._globalErrorsRaw = \'\'',
'   existingData._hasGlobalErrors = false;',
'   existingData._hasWriteConflictErrors = false;',
'   existingData._writeConflictErrors = false;',
'  } else if (mode == \'wc\') {',
'   existingData._hasWriteConflictErrors = flag;',
'   existingData._writeConflictErrors = errObj;',
'   existingData._hasServerSideError = false;',
'   existingData._serverSideErrors = false;',
'   existingData._globalErrors = \'\';',
'   existingData._hasGlobalErrors = false;',
'   existingData._globalErrorsRaw = \'\';',
'   existingData._globalErrors = \'\';',
'  } else if (mode == \'ge\') {',
'   existingData._globalErrors = errObj;',
'   existingData._globalErrorsRaw = txtRaw;',
'   existingData._hasGlobalErrors = flag;',
'   existingData._hasServerSideError = false;',
'   existingData._serverSideErrors = false;',
'  }',
'  if(flagRouteArray) {',
'   if(this._isRowInRouteVisible(rn)) {',
'    if(_row > -1) this.updateRow(_row,existingData);',
'    else this.updateRow( existingData[\'*value\'],existingData);',
'   }',
'   if(this._setGenericByChild) {',
'    rn.pop();',
'    rn.pop();',
'    this._setGenericByChild(rn,mode);',
'   }',
'  } else {',
'   if(_row > -1) this.updateRow(_row,existingData);',
'   else this.updateRow( existingData[\'*value\'],existingData);',
'  }',
' }',
' ,',
' _showWCErrorMore: function(varName,eleIn,infoIn) {   var info = {};',
'  if(typeof infoIn != \'undefined\') {',
'   info = infoIn;',
'  }',
'  if(typeof eleIn == \'undefined\') eleIn = false;',
'  var row = this.selection[0];',
'  this._wceVarname = varName;',
'  var myValue = window[this._hostComponentId + \'_DlgObj\'].getValue(varName);',
'  var _d = this._getRowData(row)',
'  var wce = _d._writeConflictErrors;',
'  var wcCount = wce.length;',
'  var indx = \'\';',
'  indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(wce,\'varName\',varName);',
'  if(indx == -1) return false',
'  wce = wce[indx];',
'  var mTheirs = this.customization.dv.writeConflict.useTheirsMessage;',
'  var mMine   = this.customization.dv.writeConflict.useMineMessage;',
'  var mTheirsAll = this.customization.dv.writeConflict.useTheirsAll;',
'  var mMineAll   = this.customization.dv.writeConflict.useMineAll;',
'  mTheirs = mTheirs.replace(\'{theirvalue}\',this._stripHTML(wce.oldValueCurrent,30));',
'  mMine = mMine.replace(\'{myvalue}\',this._stripHTML(myValue,30));',
'  var ctxt = this;',
'  var mD = [];',
'  mD.push({html: mMine, value: \'mine\'});',
'  mD.push({html: mTheirs, value: \'theirs\'});',
'  if(wcCount > 1) {',
'   mD.push(\'-\');',
'   mD.push({html: mMineAll , value: \'mineAll\'});',
'   mD.push({html: mTheirsAll, value: \'theirsAll\' });',
'  }',
'  var mS = {',
'   theme: \'Alpha-Magenta\',',
'   _hostComponentId : this._hostComponentId,',
'   listVariableName: this.listVariableName,',
'   iconColumn: {show: false},',
'   pointer: {show: true,location: \'auto\'},',
'   animation: {show: {type: \'css-slide\',duration: \'fast\'}, hide: {type: \'none\',duration: \'fast\'}},',
'   onHide: function() {  $(this._eleWCM).style.visibility = \'\';},',
'   onClick: function(item) {',
'    var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.listVariableName);',
'    if(item.value == \'mine\') lObj._useMine(this._varName);',
'    if(item.value == \'mineAll\') lObj._useMineAll();',
'    if(item.value == \'theirs\') lObj._useTheirs(this._varName);',
'    if(item.value == \'theirsAll\') lObj._useTheirsAll();',
'   }',
'  };',
'  var eleWCM = this._hostComponentId +\'.WCM.\'+this.listVariableName+ \'.\' +  varName.toUpperCase();',
'  $(eleWCM).style.visibility = \'hidden\';',
'  if(typeof this._menu == \'undefined\') {',
'   this._menu = new A5.Menu(mD,mS);',
'  } else {',
'   this._menu.populate(mD);',
'  }',
'  this._menu._varName = varName;',
'  this._menu._eleWCM = eleWCM;',
'  var ele = \'\';',
'  if(eleIn == false) {',
'   ele = window[this._hostComponentId + \'_DlgObj\'].getPointer(varName);',
'  } else {',
'   ele = eleIn;',
'  }',
'  this._menu.show(\'dropdown\',ele);',
' }',
' ,',
' _useMine: function(varName) {   this.resolveConflictUsingMine(varName);',
' }',
' ,',
' _useTheirs: function(varName) {   this.resolveConflictUsingTheirs(varName);',
' }',
' ,',
' _useMineAll: function() {   this.resolveConflictUsingMine();',
' }',
' ,',
' _useTheirsAll: function() {   this.resolveConflictUsingTheirs();',
' }',
' ,',
' resolveConflictUsingMine: function() {',
'  var control = typeof arguments[0] != \'undefined\' ? arguments[0] : \'__all__\';',
'  var formViewObject = arguments[1];',
'  var flagFV = false;',
'  if(typeof formViewObject != \'undefined\') flagFV = true;',
'  var row = this.selection[0];',
'  var _d = this._getRowData(row)',
'  var wce = _d._writeConflictErrors;',
'  if(typeof wce == \'undefined\') return false;',
'  var arr = [];',
'  if(control == \'__all__\') arr = this._getControlsInDv();',
'  else arr.push(control);',
'  var myValue = \'\';',
'  var indx = \'\';',
'  var fn = \'\';',
'  var ix2 = \'\';',
'  for(var i = 0; i < arr.length; i++) {',
'   if(!flagFV) myValue = window[this._hostComponentId + \'_DlgObj\'].getValue(arr[i]);',
'   else myValue = formViewObject.conflictValues.newValue;',
'   indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(wce,\'varName\',arr[i]);',
'   if(indx >0 -1) {',
'    ix2 = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(wce,\'varName\',arr[i]);',
'    if(ix2 == -1) return false',
'    if(!flagFV) fn = this._getListFieldFromControl(arr[i]);',
'    else fn = arr[i];',
'    _d._oldData[fn] = wce[ix2].oldValueCurrent;',
'    wce.splice(indx,1);',
'   }',
'  }',
'  if(wce.length == 0) {',
'   _d._writeConflictErrors = false;',
'   _d._hasWriteConflictErrors = false;',
'   this.updateRow(row,_d);',
'  };',
'  if(_d._hasWriteConflictErrors == false) {',
'   var parentList = this.parentList;',
'   if(typeof parentList != \'undefined\') {',
'    var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentList);',
'    lObj._setChildHasWriteConflictFlag();',
'   }',
'  }',
'  this._clearServerSideErrors();',
'  this._showWriteConflictErrors();',
' }',
' ,',
' resolveConflictUsingTheirs: function() {',
'  var control = typeof arguments[0] != \'undefined\' ? arguments[0] : \'__all__\';',
'  var formViewObject = arguments[1];',
'  var flagFV = false;',
'  if(typeof formViewObject != \'undefined\') flagFV = true;',
'  var row = this.selection[0];',
'  var _d = this._getRowData(row)',
'  var wce = _d._writeConflictErrors;',
'  if(typeof wce == \'undefined\') return false;',
'  var arr = [];',
'  if(control == \'__all__\') {',
'   arr = this._getControlsInDv();',
'  } else {',
'   if(control.constructor == Array) {',
'    arr = control;',
'   } else {',
'    arr.push(control);',
'   }',
'  }',
'  var indx = \'\';',
'  var fn = \'\';',
'  var ix2 = \'\';',
'  for(var i = 0; i < arr.length; i++) {',
'   indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(wce,\'varName\',arr[i]);',
'   if(indx >0 -1) {',
'    ix2 = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(wce,\'varName\',arr[i]);',
'    if(ix2 == -1) return false',
'    if(!flagFV) fn = this._getListFieldFromControl(arr[i]);',
'    else fn = arr[i];',
'    _d[fn] = wce[ix2].oldValueCurrent;',
'    _d._oldData[fn] = wce[ix2].oldValueCurrent;',
'    if(!flagFV) window[this._hostComponentId + \'_DlgObj\'].setValue(arr[i], wce[ix2].oldValueCurrent,false);',
'    wce.splice(indx,1);',
'   }',
'  }',
'  if(wce.length == 0) {',
'   _d._writeConflictErrors = false;',
'   _d._hasWriteConflictErrors = false;',
'  };',
'  var allArr = this._getControlsInDv();',
'  if(flagFV) {',
'   allArr = [];',
'   for(var n in _d._oldData) {',
'    allArr.push(n);',
'   }',
'  }',
'  _d._isDirty = false;',
'  var tempData = \'\';',
'  for(var i = 0; i < allArr.length; i++) {',
'   fn = this._getListFieldFromControl(allArr[i]);',
'   if(flagFV) fn = allArr[i];',
'   tempData = _d._oldData[fn];',
'   if(tempData == null) tempData = \'\';',
'   if( _d[fn] != tempData ) {',
'    _d._isDirty = true;',
'    break;',
'   }',
'  }',
'  this.updateRow(row,_d);',
'  this._clearServerSideErrors();',
'  this._showWriteConflictErrors();',
'  if(_d._hasWriteConflictErrors == false) {',
'   var parentList = this.parentList;',
'   if(typeof parentList != \'undefined\') {',
'    var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentList);',
'    lObj._setChildHasWriteConflictFlag();',
'   }',
'  }',
'  window[this._hostComponentId + \'_DlgObj\'].refreshClientSideComputations();',
' }',
' ,',
' nullOutDetailViewRecord: function() {',
'  var flagDisable = typeof arguments[0] != \'undefined\' ? arguments[0] : false;',
'  var val = \'\';',
'  var flagParentListHasActiveRow = this._parentListHasActiveRow();',
'  if(flagDisable) {',
'   if(flagParentListHasActiveRow) flagDisable = false;',
'  }',
'  var debugMsg = \'CurrentList: \' + this.listVariableName + \' - flagDisable is set to: \' + flagDisable + \' my parentList has active row: \' +  this._parentListHasActiveRow();',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var controlName = \'\';',
'  var controlType = \'\';',
'  for(var i = 0; i < this._listFields.length; i++) {',
'   controlName = this._getUXDetailViewControlName(this._listFields[i].name);',
'   controlType = _dlgObj._getControlType(controlName);',
'   val = window[this._hostComponentId + \'_DlgObj\'].defaultValues[controlName.toUpperCase()];',
'   if(controlType == \'formbox\') val = \'{}\'',
'   window[this._hostComponentId + \'_DlgObj\'].setValue(controlName,val,false);',
'  }',
'  this._deselectAll();',
'  this._clearServerSideErrors();',
'  if(flagDisable) this.disableDetailView(true);',
'  else this.disableDetailView(false)',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var arr = this._getControlsInDv();',
'  for(var i = 0; i < arr.length; i++) {',
'   _type = _dlgObj._getControlType(arr[i]);',
'   if(_type == \'formbox\') {',
'    _dlgObj.setValue(arr[i],\'{}\')',
'   }',
'  }',
' }',
' ,',
' _stripHTML: function(txt,length) {   var ele = document.createElement(\'div\');',
'  ele.innerHTML = txt;',
'  var txt2 = ele.textContent;',
'  var txt3 = txt2.substr(0,length);',
'  if(txt3.length < txt2.length) txt3 = txt3 + \'...\';',
'  delete ele;',
'  return txt2;',
' }',
' ,',
' _showWriteConflictErrors: function(row) {',
'  var _d = this._getRowData(row);',
'  if(typeof _d == \'undefined\') return false;',
'  if(typeof _d._writeConflictErrors == \'undefined\') return false;',
'  if(typeof _d._hasWriteConflictErrors == \'undefined\') return false;',
'  if(_d._hasWriteConflictErrors == false) return false;',
'  _e = _d._writeConflictErrors',
'  var arr = [];',
'  for(var i = 0; i < _e.length; i++) {',
'   delete obj;',
'   var obj = {};',
'   obj.id =  this._hostComponentId +  \'.V.R1.\' + _e[i].varName.toUpperCase();',
'   obj.message = _e[i].errorText;',
'   arr.push(obj);',
'  }',
'  var arrFix = [];',
'  for(var i = 0; i < arr.length; i++) {',
'   if($(arr[i].id)) arrFix.push(arr[i]);',
'  }',
'  if(arrFix.length > 0) window[this._hostComponentId + \'_DlgObj\'].setErrors(arr);;',
' }',
' ,',
' _showServerSideErrors: function(row) {',
'  var _d = this._getRowData();',
'  if(typeof _d == \'undefined\') return false;',
'  if(typeof _d._globalErrors != \'undefined\') {',
'   if(_d._globalErrors != \'\') {',
'    this._showGlobalError(_d._globalErrors);',
'   }',
'  }',
'  if(typeof _d._serverSideErrors == \'undefined\') return false;',
'  if(typeof _d._hasServerSideError == \'undefined\') return false;',
'  if(_d._hasServerSideError == false) return false;',
'  _e = _d._serverSideErrors;',
'  var arr = [];',
'  for(var i = 0; i < _e.length; i++) {',
'   delete obj;',
'   var obj = {};',
'   var _n = \'\';',
'   _n = _e[i].varName;',
'   if(typeof _n == \'undefined\') _n = _e[i].fieldName',
'   _n = this._getUXDetailViewControlName(_n);',
'   if(typeof _n != \'undefined\') {',
'    obj.id = this._hostComponentId + \'.V.R1.\' + _n.toUpperCase();',
'    obj.message = _e[i].errorText;',
'    obj.errorType = \'serverside\';',
'    arr.push(obj);',
'   }',
'  }',
'  var arrFix = [];',
'  for(var i = 0; i < arr.length; i++) {',
'   if($(arr[i].id)) arrFix.push(arr[i]);',
'  }',
'  if(arrFix.length > 0) window[this._hostComponentId + \'_DlgObj\'].setErrors(arr);;',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlgObj._listRowSelect(this.listVariableName);',
' }',
' ,',
' _clearServerSideErrors: function() {  var ea = window[this._hostComponentId + \'_DlgObj\']._eh._e;',
'  if(typeof ea == \'undefined\') return false;',
'  var arr = this._getControlsInDv();',
'  var fa = [];',
'  var id = \'\';',
'  for(var i = 0; i < arr.length; i++) {',
'   id = this._hostComponentId + \'.V.R1.\' + arr[i].toUpperCase()',
'   if(window[this._hostComponentId + \'_DlgObj\']._findArrayProp(ea,\'id\',id) >= 0) fa.push(id);',
'  }',
'  window[this._hostComponentId + \'_DlgObj\'].clearErrors(fa);',
'  this._clearGlobalError();',
' }',
' ,',
' _hasClientSideError: function() {   var ea = window[this._hostComponentId + \'_DlgObj\']._eh._e;',
'  if(typeof ea == \'undefined\') return false;',
'  var arr = this._getControlsInDv();',
'  var indx = \'\';',
'  for(var i = 0; i < arr.length; i++) {',
'   id = this._hostComponentId + \'.V.R1.\' + arr[i].toUpperCase()',
'   indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(ea,\'id\',id);',
'   if(indx >= 0) {',
'    if( ea[indx].clientSide == true) {',
'     return true;',
'    }',
'   }',
'  }',
'  return false;',
' }',
' ,',
' _getRowData: function() {   var rn = typeof arguments[0] != \'undefined\' ? arguments[0] : -1;',
'  if(rn > -1) return this.getData(rn);',
'  else return this.getData(this.selection[0]);',
' }',
' ,',
' deleteRow: function() {',
'  var _rn = this.selection[0];',
'  if(typeof _rn == \'undefined\') return false;',
'  if(this._executeEvent(\'detailView.canDeleteRow\',{}) == false) return false;',
'  var ops = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'  var flagPrompt = typeof ops.prompt != \'undefined\' ? ops.prompt : true;',
'  if(!flagPrompt) {',
'   this._deleteRowLow(ops);',
'   return true;',
'  }',
'  var classInst = this;',
'  if(typeof this.customization == \'undefined\') return false;',
'  var msg = this.customization.dv.confirmDeleteWarning.message;',
'  if(msg.toLowerCase().indexOf(\'javascript:\') == 0) {',
'   var fn = msg.split(\':\')[1];',
'   fn = fn.split(\'(\')[0];',
'   window[fn].call();',
'   return false;',
'  }',
'  var image = this.customization.dv.confirmDeleteWarning.icon;',
'  var iconType = window[this._hostComponentId + \'_DlgObj\']._iconType(image);',
'  var imageHTML = window[this._hostComponentId + \'_DlgObj\']._getImageHTML(image,iconType);',
'  msg = \'<div style="padding: 10px;" >\' + imageHTML + msg + \'<br style="clear: both;" /></div>\';',
'  var title = this.customization.dv.confirmDeleteWarning.title;',
'  A5.msgBox.show(title,msg,\'yn\',function(button) {',
'   if(button == \'yes\'){',
'    classInst._deleteRowLow(ops);',
'    setTimeout(function() {  classInst.refresh() ; },0);',
'      } else if(button == \'no\'){',
'      }',
'      delete classInst;',
'  } );',
' }',
' ,',
' resetRow: function() {   if(this._executeEvent(\'detailView.canResetRow\',{}) == false) return false;',
'  var ops = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'  var flagPrompt = typeof ops.prompt != \'undefined\' ? ops.prompt : true;',
'  if(!flagPrompt) {',
'   this._resetRowLow();',
'   return true;',
'  }',
'  var classInst = this;',
'  var msg = this.customization.dv.confirmRowResetWarning.message;',
'  if(msg.toLowerCase().indexOf(\'javascript:\') == 0) {',
'   var fn = msg.split(\':\')[1];',
'   fn = fn.split(\'(\')[0];',
'   window[fn].call();',
'   return false;',
'  }',
'  var image = this.customization.dv.confirmRowResetWarning.icon;',
'  var iconType = window[this._hostComponentId + \'_DlgObj\']._iconType(image);',
'  var imageHTML = window[this._hostComponentId + \'_DlgObj\']._getImageHTML(image,iconType);',
'  msg = \'<div style="padding: 10px;" >\' + imageHTML + msg + \'<br style="clear: both;" /></div>\';',
'  var title = this.customization.dv.confirmRowResetWarning.title;',
'  A5.msgBox.show(title,msg,\'yn\',function(button) {',
'   if(button == \'yes\'){',
'   setTimeout(function() { classInst._resetRowLow();    },0);',
'      } else if(button == \'no\'){',
'      }',
'      delete classInst;',
'  } );',
' }',
' ,',
' _removeDirtyFlag: function(obj) {',
' for(var n in obj) {',
'  if(n && n != null) {',
'   if(obj[n] && obj[n] != null && typeof obj[n] == \'string\') {',
'    if(obj[n].indexOf(\':::___DIRTY___:::\') > -1) {',
'     var _d = obj[n]',
'     _d = _d.split(\':::___DIRTY___:::\')[0]',
'     _d = _d.split(\':::___null___:::\')[0]',
'     obj[n] = _d;',
'    }',
'   }',
'  }',
' }',
'}',
',',
' _resetRowLow: function() {',
'  var existingData = this.getData(this.selection[0]);',
'  if(typeof existingData == \'undefined\') return;',
'  var flagNewRow = false;',
'  if(typeof existingData._isNewRow != \'undefined\') flagNewRow = existingData._isNewRow;',
'  if(flagNewRow) {',
'   this.deleteRow({prompt:false});',
'   return;',
'  }',
'  if(typeof existingData == \'undefined\') return false;',
'  if(typeof existingData._oldData == \'undefined\') return false;',
'  var data = {};',
'  var obj = existingData._oldData',
'  this._removeDirtyFlag(obj)',
'  $u.o.assign(data,obj);',
'  data._isDirty = false;',
'  data._isDeleted = false;',
'  data._hasServerSideError = false;',
'  data._serverSideErrors = false;',
'  data._hasWriteConflictErrors = false;',
'  data._writeConflictErrors = false;',
'  data._oldData = false;',
'  delete data._globalErrors;',
'  delete data._globalErrorsRaw;',
'  this.updateRow(this.selection[0],data);',
'  var existingData = this.getData(this.selection[0]);',
'  delete existingData._globalErrors;',
'  delete existingData._globalErrorsRaw;',
'  this.updateRow(this.selection[0],existingData);',
'  window[this._hostComponentId + \'_DlgObj\'].refreshClientSideComputations();',
'  this.populateUXControls();',
'  this._refreshDebugInfo();',
'  var topParent = this.allParentLists[this.allParentLists.length -1];',
'  if(typeof topParent != \'undefined\') {',
'   var lObjTP = window[this._hostComponentId + \'_DlgObj\'].getControl(topParent);',
'   var _r = lObjTP._getRoute();',
'   var _ra = this.__routeToArray(_r)',
'   this.setRowCleanPreserveState(_ra);',
'  }',
'  if(this.editInplaceSaveAll) this.editInplaceSaveAll()',
'  this._executeEvent(\'detailView.afterResetRow\',{});',
' }',
' ,',
' __routeToArray: function(_r) {   var arr = [];',
'  for(var i = 0; i < _r.length; i++) {',
'   if(i==0) {',
'    arr.push(_r[i].row);',
'   } else {',
'    arr.push(\'__LIST__\' +_r[i].list);',
'    arr.push(_r[i].row);',
'   }',
'  }',
'  return arr;',
' }',
',',
' _arrayIsDirty: function(arr) {   var flag = false;',
'  for(var i = 0; i < arr.length; i++) {',
'   if(arr[i]._isDirty) {',
'    return true;',
'   }',
'  }',
'  return false;',
' }',
',',
' _deleteRowLow: function(ops) {',
'  var flagSetValue = typeof ops.setValue != \'undefined\' ? ops.setValue : true;',
'  var data = this.getData(this.selection[0]);',
'  if(typeof data == \'undefined\') return false;',
'  var flagNewRow = \'\';',
'  if(typeof data._isNewRow != \'undefined\') flagNewRow = data._isNewRow;',
'  if(flagNewRow) {',
'   var _rn = this.selection[0];',
'   var _newRow = _rn;',
'   if( (_newRow +1) > (this._dataMap.length-1) ) _newRow = _newRow -1;',
'   this.nullOutDetailViewRecord();',
'   this.removeRows([_rn]);',
'   var flagListIsClean = !this._arrayIsDirty(this._data);',
'   data._isDeleted = true;',
'   var parentListName = this.parentList;',
'   if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'    var flagIsNewRow = false;',
'    var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.parentList);',
'    var parentData = plObj.getData(plObj.selection[0]);',
'    var parentData2 = parentData;',
'    var parentDataSublist = parentData[\'__LIST__\' + this.listVariableName];',
'    var indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(parentDataSublist,\'*key\',data[\'*key\']);',
'    parentDataSublist.splice(indx,1);',
'    var flagLoop = true;',
'    var parentList = plObj;',
'    while(flagLoop && flagListIsClean) {',
'     if( (typeof parentData[\'_oldData\'] == \'undefined\' || !parentData[\'_oldData\']) && (typeof parentData._isNewRecord != \'undefined\' || !parentData._isRewRecord)    ) {',
'      parentData._isDirty = false;',
'      parentData._flagGlobalErrorInChild = false;',
'      if(typeof parentList.parentList == \'undefined\' || parentList == \'\') break;',
'      parentList = window[this._hostComponentId + \'_DlgObj\'].getControl(parentList.parentList);',
'      if(parentList) {',
'       parentData = parentList.getData(parentList.selection[0]);',
'      } else {',
'       break;',
'      }',
'     } else {',
'      break;',
'     }',
'    }',
'    var topParent = this.allParentLists[this.allParentLists.length -1];',
'    var lTop = window[this._hostComponentId + \'_DlgObj\'].getControl(topParent);',
'    var topParentData = lTop.getData(lTop.selection[0]);',
'    lTop._resetFlags(topParentData);',
'    lTop._refreshListRecursive();',
'   }',
'   if(flagSetValue) this.setValue(_newRow);',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   _dlgObj.persistVariablesToLocalStorage();',
'   var that = this',
'   setTimeout(function() {',
'    that._executeEvent(\'detailView.afterDeleteRow\',{})',
'   },10);',
'   if(flagNewRow) {',
'     var lObjP = this._getTopParentListObject();',
'     var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'     var _mode = _dlgObj.__listPersistMode(lObjP.listVariableName);',
'    if(_mode == \'edits\') {',
'     var parentListId = this._getTopParentListObject().listVariableName;',
'     _dlgObj.persistListToLocalStorage(parentListId, { mode: \'update\'});',
'    }',
'   }',
'   return false;',
'  }',
'  data._isDirty = true;',
'  data._hasServerSideError = false;',
'  data._serverSideErrors = false;',
'  data._hasWriteConflictErrors = false;',
'  data._writeConflictErrors = false;',
'  data._oldData = false;',
'  data._isDeleted = true;',
'  data = this._base64Prefix(data,true);',
'  this.updateRow(this.selection[0],data);',
'  window[this._hostComponentId + \'_DlgObj\'].refreshClientSideComputations();',
'  this.populateUXControls();',
'  this._refreshDebugInfo();',
'  var that = this',
'   setTimeout(function() {',
'    that._executeEvent(\'detailView.afterDeleteRow\',{})',
'   },10)',
'  var parentListName = this.parentList;',
'  if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'   var flagIsNewRow = false;',
'   var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.parentList);',
'   if(plObj._setDirtyByChild) {',
'    plObj._setDirtyByChild(false);',
'   }',
'  }',
'  if(this.synchronizeImmediately) {',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var flagOnLine = _dlgObj._getOnlineStatus();',
'   if (flagOnLine) {',
'    _dlgObj.saveListEdits(this.listVariableName);',
'   }',
'  }',
'  if(this.onInplaceEditDeleteRowAfter){',
'   var d = this._data;',
'   var lObj = this;',
'   var rowNumber = this.selection[0];',
'   setTimeout(function() {',
'    lObj.onInplaceEditDeleteRowAfter.call(lObj,d,rowNumber);',
'   },100)',
'  }',
' }',
' ,',
' _base64Prefix: function(_d,flagRemove) {   var n = \'\';',
'  var b64prefix = \'\'',
'  for(var i = 0; i < this._listFields.length; i++) {',
'   if(typeof this._listFields[i].base64Prefix !== \'undefined\') {',
'    n = this._listFields[i].name;',
'    b64prefix = this._listFields[i].base64Prefix;',
'    _d[n] = _d[n].replace(b64prefix,\'\');',
'    if(!flagRemove) _d[n] = b64prefix + _d[n];',
'   }',
'  }',
'  return _d;',
' }',
' ,',
' _resetFlags: function(_d) {',
' var r = A5.u.object.each(_d,function(name,value,path,result) {',
'  if(name == \'_isDirty\'|| name == \'_isNewRow\' ){',
'   if(value) {',
'    path = path.splice(0,path.length -3);',
'    result.push({\'property\' : \'_isDirty\', path: JSON.stringify(path)} );',
'    while(path.length > 0) {',
'     path = path.splice(0,path.length -2)',
'     result.push({\'property\' : \'_isDirty\', \'path\': JSON.stringify(path)});',
'    }',
'   }',
'  }',
'  if(name == \'_hasServerSideError\' || name == \'_flagServerSideErrorInChild\' ) {',
'   if(value) {',
'    path = path.splice(0,path.length -3);',
'    result.push({\'property\' : \'_flagServerSideErrorInChild\', path: JSON.stringify(path)} );',
'    while(path.length > 0) {',
'     path = path.splice(0,path.length -2)',
'     result.push({\'property\' : \'_flagServerSideErrorInChild\', \'path\': JSON.stringify(path)});',
'    }',
'   }',
'  }',
'  if(name == \'_hasGlobalErrors\' || name == \'_flagGlobalErrorInChild\' ) {',
'   if(value) {',
'    path = path.splice(0,path.length -3);',
'    result.push({\'property\' : \'_flagGlobalErrorInChild\', path: JSON.stringify(path)} );',
'    while(path.length > 0) {',
'     path = path.splice(0,path.length -2)',
'     result.push({\'property\' : \'_flagGlobalErrorInChild\', \'path\': JSON.stringify(path)});',
'    }',
'   }',
'  }',
'  if(name == \'_hasWriteConflictErrors\' || name == \'_flagWriteConflictErrorInChild\' ) {',
'   if(value) {',
'    path = path.splice(0,path.length -3);',
'    result.push({\'property\' : \'_flagWriteConflictErrorInChild\', path: JSON.stringify(path)} );',
'    while(path.length > 0) {',
'     path = path.splice(0,path.length -2)',
'     result.push({\'property\' : \'_flagWriteConflictErrorInChild\', \'path\': JSON.stringify(path)});',
'    }',
'   }',
'  }',
' });',
' var _d2 = \'\';',
' var path = \'\';',
' var property = \'\';',
' for(var i = 0; i < r.length; i++) {',
'    _d2 = _d',
'   path = JSON.parse(r[i].path)',
'   property = r[i].property',
'   for(var j = 0; j < path.length; j++) {',
'    _d2 = _d2[path[j]];',
'   }',
'   _d2[property] = true;',
' }',
'}',
',',
' resetForm: function() {',
'  if(this._executeEvent(\'detailView.canUndoEdits\',{}) == false) return false;',
'  var ops = typeof arguments[0] != \'undefined\' ? arguments[0] : {};',
'  var flagPrompt = typeof ops.prompt != \'undefined\' ? ops.prompt : true;',
'  if(!flagPrompt) {',
'   this._resetFormLow();',
'   return true;',
'  }',
'  var classInst = this;',
'  var msg = this.customization.dv.confirmFormResetWarning.message;',
'  var image = this.customization.dv.confirmFormResetWarning.icon;',
'  var title = this.customization.dv.confirmFormResetWarning.title;',
'  if(msg.toLowerCase().indexOf(\'javascript:\') == 0) {',
'   var fn = msg.split(\':\')[1];',
'   fn = fn.split(\'(\')[0];',
'   window[fn].call();',
'   return false;',
'  }',
'  var iconType = window[this._hostComponentId + \'_DlgObj\']._iconType(image);',
'  var imageHTML = window[this._hostComponentId + \'_DlgObj\']._getImageHTML(image,iconType);',
'  msg = \'<div style="padding: 10px;" >\' + imageHTML + msg + \'<br style="clear: both;" /></div>\';',
'  A5.msgBox.show(title,msg,\'yn\',function(button) {',
'   if(button == \'yes\'){',
'    classInst._resetFormLow();',
'      } else if(button == \'no\'){',
'      }',
'      delete classInst;',
'  } );',
' }',
' ,',
' _resetFormLow: function() {  var r = this.selection[0];',
'  if(typeof r == \'undefined\') {',
'   this.newDetailViewRecord();',
'  }',
'  this.populateUXControls(undefined,true);',
'  var ctrls = this._getControlsInDv();',
'  var eleId = \'\';',
'  var arr = [];',
'  var indx = -1;',
'  for(var i = 0; i < ctrls.length; i++) {',
'   window[this._hostComponentId + \'_DlgObj\'].setControlDirty(ctrls[i],false);',
'   if( window[this._hostComponentId + \'_DlgObj\']._eh._e.length > 0) {',
'    eleId = this._hostComponentId +  \'.V.R1.\' + ctrls[i].toUpperCase();',
'    indx = window[this._hostComponentId + \'_DlgObj\']._findArrayProp(window[this._hostComponentId + \'_DlgObj\']._eh._e,\'id\',eleId);',
'    if(indx >= 0 ) arr.push(eleId);',
'   }',
'  }',
'  if(arr.length > 0) window[this._hostComponentId + \'_DlgObj\'].clearErrors(arr);',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlgObj.refreshClientSideComputations();',
'  this._executeEvent(\'detailView.afterUndoEdits\',{});',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlgObj.persistVariablesToLocalStorage();',
'  _dlgObj._list_executeEvent(this.listVariableName,\'detailView.onStateChanged\',{isDirty:false});',
'  this.__detailViewWentDirtyHasFired = undefined;',
' }',
' ,',
' detailViewIsDirty: function() {',
'  if(this._dvmode == \'search\') return false;',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  if (this._hasDetailView) {',
'   if(this._propertyGrid) {',
'    var propertyGridName = this._propertyGridName;',
'     var obj = _dlgObj.getControl(propertyGridName);',
'     if(typeof obj.state.isDirtyImmediate != \'undefined\') return obj.state.isDirtyImmediate',
'     return obj.state.isDirty;',
'   }',
'   if(this._JSONForm) {',
'    var formName = this._JSONFormName;',
'    if(formName != \'\') {',
'     try{',
'      var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'      var obj = _dlgObj.getControl(formName);',
'      if(typeof obj.state.isDirtyImmediate == \'undefined\') return false;',
'      if (obj) return obj.state.isDirtyImmediate',
'     }catch(e) {',
'      return false;',
'     }',
'    }',
'   }',
'  }',
'  var flagDrillDown = typeof arguments[0] != \'undefined\' ? arguments[0] : false;',
'  var isDirty = false;',
'  this._nameOfListWithDirtyDetailView = \'\';',
'  this._nameOfDirtyDetailViewConrol = \'\';',
'  for(var i = 0; i < this._listFields.length; i++) {',
'   controlName = this._getUXDetailViewControlName(this._listFields[i].name);',
'   if(window[this._hostComponentId + \'_DlgObj\'].getControlDirty(controlName.toUpperCase())) {',
'    var flagLog = false;',
'    if(typeof this.logDetailViewDirty != \'undefined\') flagLog = this.logDetailViewDirty;',
'    if(flagLog) console.log(controlName + \' caused the list to go dirty\')',
'    isDirty =  true;',
'    this._nameOfListWithDirtyDetailView = this.listVariableName;',
'    this._nameOfDirtyDetailViewConrol = controlName',
'    break;',
'   }',
'  }',
'  if(!isDirty) {',
'   if (this._detailView.method == \'fieldMap\') {',
'    var arr = this._detailView.fieldMap;',
'    var jForm = \'\';',
'    for(var i = 0; i < arr.length; i++) {',
'     jForm = arr[i].control.split(\'::\')[1];',
'     var jObj = _dlgObj.getControl(jForm);',
'     if(jObj && jObj.state && jObj.state.isDirty) {',
'      this._nameOfListWithDirtyDetailView = this.listVariableName;',
'      isDirty = true;',
'     }',
'    }',
'   }',
'  }',
'  this._dvIsDirty = isDirty;',
'  if(isDirty == false && flagDrillDown) {',
'   var lObj = \'\';',
'   for(var i = 0; i < this.childLists.length; i++) {',
'    lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'    if(lObj) {',
'     isDirty = lObj.detailViewIsDirty(flagDrillDown);',
'     if(isDirty) {',
'      this._nameOfListWithDirtyDetailView = lObj._nameOfListWithDirtyDetailView;',
'      $(\'msg1\').innerHTML = this._nameOfListWithDirtyDetailView ;',
'     }',
'     if(isDirty) break;',
'    }',
'   }',
'  }',
'  if(typeof this.__detailViewWentDirtyHasFired == \'undefined\') {',
'   if(isDirty) {',
'    var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'    _dlgObj._list_executeEvent(this.listVariableName,\'detailView.onStateChanged\',{isDirty:true});',
'    this.__detailViewWentDirtyHasFired = true',
'   }',
'  }',
'  return isDirty;',
' }',
' ,',
' listIsInEditMode: function() {   var flag = false;',
'  var d = this._data;',
'  for(var i = 0; i < d.length; i++) {',
'   if(d[i].__edit) {',
'    flag = true;',
'    break;',
'   }',
'  }',
'  return flag;',
' }',
' ,',
' listIsDirty: function() {  this.__fixData(this)',
'  for(var i = 0; i < this._data.length; i++) {',
'   if(typeof this._data[i]._isDirty != \'undefined\') {',
'    if(this._data[i]._isDirty) {',
'     return true;',
'     }',
'   }',
'  }',
'  if(typeof this._editing != \'undefined\') {',
'   if(this._editing.dirty) return true;',
'  }',
'  return false;',
' }',
' ,',
' _parentListHasActiveRow: function() {  var pl = this.parentList;',
'  if(typeof pl == \'undefined\') {',
'   return true;',
'  }',
'  var l = window[this._hostComponentId + \'_DlgObj\'].getControl(pl);',
'  if(!l) return false;',
'  var s = l.selection[0];',
'  if(typeof s == \'undefined\') return false;',
'  return true;',
' }',
' ,',
' newDetailViewRecord: function() {',
' if(typeof this.__hasEmbeddedDetailView != \'undefined\') {',
'  if(this.__hasEmbeddedDetailView) {',
'   var cont = this.__embeddedDetailView.container',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var ele = _dlgObj.getPointer(cont)',
'   var pEle = $(this.contId+\'.CONTENT\');',
'   pEle.appendChild(ele)',
'   ele.style.display = \'\';',
'   A5.u.element.setScroll(pEle.parentNode,ele);',
'  }',
'}',
'  var flagParentIsDeleted = false;',
'  var pData = \'\';',
'  if(this.allParentLists.length > 0) {',
'   for(var i = 0; i < this.allParentLists.length; i++) {',
'    pObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.allParentLists[i]);',
'    if(typeof pObj.selection[0] != \'undefined\') {',
'     pData = pObj.getData(pObj.selection[0]);',
'     if(typeof pData._isDeleted != \'undefined\') {',
'      if(pData._isDeleted) {',
'       flagParentIsDeleted = true;',
'       break;',
'      }',
'     }',
'    }',
'   }',
'  }',
'  if(this._executeEvent(\'detailView.canNewRecord\',{}) == false) return false;',
'  var val = \'\';',
'  var controlName = \'\';',
'  var defaultJS = \'\';',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var flagJSONForm = false;',
'  var flagPropertyGrid = false;',
'  var jfobj = {};',
'  if(this._JSONForm) {',
'   flagJSONForm = true;',
'  }',
'  if(this._propertyGrid) {',
'   flagPropertyGrid = true;',
'  }',
'  for(var i = 0; i < this._listFields.length; i++) {',
'   controlName = this._getUXDetailViewControlName(this._listFields[i].name);',
'   defaultJS = this._listFields[i].defaultValue;',
'   var flagForceSet = false;',
'   if(defaultJS != \'\') {',
'    var _f = Function(this._listFields[i].defaultValue);',
'    val = _f.call(this);',
'   } else {',
'    val = \'\';',
'   }',
'   jfobj[this._listFields[i].name] = val;',
'   var controlType = _dlgObj._getControlType(controlName).toLowerCase();',
'   if(controlType == \'formbox\' && (typeof val == \'undefined\' || val == \'\' ) ) val = \'{}\';',
'   if(typeof val == \'undefined\') val = \'\';',
'   _dlgObj.setValue(controlName,val,false);',
'   var valOriginal = _dlgObj.originalValues[0][controlName.toUpperCase()];',
'   if(  (val == valOriginal || typeof val == \'undefined\') && flagForceSet == false &&controlName != \'\' ) {',
'   } else {',
'   }',
'   if(controlType == \'signaturecapture\') {',
'    _dlgObj._functions._toggleCanvas(controlName.toUpperCase(),\'canvas\');',
'    _dlgObj._functions._clearCanvas(controlName.toUpperCase())',
'   }',
'  }',
'  this._deselectAll();',
'  this._clearServerSideErrors();',
'  this._executeEvent(\'detailView.afterNewRecord\',{});',
'  this._emptyAllChildLists();',
'  if(flagParentIsDeleted) this.disableDetailView(true);',
'  else this.disableDetailView(false);',
'  this._dvmode = \'enter\';',
'  this._setNullMode();',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlgObj._list_executeEvent(this.listVariableName,\'detailView.modeChanged\',{mode: \'enter\'});',
'  _dlgObj.refreshClientSideComputations();',
'  this._selectedRow = -1;',
'  this._currentDetailViewKey = undefined;',
'  if(this._dataSourceType.toLowerCase() == \'transform\') {',
'   var d = {};',
'   var obj = {\'setFocusToTargetRow\': true}',
'   this.addTableRow(d,obj);',
'  }',
'  if(flagJSONForm) {',
'   var json = JSON.stringify(jfobj);',
'   var fn = this._JSONFormName;',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   _dlgObj.setValue(fn,json);',
'   }',
'  if(flagPropertyGrid) {',
'   var d2 = {};',
'   d2.v = jfobj',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var pgName = lObj._propertyGridName;',
'   var pObj = _dlgObj.getControl(pgName);',
'   if(pObj) pObj.populate(d2);',
'  }',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlgObj.setValue(this.listVariableName,\'\',false);',
' }',
' ,',
' _setNullMode: function() {',
'  if(typeof this._dvmode == \'undefined\') return true;',
'  if(this._dvmode == \'enter\') {',
'   if(typeof this._allowNullSelectionStored == \'undefined\') {',
'    this._allowNullSelectionStored = this.allowNullSelection;',
'   }',
'   this.allowNullSelection = true;',
'  }',
'  if(this._dvmode != \'enter\') {',
'   if(typeof this._allowNullSelectionStored != \'undefined\') {',
'    this.allowNullSelection = this._allowNullSelectionStored;',
'   }',
'  }',
' }',
',',
' _emptyAllChildLists: function() {   for(var i = 0; i < this.childLists.length; i++) {',
'   var lobj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'   if(lobj) {',
'    if(lobj._emptyList) lobj._emptyList();',
'    window[this._hostComponentId + \'_DlgObj\'].setValue(lobj.listVariableName,false,false);',
'   }',
'  }',
' }',
' ,',
' _emptyChildList: function(row) {',
'  var _d = this.getData(row);',
'  var lName = \'\';',
'  for(var name in _d) {',
'   if(_d[name] != null) {',
'    if(_d[name].constructor == Array) {',
'     lName = name.split(\'__LIST__\')[1];',
'     if(typeof lName != \'undefined\') {',
'      _d[name] = [];',
'     }',
'    }',
'   }',
'  }',
' }',
' ,',
' _getUXDetailViewControlName: function(field) {  if(!this._hasDetailView) {',
'   return \'\';',
'  }',
'  if(this._detailView.method == \'fieldMap\') {',
'   for(var i = 0; i < this._detailView.fieldMap.length; i++) {',
'    if(this._detailView.fieldMap[i].field == field) {',
'     return this._detailView.fieldMap[i].control;',
'    }',
'   }',
'   return \'\';',
'  } else {',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var controlsInContainer = _dlgObj.__controlNesting[this._detailView.container];',
'   if(typeof controlsInContainer == \'undefined\') return \'\';',
'   var indx = controlsInContainer.indexOf(field);',
'   if(indx == -1 ) return \'\';',
'   else return field;',
'  }',
' }',
' ,',
' _showGlobalError: function(txt) {  var flagShowAlerts = this.flagShowAlerts;',
'  if(typeof flagShowAlerts == \'undefined\') flagShowAlerts = true;',
'  var gph = this._hostComponentId + \'.V.R1.\' + this._globalErrorPlaceHolder;',
'  var ele = $(gph);',
'  if(!ele) {',
'   if(flagShowAlerts) alert(txt);',
'   return false;',
'  }',
'  var cssTxt = this._detailViewGlobalErrorStyle;',
'  cssTxt = cssTxt + \'; display: ;\'',
'  ele.style.cssText = cssTxt;',
'  ele.innerHTML = txt;',
' }',
' ,',
' _clearGlobalError: function() {  var gph = this._hostComponentId + \'.V.R1.\' + this._globalErrorPlaceHolder;',
'  ele = $(gph);',
'  if(ele) {',
'   ele.style.display = \'none\';',
'   ele.innerHTML = \'\';',
'  }',
' }',
' ,',
' updateTableRow: function(primaryKeyOrRowNumber,dataObj,options) {',
'  var a = [];',
'  var fm = [];',
'  if(this._detailView.method == \'fieldMap\') {',
'   fm = this._detailView.fieldMap',
'  }',
'  var getFieldFromMap = function(n) {',
'   if(fm.length == 0) return \'\';',
'   for(var i = 0; i < fm.length; i++) {',
'    if(fm[i].control == n) return fm[i].field;',
'   }',
'   return \'\';',
'  }',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  for(var n in dataObj) {',
'   var fn = \'\';',
'   fn = getFieldFromMap(n);',
'   if(fn == \'\') fn = n;',
'   a.push({control: n, field: fn,isDirty: true})',
'   var _id = _dlgObj.dialogId + \'.V.R1.\' + n.toUpperCase() + \'_HIDDENA5FN\';',
'   var ele = $(_id);',
'   if(ele) $sa(ele,\'a5isdirty\',\'true\')',
'  }',
'  if(typeof primaryKeyOrRowNumber == undefined || primaryKeyOrRowNumber == null) {',
'   alert(\'Action cancelled because primaryKeyOrRowNumber parameter was not specified\');',
'   return;',
'  }',
'  if(typeof options == \'undefined\') options = {};',
'  if(typeof options.setFocusToTargetRow == \'undefined\') options.setFocusToTargetRow = false;',
'  var obj = {};',
'  obj.programmatic = true;',
'  obj.data = {};',
'  $u.o.assign(obj.data,dataObj);',
'  obj.primaryKeyOrRowNumber = primaryKeyOrRowNumber;',
'  obj.setFocusToTargetRow = options.setFocusToTargetRow;',
'  window[this._hostComponentId + \'_DlgObj\']._updateListDataFromUXControls(this.listVariableName,null,obj);',
'  var parentListName = this.parentList;',
'  if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'   var thisData = obj.data;',
'   var flagIsNewRow = false;',
'   if(typeof thisData._isNewRow != \'undefined\') flagIsNewRow = thisData._isNewRow;',
'   var flagIsExistingRow = false;',
'   if(typeof thisData._isDirty != \'undefined\') flagIsExistingRow = thisData._isDirty;',
'   if(flagIsNewRow || flagIsExistingRow) {',
'   }',
'   var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.parentList);',
'   if(plObj._setDirtyByChild) {',
'    plObj._setDirtyByChild(false);',
'   }',
'  }',
'  this.__modifyOldData(a,primaryKeyOrRowNumber);',
'  window[this._hostComponentId + \'_DlgObj\'].refreshClientSideComputations();',
' }',
' ,',
' __setListValues: function(row, pk,pkfields, crc,linkValue, linkFieldName,fullpath) {',
'  var _data = this._data ;',
'  if(_data.length == 0) return;',
'  var _dr = _data[row];',
'  if(typeof _dr == \'undefined\') return;',
'  for(var n in _dr) {',
'   if(n.indexOf(\'_\') == 0 && n.indexOf(\'__LIST__\') != 0) {',
'    delete _dr[n];',
'   }',
'  }',
'  _dr.__primaryKey = \'\' + pk;',
'  pkfields = pkfields.split(\',\')',
'  pk = \'\' + pk',
'  var pkval = pk.split(\'|||\');',
'  for(var i = 0; i < pkfields.length ; i++) {',
'   _dr[pkfields[i]] = pkval[i];',
'  }',
'  _dr.__A5crc = \'\' + crc;',
'  if(typeof linkValue != \'undefined\') {',
'   _dr[linkFieldName] = linkValue;',
'  }',
'  this.refresh();',
'  this.setValue(row,false);',
' }',
',',
' __setFocusToKey: function(pk) {   var _data = this._rData;',
'  if(pk == \'lastrecord\') {',
'   if(typeof _data[_data.length -1] == \'undefined\') return;',
'   var pk2 = _data[_data.length -1].__primaryKey;',
'   obj.setValue(pk2,false);',
'  }else {',
'   obj.setValue(pk,false);',
'  }',
' }',
',',
' __findRowNumberForKey: function(pk) {   var _data = this._rData;',
'  var ix = -1',
'  for(var i = 0; i < _data.length; i++) {',
'   if(_data[i].__primaryKey == pk) {',
'    ix = i;',
'    break;',
'   }',
'  }',
'  if(typeof _data[ix+1] == \'undefined\' || typeof _data[ix+1].__primaryKey == \'undefined\') return \'lastrecord\';',
'  else return _data[ix+1].__primaryKey',
'  return ix;',
' }',
',',
' deleteTableRowsBulk: function(dataArray) {   var d = this._data',
'  function findrow(data,pk) {',
'   var n = -1',
'   for (var i = 0; i < data.length; i++) {',
'    if(typeof pk == \'string\') {',
'     if(data[i][\'*value\'] == pk) {',
'      n = i;',
'      break;',
'     }',
'    } else {',
'     n = data[i];',
'    }',
'   }',
'   return n;',
'  }',
'  var indx = [];',
'  for(var i = 0; i <dataArray.length; i++) {',
'   var n = -1',
'   if(typeof dataArray[i] == \'string\') {',
'    n = findrow(d,dataArray[i])',
'   } else {',
'    n = i;',
'   }',
'   if(n > -1) {',
'    if(typeof d[n].__primaryKey != \'undefined\') {',
'     d[n]._isDeleted = true;',
'     d[n].__displayStyle = \'deleteRow\';',
'     d[n]._isDirty = true;',
'    } else {',
'     indx.push(n);',
'    }',
'   }',
'  }',
'  indx.sort(function(a,b){return a < b ? 1 : -1});',
'  for(var i = 0; i < indx.length; i++) {',
'   this._data.splice(indx[i],1)',
'  }',
'  this.refresh();',
'}',
',',
' addTableRowsBulk: function(dataArray) {',
'  var _str = JSON.stringify(dataArray);',
'  dataArray = JSON.parse(_str)',
'  if(this.__pkisguid) {',
'   if(this.__assignPKGuidClientSide) {',
'    var d2;',
'    for(var i = 0; i < dataArray.length; i++) {',
'     d2 = dataArray[i]',
'     if(typeof d2[this.__pkfieldname] == \'undefined\') {',
'      d2[this.__pkfieldname] = A5.UUID();',
'      if(!this.__stripcurlyfromguid) {',
'       d2[this.__pkfieldname] = \'{\' + d2[this.__pkfieldname] + \'}\';',
'      }',
'     }',
'    }',
'   }',
'  }',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  if(typeof dataArray == \'undefined\') return false;',
'  if(dataArray.length == 0) return false;',
'  var mf = this._mediaFields;',
'  var dirtyMediaFields = [];',
'  var flagHasDirtyMediaFields = false;',
'  if(typeof mf != \'undefined\') {',
'   var d1 = dataArray[0];',
'   for(var n in d1) {',
'    if(mf.indexOf(n) > -1) dirtyMediaFields.push(n);',
'   }',
'  }',
'  if(dirtyMediaFields.length > 0) flagHasDirtyMediaFields = true;',
'  if(flagHasDirtyMediaFields) {',
'   var _dirtyImages = {};',
'   for(var i = 0; i < dirtyMediaFields.length; i++) {',
'    _dirtyImages[dirtyMediaFields[i]] = true;',
'   }',
'  }',
'  var _guid;',
'  for(var i = 0; i < dataArray.length; i++) {',
'   _guid = A5.UUID();',
'   dataArray[i][\'*rowGUID\'] = _guid ;',
'   dataArray[i]._isDirty = true;',
'   dataArray[i]._isNewRow = true;',
'   dataArray[i]._displayStyle = \'newRow\';',
'   if(flagHasDirtyMediaFields) dataArray[i]._dirtyImages = _dirtyImages;',
'  }',
'  var allParentLists = this.allParentLists;',
'  var isTopParent = false;',
'  if(allParentLists == \'\') {',
'   isTopParent = true;',
'   var _d = this._data;',
'   this.appendRows(dataArray);',
'   var targetRow;',
'   targetRow = this._data.length-1;',
'   this.setValue(targetRow ,true)',
'   return false;',
'  }',
'  var route;',
'  var thisList = this;',
'  var topParentListName = this.listVariableName;',
'  var flag = true;',
'  while(flag) {',
'   if(typeof thisList.parentList == \'undefined\' || thisList.parentList == \'\') break;',
'   thisList = _dlgObj.getControl(thisList.parentList);',
'  };',
'  var lObjTopParent = thisList;',
'  var listName = this.listVariableName;',
'  route = lObjTopParent._getRoute(\'*key\',[],listName);',
'  if(!route) {',
'   alert(\'Cannot add rows to List becuase parent List does not have a selected row.\')',
'   return false;',
'  }',
'  var _row = this.selection[0];',
'  var ra = lObjTopParent.__routeToArray(route);',
'  if(ra.indexOf(\'__LIST__\' + this.listVariableName.toUpperCase()) == -1) {',
'   ra.push(\'__LIST__\' + this.listVariableName.toUpperCase());',
'   ra.push(0);',
'  }',
'  var _d = lObjTopParent._data;',
'  for(var i = 0; i < ra.length-1; i++) {',
'   var _r = ra[i];',
'   if(typeof _d[_r] != \'undefined\') _d = _d[_r];',
'  }',
'  _d.push.apply(_d,dataArray);',
'  var flag = true;',
'  var listPObj;',
'  var listCObj;',
'  listCObj = this;',
'  while(flag) {',
'   if(typeof listCObj.parentList == \'undefined\' || listCObj.parentList == \'\') break;',
'   listPObj = _dlgObj.getControl(listCObj.parentList);',
'   listPObj._setDirtyByChild(false,[],listCObj.listVariableName);',
'   listCObj = listPObj;',
'  };',
'  listPObj = _dlgObj.getControl(this.parentList);',
'  listPObj._populateChildList(this.listVariableName);',
' }',
' ,',
' addTableRow: function(dataObj,options) {  var flagRefresh = false;',
'  for(var n in dataObj) {',
'   if(A5.u.typeOf(dataObj[n]) == \'date\') dataObj[n] = \'\' + dataObj[n];',
'  }',
'  var _str = JSON.stringify(dataObj);',
'  dataObj = JSON.parse(_str)',
'  var parentList = this.parentList;',
'  if(typeof parentList != \'undefined\' && parentList != \'\') {',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   var lp = _dlgObj.getControl(parentList);',
'   var r = lp.selection[0];',
'   if(typeof r == \'undefined\') {',
'    alert(\'Can not add row to list \' + this.listVariableName + \' as there is no row selected in this List\\\'s parent list (\\\'\'+parentList+\'\\\')\');',
'    return false;',
'   }',
'  }',
'  if(typeof options == \'undefined\') {',
'   options = {};',
'  }',
'  if(typeof options.setFocusToTargetRow == \'undefined\') options.setFocusToTargetRow = false;',
'  var obj = {};',
'  obj.programmatic = true;',
'  obj.data = {};',
'  if(this.__pkisguid) {',
'   if(this.__assignPKGuidClientSide) {',
'    if(typeof dataObj[this.__pkfieldname] == \'undefined\') {',
'     dataObj[this.__pkfieldname] = A5.UUID();',
'     if(!this.__stripcurlyfromguid) {',
'      dataObj[this.__pkfieldname] = \'{\' + dataObj[this.__pkfieldname] + \'}\';',
'     }',
'    }',
'   }',
'  }',
'  $u.o.assign(obj.data,dataObj);',
'  obj.primaryKeyOrRowNumber = null;',
'  obj.setFocusToTargetRow = options.setFocusToTargetRow;',
'  if(typeof options.insertRow == \'undefined\') options.insertRow = false;',
'  obj.insertRow = options.insertRow;',
'  obj.insertRowPosition = options.insertPosition;',
'  var _dlg = window[this._hostComponentId + \'_DlgObj\'];',
'  _dlg._updateListDataFromUXControls(this.listVariableName,null,obj);',
'  var parentListName = this.parentList;',
'  if(typeof parentListName != \'undefined\' && parentListName != \'\') {',
'   var thisData = obj.data;',
'   var plObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.parentList);',
'   if(plObj._setDirtyByChild) {',
'    plObj._setDirtyByChild(true,thisData,this.listVariableName);',
'   }',
'  }',
'  if(!options.preventOnSelect) this._onSelect();',
'  _dlg.refreshClientSideComputations();',
'  return obj.data;',
' }',
' ,',
' _setChildHasWriteConflictFlag: function() {',
' var _d = this.getData(this.selection[0]);',
' var flag = this._hasChildWithWriteConflict();',
' _d._flagWriteConflictErrorInChild = flag;',
' if(typeof _d._oldData == \'undefined\') {',
'  var flag = this._hasChildWithDirtyData()',
'  _d._isDirty = flag;',
' }',
' this.updateRow(this.selection[0],_d);',
' var parentList = this.parentList;',
' if(typeof parentList != \'undefined\') {',
'  var lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(parentList);',
'  lObj._setChildHasWriteConflictFlag();',
' }',
' return false;',
'}',
',',
' detailViewOrChildListDetailViewIsDirty: function() {',
' var flag = false;',
' if(this.detailViewIsDirty() )return true;',
' var lObj = \'\';',
' var data = \'\';',
' for (var i = 0; i < this.childLists.length; i++) {',
'  lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'  if (lObj && lObj.detailViewIsDirty()) {',
'   flag = true;',
'   return true;',
'  }',
' }',
' return flag;',
'}',
',',
' _hasChildWithDirtyData: function() {',
' var flag = false;',
' var lObj = \'\';',
' var data = \'\';',
' for (var i = 0; i < this.childLists.length; i++) {',
'  lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'  data = lObj.getData(lObj.selection[0]);',
'  if(typeof data._isDirty != \'undefined\') {',
'   if(data._isDirty) flag = true;',
'  }',
'  if(flag == false) {',
'   var flag2 = lObj._hasChildWithDirtyData();',
'   if(flag2) flag = true;',
'  }',
' }',
' return flag;',
'}',
',',
' _hasChildWithWriteConflict: function() {',
' var flag = false;',
' var lObj = \'\';',
' var data = \'\';',
' for (var i = 0; i < this.childLists.length; i++) {',
'  lObj = window[this._hostComponentId + \'_DlgObj\'].getControl(this.childLists[i]);',
'  data = lObj.getData(lObj.selection[0]);',
'  if(typeof data._hasWriteConflictErrors != \'undefined\') {',
'   if(data._hasWriteConflictErrors) flag = true;',
'  }',
'  if(typeof data._flagWriteConflictErrorInChild != \'undefined\') {',
'   if(data._flagWriteConflictErrorInChild) flag = true;',
'  }',
'  if(flag == false) {',
'   var flag2 = lObj._hasChildWithWriteConflict();',
'   if(flag2) flag = true;',
'  }',
' }',
' return flag;',
'}',
',',
' _populateMyChildren: function() {',
'if(this.detailViewOrChildListDetailViewIsDirty() ) return false;',
' for(var i = 0; i < this.childLists.length; i++) {',
'  var lname = this.childLists[i];',
'  this._populateChildList(lname);',
' }',
'}',
',',
' _emptyList: function() {',
' this.populate([]);',
' this._currentDetailViewKey = undefined;',
' this._selectedRow = -1;',
' var e = $(this._hostComponentId + \'.\' + this.listVariableNameTrueCase + \'.RECORDCOUNT\');',
' if(e) e.innerHTML = \'0\';',
' this.nullOutDetailViewRecord(true);',
' for(var i = 0; i < this.childLists.length; i++) {',
'  var lname = this.childLists[i];',
'  var lobj = window[this._hostComponentId + \'_DlgObj\'].getControl(lname);',
'  lobj._emptyList();',
' }',
'}',
',',
' _populateChildList: function(list) {',
' var alreadyCleared = arguments[1] || false;',
' var flagParentIsDeleted = false;',
' lChildObj = window[this._hostComponentId + \'_DlgObj\'].getControl(list);',
' if(typeof lChildObj._parentIsDeleted != \'undefined\') flagParentIsDeleted = lChildObj._parentIsDeleted;',
' var _d = this.getData(this.selection[0]);',
' var flagClearChildLists = false;',
' if(typeof _d == \'undefined\' || _d == null || this.selectionData.length == 0) {',
'  flagClearChildLists = true;',
' }',
' if(typeof _d == \'undefined\') {',
'  flagClearChildLists = true;',
' }',
' if(flagClearChildLists) {',
'  if(! alreadyCleared) this._emptyAllChildLists();',
'  return false;',
' }',
' var childDataObjectName = this._getChildDataObjectName(list);',
' var _rd = _d[childDataObjectName];',
' if(_rd == null || typeof _rd == \'undefined\') {',
'  _rd = [];',
' }',
' if(typeof _rd == \'undefined\' || _rd.length == 0) {',
'  if(_d == false) _d = [];',
'  _d[childDataObjectName] = [];',
'  _rd = _d[childDataObjectName]',
' }',
' var lobj = window[this._hostComponentId + \'_DlgObj\'].getControl(list);',
' if(lobj) {',
'  lobj.populate(_rd);',
'  var e = $(this._hostComponentId + \'.\' + lobj.listVariableNameTrueCase + \'.RECORDCOUNT\');',
'  if(e) e.innerHTML = _rd.length;',
'  lobj.disableDetailView(false);',
'  if(lobj.allowNullSelection) {',
'   if(lobj.nullOutDetailViewRecord) lobj.nullOutDetailViewRecord(true);',
'   var ac = false;',
'   for(var i = 0; i < lobj.childLists.length; i++) {',
'    var lname = lobj.childLists[i];',
'    if(!lobj._populateChildList(lname,ac)) {',
'     ac = true;',
'       }',
'   }',
'  }',
' }',
' this._currentSelection = this.selection[0];',
' if(flagParentIsDeleted) lobj.disableDetailView(true);',
' setTimeout(function() { if(lobj) lobj.refresh()},10);',
'}',
',',
' _setSynchProgress: function(pct) {',
' var x = \'\';',
' if(Number(pct) == 0) x = \'none\';',
' var eleO = $(\'SYNCHPROGRESS.\' + this.listVariableName);',
' if(eleO) eleO.style.display = \'\';',
' var eleI = $(\'SYNCHPROGRESS.\' + this.listVariableName + \'.SLIDER\');',
' if(eleI) {',
'  eleI.style.display = x;',
'  eleI.style.width = \'\' + pct + \'%\';',
' }',
'}',
',',
' _hideSynchProgress: function(pct) {',
' var eleO = $(\'SYNCHPROGRESS.\' + this.listVariableName);',
' if(eleO) eleO.style.display = \'none\';',
'}',
',',
' _cancelBatchSynchronize: function() {',
' var flag = this._executeEvent(\'detailView.canCancelBatch\',{});',
' if(!flag) {',
'  return false;',
' }',
' this._flagCancelBatchSynchronize = true;',
'}',
',',
' _harvestMediaFields_low: function(arr,objListName,objState,data,options) {',
' var _mediaMap = \'\';;',
' var _mediaFields = \'\';',
' var listName = \'\';',
' var lObj = \'\';',
' var flagNested = false;',
' var objDirty = false;',
' var fieldDirty = false;',
' var lName = \'\';',
' var flagCheck = \'\';',
' var flagIsMediaField = false;',
' var mode = options.mode;',
' if(typeof mode == \'undefined\') mode = \'\';',
' var flagCapture = false;',
' var flagCapture2 = false;',
' var flagChildTable = false;',
' for(var prop in data) {',
'  if(prop == \'_dirtyImages\' || prop == \'_writeConflictErrors\' || prop == \'_serverSideErrors\' || prop ==\'_globalErrorsRaw\' || prop == \'_globalErrors\' ) continue;',
'  if( data[prop] != null && data[prop].constructor == Array) {',
'   if(data[prop].length > 0 && prop.indexOf(\'__LIST__\') ==0) {',
'    objListName.push({table: prop, nested: true});',
'    for(var i = 0; i < data[prop].length; i++) {',
'     objState.push( {table: objListName[  objListName.length -1][\'table\'], row: i}) ;',
'     this._harvestMediaFields_low(arr,objListName,objState,data[prop][i],options);',
'     objState.pop();',
'    }',
'    objListName.pop();',
'   }',
'  } else {',
'   if(objListName.length == 0) {',
'    continue;',
'   }',
'   listName   = objListName[objListName.length -1][\'table\'];',
'   flagNested = objListName[objListName.length -1][\'nested\'];',
'   var lObj = \'\';',
'   if(listName == \'_top_\') {',
'    lObj = this;',
'    flagChildTable = false;',
'   } else {',
'    listName = listName.split(\'__LIST__\')[1];',
'    if(typeof listName != \'undefined\') {',
'     var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'     lObj = _dlgObj.getControl(listName);',
'     flagChildTable = true;',
'    }',
'   }',
'   if(lObj) {',
'    flagCheck = true;',
'    _mediaMap = lObj._mediaFields;',
'    flagIsMediaField = false;',
'    if(!options.flagDirtyOnly) {',
'     if(_mediaMap.indexOf(prop) > -1) flagIsMediaField = true;',
'     if(flagIsMediaField) {',
'      lName = objListName[objListName.length -1][\'table\'];',
'      if(lName == \'_top_\') lName = lObj.listVariableName;',
'      flagCapture = false;',
'      var _data = \'\';',
'      try{',
'       _data = data[prop];',
'       if(_data.toLowerCase().indexOf(\'alpha-local://jpg?url=\') == 0) {',
'        _data = _data.split(\'url=\')[1];',
'       }',
'      }catch(e) { }',
'      if(mode == \'\') {',
'       if(_data != null && _data != \'\' && _data.toLowerCase().indexOf(\'file:\') != 0) flagCapture = true;',
'      } else if(mode == \'file\') {',
'       if(_data != null && _data != \'\' && _data.toLowerCase().indexOf(\'file:\') == 0) flagCapture = true;',
'      }',
'      if(flagCapture) {',
'       arr.push({',
'        listFieldName: prop,',
'        filename: _data,',
'        listName: lName,',
'        route: JSON.stringify(objState),',
'        flagChildTable: flagChildTable,',
'        listRowData: data',
'        });',
'      }',
'     }',
'    } else {',
'     if(flagCheck) {',
'      fieldDirty = false;',
'      if( (typeof data._dirtyImages != \'undefined\') && (data._dirtyImages.constructor == Array) ) {',
'       objDirty = data._dirtyImages[prop];',
'       fieldDirty = false;',
'       if(typeof objDirty != \'undefined\') fieldDirty = objDirty;',
'      } else if(data._dirtyImages == false) {',
'       fieldDirty = false;',
'      } else {',
'       if(data._isNewRow) {',
'        fieldDirty = true;',
'       } else {',
'        if(typeof data._oldData != \'undefined\') {',
'         if(data[prop] != data._oldData[prop]) fieldDirty = true;',
'        }',
'       }',
'      }',
'      _mediaMap = lObj._mediaFields;',
'      if(_mediaMap.indexOf(prop) > -1) flagIsMediaField = true;',
'      if(flagIsMediaField) {',
'       var flagImageIsDirty = false;',
'       if(typeof data._dirtyImages != \'undefined\') {',
'        var _isDirtyMedia = data._dirtyImages[prop];',
'        if(_isDirtyMedia) flagImageIsDirty = true;',
'       } else {',
'       }',
'      }',
'      flagCapture2 = false;',
'      if(options.flagCleanOnly) {',
'       if(!fieldDirty) {',
'        if(flagIsMediaField) flagCapture2 = true;',
'       }',
'      } else {',
'       if(fieldDirty) {',
'        if(flagIsMediaField && flagImageIsDirty ) flagCapture2 = true;',
'       }',
'      }',
'      var flagDeleted = false;',
'      if(typeof data[\'_isDeleted\'] != \'undefined\') {',
'       if(data[\'_isDeleted\']) flagDeleted = true;',
'       flagCapture2 = false;',
'      }',
'      var _data = \'\';',
'      try{',
'       _data = data[prop];',
'       if(_data.toLowerCase().indexOf(\'alpha-local://jpg?url=\') == 0) {',
'        _data = _data.split(\'url=\')[1];',
'       }',
'      }catch(e) { }',
'      if( ( ( flagCapture2 ) && _data != null &&  _data.toLowerCase().indexOf(\'file:\') == 0 && _data.toLowerCase().indexOf(\'null_1x1.png\' ) == -1 )) {',
'       lName = objListName[objListName.length -1][\'table\'];',
'       if(lName == \'_top_\') {',
'        lName = lObj.listVariableName;',
'        flagChildTable = false;',
'       } else  {',
'        flagChildTable = true;',
'       }',
'       arr.push({',
'        listFieldName: prop,',
'        filename: _data,',
'        listName: lName,',
'        route: JSON.stringify(objState),',
'        flagChildTable: flagChildTable',
'        });',
'      }',
'     }',
'    }',
'   }',
'  }',
' }',
'}',
',',
' _harvestMediaFields: function(arg0,rows) {',
' var ops = arguments[0];',
' if(typeof ops == \'undefined\') ops = {};',
' if (typeof window[\'cordova\'] == \'undefined\' && typeof ops.indexDB == \'undefined\') return [];',
' if(typeof ops.dirtyOnly == \'undefined\') ops.dirtyOnly = true;',
' if(typeof ops.cleanOnly == \'undefined\') ops.cleanOnly = false;',
' if(typeof ops.mode == \'undefined\') ops.mode = \'\';',
' var _r = ops.row;',
' if(typeof _r == \'undefined\') _r = -1;',
' try{',
'  if (rows.toString().toLowerCase() == \'current\') {',
'   _r = this.selection[0];',
'   _r = this._dataMap[_r];',
'  }',
' }catch(e) {',
' }',
' var arr = [];',
' var objListName = [];',
' var objState = [];',
' var flagRowIsDirty = \'\';',
' var flagDirtyOnly = ops.dirtyOnly;',
' var options = {',
'  flagDirtyOnly: flagDirtyOnly,',
'  mode: ops.mode,',
'  flagCleanOnly: ops.cleanOnly',
' };',
' var flagSingleRow = false;',
' if(_r == -1) {',
'  var _d = this._data;',
' } else {',
'  var _d = [this._data[_r]];',
'  flagSingleRow = true;',
' }',
' var _row = \'\';',
' objListName.push({table: \'_top_\', nested: false});',
' for(var i = 0; i < _d.length; i++) {',
'  flagRowIsDirty = false;',
'  if(typeof _d[i]._isDirty != \'undefined\') flagRowIsDirty = _d[i]._isDirty;',
'  if(flagRowIsDirty || !flagDirtyOnly || ops.cleanOnly ) {',
'   _row = i;',
'   if(flagSingleRow) _row = _r;',
'   objState.push( {table: objListName[  objListName.length -1][\'table\'], row: _row})',
'   this._harvestMediaFields_low(arr,objListName,objState,_d[i],options);',
'   objState.pop();',
'  }',
' }',
' if (!ops.cleanOnly) {',
'   this._mediaFieldsArray = arr;',
' }',
' return arr;',
'}',
',',
' _pushMediaFieldArrayToList: function(arr) {',
' if (typeof window[\'cordova\'] == \'undefined\') return false;',
' var flagUnFix = false;',
' if(typeof arguments[1] != \'undefined\') flagUnFix = arguments[1];',
' var lObj = this;',
' var _data = lObj._data;',
' if(_data.length == 0) return false;',
' var _di = \'\';',
' var r = \'\';',
' var table = \'\';',
' for(var i = 0; i < arr.length; i++) {',
'  arr[i].routeObj = JSON.parse(arr[i].route);',
'  r = arr[i].routeObj[0].row;',
'  for(var j = 0; j < arr[i].routeObj.length; j ++) {',
'   table = arr[i].routeObj[j].table;',
'   r = arr[i].routeObj[j].row;',
'   if(table == \'_top_\') {',
'    _di = _data[r];',
'   } else {',
'    if(typeof _di[table] == \'undefined\') return false;',
'    _di = _di[table][r];',
'   }',
'  };',
'  if(typeof _di == \'undefined\') return false;',
'  _di._flagMediaFileUploadError = false;',
'  if(!flagUnFix) {',
'   if(typeof arr[i].modifiedValue != \'undefined\') {',
'    if(arr[i].succeeded || arr[i].success) {',
'     _di[arr[i].listFieldName] = arr[i].modifiedValue;',
'    } else {',
'    }',
'   } else {',
'    _di._flagMediaFileUploadError = true;',
'   }',
'  } else {',
'   _di[arr[i].listFieldName] = arr[i].filename;',
'  }',
' }',
' var _route = lObj._getRoute();',
' lObj.refresh();',
' this._setRoute(_route);',
' if(flagUnFix) {',
'  this.populateUXControls();',
' }',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' if(typeof lObj.__fetchMediaMode != \'undefined\') {',
'  _dlgObj._list_executeEvent(lObj.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: lObj.__fetchMediaMode });',
' }',
' lObj.__fetchMediaMode  = undefined;',
' if(this.__flagPersist) {',
'  if(this.persistToStorage) { this.persistToStorage({}); }',
' }',
'}',
',',
' _unFixMediaFields: function() {',
' if (typeof window[\'cordova\'] == \'undefined\') return false;',
' var arr = this._mediaFieldsArray;',
' if(typeof arr == \'undefined\') return false;',
' this._pushMediaFieldArrayToList(arr,true);',
' delete this._mediaFieldsArray;',
'}',
',',
' _syncMediaFiles: function(objS) {',
' if (typeof window[\'cordova\'] == \'undefined\') return false;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _list = this._mediaFiles;',
' var msg = JSON.stringify(_list,\'\',\'\\t\');',
' var _onProgressEvent = this._phoneGap.mediaFiles.onProgressEvent;',
' var listName = this.listVariableName;',
' var componentAlias = this._hostComponentId;',
' var target = this._phoneGap.mediaFiles.target.toLowerCase();',
' if(target == \'s3\') {',
'  var S3ConnectionString = this._phoneGap.mediaFiles.s3.connectionString;',
' } else {',
'  target = \'alphaanywhere\';',
' }',
' var targetFileNameFunction = this._phoneGap.mediaFiles.targetFilenameFunction;',
' var protectedRead = this._phoneGap.mediaFiles.protectedRead;',
' var fileNameTemplate = this._phoneGap.mediaFiles.template;',
' var instanceId = A5.ts();',
' if(typeof device != \'undefined\') {',
'  if(typeof device.uuid != \'undefined\') instanceId = device.uuid;',
' }',
' targetFileNameFunction = targetFileNameFunction.replace(\'<DeviceId>\',instanceId);',
' var showProgress = this._phoneGap.mediaFiles.showProgress;',
' var onErrorFunction = this._phoneGap.mediaFiles.onErrorFunction;',
' var pColor = \'\';',
' var pElement = \'\';',
' var pWidth = \'\';',
' if(showProgress) {',
'  pColor = this._phoneGap.mediaFiles.progress.color;',
'  pElement = this._phoneGap.mediaFiles.progress.element;',
'  pWidth = this._phoneGap.mediaFiles.progress.width;',
' }',
' var arr = _list;',
' var s3Obj = {};',
' var aaObj = {}',
' if(target == \'s3\') {',
'  s3Obj.connectionString = S3ConnectionString;',
'  s3Obj.protectedRead = protectedRead;',
' } else {',
' }',
' var that = this;',
' var options = {',
'  specialMode: \'detailViewMediaUpload\',',
'  target: target,',
'  listName: listName,',
'  componentAlias: componentAlias,',
'  AAServerOptions: aaObj,',
'  s3: s3Obj,',
'  showProgress: showProgress,',
'  onComputeS3Filename: Function(\'e\',targetFileNameFunction),',
'  fileNameTemplate: fileNameTemplate,',
'  onProgressEvent: _onProgressEvent,',
'  onComplete: function(array) {',
'   if(target == \'alphaanywhere\') {',
'   } else {',
'    var fileNameTemplate = this.fileNameTemplate;',
'    var _dlgObj = window[that._hostComponentId + \'_DlgObj\'];',
'    if(typeof _dlgObj._pgS3.urlTemplate != \'undefined\') fileNameTemplate = _dlgObj._pgS3.urlTemplate;',
'    var mVal = \'\';',
'    for(var i = 0; i < array.length; i++) {',
'     mVal = fileNameTemplate.replace(\'__name__\',array[i].targetName);',
'     array[i].modifiedValue = mVal;',
'    }',
'   }',
'   var _dlgObj = window[this.componentAlias + \'_DlgObj\'];',
'   var lObj = _dlgObj.getControl(listName);',
'   var _dlgObj = window[options.componentAlias + \'_DlgObj\'];',
'   _dlgObj._list_executeEvent(listName,\'detailView.afterMediaFilesUploaded\',{array:array});',
'   for(var i = 0; i < array.length; i++) {',
'    array[i].routeObj = JSON.parse(array[i].route);',
'   }',
'   var rowsWithMediaUploadErrors = [];',
'   var _rn;',
'   for(var i = 0; i < array.length; i++) {',
'    if(!array[i].succeeded) {',
'     _rn = array[i].routeObj[0].row;',
'     if(rowsWithMediaUploadErrors.indexOf(_rn) == -1) {',
'      rowsWithMediaUploadErrors.push(array[i].routeObj[0].row)',
'     }',
'    }',
'   }',
'   var topParentRow;',
'   for(var i = 0; i < array.length; i++) {',
'    topParentRow = array[i].routeObj[0].row;',
'    if( rowsWithMediaUploadErrors.indexOf(topParentRow) > -1) {',
'     array[i].succeeded = false;',
'    }',
'   }',
'   lObj._pushMediaFieldArrayToList(array);',
'   var countSucceeded = 0;',
'   for(var i = 0; i < array.length; i++) {',
'    if(array[i].succeeded) countSucceeded = countSucceeded + 1;',
'   }',
'   var errorCount = 0;',
'   if(countSucceeded < array.length) {',
'    errorCount = array.length - countSucceeded;',
'    if(typeof errorCount != \'undefined\') {',
'     _dlgObj._list_executeEvent(listName,\'detailView.onMediaFilesUploadErrors\',{array:array, errorCount: errorCount, rowsWithMediFileUploadErrors: rowsWithMediaUploadErrors});',
'    }',
'     return;',
'   }',
'   if(typeof objS.other.chunked == \'object\') flagChunked = objS.other.chunked.allow',
'   else if(typeof flagChunked == \'undefined\') flagChunked = false;',
'   var _rows = \'allRows\';',
'   if(typeof objS.rows != \'undefined\') _rows = objS.rows',
'   _dlgObj.saveListEdits(options.listName,',
'   {',
'    rows: _rows,',
'    chunked: {allow: flagChunked},',
'    checkForMediaFiles: false,',
'    fixMediaFileReferences: true,',
'    resetMediaFileUploadErrors: false,',
'    rowsWithMediaUploadErrors: rowsWithMediaUploadErrors,',
'    ajax: objS.ajax',
'   });',
'  },',
'  progress: {',
'   color: pColor,',
'   width: pWidth,',
'   individualProgress: false,',
'   showTotalProgress: true,',
'   allowCancel: false,',
'   progressElement: pElement',
'  },',
'  onError : onErrorFunction',
' }',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var result = _dlgObj._list_executeEvent(listName,\'detailView.beforeMediaFilesUploaded\',{array:arr});',
' if(!result) return false;',
' _dlgObj.phoneGapFileUpload(arr,options);',
'}',
',',
' _fetchMediaFiles1: function() { this._fetchMediaFiles() },',
' _fetchMediaFiles: function() {',
' if(typeof cordova == \'undefined\') {',
'  if(typeof this._afterSynchronizeData != \'undefined\') {',
'   var _obj = this._afterSynchronizeData;',
'   var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'   _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterSynchronizeListCompleted\',_obj);',
'   delete this._afterSynchronizeData;',
'  }',
'  return false;',
' }',
' var _arg0 = arguments[0];',
' var _arg1 = arguments[1];',
' var that = this;',
' var flagFetchMediaFiles = false;',
' if(typeof this._phoneGap != \'undefined\') {',
'  if(typeof this._phoneGap.mediaFiles != \'undefined\') {',
'   if(typeof this._phoneGap.mediaFiles.download != \'undefined\') {',
'    if(typeof this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch != \'undefined\') {',
'     flagFetchMediaFiles = this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch;',
'    }',
'   }',
'  }',
' }',
' if(!flagFetchMediaFiles) return false;',
' flagIgnoreMediaFieldsInWWW = false;',
' if(typeof this._ignoreMediaFieldsInWWWSubFolder != \'undefined\') flagIgnoreMediaFieldsInWWW = this._ignoreMediaFieldsInWWWSubFolder;',
' if(flagIgnoreMediaFieldsInWWW && typeof this._mediaFilesInWWW == \'undefined\' ) {',
'  var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
'  var _onCompletion = function(filelist) {',
'   that._mediaFilesInWWW = filelist;',
'   that._fetchMediaFiles_low(_arg0,_arg1);',
'  };',
'  var _error = function(e) { that._fetchMediaFiles_low(_arg0,_arg1); };',
'  var _baseURI = cordova.file.applicationDirectory;',
'  var _dirName = \'www/\' + this._mediaFieldFolderInWWW',
'  var _matchRegex = \'\';',
'  var _dirPath = _baseURI + _dirName;',
'  _dlgObj.phoneGapListFilesURL(_dirPath,_matchRegex, _onCompletion, _error);',
' } else {',
' ;',
'  this._fetchMediaFiles_low(_arg0,_arg1);',
' }',
'}',
',',
' _fetchMediaFiles_low: function() {',
' if(A5.log) A5.log(\'About to fetch media files\');',
' var __persistWhere = this.__persistWhere;',
' if(typeof __persistWhere == \'undefined\') __persistWhere = \'\';',
' if (typeof window[\'cordova\'] == \'undefined\') return false;',
' if (typeof this._mediaFields == \'undefined\') return false;',
' var _route = arguments[1];',
' if(typeof _route == \'undefined\') _route = false;',
' var _r = arguments[0];',
' if(typeof  _r == \'undefined\') _r = -1;',
' var flagFetchMediaFiles = false;',
' if(typeof this._phoneGap != \'undefined\') {',
'  if(typeof this._phoneGap.mediaFiles != \'undefined\') {',
'   if(typeof this._phoneGap.mediaFiles.download != \'undefined\') {',
'    if(typeof this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch != \'undefined\') {',
'     flagFetchMediaFiles = this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch;',
'    }',
'   }',
'  }',
' }',
' if(!flagFetchMediaFiles) return false;',
' var folder = this._phoneGap.mediaFiles.download.targetFolder;',
' if(folder == \'\') {',
'  alert(\'You have not specified the file download settings in the List builder. Edit the settings for List \'+this.listVariableName+\' and go to \\\'Detail View\\\' pane, \\\'PhoneGap Properties\\\'.\');',
'  return false;',
' }',
' if(typeof folder == \'function\') {',
'   folder = folder.call();',
' }',
' this._flagFetchMediaHasRun = true;',
' folder = folder + \'/\' + this.listVariableName;',
' var listName = this.listVariableName;',
' var showProgress = this._phoneGap.mediaFiles.download.showProgress;',
' var fileSystemPart = \'persistent\';',
' if(typeof this._phoneGap.mediaFiles.download.targetFileSystem != \'undefined\') {',
'  fileSystemPart = this._phoneGap.mediaFiles.download.targetFileSystem;',
'  if(typeof fileSystemPart == \'function\') {',
'   fileSystemPart = fileSystemPart.call();',
'  }',
' }',
' var pColor = \'\';',
' var pElement = \'\';',
' var pWidth = \'\';',
' if(showProgress) {',
'  pColor = this._phoneGap.mediaFiles.download.progress.color;',
'  pElement = this._phoneGap.mediaFiles.download.progress.element;',
'  pWidth = this._phoneGap.mediaFiles.download.progress.width;',
' }',
' var flagDeleteOrphans = false;',
' if(typeof this._phoneGap.mediaFiles.download.deleteOrphansAfterSync != \'undefined\') flagDeleteOrphans =this._phoneGap.mediaFiles.download.deleteOrphansAfterSync;',
' var arr = this._harvestMediaFields({dirtyOnly: false, row: _r});',
' if(flagDeleteOrphans) {',
'  this.__harvestedMediaFields = arr;',
' }',
' if(A5.log) A5.log(\'Harvest media files has run.\');',
' if(A5.log) A5.log(\'Harvested media files (that must be downloaded): \' + JSON.stringify(arr,\'\',\'\\t\'));',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' if(A5.log) A5.log(\'Fire beforeMediaFilesDownload event\');',
' if(arr.length == 0) {',
'  _dlgObj._list_executeEvent(listName,\'detailView.onNoMediaFilesToFetch\',{});',
'  var that = this;',
'  setTimeout(function() {',
'  },0)',
'  if(typeof this._afterSynchronizeData != \'undefined\') {',
'   var _obj = this._afterSynchronizeData;',
'    _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterSynchronizeListCompleted\',_obj);',
'   delete this._afterSynchronizeData;',
'  }',
'  if(typeof this.__fetchMediaMode != \'undefined\') {',
'   _dlgObj._list_executeEvent(this.listVariableName,\'detailView.listReadyToPersist\',{listSyncMode: this.__fetchMediaMode });',
'  }',
'  this.__fetchMediaMode  = undefined;',
'  return true;',
' }',
' flagIgnoreMediaFieldsInWWW = false;',
' if(typeof this._ignoreMediaFieldsInWWWSubFolder != \'undefined\') flagIgnoreMediaFieldsInWWW = this._ignoreMediaFieldsInWWWSubFolder;',
' if(flagIgnoreMediaFieldsInWWW) {',
'  var _skip = this._mediaFilesInWWW;',
'  var _folder = this._mediaFieldFolderInWWW;',
'  _folder = $u.s.rTrim(_folder,\'/\');',
'  for(var i9 = 0; i9 < _skip.length; i9++) {',
'   if(_skip[i9].indexOf(_folder) == -1) _skip[i9] = _folder + \'/\' +  _skip[i9]',
'  }',
'  var skipCount = 0;',
'  for(var i = 0; i < arr.length; i++) {',
'   arr[i].skip = false;',
'   if(_skip.indexOf(arr[i].filename) > -1) {',
'    skipCount++',
'    arr[i].skip = true;',
'   }',
'  }',
'  for(var i = arr.length-1; i >= 0; i--) {',
'   if(arr[i].skip) arr.splice(i,1);',
'  }',
' }',
' var _onSuccess = function(arr2, obj, arrfound) {',
'  var result = _dlgObj._list_executeEvent(listName,\'detailView.beforeMediaFilesDownloaded\',{array:arr2, originalArray:arr});',
'  if(!result) {',
'   _dlgObj._list_executeEvent(listName,\'detailView.afterMediaFilesDownloaded\',{array:arr2, aborted: true, originalArray: arr});',
'   return false;',
'  }',
'  obj._fetchMediaFiles_lowWork(arr2,_route,folder, arrfound);',
' };',
' this._getPreviouslyDownloadedFiles(fileSystemPart,folder,arr,_onSuccess);',
'}',
',',
' _getPreviouslyDownloadedFiles: function(fileSystemPart,folder,arr,_onSuccess) {',
' var obj = this;',
' var _onSuccess2 = function(filelist) {',
'  var fnshort;',
'  var ix;',
'  var arr2 = [];',
'  var arrfound = [];',
'  for(var i = 0; i < arr.length; i++) {',
'   fnshort = A5.parseFilename(arr[i].filename).name',
'   fnshort = decodeURIComponent(fnshort)',
'   ix = filelist.indexOf(fnshort);',
'   if(ix == -1) {',
'    arr2.push(arr[i]);',
'   } else {',
'    arr[i].modifiedValue = _dirPath + \'/\' + fnshort;',
'    arr[i].success = true;',
'    arrfound.push(arr[i]);',
'   }',
'  }',
'  _onSuccess.call(obj,arr2, obj,arrfound);',
' };',
' var _error2 = function(e) {',
'  _onSuccess.call(obj,arr,obj)',
'  };',
' var _baseURI = {UXPRERENDEREDALIAS}_DlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
' var _dirName = folder + \'/\';;',
' var _dirPath = _baseURI + _dirName;',
' {UXPRERENDEREDALIAS}_DlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccess2, _error2);',
'}',
',',
' _fetchMediaFiles_lowWork: function(arr,_route,folder, arrfound) {',
' if(typeof arrfound != \'undefined\' && arrfound.length > 0) {',
'  var lObj = this;',
'  lObj._pushMediaFieldArrayToList(arrfound);',
' } else {',
' }',
' var showProgress = this._phoneGap.mediaFiles.download.showProgress;',
' var fileSystemPart = \'persistent\';',
' if(typeof this._phoneGap.mediaFiles.download.targetFileSystem != \'undefined\') {',
'  fileSystemPart = this._phoneGap.mediaFiles.download.targetFileSystem;',
'  if(typeof fileSystemPart == \'function\') {',
'   fileSystemPart = fileSystemPart.call();',
'  }',
' }',
' var pColor = \'\';',
' var pElement = \'\';',
' var pWidth = \'\';',
' if(showProgress) {',
'  pColor = this._phoneGap.mediaFiles.download.progress.color;',
'  pElement = this._phoneGap.mediaFiles.download.progress.element;',
'  pWidth = this._phoneGap.mediaFiles.download.progress.width;',
' }',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var listName = this.listVariableName;',
' var flagDeleteOrphans = false;',
' if(typeof this._phoneGap.mediaFiles.download.deleteOrphansAfterSync != \'undefined\') flagDeleteOrphans =this._phoneGap.mediaFiles.download.deleteOrphansAfterSync;',
' if(arr.length > 0 ) {',
'  var lObj = this;',
'  var _dlgObj = _dlgObj;',
'  var that = this;',
'  var options = {',
'   showProgress: showProgress,',
'   directory: folder,',
'   strip: true,',
'   filesystem: fileSystemPart,',
'   onComplete: function(array) {',
'    var arr = [];',
'    var _d = lObj._data;',
'    for(var i = 0; i < array.length; i++) {',
'     if(array[i].success) {',
'      array[i].modifiedValue = array[i].localFilename;',
'     } else {',
'      array[i].modifiedValue = array[i].filename;',
'     }',
'    }',
'    if(A5.log) A5.log(\'File download complete.\');',
'    if(A5.log) A5.log(\'Downloaded files: \' + JSON.stringify(array,\'\',\'\\t\'));',
'    if(A5.log) A5.log(\'Fire afterMediaFilesDownloaded event.\');',
'    var result = _dlgObj._list_executeEvent(listName,\'detailView.afterMediaFilesDownloaded\',{array:array, aborted: false});',
'    if(typeof that._afterSynchronizeData != \'undefined\') {',
'     var _obj = that._afterSynchronizeData;',
'      _dlgObj._list_executeEvent(that.listVariableName,\'detailView.afterSynchronizeListCompleted\',_obj);',
'     delete that._afterSynchronizeData;',
'    }',
'    if(!result) return false;',
'    if(A5.log) A5.log(\'Push translated media filenames to array.\');',
'    lObj._pushMediaFieldArrayToList(array);',
'    if(flagDeleteOrphans) {',
'     if(A5.log) A5.log(\'Delete orphan media files.\');',
'     that._deleteOrphanMediaFiles()',
'    }',
'    if(A5.log) A5.log(\'Populate DetailView Controls.\');',
'    that.populateUXControls();',
'    var r = that._getRoute()',
'    that._populateAllChildLists();',
'    that._setRoute(r);',
'    if(_route) {',
'     that._setRoute(_route);',
'     that.populateUXControls();',
'     that._setRoute(_route);',
'     that._populateAllChildLists();',
'     that._setRoute(_route);',
'    }',
'   },',
'   onProgressEvent: this._phoneGap.mediaFiles.download.onProgressEvent,',
'   progress: {',
'    color: pColor,',
'    width: pWidth,',
'    allowCancel: false,',
'    progressElement: pElement',
'   }',
'  }',
'  _dlgObj.phoneGapFileDownload(arr,options);',
' } else {',
'  if(A5.log) A5.log(\'No media files to download - execute afterMediaFilesDownloaded.\');',
'   _dlgObj._list_executeEvent(listName,\'detailView.onNoMediaFilesToFetch\',{});',
'  if(typeof this._afterSynchronizeData != \'undefined\') {',
'   var _obj = this._afterSynchronizeData;',
'    _dlgObj._list_executeEvent(this.listVariableName,\'detailView.afterSynchronizeListCompleted\',_obj);',
'   delete this._afterSynchronizeData;',
'  }',
' }',
'}',
',',
' resolveFieldConflict: function(route,fieldName,oldValueCurrent,newValueMine) {',
' var _d = this._getDataFromRoute(route);',
' var _routeCapture = this._getRoute();',
' if(!_d) return false;',
' if(typeof _d[fieldName] == \'undefined\') return false;',
' if(typeof _d[\'_oldData\'] == \'undefined\') return false;',
' _d[\'_oldData\'][fieldName] = oldValueCurrent;',
' if(typeof newValueMine != \'undefined\') {',
'  _d[fieldName] = newValueMine;',
' } else {',
'  _d[fieldName] = oldValueCurrent;',
' }',
' if(typeof _d[\'_writeConflictErrors\'] != \'undefined\') {',
'  var _wce = _d[\'_writeConflictErrors\'];',
'  for(var i = 0; i < _wce.length; i++)  {',
'   if(_wce[i].fieldName == fieldName) {',
'    _wce.splice(i,1);',
'   }',
'  }',
'  if(_wce.length == 0) {',
'   _d[\'_hasWriteConflictErrors\'] = false;',
'   _d[\'_writeConflictErrors\'] = false;',
'  }',
' }',
' var flagClean = true;',
' for(var n in _d[\'_oldData\']) {',
'  if(_d[\'_oldData\'][n] != _d[n]) {',
'   flagClean = false;',
'   break;',
'  }',
' }',
' if(flagClean) {',
'  delete _d[\'_oldData\'];',
'  delete _d.__displayStyle;',
'  _d._isDirty = false;',
'  var flagLoop = true;',
'  while(flagLoop) {',
'   route.pop();',
'   route.pop();',
'   if(route.length == 0) {',
'    break;',
'   };',
'   var _dp = this._getDataFromRoute(route);',
'   if(typeof _dp[\'_oldData\'] == \'undefined\') {',
'    _dp._isDirty = false;',
'    delete _dp.__displayStyle;',
'   }',
'  }',
'  this._refreshListRecursive();',
' }',
'}',
',',
' _refreshListRecursive: function() {',
' this.refresh();',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var lObj = \'\';',
' for(var i = 0; i < this.childLists.length; i++) {',
'  lObj = _dlgObj.getControl(this.childLists[i]);',
'  if(lObj) lObj._refreshListRecursive();',
' }',
'}',
',',
' _getOrphanFiles: function(cb) {',
' var obj = this;',
' var rows = \'all\';',
' var arr = obj._harvestMediaFields({cleanOnly: true},rows);',
' var referencedCleanMediaFiles = [];',
' for(var i = 0; i < arr.length; i++) {',
'  var fi = arr[i].filename',
'  fi = fi.split(\'//\');',
'  fi = fi.join(\'/\');',
'  referencedCleanMediaFiles.push(fi)',
' }',
' alert(\'outside the cb. referencedCleanMediaFiles.length: \' + referencedCleanMediaFiles.length)',
' var cb = function() {',
'  alert(\'files in download folder: \' + arr.length);',
'  var rows = \'all\';',
'  alert(\'obj: \' + obj);',
'  var arrX = obj._harvestMediaFields({cleanOnly: true},rows);',
'  alert(\'arrx\' + arrX.length);',
'  var referencedCleanMediaFiles = [];',
'  for(var i = 0; i < arrX.length; i++) {',
'   var fi = arrX[i].filename',
'   fi = fi.split(\'//\');',
'   fi = fi.join(\'/\');',
'   referencedCleanMediaFiles.push(fi)',
'  }',
'  alert(\'referenced files length: \' + referencedCleanMediaFiles.length)',
' }',
' this._getMediaFilesInDownloadFolder(cb);',
'}',
',',
' _getMediaFilesInDownloadFolder: function(cb) {',
' var obj = this;',
' var listName = obj.listVariableName;',
' var flag = obj._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch',
' var fs = obj._phoneGap.mediaFiles.download.targetFileSystem',
' var folder = obj._phoneGap.mediaFiles.download.targetFolder',
' var _onCompletion = function(filelist) {',
'  var f2 = [];',
'  for(var i = 0; i < filelist.length; i++) {',
'   var fi = filelist[i];',
'   if(fi[fi.length-1] != \'/\') f2.push(fi)',
'  }',
'  filelist = f2;',
'  for(var i = 0; i <filelist.length; i++) {',
'   filelist[i] = _dirPath + filelist[i];',
'  }',
'  if(typeof cb == \'function\') cb.call(this,filelist);',
' };',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var _error = function(e) { alert(\'error\');};',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(fs);;',
' var _dirName = folder +\'/\' + listName + \'/\';;',
' var _dirPath = _baseURI + _dirName;',
' _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onCompletion, _error);',
'}',
',',
' _deleteOrphanMediaFiles: function() {',
' obj = this;',
' try{',
'  flagDeleteOrphans = obj._phoneGap.mediaFiles.download.deleteOrphansAfterSync;',
' }catch(e) {',
'  var flagDeleteOrphans = false;',
' }',
' if(flagDeleteOrphans == false) return;',
' this._deleteOrphanMediaFiles_low()',
'}',
',',
' _deleteOrphanMediaFilesOLD: function() {',
' var lTemp = this._getTopParentListObject();',
' var persistLocation = \'\';',
' if(lTemp.__flagPersist) {',
'  persistLocation = lTemp.__persistWhere;',
' };',
' if(persistLocation.toLowerCase() == \'indexdb\') {',
'  this._deleteOrphanIndexDBImages(true);',
'  return;',
' }',
' var flagDownloadMediaFiles = false;',
' if(typeof this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch != \'undefined\') flagDownloadMediaFiles =this._phoneGap.mediaFiles.download.autodownloadFilesOnPullSynch;',
' if(flagDownloadMediaFiles == false) return false;',
' var flagDeleteOrphans = false;',
' if(typeof this._phoneGap.mediaFiles.download.deleteOrphansAfterSync != \'undefined\') flagDeleteOrphans =this._phoneGap.mediaFiles.download.deleteOrphansAfterSync;',
' if(flagDeleteOrphans == false) return false;',
' if (typeof window[\'cordova\'] == \'undefined\') return false;',
' var folder = this._phoneGap.mediaFiles.download.targetFolder;',
' if(folder == \'\') {',
'  alert(\'You have not specified the file download settings in the List builder. Edit the settings for List \'+this.listVariableName+\' and go to \\\'Detail View\\\' pane, \\\'PhoneGap Properties\\\'.\');',
'  return false;',
' }',
' if(typeof folder == \'function\') {',
'   folder = folder.call();',
' }',
' if(typeof this._flagFetchMediaHasRun == \'undefined\' || this._flagFetchMediaHasRun == false ) {',
'  alert(\'Sync media files method has not yet been run\');',
'  return false;',
' }',
' if(folder.substring(0,1) == \'/\') folder = folder.substring(1);',
' if(folder.substr( folder.length -1,1) == \'/\') {',
'  folder = folder.substring(0,folder.length -1);',
' }',
' folder = folder + \'/\' + this.listVariableName;',
' var that = this;',
' var listName = this.listVariableName;',
' var _dlgObj = window[this._hostComponentId + \'_DlgObj\'];',
' var fileSystemPart = \'persistent\';',
' var folder = this._phoneGap.mediaFiles.download.targetFolder;',
' if(typeof folder == \'function\') {',
'  folder = folder.call();',
' }',
' folder = folder + \'/\' + this.listVariableName.toUpperCase();',
' if(typeof this._phoneGap.mediaFiles.download.targetFileSystem != \'undefined\') {',
'  fileSystemPart = this._phoneGap.mediaFiles.download.targetFileSystem;',
' }',
' if(typeof this._phoneGap.mediaFiles.download.targetFileSystem != \'undefined\') {',
'  fileSystemPart = this._phoneGap.mediaFiles.download.targetFileSystem;',
'  if(typeof fileSystemPart == \'function\') {',
'   fileSystemPart = fileSystemPart.call();',
'  }',
' }',
' var that = this;',
' _onSuccessGotFiles = function(fileList) {',
'  alert(\'_onsuccessgotfiles inside delete orphans: \' + fileList.length + \' harvestMediaFields: \' + arr.length);',
'  alert(lObj)',
'  debugger;',
'  var arr = lObj._harvestMediaFields({},\'all\');',
'  alert(arr.length);',
'  var arr2 = that.__harvestedMediaFields;',
'  that.__harvestedMediaFields = false;',
'  arr = arr2',
'  var fnshort;',
'  var fd = [];',
'  for(var i = 0; i < arr.length; i++) {',
'   fnshort = A5.parseFilename(arr[i].filename).name',
'   fnshort = decodeURIComponent(fnshort)',
'   if (fileList.indexOf(fnshort) == -1 ) {',
'    fd.push(arr[i].localFilename);',
'   }',
'  }',
'  if(fd.length == 0) {',
'   _dlgObj._list_executeEvent(listName,\'detailView.afterDeleteOrphanMediaFiles\',{array:fd});',
'   return false;',
'  }',
'  alert(\'orphans to delete: \' + fd.length);',
'  var result = _dlgObj._list_executeEvent(listName,\'detailView.beforeDeleteOrphanMediaFiles\',{array:fd});',
'  if(!result) return false;',
'  var countDeleted = 0;',
'  var _onDeleteSuccess = function() {',
'   countDeleted++',
'   if(countDeleted == fd.length) {',
'    _dlgObj._list_executeEvent(listName,\'detailView.afterDeleteOrphanMediaFiles\',{array:fd});',
'   }',
'  }',
'  var _error = function(e) {',
'   countDeleted++',
'  }',
'  alert(\'count files to delete: \' + fd.length);',
'  if(fd.length == 0) {',
'   _dlgObj._list_executeEvent(listName,\'detailView.afterDeleteOrphanMediaFiles\',{array:fd});',
'  } else {',
'   for(var i = 0; i < fd.length; i++) {',
'    _dlgObj.phoneGapDeleteFileURL(fd[i], _onDeleteSuccess,_error);',
'   }',
'  }',
'  return false;',
' }',
' _onErrorCouldNotGetFiles = function(e) {',
'  alert(\'error::::: could not get files\') ;',
'  return true;',
' };',
' var _baseURI = _dlgObj.phoneGapGetLocalDirURL(fileSystemPart);;',
' var _dirName = folder + \'/\';',
' var _dirPath = _baseURI + _dirName;',
' _dlgObj.phoneGapListFilesRecurseURL(_dirPath, _onSuccessGotFiles, _onErrorCouldNotGetFiles);',
'}',
'}',
')',
'//End section - Add methods to List prototype',
'{UXPRERENDEREDALIAS}_DlgObj._listControls = [\'LSTMESSAGE\',\'LIST1\']',
'{UXPRERENDEREDALIAS}_DlgObj._formBoxControls = [];',
'{UXPRERENDEREDALIAS}_DlgObj._localStorageSettings = {namespace: \'ALPHA_f062a9cd9bcd433fa51d57f378a7cc82\',friendlyName: \'\',description: \'\',persistVariableValues: false,__version: 1,persistComponentState: false,workingPreviewTestingFolder: \'\',restore: {variables: false,data: false,state: false},compressData: false,minify: false,variablesToNotPersist: \'\',workingPreviewTestingMode: \'Browser\',compressListData: false}',
';',
'{UXPRERENDEREDALIAS}_DlgObj.__r = [];',
'{UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML = false;',
'{UXPRERENDEREDALIAS}_DlgObj._EDITOR_EDITORSET = {};',
'{UXPRERENDEREDALIAS}_DlgObj.styleName = \'Alpha-Magenta\';',
'{UXPRERENDEREDALIAS}_DlgObj.styleVersion = 4',
'{UXPRERENDEREDALIAS}_DlgObj.framesInfo = {',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._beforePrepare = function(e) { ;if({UXPRERENDEREDALIAS}_DlgObj.styleVersion < 3) {',
'\tA5.themes.add(\'Alpha-Magenta\', {edit: {base: { className: \'Alpha-MagentaEdit\', errorClassName: \'Alpha-MagentaEditError\', watermark: {className: \'Alpha-MagentaEditWatermark\'}}}});',
'}',
'};',
'{UXPRERENDEREDALIAS}_DlgObj._noPersist = []',
'{UXPRERENDEREDALIAS}_DlgObj._ssdecimal = \'.\';',
'{UXPRERENDEREDALIAS}_DlgObj._modernFrames = {};',
'{UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls = {UXPRERENDEREDALIAS}_DlgObj._listsWithDependentTFControls = {}',
'{UXPRERENDEREDALIAS}_DlgObj.__r = [];',
'var obj = $(\'{UXPRERENDEREDALIAS}.R1\'); if(obj) $acn(obj,\'compact\');',
'window.__preventDefault = function(event) { event.preventDefault()};',
'setTimeout(function() {; },100);',
'{UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML = false;',
'{UXPRERENDEREDALIAS}_DlgObj._listInsideCards = {',
'}',
';{UXPRERENDEREDALIAS}_DlgObj.__workingPreviewProject = \'C:/amigacloud/AMIGACLOUD/AMIGACLOUD.WebProjects/Default.WebProject\';',
'var arr = {UXPRERENDEREDALIAS}_DlgObj._listControls;',
'if(arr) {',
' var obj;',
' for(var i = 0; i < arr.length; i++) {',
'  obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(arr[i]);',
'  if(obj) {',
'    obj.resize = function() {',
'        if(this.fireResize) this._resize(\'resize\'); //._resize() is a private internal method',
'    }',
'  }',
' }',
'}',
'var ele = {UXPRERENDEREDALIAS}_DlgObj.getPointer(\'CONTAINER_FORGOTPASSWORDLINK\'); if(ele) ele.style.display = \'none\';{UXPRERENDEREDALIAS}_DlgObj.____passwordReset = false;{UXPRERENDEREDALIAS}_DlgObj.____createAccount = false;;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHGOOGLE\',false);;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHCOGNITO\',false);;{UXPRERENDEREDALIAS}_DlgObj.setControlDisplay(\'LOGINWITHFIREBASE\',false);',
'{UXPRERENDEREDALIAS}_DlgObj.__serverVersion = \'9305-5711\';',
'{UXPRERENDEREDALIAS}_DlgObj.__guid = \'f062a9cd-9bcd-433f-a51d-57f378a7cc82\';',
'{UXPRERENDEREDALIAS}_DlgObj._watchEvents = []',
'{UXPRERENDEREDALIAS}_DlgObj._csDateFormats = {',
'\t\'DUEDATE\' : {dateformat: \'<DefaultDateOnlyFormat>\'}',
'}',
'{UXPRERENDEREDALIAS}_DlgObj._dataBindingJSONForm = \'\';',
'var href = window.location.href;',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \'locationHref\' : href}); ',
'{UXPRERENDEREDALIAS}_DlgObj.__panelLayouts = []',
';{UXPRERENDEREDALIAS}_DlgObj.__parentAlias = \'__parentAliasNotDefined\'; ',
'{UXPRERENDEREDALIAS}_DlgObj.__info = {',
'\t"description": "",',
'\t"createdBy": "paul",',
'\t"lastUpdatedBy": "",',
'\t"dateCreated": "2020-3-23",',
'\t"dateLastEdited": "2024-9-3",',
'\t"comments": "",',
'\t"revisionnumber": 53',
'}',
'A5.__csdfmt = (obj) =>{ if(obj) return obj.stateInfo.__dtfmt};{UXPRERENDEREDALIAS}_DlgObj._workingPreview = false;',
'$u.decimal = \'.\';',
'$u.comma = \',\';',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCH_LSTMESSAGE\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {{UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\').searchList({searchMode : \'auto\'});',
'',
' } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCH_LSTMESSAGE\');',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {{UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\').clearSearchList({searchMode : \'auto\'});',
'',
' } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_LISTSEARCHCLEAR_LSTMESSAGE\');',
'',
'',
'',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVNEWRECORD_LSTMESSAGE\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_2\');',
'var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'lObj.newDetailViewRecord(); } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVNEWRECORD_LSTMESSAGE\');',
'',
'',
'',
'',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVRESET_LSTMESSAGE\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'lObj.resetForm({prompt: false});',
'{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_1\'); } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVRESET_LSTMESSAGE\');',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.POIID.CUSTOMBUTTON.0\',A5.d.evnts.click,function(e) { {UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_3\');});',
'',
'',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVSAVE_LSTMESSAGE\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'',
'',
'if(lObj.selection[0] != \'undefined\') { ',
'\tlObj._selectedRow = lObj.selection[0];',
'}',
'',
'lObj.updateListFromUXControls();',
'{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_1\'); } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_DVSAVE_LSTMESSAGE\');',
'',
'',
'',
'',
'',
'$e.add(\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_6\',A5.d.evnts.click,function(e) {',
'var _disabled = this.disabled; if(typeof _disabled == \'undefined\') _disabled = false; if(!_disabled) {;var flagLocked = false; if (typeof this._locked != \'undefined\') flagLocked = this._locked;  if(!flagLocked) {{UXPRERENDEREDALIAS}_DlgObj.panelSetActive(\'PANELCARD_2\'); } ; this._locked = true; flagLocked = true; var that = this; setTimeout(function() { that._locked = false; },300);}',
'},this,false,\'{UXPRERENDEREDALIAS}.V.R1.BUTTON_6\');',
'',
'{UXPRERENDEREDALIAS}_DlgObj.prepare();',
'{UXPRERENDEREDALIAS}_DlgObj._fireWatches(1);',
'',
'',
'if(!A5.flags.isMobile) $e.add(window,\'resize\',{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation,null,false,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'else $e.add(window,\'orientationchange\',{UXPRERENDEREDALIAS}_DlgObj._orientationChangeHandler,{UXPRERENDEREDALIAS}_DlgObj,true,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'{UXPRERENDEREDALIAS}_DlgObj._functions.calcOrientation();',
'',
'{UXPRERENDEREDALIAS}_DlgObj._functions._windowResize = function() {',
'\tvar _d = 50;',
'',
'',
'\tif(typeof {UXPRERENDEREDALIAS}_DlgObj._windowResizeDelay != \'undefined\') _d = {UXPRERENDEREDALIAS}_DlgObj._windowResizeDelay;',
'\tclearTimeout({UXPRERENDEREDALIAS}_DlgObj._wrTO);',
'\t{UXPRERENDEREDALIAS}_DlgObj._wrTo = setTimeout(function() {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onWindowResize\',{});',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule) {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule() ',
'\t\tif({UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes) { {UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes(); }',
'\t},_d);',
'}',
'$e.add(window,\'resize\',{UXPRERENDEREDALIAS}_DlgObj._functions._windowResize,null,false,\'{UXPRERENDEREDALIAS}.DIALOG\');',
'setTimeout(function() {',
'\tif({UXPRERENDEREDALIAS}_DlgObj.resizeLists) { {UXPRERENDEREDALIAS}_DlgObj.resizeLists(); }  ;',
'\t//do initial formbox resize',
'\tif({UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes) { {UXPRERENDEREDALIAS}_DlgObj.resizeFormBoxes(); }',
'\t',
'\t',
'},0);',
'',
';',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'var listObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'if(listObj) listObj._state.recordCount = 0;',
'if(listObj) listObj._state.recordCountFormatted = \'0\';',
'if(listObj) listObj._state.lastBreakValue = \'<None>\';',
'if(listObj) listObj._state.pageCount = 0;',
'if(listObj) listObj._state.pageSize = 20;',
'if(listObj) {var ele = $(\'{UXPRERENDEREDALIAS}.LSTMESSAGE.RECORDCOUNT\'); if(ele) ele.innerHTML = listObj._state.recordCountFormatted;};',
'if(listObj) listObj._state.paginated = false;',
'',
'if(listObj) listObj._state.highlight = {  };',
'if(listObj) listObj._state.whereClause = \'\';',
'if(listObj) listObj._state.whereParameters = \'\';',
'listObj._state.order = \'\';',
'\t\t',
'\t\tvar flagPersist = false;',
'\t\tif(typeof listObj._flagPersistDataOK != \'undefined\') { ',
'\t\t\tif(listObj._flagPersistDataOK) { ',
'\t\t\t\tvar data = listObj._data;',
'\t\t\t\tlistObj.persistToStorage({mode:\'populate\', data: data, submode: \'ListViewData\'});',
'\t\t\t}',
'\t\t}',
'\t\t',
'\t\t',
';',
'{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(\'LSTMESSAGE\',\'afterRenderComplete\',{});',
'',
'if(listObj._refreshStateMessages) listObj._refreshStateMessages();',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'',
'var listObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LIST1\');',
'if(listObj) listObj._state.recordCount = 0;',
'if(listObj) listObj._state.recordCountFormatted = \'0\';',
'if(listObj) listObj._state.lastBreakValue = \'<None>\';',
'if(listObj) listObj._state.pageCount = 0;',
'if(listObj) listObj._state.pageSize = 20;',
'if(listObj) {var ele = $(\'{UXPRERENDEREDALIAS}.LIST1.RECORDCOUNT\'); if(ele) ele.innerHTML = listObj._state.recordCountFormatted;};',
'if(listObj) listObj._state.paginated = false;',
'',
'if(listObj) listObj._state.highlight = {  };',
'if(listObj) listObj._state.whereClause = \'\';',
'if(listObj) listObj._state.whereParameters = \'\';',
'listObj._state.order = \'\';',
'\t\t',
'\t\tvar flagPersist = false;',
'\t\tif(typeof listObj._flagPersistDataOK != \'undefined\') { ',
'\t\t\tif(listObj._flagPersistDataOK) { ',
'\t\t\t\tvar data = listObj._data;',
'\t\t\t\tlistObj.persistToStorage({mode:\'populate\', data: data, submode: \'ListViewData\'});',
'\t\t\t}',
'\t\t}',
'\t\t',
'\t\t',
';',
'{UXPRERENDEREDALIAS}_DlgObj._list_executeEvent(\'LIST1\',\'afterRenderComplete\',{});',
'',
'if(listObj._refreshStateMessages) listObj._refreshStateMessages();',
'',
'',
'',
'var obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'obj._hasBeenRendered = false;',
'var obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LIST1\');',
'obj._hasBeenRendered = false;',
';',
'var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LSTMESSAGE\');',
'var __obj = {',
'};',
'if(lObj) $u.o.assign(lObj,__obj);;;',
'var lObj = {UXPRERENDEREDALIAS}_DlgObj.getControl(\'LIST1\');',
'var __obj = {',
'};',
'if(lObj) $u.o.assign(lObj,__obj);;',
'',
'',
'',
'',
'',
'',
'',
'',
'setTimeout(function() { },0);',
'{UXPRERENDEREDALIAS}_DlgObj._listsWithJSFuncDataSource = {};',
'',
'',
'{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onInitializeComplete\');',
'{UXPRERENDEREDALIAS}_DlgObj.initialized = true;',
'',
'',
'',
'',
';{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \t__args_c_MYUSERNAME: \'\', \t__args_n_COMPID: \'0\', \t__args_n_TPOIID: \'0\', \targValuesENC: \'7C3tO+HPao13/PscKxWu0UE5CwTgixkzpNbPSdxmwPt6gvNTRtFsjWf8VQTl6l0+0b0WheDrvjoyAIqnZWEJF5WVbZZKOldb9St6c7ebU0AFAtLj6HW2wA==\', \t__debugInfo: \'ssi-6014\' });//ssi-6014;',
';',
'',
'',
'setTimeout(function() { ;',
';',
'{UXPRERENDEREDALIAS}_DlgObj._onRenderComplete = function() { var a = {UXPRERENDEREDALIAS}_DlgObj._listControls;',
'if(typeof a != \'undefined\') { ',
'\tfor(var i = 0; i < a.length; i++) {',
'\t\tvar obj = {UXPRERENDEREDALIAS}_DlgObj.getControl(a[i])',
'\t\tif(obj._refreshStateMessages) obj._refreshStateMessages();',
'\t}',
'};',
'var flagStaticHTML = {UXPRERENDEREDALIAS}_DlgObj.__flagIsStaticHTML',
'if(typeof flagStaticHTML == \'undefined\') flagStaticHTML = false; ',
'if(flagStaticHTML) { ',
'',
'\t{UXPRERENDEREDALIAS}_DlgObj.ajaxCallback(\'\',\'\',\'a5dialogHelper_staticHTMLInitialCallback\')',
'}',
'',
'var href = window.location.href;',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({ \'locationHref\' : href}); ',
'',
'{UXPRERENDEREDALIAS}_DlgObj._runJSOnLoad(); {UXPRERENDEREDALIAS}_DlgObj._findActiveLayoutRule(); }; ',
'',
'var winObj = A5.windows.getFromElement({UXPRERENDEREDALIAS}_DlgObj.dialogId + \'.R1\');',
'if(winObj) { ',
'\tif(typeof winObj._uxComponents == \'undefined\') winObj._uxComponents = [];',
'\twinObj._uxComponents.push({UXPRERENDEREDALIAS}_DlgObj.dialogId);',
'\t',
'',
'\t',
'}',
';',
'var pObj = window[\'{UXPRERENDEREDALIAS}_PanelObj\'];',
'if(pObj) pObj.refresh(true);',
';\t',
'//this code ensures that content is shown in the mobile peview window even if the content does not use Panels',
'var eled = $(\'device.screen\')',
'if(eled) { ',
'\teled2 = eled.firstChild ',
'\teles = $(\'{UXPRERENDEREDALIAS}.R1\');',
'\ttry{eled2.appendChild(eles);}catch(e) { };',
'};',
'',
'{UXPRERENDEREDALIAS}_DlgObj.setStateInfo({\'__locationhref\':location.href})',
'',
'///////////',
'if({UXPRERENDEREDALIAS}_DlgObj.__restorePanelSizes) {{UXPRERENDEREDALIAS}_DlgObj.__restorePanelSizes();}',
'setTimeout(function(){ var pObj = window[\'{UXPRERENDEREDALIAS}_PanelObj\']; if(pObj) pObj.refresh();},100);;setTimeout(function() { if({UXPRERENDEREDALIAS}_DlgObj) {var obj = {UXPRERENDEREDALIAS}_DlgObj.getPanelObject();\t\tif(obj && obj.resize && typeof obj.resize == \'function\') obj.resize();\t\t\t}},100);',
'setTimeout(function() {',
'\t{UXPRERENDEREDALIAS}_DlgObj._executeEvent(\'onRenderComplete\'); ',
'\tvar ele = window.frameElement;',
'if (ele) {',
'\tvar panelCardName = $ga(ele,\'A5-PARENTPANEL\');',
'\tvar flagDoResize = true;',
'\tvar flagResize = $ga(ele,\'A5-RESIZE\');',
'\tif(flagResize ==\'NO\') flagDoResize = false',
'\t',
'\tif(panelCardName) {',
'\t\tvar po = {UXPRERENDEREDALIAS}_DlgObj.getParentObject();',
'\t\tif(po) var pId = po.panelGetId(panelCardName,\'body\');',
'\t\tvar pEle = parent.$(pId);',
'\t\tele.style.width = \'100%\';',
'\t\tif(pEle) ele.style.height = pEle.style.height;',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc = function() {',
'\t\t\tvar ele = parent.$(this.getAttribute(\'CHILDUXIFRAME\'));',
'\t\t\tif(ele) ele.style.height = this.style.height;',
'\t\t }',
'\t\tparent.$e.add(pEle,\'a5resize\',{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc);',
'\t\tif(pEle) pEle.setAttribute(\'CHILDUXIFRAME\',ele.id);',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._onDestroy = function() { ',
'\t\t\tparent.$e.remove(pEle,\'a5resize\',{UXPRERENDEREDALIAS}_DlgObj._iframeResizeFunc);',
'\t\t}',
'\t} else if(flagDoResize) { ',
'\t\tele.style.width = \'100%\';',
'\t\tvar _height = ele.contentDocument.documentElement.scrollHeight + \'px\';',
'\t\tele.style.height = _height;',
'\t\tvar observer = new ResizeObserver(function(){',
'\t\t\tvar _height = ele.contentDocument.documentElement.scrollHeight + \'px\';',
'\t\t\tele.style.height = _height;',
'\t\t\t});',
'\t\tobserver.observe(ele.contentDocument.documentElement);',
'\t}',
'}',
';{UXPRERENDEREDALIAS}_DlgObj.refreshListData(\'LIST1\');',
'var options = {mode: \'incremental\'};{UXPRERENDEREDALIAS}_DlgObj.refreshListData(\'LSTMESSAGE\',options);',
';',
'\t{UXPRERENDEREDALIAS}_DlgObj.flagRenderComplete = true;',
'\tvar _flagPGApp = false;',
'\tif(typeof _phoneGapSettings == \'function\') {',
'\t\t_flagPGApp = true;',
'\t\t/*',
'\t\tif(typeof cordova == \'object\') {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = true;',
'\t\t} else {',
'\t\t\t{UXPRERENDEREDALIAS}_DlgObj._cordovaReady = false;',
'\t\t};',
'\t\t*/',
'\t};',
'',
'',
'',
'\t//alert(\'is a pg app: \' + _flagPGApp + \'  _cordovaReady: \' + {UXPRERENDEREDALIAS}_DlgObj._cordovaReady );',
'\tif(!_flagPGApp) {',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._restoreFromLocalStorage();',
'\t} else {',
'',
'\t\t//phonegap app, but phonegap may not yet be loaded',
'\t\t//alert(\'register the _restoreFormLocalStorage to fire when phonegap is ready\');',
'',
'\t\t{UXPRERENDEREDALIAS}_DlgObj._delayTillPhoneGapReady({UXPRERENDEREDALIAS}_DlgObj._restoreFromLocalStorage,{UXPRERENDEREDALIAS}_DlgObj);',
'\t}',
'',
' },0);',
' ',
' ',
' ',
';',
'setTimeout(function() { ',
'\tvar key = \'INSTANCEGUID_\' + {UXPRERENDEREDALIAS}_DlgObj.componentGUID;',
'\tvar instanceGuid = localStorage.getItem(key)',
'\tif(instanceGuid == null || instanceGuid == \'\' || typeof instanceGuid == \'undefined\') { ',
'\t\tvar instanceGuid = A5.UUID()',
'\t\tlocalStorage.setItem(key,instanceGuid)',
'\t} else { ',
'\t}',
'\t{UXPRERENDEREDALIAS}_DlgObj.instanceGUID = instanceGuid;',
'},0);',
';',
'',
'var o2 = \'portrait\';',
'if(window.innerHeight < window.innerWidth) o2 = \'landscape\';',
'{UXPRERENDEREDALIAS}_DlgObj._screen = {h: window.innerHeight, w: window.innerWidth, o: o2};',
'',
'{UXPRERENDEREDALIAS}_DlgObj._getOnlineStatus();',
'try {',
'$e.removeGroup(\'window_offline_event\');',
'$e.add(window,\'offline\',function() { if({UXPRERENDEREDALIAS}_DlgObj) {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'offline\') }, null,false,\'window_offline_event\');',
'$e.add(window,\'online\',function() {  if({UXPRERENDEREDALIAS}_DlgObj) {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'online\') }, null,false,\'window_offline_event\')',
'//window.addEventListener("offline",function() {  {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'offline\') });',
'//window.addEventListener("online",function() { {UXPRERENDEREDALIAS}_DlgObj._fireOnConnectionChangeEvent(\'online\') });',
'} catch(err){}',
'',
'',
'',
'setTimeout(function() {$e.execute(\'device.screen\',\'a5resize\')},1);',
';',
'',
'if({UXPRERENDEREDALIAS}_DlgObj.restoreListLayouts) {UXPRERENDEREDALIAS}_DlgObj.restoreListLayouts();',
'',
'},0);;',
'setTimeout(function() { },10);;',
'{UXPRERENDEREDALIAS}_DlgObj._activeLanguage = \'\';',
''].join('\n');
jsout = jsout.replace(/\{UXPRERENDERAJAXURL\}/g,'');
jsout = jsout.replace(/\{UXPRERENDEREDALIAS\}/g,go.alias);
jsout = jsout.replace(/\{UXPRERENDEROUTPUTDIV\}/g,go.dialog2Div);
;return jsout}; 
